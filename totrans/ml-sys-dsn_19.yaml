- en: 16 Ownership and maintenance
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 16 所有者和维护
- en: This chapter covers
  id: totrans-1
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 本章涵盖了
- en: The importance of proper system maintenance
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 正确系统维护的重要性
- en: Accountability as one of the key factors in building and maintaining a healthy
    machine learning system
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 责任感是构建和维护健康机器学习系统的一个关键因素
- en: The “bus factor” and the tradeoff between teams’ efficiency and redundancy
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: “巴士因素”以及团队效率与冗余之间的权衡
- en: The fundamental importance of properly arranged documentation
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 正确安排文档的基本重要性
- en: The deceptive appeal of complexity
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 复杂性的欺骗性吸引力
- en: The competent programmer is fully aware of the limited size of his own skull.
    He therefore approaches his task with full humility and avoids clever tricks like
    the plague.— Edsger Dijkstra
  id: totrans-7
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 有能力的程序员完全清楚自己头脑的局限性。因此，他以完全谦卑的态度来处理任务，并像躲避瘟疫一样避免使用巧妙的技巧。——埃德加·迪杰斯特拉
- en: Throughout the last 15 chapters, we have tried to keep this book organized as
    an extended, in-depth checklist that you can always refer to at any stage in the
    design of your machine learning (ML) system. But these seemingly obvious recommendations
    are harder to follow than you may think.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 在过去的15章中，我们一直试图将这本书组织成一个扩展的、深入的清单，你可以在设计你的机器学习（ML）系统过程中的任何阶段随时参考。但这些看似明显的建议比你想象的更难遵循。
- en: Building an ML system from scratch and especially operating an existing solution
    is a process so complex and all-demanding, we’re guaranteed to stumble, blunder,
    hit a few bumps, and compromise some of the principles on our road to bringing
    value to a business. Being imperfect humans, we are also aware that sometimes
    we may allow ourselves to ignore some of our own tips.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 从零开始构建ML系统，尤其是运营现有解决方案，是一个如此复杂和苛刻的过程，我们肯定会犯错、跌倒、遇到一些障碍，并在为业务创造价值的过程中妥协一些原则。作为不完美的人类，我们也意识到有时我们可能允许自己忽略一些自己的建议。
- en: 'Indeed, sometimes you may see or end up with a system that is not following
    the principles we advocate in the book, and reasons for that may vary in a vast
    number of ways: some details could have been missed, the company may have changed
    priorities and constraints, the system really needs some refresh because its original
    assumptions are not valid anymore, and so on.'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 事实上，有时你可能看到或最终得到一个不遵循我们在书中倡导的原则的系统，其原因可能以无数种方式变化：一些细节可能被遗漏，公司可能已经改变了优先级和约束条件，系统可能确实需要更新，因为其原始假设不再有效，等等。
- en: Usually, it’s even more mundane, as the people who originally designed and built
    the systems tend to change jobs. More than that, they may leave the company before
    they finish building the system; this is the nature of things. With that in mind,
    ownership and maintenance is not something we only need to think about later but
    rather is the cornerstone of the whole system to be ingrained from the very beginning.
    In this process, however, there is the possibility and risk of becoming too attached
    to your creation, and this is something that should be avoided. The system should
    not be viewed as part of its author, and you should detach yourself and your ego
    from your design to deliver the best possible solution.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 通常，这甚至更加平凡，因为最初设计和构建系统的人往往会更换工作。更甚者，他们可能在完成系统建设之前离开公司；这是事物的本质。考虑到这一点，所有者和维护不是我们以后需要考虑的事情，而是整个系统的基石，需要从一开始就深入人心。然而，在这个过程中，有可能和风险是过于沉迷于自己的创造，这是应该避免的。系统不应被视为作者的一部分，你应该从你的设计和自我中解脱出来，以提供最佳可能的解决方案。
- en: 'To put that in three bullet points, it is essential to know the following at
    any moment in time:'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 用三个要点来概括，在任何时刻都至关重要：
- en: What is the area of responsibility behind every person involved in the project?
    Do we have any gaps in accountability/ownership?
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 每个参与项目的人背后的责任区域是什么？我们在责任/所有权方面是否有任何缺口？
- en: How many people have specific knowledge? Do we have enough redundancy?
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 有多少人具有特定的知识？我们是否有足够的冗余？
- en: Where is available documentation, and what components of the system are documented?
    Will anyone outside of the responsible team be able to run the system?
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 可用文档在哪里，系统的哪些组件被记录在案？负责团队之外的人能否运行该系统？
- en: 'To some extent, the design document helps answer (although only partially and
    not always directly) these questions. That means only one thing: we must focus
    on these aspects to avoid any woeful consequences in the future. After all, the
    most important thing is to build and maintain a product that will meet your demands
    and bring value.'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 在一定程度上，设计文档有助于回答（尽管只是部分且不总是直接）这些问题。这意味着只有一个结论：我们必须关注这些方面，以避免未来出现任何令人遗憾的后果。毕竟，最重要的是构建和维护一个能满足你的需求并带来价值的产品。
- en: In this chapter, we cover the essential basics of making the system long-lasting
    and robust to human-induced changes.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们涵盖了使系统持久和稳健应对人为变化的必要基础知识。
- en: 16.1 Accountability
  id: totrans-18
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 16.1 责任制
- en: In earlier chapters of this book, we mentioned the importance of involving a
    variety of stakeholders in the information-gathering process who will provide
    critical input into the preparation stage of ML system development.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 在本书的前几章中，我们提到了在信息收集过程中涉及各种利益相关者的必要性，他们将为机器学习系统开发的准备阶段提供关键输入。
- en: As the project grows, enriches with new inputs, and evolves from a simple constant
    baseline to a series of tightly interconnected complex models, it will be gradually
    joined by new participants. Some of them will only join you for a short period
    of time and leave once their participation is no longer necessary (e.g., data
    labelers are vital at the dataset processing stage but fall off by the time of
    deployment), some of them will turn into permanent contributors until the system’s
    release, and a handful of people will eventually become what can be called the
    “core team” (i.e., your closest people on the project). These colleagues of yours
    (or representatives of external vendors, if that’s the case) will become the ones
    accountable for the end result and the stability of your system. And it is you
    who should keep in touch with them on a regular basis, or at least know them personally.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 随着项目的增长，不断吸收新的输入，并从简单的常量基线演变为一系列紧密相连的复杂模型，它将逐渐被新的参与者加入。其中一些人可能只会在短时间内加入你，一旦他们的参与不再必要（例如，数据标注者在数据集处理阶段至关重要，但在部署时就会减少），一些人将变成永久贡献者直到系统发布，而少数人最终将成为所谓的“核心团队”（即项目中最亲近的人）。这些同事（或如果是外部供应商的代表，则指他们）将成为对最终结果和系统稳定性负责的人。而你应当定期与他们保持联系，或者至少要认识他们。
- en: Knowing the areas of responsibility and the people assigned to these roles is
    crucial for the successful launch and future of any project or system. It may
    sound absurd, but it’s even more important for team members who are actually responsible
    for specific components to be aware of that. You would be surprised to know how
    many times person A was convinced that person B was accountable for a certain
    part of a project, while person B, in turn, was sure of the opposite. A classic
    illustration of such a case can be seen in figure 16.1.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 了解责任区域和分配给这些角色的个人对于任何项目或系统的成功启动和未来发展至关重要。这可能听起来很荒谬，但对于实际上负责特定组件的团队成员来说，了解这一点甚至更重要。你会惊讶地发现，有多少次A认为B对项目的某个部分负责，而B反过来又确信情况相反。这种情况的经典例子可以在图16.1中看到。
- en: '![figure](../Images/CH16_F01_Babushkin.png)'
  id: totrans-22
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/CH16_F01_Babushkin.png)'
- en: Figure 16.1 Explicit versus implicit approaches to involving people in the project
  id: totrans-23
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图16.1 明确与隐含方法在项目中对人的参与
- en: Being redundantly explicit is much more valuable than being implicit in the
    hopes that everyone is on the same page, and based on our experience, this approach
    is applicable as soon as there are three people on the project, let alone more
    team members involved. One of our favorite quotes on the subject comes from the
    Nobel Prize-winning physicist Richard Feynman. In his book *Surely You’re Joking,
    Mr Feynman!*”, he wrote
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 明确地重复说明比隐含地希望每个人都处于同一页面上更有价值，根据我们的经验，这种方法一旦项目中有三个人参与，就更适用，更不用说更多的团队成员了。关于这个主题，我们最喜欢的一句话来自诺贝尔物理学奖获得者理查德·费曼。在他的书《当然你在开玩笑，费曼先生！》中，他写道
- en: One of the first interesting experiences I had in this project at Princeton
    was meeting great men. I had never met very many great men before. But there was
    an evaluation committee that had to try to help us along, and help us ultimately
    decide which way we were going to separate the uranium. This committee had men
    like Compton and Tolman and Smyth and Urey and Rabi and Oppenheimer on it. I would
    sit in because I understood the theory of how our process of separating isotopes
    worked, and so they’d ask me questions and talk about it. In these discussions
    one man would make a point. Then Compton, for example, would explain a different
    point of view. He would say it should be this way, and he was perfectly right.
    Another guy would say, well, maybe, but there’s this other possibility we have
    to consider against it.
  id: totrans-25
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 在普林斯顿这个项目中，我第一次遇到的有趣经历之一是遇见了许多杰出人物。我以前从未遇见过这么多杰出人物。但有一个评估委员会必须试图帮助我们，并最终决定我们将如何分离铀。这个委员会上有康普顿、托尔曼、斯密思、尤里、拉比和奥本海默这样的人。我会坐下来，因为我理解我们分离同位素的过程的理论，所以他们就会问我问题并讨论它。在这些讨论中，一个人会提出一个观点。然后，比如康普顿会解释一个不同的观点。他会说应该是这样，而且他完全正确。另一个人会说，嗯，也许，但是还有其他可能性我们必须考虑。
- en: So everybody is disagreeing, all around the table. I am surprised and disturbed
    that Compton doesn’t repeat and emphasize his point. Finally, at the end, Tolman,
    who’s the chairman, would say, “Well, having heard all these arguments, I guess
    it’s true that Compton’s argument is the best of all, and now we have to go ahead.”
  id: totrans-26
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 所以每个人都不同意，围坐在桌旁。我很惊讶和不安，康普顿没有重复并强调他的观点。最后，在结束时，作为主席的托尔曼会说：“好吧，听了所有这些论点，我想康普顿的论点是所有中最出色的，现在我们必须继续前进。”
- en: It was such a shock to me to see that a committee of men could present a whole
    lot of ideas, each one thinking of a new facet, while remembering what the other
    fella said, so that, at the end, the decision is made as to which idea was the
    best—summing it all up—without having to say it three times. These were very great
    men indeed.
  id: totrans-27
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 看到一群人能够提出很多想法，每个人都想到了一个新的方面，同时记住其他人说过的话，最终决定哪个想法最好——总结所有这些——而不必说三遍，这对我来说是个很大的冲击。这些人确实非常伟大。
- en: If you don’t have a bunch of geniuses working on a national priority project,
    you better not rely on their internal understanding and say (or write!) things
    three times, sharing it with everyone and putting it where it is hard to miss
    them. Things like meeting minutes, follow-ups, updates, and syncs are essentially
    done for this sake.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你没有一帮天才在处理一个国家优先级项目，你最好不要依赖他们的内部理解，说（或写！）三遍，与每个人分享，并确保他们不容易错过。像会议记录、跟进、更新和同步这类事情本质上都是为了这个目的而做的。
- en: However, we have seen plenty of people abusing these principles, spending too
    much on meaningless syncs, turning the very concept of meetings into an industry-wide
    boogeyman. Those rituals, artifacts, or whatever you call them don’t require much
    time and don’t have to be done just because it’s written in the textbooks but
    rather serve the specific goal of maintaining focus. Not using them, as well as
    using them too much, might seriously affect performance and sustainability in
    the long run. We are convinced documentation is very undervalued, and its importance
    is severely underestimated.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，我们看到了很多人滥用这些原则，在无意义的同步上花费太多，将会议的概念变成了整个行业的噩梦。那些仪式、遗物或无论你叫它们什么，都不需要花费太多时间，也不必仅仅因为它们写在了教科书中就去做，而是为了实现保持专注的具体目标。不使用它们，以及过度使用它们，都可能严重影响长期的表现和可持续性。我们坚信文档被严重低估了，其重要性被严重低估。
- en: 'Areas of accountability should be written down for explicit and unambiguous
    understanding across the team. There may be various levels of formality—from the
    startup-friendly “Alice is fully responsible for making system X work” to a complex
    multipage hierarchy. A fairly balanced approach will involve using the simple
    yet powerful RACI matrix that splits involved people into four groups:'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 应对责任区域应该被记录下来，以确保团队对它们有明确和不含糊的理解。可能有各种正式程度——从创业友好的“爱丽丝完全负责让系统X工作”到复杂的跨页层次结构。一种相当平衡的方法是使用简单而强大的RACI矩阵，将涉及的人员分为四个组：
- en: '*Responsible**—*The individual(s) who actually perform the task. Usual suspects:
    ML engineers.'
  id: totrans-31
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**负责**——*实际执行任务的个人（们）。常见人选：机器学习工程师*。'
- en: '*Accountable**—*The person ultimately answerable for the completion of the
    task, typically a manager or team leader. It is recommended that a single person
    accountable for every component should also have the authority to approve or reject
    the work. Usual suspects: a project lead or a senior engineer.'
  id: totrans-32
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*责任人*——*最终对任务完成负责的人，通常是经理或团队领导。建议每个组件的责任人应也有权批准或拒绝工作。常见角色：项目经理或高级工程师。'
- en: '*Consulted**—*Those whose opinions are sought, usually subject matter experts
    or stakeholders with a particular interest in the task. Usual suspects: subject
    matter experts or legal representatives.'
  id: totrans-33
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*咨询者*——*寻求其意见的人，通常是领域专家或对任务有特定兴趣的利益相关者。常见角色：领域专家或法律代表。'
- en: '*Informed**—*People who need to be kept up-to-date on the progress or decisions
    but do not directly contribute to the overall input. Usual suspects: front-end
    engineers.'
  id: totrans-34
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*知情者*——*需要了解进度或决策但并不直接贡献整体输入的人。常见角色：前端工程师。'
- en: For better or worse, there’s always room for gaps in accountability; thus, it
    makes sense to describe an explicit way of escalation—what can be done if the
    situation doesn’t match the matrix or other accountability-related artifact?
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 无论好坏，总会有责任上的空缺；因此，描述一种明确的升级方式是有意义的——如果情况不符合矩阵或其他与责任相关的工具，可以采取什么措施？
- en: One final and probably least favorite part about accountability is an on-call
    rotation. Being on call means that a specific person is responsible for responding
    to any critical incidents during their shift. They must be ready to react quickly
    in case of emergency, usually within 30 to 60 minutes. The rotation part implies
    this duty is typically shared among team members and changes on a regular basis.
    For example, one person might be on call for a week and then pass the duty to
    the next person for the following week (see figure 16.2).
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 关于责任的一个最终且可能不太受欢迎的部分是应急班次。处于应急状态意味着在班次期间，有特定的人负责响应任何关键事件。他们必须准备好在紧急情况下迅速反应，通常在30到60分钟内。轮换部分意味着这项职责通常由团队成员共享，并定期变更。例如，某个人可能一周处于应急状态，然后在下周将职责转交给下一个人（见图16.2）。
- en: '![figure](../Images/CH16_F02_Babushkin.png)'
  id: totrans-37
  prefs: []
  type: TYPE_IMG
  zh: '![图](../Images/CH16_F02_Babushkin.png)'
- en: Figure 16.2 On-call shifts are a necessary measure against team burnout.
  id: totrans-38
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图16.2 应急班次是防止团队过劳的必要措施。
- en: An on-call schedule usually emerges over the company’s growth. Those who started
    their careers or had experience in smaller companies may recall that there’s no
    need for rotation in those environments, as everyone is on call all the time,
    with incidents being handled by whoever is available at the moment. However, at
    some point, this approach becomes unmanageable, when the responsibility is blurred
    between team members, leading to incidents being managed by everyone and no one
    at the same time. As soon as you start to pick up signals of such behavior, it’s
    time to formalize an on-call rotation. Later, there might be a need to have a
    dedicated on-call team structuring the rotation into tiers like L1/L2/L3 and so
    on.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 应急班次通常在公司成长过程中出现。那些在职业生涯早期或在较小的公司有经验的人可能还记得，在那个环境中不需要轮换，因为每个人都是应急状态，事件由当时可用的任何人处理。然而，在某个时候，这种方法变得难以管理，当团队成员之间的责任模糊时，会导致事件由每个人同时管理，又没有人管理。一旦你开始注意到这种行为，就是时候正式化应急班次了。后来，可能需要有一个专门的应急班次团队，将轮换结构化为L1/L2/L3等级等。
- en: But even if your on-call schedule is up and running, there may be other reasons
    for overloading the whole team. Arseny worked for a company during its early evolution
    stage, where he faced system incidents that couldn’t be solved at all simply because
    he had no clue what systems were even affected. This was a frustrating experience
    until the engineers who had built and maintained those systems finally wrote solid
    cookbooks with recommendations on typical problems. Some tech debt was cleared,
    and on-call shifts transformed from endless nightmares to a regular duty—not the
    most comfortable one but at least tolerable. When L1 incidents became owned by
    a dedicated team, the amount of time spent on call by the ML team was reduced
    even further.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 即使你的值班时间表正在运行，也可能有其他原因导致整个团队超负荷工作。Arseny曾在一家处于早期发展阶段的公司工作，他面临了一些系统事件，由于他根本不知道哪些系统受到影响，这些问题根本无法解决。这是一次令人沮丧的经历，直到那些构建和维护这些系统的工程师最终编写了包含典型问题建议的稳固的食谱。一些技术债务得到了清理，值班班次从无尽的噩梦转变为常规任务——虽然不是最舒适的，但至少是可以忍受的。当L1事件由一个专门的团队负责时，机器学习团队值班的时间进一步减少。
- en: Obviously, being pinged at 3:00 am on a Saturday is not ideal, which probably
    creates additional incentives to build a robust and well-monitored system, which
    could help minimize problems and build a schedule in a way that people know in
    advance the on-call “roster” and shift times. Any engineer who doesn’t see the
    value in proper logging and observability should be put on call for a long enough
    period to change their mind.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 显然，周六凌晨3点被叫醒并不是理想的情况，这可能会产生额外的动力去构建一个健壮且监控良好的系统，这有助于最小化问题，并以人们事先知道的方式制定值班“名单”和班次时间。任何看不到适当日志和可观察性价值的工程师都应该被安排足够长时间的值班，以改变他们的想法。
- en: We believe that a person responsible for system design and implementation is
    also responsible for the system’s maintenance and support. They know the details
    better than anyone else, and they can forecast corner cases and suggest shortcuts
    to fix them. It doesn’t mean they have to be the only person on call, but they
    should prepare the system for the on-call rotation and provide the on-call team
    with the necessary tools and documentation.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 我们相信，负责系统设计和实施的人也应对系统的维护和支持负责。他们比任何人都更了解细节，并能预测边缘情况并提出解决问题的捷径。这并不意味着他们必须是唯一被召唤的人，但他们应该为值班轮换做好准备，并为值班团队提供必要的工具和文档。
- en: Typical tools include
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 常用的工具包括
- en: Logs, metrics, alerts, and dashboards
  id: totrans-44
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 日志、指标、警报和仪表板
- en: System and related infrastructure configuration
  id: totrans-45
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 系统和相关基础设施配置
- en: System source code and documentation
  id: totrans-46
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 系统源代码和文档
- en: Access to production data is a bit trickier. It’s not always necessary to have
    access to production data to fix a problem; we have witnessed cases when privacy
    policies limit access. However, it’s usually good to have access to the production
    data to investigate the problem and find the root cause. Otherwise, logs and metrics
    should be detailed enough to help with that.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 访问生产数据有些复杂。修复问题并不总是需要访问生产数据；我们见证过隐私政策限制访问的情况。然而，通常来说，访问生产数据以调查问题和找到根本原因是有益的。否则，日志和指标应该足够详细，以便帮助解决这个问题。
- en: There should always be a runbook containing comments on how to fix the most
    common problems and a list of people to escalate the problem to if needed (e.g.,
    there may be an outage on the vendor’s side, and an on-call engineer has to reach
    the CTO who can communicate with the vendor). Many problems occur with some cadence;
    they are reflections of either the tech debt or usage pattern. For example, imagine
    having a big customer with a spiky usage pattern, which causes the system to struggle
    with the load. For such a scenario, an on-call engineer may need a recipe on how
    to spin up additional instances of the system and how to scale it down when the
    load is back to normal.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 总应该有一个运行手册，其中包含如何修复最常见问题的注释以及如果需要升级问题的人员名单（例如，供应商方面可能发生故障，值班工程师需要联系可以与供应商沟通的CTO）。许多问题都有一定的节奏；它们是技术债务或使用模式的反映。例如，想象有一个大客户具有尖峰使用模式，这导致系统在负载下挣扎。对于这种情况，值班工程师可能需要一份关于如何启动系统额外实例以及如何在负载恢复正常时缩小规模的食谱。
- en: 'Arising production problems provoke two derivatives: solving and learning.
    To avoid facing the same mistake repeatedly, make sure to set up a process of
    learning from failures. This can be arranged through retrospectives and postmortems.
    We recommend following the principle of *proportional response*—a set of postincident
    actions that should be sized similarly to the failure effect adjusted for a chance
    of a similar failure in the future. Some incidents are only worth a 10-minute
    discussion and adding a paragraph in the runbook. Arseny once triggered an outage
    so large that a CTO had to start an initiative named “Race for Reliable Releases,”
    which involved every engineering team in the company and improved the reliability
    across all systems, not only the ML system Arseny successfully broke.'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 出现的生产问题会引发两个衍生品：解决和学习。为了避免反复面对同样的错误，请确保建立一个从失败中学习的流程。这可以通过回顾和事后分析来安排。我们建议遵循**比例响应**原则——一套针对事件后采取的行动，其规模应与失败影响相似，并考虑到未来可能发生类似失败的机会。有些事件只需10分钟的讨论，并在操作手册中添加一段内容。Arseny曾经触发了一次大规模的故障，以至于CTO不得不启动一个名为“可靠发布竞赛”的倡议，涉及公司中的每个工程团队，并提高了所有系统的可靠性，而不仅仅是Arseny成功破坏的机器学习系统。
- en: 16.2 Bus factor
  id: totrans-50
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 16.2 **公交车因素**
- en: The bus factor is a measure of the risk of a project being disrupted by the
    loss of a single team member. The term *bus factor* comes from the hypothetical
    scenario of a team member being hit by a bus, which would suddenly and unexpectedly
    remove them from the project.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: '**公交车因素**是一个衡量项目因单个团队成员的丢失而中断风险的指标。术语**公交车因素**来源于一个假设场景，即团队成员被公交车撞到，这会突然且意外地使他们从项目中消失。'
- en: 'The CAP theorem states that any distributed data store can only offer two of
    the following three characteristics:'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: '**CAP定理**指出，任何分布式数据存储只能提供以下三个特性中的两个：'
- en: '*Consistency**—*Every read request receives the most up-to-date response or
    an error.'
  id: totrans-53
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**一致性**——每个读取请求都收到最新的响应或错误。'
- en: '*Availability**—*Every request receives a valid response, but with no assurance
    that it contains the most recent data.'
  id: totrans-54
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**可用性**——每个请求都收到有效的响应，但没有任何保证它包含最新的数据。'
- en: '*Partition tolerance**—*The system continues to operate even if communication
    between nodes is disrupted or lost.'
  id: totrans-55
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**分区容错**——即使节点间的通信被中断或丢失，系统仍然继续运行。'
- en: When a network partition failure occurs, a decision must be made between canceling
    the operation to enhance consistency at the cost of availability or proceeding
    with the operation to maintain availability while potentially compromising consistency.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 当发生网络分区故障时，必须在取消操作以增强一致性但牺牲可用性或继续操作以保持可用性但可能损害一致性之间做出决定。
- en: 'We consider the team structure very close to that but with different criteria:
    efficiency and redundancy. As computer science describes, redundancy means having
    extra or duplicate resources available to support the primary system. It is a
    backup or reserve system that can step in if the primary system fails. The reserve
    resources are redundant as they are not being used if everything is working correctly.'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 我们认为团队结构非常接近，但有不同的标准：效率和冗余。正如计算机科学所描述的，冗余意味着有额外的或重复的资源可用以支持主系统。这是一个备份或备用系统，如果主系统失败，它可以介入。备用资源是冗余的，因为如果一切正常，它们就不会被使用。
- en: note  Engineers often tend to solve organizational problems with technical solutions
    (in other words, treat people like software) just because that is what they excel
    at. Sometimes it is a good enough call because building software may indeed be
    simpler than getting along with people and aligning toward a challenging goal.
    However, a senior engineer should not be like a hammer seeing nails everywhere—they
    should choose the right tool for the problem, and sometimes one that is not technical
    at all.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: '**注意**工程师往往倾向于用技术解决方案来解决组织问题（换句话说，把人当作软件来对待），仅仅因为他们在这方面很擅长。有时这已经足够好了，因为构建软件可能确实比与人相处和对齐以实现具有挑战性的目标要简单。然而，高级工程师不应该像看到到处都是钉子的锤子一样——他们应该为问题选择合适的工具，有时甚至不是技术工具。'
- en: How can this redundancy/efficiency problem affect the team structure? From what
    we have seen, the company/team/project scheme usually evolves from being efficient
    to becoming redundant. However, neither being too efficient nor too redundant
    is beneficial.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 这种冗余/效率问题如何影响团队结构？从我们所见到的来看，公司/团队/项目方案通常是从高效发展到冗余。然而，过于高效或过于冗余都不利。
- en: 16.2.1 Why is being too efficient not beneficial?
  id: totrans-60
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 16.2.1 为什么过于高效并不好？
- en: If you are too efficient and cover multiple factors with only a few people,
    you are at risk. Every single person on the team is irreplaceable, not only thanks
    to their experience but, unfortunately, also because they work at full capacity.
    If anything happens to at least one of your team members, the company (or a project)
    is in trouble. The only way to handle problems that arise with no drops in overall
    efficiency is by acts of heroism that are not in any way scalable and thus are
    considered an antipattern ([https://mng.bz/YVyA;](https://mng.bz/YVyA;)see figure
    16.3).
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你过于高效，并且只有少数人覆盖多个因素，你就有风险。团队中的每个人都是不可替代的，这不仅是因为他们的经验，而且不幸的是，也因为他们以全负荷工作。如果至少有一个团队成员发生任何问题，公司（或项目）就会陷入困境。唯一能够处理不降低整体效率出现的任何问题的方法是通过英雄行为，这些行为在任何方式上都是不可扩展的，因此被视为反模式（[https://mng.bz/YVyA;](https://mng.bz/YVyA;)参见图16.3）。
- en: '![figure](../Images/CH16_F03_Babushkin.png)'
  id: totrans-62
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/CH16_F03_Babushkin.png)'
- en: Figure 16.3 The downside of ultraefficiency is extremely high vulnerability
    to external factors.
  id: totrans-63
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图16.3 极端效率的缺点是对外部因素极端脆弱。
- en: 16.2.2 Why is being too redundant not beneficial?
  id: totrans-64
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 16.2.2 为什么过度冗余并不有益？
- en: As opposed to efficiency, the main advantage of redundancy is extra capacity
    that provides reliability, security, room for improvement, and a margin to outlast
    a crisis. However, too much redundancy creates sloppiness, reduces trust between
    team members, and repels top performers, as it impairs the overall vibe and feeling
    of doing a meaningful and impactful job.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 与效率相比，冗余的主要优势是额外的容量，这提供了可靠性、安全性、改进的空间以及度过危机的余地。然而，过多的冗余会导致粗心大意，减少团队成员之间的信任，并排斥顶尖人才，因为它损害了整体的工作氛围和完成有意义且影响深远工作的感觉。
- en: The two examples here are obvious corner cases that should be avoided. As soon
    as you feel that the team is approaching its capacity limit, it is worth thinking
    about expanding, which will be the right solution in the long run, despite the
    increased costs at the current moment.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 这里的两个例子是明显的边缘情况，应该避免。一旦你觉得团队接近其容量极限，考虑扩展是值得的，尽管目前成本会增加，但这将是长期正确的解决方案。
- en: 'The same rule will work the other way around: have just enough capacity to
    avoid working to exhaustion on the one hand but to be well-armed for potential
    crunching at peak load times.'
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 同样的规则也可以反过来应用：一方面，有足够的容量避免过度劳累，另一方面，在高峰负载时间准备好应对潜在的危机。
- en: 16.2.3 When and how to use the bus factor
  id: totrans-68
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 16.2.3 何时以及如何使用公交车因素
- en: We need to keep the right balance between efficiency and redundancy, and the
    first step to controlling something is the ability to measure; one of the very
    simple and well-known metrics is the bus factor.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要在效率和冗余之间保持适当的平衡，控制某物的第一步是能够衡量；一个非常简单且广为人知的指标就是公交车因素。
- en: The bus factor is calculated by counting the number of team members that would
    need to be lost before the project would be unable to continue. For example, a
    project with a bus factor of 1 would be in serious trouble even if one (specific)
    team member was lost.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 公交车因素是通过计算在项目无法继续之前需要失去多少团队成员来计算的。例如，如果一个项目的公交车因素为1，即使失去一个（特定的）团队成员，项目也会陷入严重困境。
- en: 'Obviously, a bus factor of 1 is less than desirable, while a bus factor of
    10,000 might be too much (though this might happen if you need many people with
    relatively similar scope, e.g., customer support); the final number depends on
    many variables: project importance, budget constraints, deadlines, expected turnover,
    and project owner’s anxiety/confidence. But as soon as you have a list of people
    accountable for different parts of the system/project, you have everything you
    need to calculate a bus factor, which includes areas and people accountable for
    them. The next thing you need to do is to find out how many other people know
    this area well enough. As a rule of thumb, a person accountable for the area knows
    everybody else who can (to some extent) replace them. With that in mind, you can
    calculate the bus factor, assess potential risks, and make the necessary decisions
    on hiring, moving, or collaboration activities to cross-pollinate the knowledge
    and address the fragility you might have on the project.'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 显然，1 的公交车因素（bus factor）低于理想水平，而10000 的公交车因素可能过多（尽管这可能发生在你需要许多具有相对相似范围的人的情况下，例如客户支持）；最终数字取决于许多变量：项目重要性、预算限制、截止日期、预期周转率和项目所有者的焦虑/信心。但一旦你有一份负责系统/项目不同部分的负责人的名单，你就拥有了计算公交车因素所需的一切，这包括负责区域和负责人员。接下来你需要做的是找出有多少其他人足够了解这个领域。一般来说，负责该领域的人知道所有可以（在一定程度上）替代他们的人。考虑到这一点，你可以计算公交车因素，评估潜在风险，并做出必要的招聘、调动或协作活动决策，以传播知识并解决项目可能存在的脆弱性。
- en: Of course, we can’t label people in a discrete manner as “they know how the
    system or its component works” versus “they don’t.” Typically, there are shades
    of knowledge within a system, and even when it is not possible to keep many engineers
    informed about everything, it is possible to spread this knowledge partially.
    This usually manifests through design/code/documentation review, pair programming
    sessions, and open hours where key members share their expertise.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 当然，我们不能将人们以离散的方式标记为“他们知道系统或其组件是如何工作的”与“他们不知道”。通常，系统内部存在知识的不同层次，即使不可能让许多工程师了解所有事情，也有可能部分地传播这种知识。这通常通过设计/代码/文档审查、结对编程会议和开放时间来实现，关键成员在此分享他们的专业知识。
- en: This reasoning describes the balance between two criteria. Real decision-making,
    though, may and will require more criteria to take into account (e.g., not just
    team size but also its seniority balance and exposure to particular technologies).
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 这种推理描述了两个标准之间的平衡。然而，真正的决策可能需要考虑更多的标准（例如，不仅仅是团队规模，还包括其高级平衡和特定技术的接触）。
- en: 'For those who are interested in a simple yet practical framework on how to
    see the tradeoff between costs, system performance, and human capacity, we recommend
    getting familiar with the Rasmussen model for failures, nicely explained in this
    post: [https://mng.bz/GNqO](https://mng.bz/GNqO). Unlike the previous text, which
    focused on the team structure, the post reflects SRE’s perspective on the system
    tradeoffs: while people and hardware are very different, there are similar patterns
    in finding an optimal tradeoff.'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 对于那些对如何看到成本、系统性能和人力容量之间的权衡感兴趣的人来说，我们建议熟悉Rasmussen模型，该模型在本文中得到了很好的解释：[https://mng.bz/GNqO](https://mng.bz/GNqO)。与之前专注于团队结构的文本不同，这篇文章反映了SRE对系统权衡的看法：尽管人和硬件非常不同，但在寻找最佳权衡方面存在相似的模式。
- en: 16.3 Documentation
  id: totrans-75
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 16.3 文档
- en: We have already mentioned the importance of documentation. Unfortunately, documentation
    is usually highly underestimated and does not always receive the level of care
    and attention it deserves. Ironically, the word “documentation” often stands next
    to such words as “later,” “not now,” and “not urgent.” And when documentation
    is needed, it is usually either too late to prepare or extremely outdated.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经提到了文档的重要性。不幸的是，文档通常被高度低估，并且并不总是得到应有的关注和照顾。讽刺的是，“文档”这个词经常与“稍后”、“现在不”、“不紧急”等词语并列。而且当需要文档时，通常为时已晚，或者过于陈旧。
- en: The significance of documentation cannot be overstated. It serves as a means
    of knowledge transfer and onboarding new team members, helping to smooth the learning
    curve for newcomers and ensuring the system’s longevity. Comprehensive documentation
    allows someone outside of the responsible team to understand and run the system
    effectively.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 文档的重要性不容小觑。它作为知识转移和入职新团队成员的手段，有助于为新员工平滑学习曲线，并确保系统的长期运行。全面的文档允许负责团队之外的人有效地理解和运行系统。
- en: Campfire story from Valerii
  id: totrans-78
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 瓦列里营火故事
- en: 'I have worked in different companies: offline and online food retail, eCommerce
    marketplaces, social network companies, and fintech. One thing I am very proud
    of is that—regardless of the company size, market, and maturity—the systems and
    organizations I built were able to withstand my departure and continued successful
    operation. Cornerstones to this were a smooth learning curve for newcomers, extensive
    documentation and thorough integration with other departments, and people knowing
    who was accountable for specific parts.'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 我在不同的公司工作过：线下和线上食品零售、电子商务平台、社交网络公司以及金融科技公司。我非常自豪的一点是——无论公司规模、市场和发展成熟度如何——我所建立的系统和组织都能够经受住我的离职并继续成功运营。这其中的基石包括为新员工提供平滑的学习曲线、广泛的文档以及与其他部门的彻底整合，以及让每个人都知道谁负责特定的部分。
- en: Once I received a message from my former peer at a big tech company asking how
    to reproduce a specific system component (a language model capable of generating
    synthetic reviews for sold items). My answer was brief—the documentation for that
    project is available under a specific tag, and it was! (Frankly, he didn’t even
    need me to find that out.) And not only was it available, but you could use it
    to reproduce the whole deployment process with a single command or inspect the
    code repo and datasets if needed.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 有一回，我收到了一位来自大型科技公司的前同事的消息，询问如何重现一个特定的系统组件（一个能够为销售商品生成合成评论的语言模型）。我的回答简短——那个项目的文档可以在特定的标签下找到，而且确实找到了！（坦白说，他甚至不需要我帮忙找到。）而且不仅找到了，你还可以使用它通过单个命令重现整个部署过程，或者如果需要的话，检查代码库和数据集。
- en: Here is a very different example. Once I worked at a company where we had to
    re-create an on-chain analysis of the Bitcoin blockchain, which had initially
    been done 2 years ago, but some sources had changed and had to be replaced/updated.
    Unfortunately, there was almost no documentation, and what should have taken 2
    weeks at most consumed almost 3 months (on-chain analysis is not very straightforward;
    for example, you might send 0.1 BTC, but it will look like you sent 1 and received
    0.9, which is very different from the actual situation). A short time after this
    project was finished, most of the team members working there were laid off, alongside
    30% of the company’s workforce. That was the second layoff within 6 months. Combined,
    they shrank the company’s population by almost 60%. It is hard to say if the primary
    reason for that was the lack of documentation, but I am sure that reinventing
    the wheel (in this case, retaking the same step anew) repeatedly is not the most
    efficient way of spending resources. That is why caching is so widespread in computer
    science. Unfortunately, the layoff happened when the project was finished, but
    the documentation wasn’t yet done.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 这里有一个非常不同的例子。有一回我在一家公司工作，我们必须重新创建比特币区块链的链上分析，这最初是在2年前完成的，但一些来源已经改变，需要替换/更新。不幸的是，几乎没有文档，原本最多只需要两周就能完成的工作几乎消耗了3个月的时间（链上分析并不简单；例如，你可能会发送0.1BTC，但它看起来像你发送了1BTC并收到了0.9BTC，这与实际情况非常不同）。在这个项目完成后不久，那里的大部分团队成员都被裁员，公司员工总数的30%也被裁掉。这是6个月内的第二次裁员。合计，他们几乎将公司的员工人数减少了60%。很难说主要原因是否是缺乏文档，但我确信反复重新发明轮子（在这个案例中，重新走同样的步骤）并不是最有效率的资源利用方式。这就是为什么缓存在计算机科学中如此普遍。不幸的是，裁员发生在项目完成后，但文档还没有完成。
- en: Documentation also helps to achieve higher reliability by enabling smoother
    transitions when team members leave (bus factor) or new members join. Moreover,
    documentation facilitates collaboration across different departments and stakeholders,
    fostering a shared understanding of the system (accountability) and keeping each
    engineer more autonomous, thus agentic and productive.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 文档还有助于在团队成员离职（人员冗余）或新成员加入时实现更平滑的过渡。此外，文档促进了不同部门和利益相关者之间的协作，促进了系统（责任）的共享理解，并使每个工程师更加独立，从而更加主动和高效。
- en: While it may require additional time and effort upfront, documentation ultimately
    saves resources in the long run. It reduces the reliance on tribal knowledge,
    prevents the repetition of work, and minimizes the risk of costly errors and delays
    due to a lack of information. Documenting processes, procedures, configurations,
    and best practices empowers the team to work more efficiently and provides a foundation
    for continuous improvement. It should be prioritized from the beginning and not
    considered an afterthought. By acknowledging the importance of documentation and
    dedicating the necessary resources, teams can build resilient systems that can
    adapt to changes and continue to deliver value over time.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然一开始可能需要额外的时间和精力，但文档最终在长期中节省了资源。它减少了部落知识的依赖，防止了工作的重复，并最小化了由于信息不足而导致的高成本错误和延迟的风险。记录流程、程序、配置和最佳实践使团队能够更有效地工作，并为持续改进提供了基础。它应该从一开始就优先考虑，而不是被视为事后之想。通过承认文档的重要性并投入必要的资源，团队能够构建能够适应变化并随着时间的推移持续提供价值的弹性系统。
- en: To some extent, our whole book is dedicated to why and how to write a particular
    sort of documentation, which captures important information about the system’s
    design, architecture, implementation details, and operational procedures. But
    a design document is a very specific piece of documentation and does not aim to
    become a holistic text covering all aspects of the system but rather an overview
    that helps to sync the team of system builders and stakeholders. That said, there
    is always space for other documents, including
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 在一定程度上，我们整本书都是致力于探讨为什么以及如何编写特定类型的文档，这些文档能够捕捉到关于系统设计、架构、实现细节和操作流程的重要信息。但设计文档是非常具体的一份文档，其目标不是成为涵盖系统所有方面的全面文本，而是一个概述，有助于同步系统构建者和利益相关者的团队。话虽如此，总还有空间为其他文档留出位置，包括
- en: '*User manuals and guides* that explain how to use a system and provide step-by-step
    instructions for common tasks, such as data preparation, model training, and prediction'
  id: totrans-85
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*用户手册和指南* 解释如何使用系统，并提供常见任务（如数据准备、模型训练和预测）的逐步说明'
- en: '*Cookbooks* that suggest simple ways to reach a goal using the system and provide
    code snippets, data examples, and specific steps to reach a target outcome'
  id: totrans-86
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*操作手册* 提供使用系统达成目标的方法，并提供代码片段、数据示例和达到目标结果的特定步骤'
- en: '*Low-level technical specifications* and *API documentation* for developers
    that describe the underlying technical details of an ML system and give guidance
    on how to interact with the system on a programming level using functions and
    APIs'
  id: totrans-87
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*低级技术规范* 和 *API 文档*，为开发者描述机器学习系统的底层技术细节，并指导如何使用函数和API在编程层面上与系统交互'
- en: '*Installation and configuration guides* that give instructions on how to set
    up and finetune ML environments, as well as explain dependencies, installation
    steps, and options for configuring software'
  id: totrans-88
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*安装和配置指南*，提供如何设置和微调机器学习环境、解释依赖关系、安装步骤以及配置软件的选项'
- en: '*FAQs and troubleshooting guides* that address frequently asked questions related
    to using ML tools and suggest solutions or workarounds for common problems you
    may face during training, testing, or deployment'
  id: totrans-89
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*常见问题解答和故障排除指南*，针对使用机器学习工具时遇到的一些常见问题，提出解决方案或替代方案，以解决您在训练、测试或部署过程中可能遇到的问题'
- en: '*Release notes* that detail changes applied in new software versions; explain
    new features, bug fixes, performance improvements, or known problems; and inform
    users about new releases and their impact on the general workflow'
  id: totrans-90
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*版本发布说明* 详细说明新软件版本中应用的变化；解释新功能、错误修复、性能改进或已知问题；并通知用户关于新版本及其对整体工作流程的影响'
- en: '*Previous incident investigation reports* that analyze and document root causes
    of past problems or failures, share lessons learned and measures to avoid similar
    incidents, and improve system reliability and user confidence'
  id: totrans-91
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*以往事件调查报告* 分析并记录过去问题或失败的根本原因，分享经验教训和避免类似事件采取的措施，以提高系统可靠性和用户信心'
- en: Investing time and effort in creating and maintaining documentation from the
    outset helps teams mitigate risks associated with knowledge gaps and dependencies
    on specific individuals. In the course of the book, you have seen two design documents
    that we hope have given you a good overview of the described systems.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 从一开始就投入时间和精力来创建和维护文档，有助于团队减轻与知识差距和依赖特定个人相关的风险。在本书的编写过程中，您已经看到了两份设计文档，我们希望这些文档能为您提供关于所描述系统的良好概述。
- en: 16.4 Complexity
  id: totrans-93
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 16.4 复杂度
- en: Make everything as simple as possible, but not simpler.— Attributed to Albert
    Einstein
  id: totrans-94
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 尽可能使一切尽可能简单，但不能更简单。——据说是爱因斯坦所说
- en: 'According to the second law of thermodynamics, the entropy of an isolated system
    left to spontaneous evolution cannot decrease with time. While originally *entropy*
    was a term used for physics, it was later adapted by information theory with almost
    the same meaning: entropy quantifies the amount of uncertainty or randomness.'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 根据热力学第二定律，一个孤立系统在自发演化过程中，其熵随时间不能减少。虽然最初“熵”是一个用于物理学的术语，但它后来被信息理论所采用，几乎具有相同的意义：熵量化了不确定性或随机性的数量。
- en: 'Metaphorically speaking, software and ML systems follow the very same law:
    during time, entropy can only increase. At some point, it becomes too hard to
    handle, and that’s why old systems are often decomposed into sets of smaller systems
    (remember the fundamental theorem of software engineering from section 13.1) to
    be maintainable by teams of decently intelligent people, not generational talents.
    Adding a new level of abstraction “hides” the entropy but doesn’t really reduce
    its level across the whole stack.'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 比喻来说，软件和机器学习系统遵循相同的法则：随着时间的推移，熵只能增加。在某个时刻，它变得难以处理，这就是为什么旧系统通常被分解成一系列较小的系统（记住第13.1节中的软件工程基本定理），以便由一群相当聪明的人维护，而不是一代代的天才。添加一个新的抽象层次“隐藏”了熵，但并没有真正在整个堆栈中降低其水平。
- en: 'There are many pieces of collective consciousness stating similar ideas: the
    YAGNI (“You aren’t gonna need it”) approach from the extreme programming culture,
    the KISS (“Keep it simple, stupid”) principle that originated in the US Navy in
    the middle of the 20th century, and even Occam’s razor from as far back as medieval
    ages. All these ideas pursue the same goal: limit complexity.'
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 有许多集体意识碎片表达类似的想法：极限编程文化中的YAGNI（“你不需要它”）方法，20世纪中叶起源于美国海军的KISS（“保持简单，傻瓜”）原则，甚至还有从中世纪时代开始的奥卡姆剃刀。所有这些想法都追求同一个目标：限制复杂性。
- en: 'At the same time, the software engineering culture tends to land on the opposite
    side of the spectrum, as expressed in acronymic proverbs like DRY (“Don’t repeat
    yourself”). At first glance, those are controversial: following DRY suggests introducing
    more layers of abstraction, and that is exactly one of the (or rather the only)
    sources of complexity.'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 同时，软件工程文化倾向于光谱的另一端，正如DRY（“不要重复自己”）这样的缩写谚语所表达的那样。乍一看，这些是具有争议性的：遵循DRY意味着引入更多的抽象层，而这正是复杂性的一个（或者更确切地说，是唯一的一个）来源。
- en: 'Imagine writing a simple code snippet computing a well-known metric across
    multiple datasets. A typical code set would contain maybe three functions: one
    reads the data, the next one calculates the metric, and the final one orchestrates
    the execution, running both functions in a loop and saving the result.'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 想象编写一个简单的代码片段，计算多个数据集上的一个众所周知的指标。一个典型的代码集可能包含大约三个函数：一个读取数据，下一个计算指标，最后一个协调执行，在循环中运行这两个函数并保存结果。
- en: 'Now, let’s imagine two sides of the spectrum: too-simplistic code on the one
    hand and overcomplicated code on the other hand, which execute the same thing.
    The former could be written by a person who doesn’t know much about loops and
    functions; they would just write it by instruction: read file A, calculate metric
    for A, save metric for A, read file B, etc. Overcomplicated code would contain
    some metaprogramming and other complex patterns. While they are completely different
    in nature, both would make the code readability worse.'
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们想象光谱的两端：一方面是过于简单的代码，另一方面是过于复杂的代码，它们执行相同的事情。前者可能是由一个对循环和函数知之甚少的人编写的；他们只是按照指示编写：读取文件A，计算A的指标，保存A的指标，读取文件B，等等。过于复杂的代码将包含一些元编程和其他复杂模式。虽然它们在本质上完全不同，但两者都会使代码的可读性变差。
- en: 'This is a trivial example you can find in almost every software engineering
    textbook that teaches how to write clean code. But the same principle is applicable
    on a larger scale. Imagine solving the following problem: your company wants to
    help the customer support team prioritize the most urgent cases to help the most
    unhappy customers first.'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 这是一个在几乎每本教授如何编写干净代码的软件工程教科书中都能找到的简单示例。但同样的原则也适用于更大的规模。想象一下解决以下问题：你的公司想要帮助客户支持团队优先处理最紧急的案件，以便首先帮助最不满意的客户。
- en: A typical solution for this problem these days would be to use a foundation
    large language model with a tailored prompt to classify messages into several
    urgency buckets. Before the large language model revolution, the proportional
    baseline would be to make a simplistic model (like a logistic regression on top
    of a bag of words) to run the classification so it covers the majority of urgent
    messages. It would also need some engineering efforts (e.g., building data pipelines
    to fetch the training set and labeling it with the customer support team, connecting
    the model with customer service software to propagate these labels and visualize
    them in the UI, etc.).
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 目前解决这个问题的典型方案是使用一个定制的提示来对消息进行分类，将其归入几个紧急程度不同的类别。在大语言模型革命之前，比例基线是创建一个简单的模型（例如在词袋模型上进行的逻辑回归）来进行分类，以便覆盖大多数紧急消息。这还需要一些工程努力（例如，构建数据管道以获取训练集，并使用客户支持团队进行标记，将模型与客户服务软件连接起来以传播这些标签并在UI中可视化它们等）。
- en: A deviation into unreasonable simplicity would be to build a baseline with several
    ifs and regular expressions. This solution will definitely work for a while, but
    relatively soon your colleagues will be as unhappy as a customer who paid for
    the product twice because a glitch requested the company to roll back the transaction,
    and for some unclear reason, your model classified the ticket as “low priority.”
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 一种不合理简单化的偏差是构建一个包含多个条件和正则表达式的基线。这个解决方案肯定会在一段时间内有效，但相对很快，你的同事会像支付了两次产品的客户一样不高兴，因为一个错误请求公司回滚交易，并且由于某些不清楚的原因，你的模型将票据分类为“低优先级”。
- en: 'An overcomplicated solution can include many components united by the same
    word: *irrelevant*. You can bring multiple complicated natural language understanding
    models trained from scratch, cover them with some research to make them work in
    a few-shot scenario, and polish them with a calibration layer. Complexity can
    be not ML-specific but skewed into engineering as well: instead of having a couple
    of simple APIs, an engineer can use all the buzzwords they know of to make the
    system as fault-tolerant as spaceship firmware and as scalable as Google’s search
    engine, ignoring the fact it should only process dozens of messages per day.'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 一种过度复杂的解决方案可以包括许多由同一个词“不相关”连接的组件。你可以引入多个从头开始训练的复杂自然语言理解模型，用一些研究使它们在少量样本的情况下工作，并用校准层进行润色。复杂性可能不仅仅是机器学习特有的，也可能偏向于工程：而不是拥有几个简单的API，工程师可以使用他们知道的全部流行词汇来使系统具有与太空船固件一样容错性和与谷歌搜索引擎一样可扩展性，而忽略了它每天只需处理几十条消息的事实。
- en: All kinds of systems—including nonsoftware ones—suffer from complexity. The
    additional layer of software complexity is its constant evolution. When you’re
    building a house, you won’t be adding extra rooms on top of it a month after finishing
    the roof. Adding new features to a software system, though, is a much more commonly
    applied practice. The complexity of data-focused systems increases because of
    constant problems related to data drifts. ML systems are even more complex—some
    models are nonlinear black boxes by design, and this doesn’t make things easier.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 所有类型的系统——包括非软件系统——都受到复杂性的困扰。软件复杂性的额外层次在于其不断的演变。当你建造房子时，你不会在屋顶完工后一个月就在上面添加额外的房间。然而，向软件系统中添加新功能却是一种更为常见的做法。数据导向系统的复杂性增加是因为与数据漂移相关的持续问题。机器学习系统甚至更加复杂——一些模型设计上就是非线性黑盒，这并没有使事情变得更容易。
- en: 'At the very end of the book, we’d like to once again refer to chapters 2 and
    3, covering problem understanding and preliminary research. Some complexity is
    unavoidable, but a big share of excessive complexity is caused by misses on these
    stages: poor understanding of the problem, surface-level research, setting irrelevant
    goals, and not covering obvious risks from the very beginning. These can lead
    to a snowball of poor decisions and increased complexity.'
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 在书的最后，我们再次提到第2章和第3章，涵盖问题理解和初步研究。一些复杂性是不可避免的，但大量不必要的复杂性是由这些阶段的失误造成的：对问题理解不足、表面化研究、设定不相关的目标，以及从一开始就没有涵盖明显的风险。这些都可能导致一系列糟糕的决定和复杂性的增加。
- en: 'When you need to cross a river, a reliable paddle boat can be enough. You could
    even equip it with a motor to speed up your cross-river journeys, but there is
    no way of evolving this boat for transporting thousands of people across the ocean
    (see figure 16.4). At the same time, those who start assembling a cruise ship
    when the traveling distance does not exceed a couple of miles can never reach
    the goal. Many ML systems are doomed for reasons related to this metaphor: their
    designers either try to evolve a primitive system with bells and whistles to meet
    rather challenging goals or start building a spacecraft with no good reasoning
    and get fired even before the first phase of construction is ready.'
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 当你需要横渡河流时，一艘可靠的划船可能就足够了。你甚至可以给它装上马达来加速你的渡河之旅，但无法将这艘船进化成能够运送数千人横渡大洋的船只（见图16.4）。同时，那些在旅行距离不超过几英里时就着手组装邮轮的人永远无法达到目标。许多机器学习系统因为与这个比喻相关的原因而注定失败：他们的设计者要么试图将一个原始系统通过添加各种功能来满足相当具有挑战性的目标，要么在没有良好推理的情况下开始建造宇宙飞船，甚至在建设的第一阶段准备就绪之前就被解雇了。
- en: '![figure](../Images/CH16_F04_Babushkin.png)'
  id: totrans-108
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../Images/CH16_F04_Babushkin.png)'
- en: Figure 16.4 Just like a basic model will end up underperforming and failing
    to meet the project goals, an overkill solution will devour valuable resources
    of a business.
  id: totrans-109
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图16.4 正如一个基本模型最终会表现不佳并无法满足项目目标一样，过度设计的解决方案会消耗企业宝贵的资源。
- en: Campfire story from Arseny
  id: totrans-110
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 来自阿列克谢的篝火故事
- en: 'I failed the deadline of finalizing this chapter because I was too busy with
    my main job and because of my own smarty-pants decision in the past. Three years
    ago, I needed to test a part of the system that was supposed to run the model
    in two environments: locally and cloud-based. The test was straightforward: run
    the same thing in both spaces and assert the results are equal. But I was chasing
    to save some milliseconds and thus made two calls run concurrently in separate
    threads. That was smart and effective! Years passed, the codebase evolved, new
    features were shipped, the infrastructure changed a lot, and one of these infrastructural
    changes changed the way things are supposed to work in the cloud. So you could
    expect this test to start failing. However, Python exceptions in threads are not
    implicit, so a test failure in this situation leads to a barely relevant message.
    As a cherry on top, these tests were also executed concurrently, which hid the
    real problem even further. An unnecessary complexity took a full day of my work
    to uncover this problem.'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 我未能按时完成这一章的定稿，因为我忙于我的主要工作，并且因为我过去自己做出的聪明决定。三年前，我需要测试一个应该在两个环境中运行模型的部分系统：本地和基于云的环境。测试很简单：在两个空间中运行相同的内容，并断言结果相等。但我追求节省一些毫秒，因此让两个调用在单独的线程中并发运行。这很聪明，也很有效！几年过去了，代码库发生了演变，推出了新功能，基础设施发生了很大变化，其中这些基础设施变化之一改变了云中事物应有的工作方式。所以你可以预期这个测试开始失败。然而，Python线程中的异常不是隐式的，所以在这种情况下测试失败只会导致一个几乎无关紧要的消息。更糟糕的是，这些测试也是并发执行的，这进一步隐藏了真正的问题。一个不必要的复杂性让我花费整整一天的时间来揭露这个问题。
- en: 'This story omits some engineering details like non-typical CI configuration,
    but even when simplified, it demonstrates that there is no single root cause of
    this wasted time—it is more like death by a thousand cuts. As a popular list,
    “How Complex Systems Fail” ([https://how.complexsystems.fail/](https://how.complexsystems.fail/)),
    says, “Post-accident attribution to a ‘root cause’ is fundamentally wrong.” There
    was not a single poor decision but a combination of suboptimal choices. The combinatorics
    is not on your side: even when most of the decisions related to the system are
    optimal, an enormous number of combinations in a complicated system will lead
    to a growing number of incidents. All you can do is reduce this number together
    with the effect of each small failure.'
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 这个故事省略了一些工程细节，比如非典型性的持续集成配置，但即使简化后，它也表明这种浪费时间的根本原因不是单一的——它更像是千刀万剐的死亡。正如流行的列表“复杂系统如何失败”([https://how.complexsystems.fail/](https://how.complexsystems.fail/))所说：“事故后归因于‘根本原因’是根本错误的。”并不是一个糟糕的决定，而是一系列次优选择的结果。组合数学对你不利：即使与系统相关的决策大多数是最佳的，一个复杂系统中的巨大组合数量会导致越来越多的意外事件。你能做的只是减少这些数量，以及每个小故障的影响。
- en: '16.5 Maintenance and ownership: Supermegaretail and PhotoStock Inc.'
  id: totrans-113
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 16.5 维护与所有权：超级大零售和PhotoStock Inc.
- en: Throughout the book, we have concluded each chapter with a case study illustrating
    the chapter’s relevant design-document section for Supermegaretail and PhotoStock
    Inc. This makes little sense in this case, as it would have required making up
    a couple dozen fake first and last names. We limit ourselves to general considerations
    about how maintenance would go in both examples.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 在整本书中，我们每章都以一个案例研究结束，展示了Supermegaretail和PhotoStock Inc.的相关设计文档部分。在这个案例中，这样做意义不大，因为这需要虚构几十个假的前后名字。我们只限于对如何在两个例子中进行维护的一般性考虑。
- en: Since Supermegaretail is a large corporation with thousands of employees and
    has a high level of bureaucratization and complex work processes, while its key
    business units are predominantly nontechnical, an important role in a project’s
    success lies in the successful coordination of all stages with stakeholders at
    each level of the hierarchy. Thus, the basis for the effective postrelease operation
    of the system would be a detailed RACI matrix that would include the company’s
    employees involved in the project, as well as lists of sign-offs from the delivery
    team and executive and business teams.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 由于Supermegaretail是一家拥有数千名员工的大型企业，官僚化程度高，工作流程复杂，而其关键业务部门主要是非技术性的，因此，在项目成功中扮演着重要角色的是与每个层级利益相关者的所有阶段的成功协调。因此，系统有效发布后的基础将是一个详细的RACI矩阵，包括参与项目的公司员工，以及交付团队、执行团队和业务团队的签字清单。
- en: On the other hand, PhotoStock Inc. is a fairly small, purely tech-based company,
    and the specificity of custom search engines working with millions of images implies
    continuous load on the system with regular peak loads. The search engine is both
    an ML-heavy and infrastructure-heavy project. As highlighted before, it requires
    extensive cross-team collaboration. Given that there are four core components
    (API handlers, index, ranking models, internal tools), we would want to make sure
    that
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 另一方面，PhotoStock Inc.是一家相当小、完全基于技术的公司，与数百万图像一起工作的定制搜索引擎的特定性意味着系统上持续有负载，并且有定期的峰值负载。搜索引擎是一个既依赖机器学习又依赖基础设施的项目。正如之前所强调的，它需要广泛的跨团队合作。鉴于有四个核心组件（API处理器、索引、排名模型、内部工具），我们希望确保
- en: There is a senior engineer directly responsible for each component.
  id: totrans-117
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 每个组件都有一个直接负责的高级工程师。
- en: Those engineers have a fair visibility of other components.
  id: totrans-118
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 这些工程师对其他组件有相当的了解。
- en: 'With that in mind, two levels of on-call rotation would be the optimal solution:'
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 考虑到这一点，两级值班轮换将是最佳解决方案：
- en: The primary on-call engineer is first to respond to any incident.
  id: totrans-120
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 主要的值班工程师是第一个响应任何事件的。
- en: The primary on-call engineer can escalate specific problems to component on-call
    engineers.
  id: totrans-121
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 主要的值班工程师可以将特定问题升级到组件值班工程师。
- en: As we said back in chapter 4, the design document is a living thing, and the
    maintenance section is to be added and filled in last, not only because, at this
    stage, you have a complete vision of your ML system but also because by this point
    you have managed to build connections with representatives of other teams and
    units and have an understanding which personalities will be included in the working
    group of your project.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 正如我们在第4章所说的，设计文档是一个活生生的东西，维护部分是最后添加和填写的，这不仅是因为在这个阶段，你对你的机器学习系统有一个完整的愿景，而且还因为到这个时候，你已经设法与其他团队和单位的代表建立了联系，并了解哪些个性将包括在你的项目工作组中。
- en: Summary
  id: totrans-123
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 摘要
- en: A person responsible for system design and implementation is also responsible
    for the system’s maintenance and support.
  id: totrans-124
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 负责系统设计和实施的人也负责系统的维护和支持。
- en: Be sure to know the areas of responsibility and the people assigned to these
    roles. Even more importantly, be explicit in reminding those people of their respective
    roles, as it is much more valuable than being implicit in the hopes that everybody
    is on the same page.
  id: totrans-125
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一定要了解责任区域和分配给这些角色的人员。更重要的是，明确提醒这些人他们的角色，因为这比隐含地希望每个人都处于同一页面上更有价值。
- en: To follow the growing reach of your system, remember to provide an on-call rotation
    to respond to any critical incidents.
  id: totrans-126
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为了跟随你系统的不断扩展，记得提供值班轮换以应对任何关键事件。
- en: Always look for a tradeoff between the efficiency and redundancy of your team
    to avoid working to exhaustion and, at the same time, maintain enough capacity
    to withstand peak load times.
  id: totrans-127
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 总是寻找团队效率和冗余之间的权衡，以避免过度劳累，同时保持足够的容量来应对高峰时段。
- en: Keep every piece of documentation for your system updated and available to any
    engaged parties. While it may require additional time and effort up front, documentation
    ultimately saves resources in the long run.
  id: totrans-128
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 保持你系统中的每一份文档都更新并可供任何相关人员获取。虽然这可能需要前期额外的时力和精力，但文档最终会在长期中节省资源。
- en: Start small, improve a thing or two, build trust, and then continue with higher-effect
    changes. It’s very likely you will get more support from your colleagues and gather
    more implicit knowledge about the system while doing so, which will help you to
    make better decisions.
  id: totrans-129
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 从小处着手，改进一两件事，建立信任，然后继续进行更有效果的改变。在这样做的时候，你很可能从同事那里获得更多支持，并收集更多关于系统的隐性知识，这将帮助你做出更好的决策。
- en: Try to avoid overcomplicating your solution. Excessive complexity either can
    be a result of personal ambitions or can indicate a poor understanding of the
    problem, surface-level research, setting irrelevant goals, and not covering obvious
    risks from the very beginning.
  id: totrans-130
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 尽量避免使你的解决方案过于复杂。过度的复杂性可能是个人雄心壮志的结果，也可能表明对问题理解不足、表面化研究、设定不相关目标，以及从一开始就没有覆盖明显的风险。
