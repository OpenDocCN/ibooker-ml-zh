<html><head></head><body><section data-pdf-bookmark="Chapter 17. Dimensionality Reduction" data-type="chapter" epub:type="chapter"><div class="chapter" id="idm46066886215192">&#13;
<h1><span class="label">Chapter 17. </span>Dimensionality Reduction</h1>&#13;
&#13;
&#13;
<p><a data-primary="dimensionality reduction" data-type="indexterm" id="ix_ch17-asciidoc0"/>There are many techniques to decompose features into a smaller subset. This can be useful for exploratory data analysis, visualization, making predictive models, or clustering.</p>&#13;
&#13;
<p>In this chapter we will explore the Titanic dataset using various techniques. We will look at PCA, UMAP, t-SNE, and PHATE.</p>&#13;
&#13;
<p>Here is the data:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">ti_df</code> <code class="o">=</code> <code class="n">tweak_titanic</code><code class="p">(</code><code class="n">orig_df</code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">std_cols</code> <code class="o">=</code> <code class="s">"pclass,age,sibsp,fare"</code><code class="o">.</code><code class="n">split</code><code class="p">(</code><code class="s">","</code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">X_train</code><code class="p">,</code> <code class="n">X_test</code><code class="p">,</code> <code class="n">y_train</code><code class="p">,</code> <code class="n">y_test</code> <code class="o">=</code> <code class="n">get_train_test_X_y</code><code class="p">(</code>&#13;
<code class="gp">... </code>    <code class="n">ti_df</code><code class="p">,</code> <code class="s">"survived"</code><code class="p">,</code> <code class="n">std_cols</code><code class="o">=</code><code class="n">std_cols</code>&#13;
<code class="gp">... </code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">X</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">concat</code><code class="p">([</code><code class="n">X_train</code><code class="p">,</code> <code class="n">X_test</code><code class="p">])</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">y</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">concat</code><code class="p">([</code><code class="n">y_train</code><code class="p">,</code> <code class="n">y_test</code><code class="p">])</code></pre>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="PCA" data-type="sect1"><div class="sect1" id="pca1">&#13;
<h1>PCA</h1>&#13;
&#13;
<p><a data-primary="dimensionality reduction" data-secondary="PCA" data-type="indexterm" id="ix_ch17-asciidoc1"/><a data-primary="principal component analysis (PCA)" data-secondary="for dimensionality reduction" data-type="indexterm" id="ix_ch17-asciidoc2"/>Principal Component Analysis (PCA) takes a matrix (X) of rows (samples) and columns (features). PCA returns a new matrix that has columns that are linear combinations of the original columns. These linear combinations maximize the <span class="keep-together">variance.</span></p>&#13;
&#13;
<p>Each column is orthogonal (a right angle) to the other columns. The columns are sorted in order of decreasing variance.</p>&#13;
&#13;
<p><a data-primary="scikit-learn" data-secondary="PCA implementation" data-type="indexterm" id="idm46066885731304"/>Scikit-learn has an implementation of this model. It is best to standardize the data prior to running the algorithm. After calling the <code>.fit</code> method, you will have access to an <span class="keep-together"><code>.explained_variance_ratio_</code></span> attribute that lists the percentage of variance in each column.</p>&#13;
&#13;
<p>PCA is useful to visualize data in two (or three) dimensions. It is also used as a preprocessing step to filter out random noise in data. It is good for finding global structures, but not local ones, and works well with linear data.</p>&#13;
&#13;
<p>In this example, we are going to run PCA on the Titanic features. The PCA class is a <em>transformer</em> in scikit-learn; you call the <code>.fit</code> method to teach it how to get the principal components, then you call <code>.transform</code> to convert a matrix into a matrix of principal components:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="kn">from</code> <code class="nn">sklearn.decomposition</code> <code class="kn">import</code> <code class="n">PCA</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="kn">from</code> <code class="nn">sklearn.preprocessing</code> <code class="kn">import</code> <code class="p">(</code>&#13;
<code class="gp">... </code>    <code class="n">StandardScaler</code><code class="p">,</code>&#13;
<code class="gp">... </code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">pca</code> <code class="o">=</code> <code class="n">PCA</code><code class="p">(</code><code class="n">random_state</code><code class="o">=</code><code class="mi">42</code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">X_pca</code> <code class="o">=</code> <code class="n">pca</code><code class="o">.</code><code class="n">fit_transform</code><code class="p">(</code>&#13;
<code class="gp">... </code>    <code class="n">StandardScaler</code><code class="p">()</code><code class="o">.</code><code class="n">fit_transform</code><code class="p">(</code><code class="n">X</code><code class="p">)</code>&#13;
<code class="gp">... </code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">pca</code><code class="o">.</code><code class="n">explained_variance_ratio_</code>&#13;
<code class="go">array([0.23917891, 0.21623078, 0.19265028,</code>&#13;
<code class="go">  0.10460882, 0.08170342, 0.07229959,</code>&#13;
<code class="go">  0.05133752, 0.04199068])</code>&#13;
&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">pca</code><code class="o">.</code><code class="n">components_</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code>&#13;
<code class="go">arrayarray([-0.63368693,  0.39682566,</code>&#13;
<code class="go">  0.00614498,  0.11488415,  0.58075352,</code>&#13;
<code class="go">  -0.19046812, -0.21190808, -0.09631388])</code></pre>&#13;
&#13;
<p class="pagebreak-before">Instance parameters:</p>&#13;
<dl>&#13;
<dt><code>n_components=None</code></dt>&#13;
<dd>&#13;
<p>Number of components to generate. If <code>None</code>, return same number as number of columns. Can be a float (0, 1), then will create as many components as needed to get that ratio of variance.</p>&#13;
</dd>&#13;
<dt><code>copy=True</code></dt>&#13;
<dd>&#13;
<p>Will mutate data on <code>.fit</code> if <code>True</code>.</p>&#13;
</dd>&#13;
<dt><code>whiten=False</code></dt>&#13;
<dd>&#13;
<p>Whiten data after transform to ensure uncorrelated <span class="keep-together">components.</span></p>&#13;
</dd>&#13;
<dt><code>svd_solver='auto'</code></dt>&#13;
<dd>&#13;
<p><code>'auto'</code> runs <code>'randomized'</code> SVD if <code>n_components</code> is less than 80% of the smallest dimension (faster, but an approximation). Otherwise runs <code>'full'</code>.</p>&#13;
</dd>&#13;
<dt><code>tol=0.0</code></dt>&#13;
<dd>&#13;
<p>Tolerance for singular values.</p>&#13;
</dd>&#13;
<dt><code>iterated_power='auto'</code></dt>&#13;
<dd>&#13;
<p>Number of iterations for <code>'randomized'</code> <code>svd_solver</code>.</p>&#13;
</dd>&#13;
<dt><code>random_state=None</code></dt>&#13;
<dd>&#13;
<p>Random state for <code>'randomized'</code> <code>svd_solver</code>.</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>Attributes:</p>&#13;
<dl>&#13;
<dt><code>components_</code></dt>&#13;
<dd>&#13;
<p>Principal components (columns of linear combination weights for original features).</p>&#13;
</dd>&#13;
<dt><code>explained_variance_</code></dt>&#13;
<dd>&#13;
<p>Amount of variance for each component.</p>&#13;
</dd>&#13;
<dt><code>explained_variance_ratio_</code></dt>&#13;
<dd>&#13;
<p>Amount of variance for each component normalized (sums to 1).</p>&#13;
</dd>&#13;
<dt><code>singular_values_</code></dt>&#13;
<dd>&#13;
<p>Singular values for each component.</p>&#13;
</dd>&#13;
<dt><code>mean_</code></dt>&#13;
<dd>&#13;
<p>Mean of each feature.</p>&#13;
</dd>&#13;
<dt><code>n_components_</code></dt>&#13;
<dd>&#13;
<p>When <code>n_components</code> is a float, this is the size of the <span class="keep-together">components.</span></p>&#13;
</dd>&#13;
<dt><code>noise_variance_</code></dt>&#13;
<dd>&#13;
<p>Estimated noise covariance.</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p><a data-primary="scree plot" data-type="indexterm" id="idm46066885584104"/>Plotting the cumulative sum of the explained variance ratio is called a <em>scree plot</em> (see <a data-type="xref" href="#idpca-comp1">Figure 17-1</a>). It will show how much information is stored in the components. <a data-primary="elbow method" data-type="indexterm" id="idm46066885582024"/>You can use the <em>elbow method</em> to see if it bends to determine how many components to use:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">fig</code><code class="p">,</code> <code class="n">ax</code> <code class="o">=</code> <code class="n">plt</code><code class="o">.</code><code class="n">subplots</code><code class="p">(</code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">6</code><code class="p">,</code> <code class="mi">4</code><code class="p">))</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">ax</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">pca</code><code class="o">.</code><code class="n">explained_variance_ratio_</code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">ax</code><code class="o">.</code><code class="n">set</code><code class="p">(</code>&#13;
<code class="gp">... </code>    <code class="n">xlabel</code><code class="o">=</code><code class="s">"Component"</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="n">ylabel</code><code class="o">=</code><code class="s">"Percent of Explained variance"</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="n">title</code><code class="o">=</code><code class="s">"Scree Plot"</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="n">ylim</code><code class="o">=</code><code class="p">(</code><code class="mi">0</code><code class="p">,</code> <code class="mi">1</code><code class="p">),</code>&#13;
<code class="gp">... </code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">fig</code><code class="o">.</code><code class="n">savefig</code><code class="p">(</code>&#13;
<code class="gp">... </code>    <code class="s">"images/mlpr_1701.png"</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="n">dpi</code><code class="o">=</code><code class="mi">300</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="n">bbox_inches</code><code class="o">=</code><code class="s">"tight"</code><code class="p">,</code>&#13;
<code class="gp">... </code><code class="p">)</code></pre>&#13;
&#13;
<figure><div class="figure" id="idpca-comp1">&#13;
<img alt="PCA scree plot." src="assets/mlpr_1701.png"/>&#13;
<h6><span class="label">Figure 17-1. </span>PCA scree plot.</h6>&#13;
</div></figure>&#13;
&#13;
<p><a data-primary="cumulative plot" data-type="indexterm" id="idm46066885475192"/>Another way to view this data is using a cumulative plot (see <a data-type="xref" href="#id49">Figure 17-2</a>). Our original data had 8 columns, but from the plot it appears that we keep around 90% of the variance if we use just 4 of the PCA components:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">fig</code><code class="p">,</code> <code class="n">ax</code> <code class="o">=</code> <code class="n">plt</code><code class="o">.</code><code class="n">subplots</code><code class="p">(</code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">6</code><code class="p">,</code> <code class="mi">4</code><code class="p">))</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">ax</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code>&#13;
<code class="gp">... </code>    <code class="n">np</code><code class="o">.</code><code class="n">cumsum</code><code class="p">(</code><code class="n">pca</code><code class="o">.</code><code class="n">explained_variance_ratio_</code><code class="p">)</code>&#13;
<code class="gp">... </code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">ax</code><code class="o">.</code><code class="n">set</code><code class="p">(</code>&#13;
<code class="gp">... </code>    <code class="n">xlabel</code><code class="o">=</code><code class="s">"Component"</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="n">ylabel</code><code class="o">=</code><code class="s">"Percent of Explained variance"</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="n">title</code><code class="o">=</code><code class="s">"Cumulative Variance"</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="n">ylim</code><code class="o">=</code><code class="p">(</code><code class="mi">0</code><code class="p">,</code> <code class="mi">1</code><code class="p">),</code>&#13;
<code class="gp">... </code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">fig</code><code class="o">.</code><code class="n">savefig</code><code class="p">(</code><code class="s">"images/mlpr_1702.png"</code><code class="p">,</code> <code class="n">dpi</code><code class="o">=</code><code class="mi">300</code><code class="p">)</code></pre>&#13;
&#13;
<figure><div class="figure" id="id49">&#13;
<img alt="PCA cumulative explained variance." src="assets/mlpr_1702.png"/>&#13;
<h6><span class="label">Figure 17-2. </span>PCA cumulative explained variance.</h6>&#13;
</div></figure>&#13;
&#13;
<p>How much do features impact components? Use the matplotlib <code>imshow</code> function to plot the components along the x axis and the original features along the y axis (see <a data-type="xref" href="#id50">Figure 17-3</a>). The darker the color, the more the original column contributes to the component.</p>&#13;
&#13;
<p>It looks like the first component is heavily influenced by the pclass, age, and fare columns. (Using the spectral colormap (<code>cmap</code>) emphasizes nonzero values, and providing <code>vmin</code> and <code>vmax</code> adds limits to the colorbar legend.)</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">fig</code><code class="p">,</code> <code class="n">ax</code> <code class="o">=</code> <code class="n">plt</code><code class="o">.</code><code class="n">subplots</code><code class="p">(</code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">6</code><code class="p">,</code> <code class="mi">4</code><code class="p">))</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">plt</code><code class="o">.</code><code class="n">imshow</code><code class="p">(</code>&#13;
<code class="gp">... </code>    <code class="n">pca</code><code class="o">.</code><code class="n">components_</code><code class="o">.</code><code class="n">T</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="n">cmap</code><code class="o">=</code><code class="s">"Spectral"</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="n">vmin</code><code class="o">=-</code><code class="mi">1</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="n">vmax</code><code class="o">=</code><code class="mi">1</code><code class="p">,</code>&#13;
<code class="gp">... </code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">plt</code><code class="o">.</code><code class="n">yticks</code><code class="p">(</code><code class="nb">range</code><code class="p">(</code><code class="nb">len</code><code class="p">(</code><code class="n">X</code><code class="o">.</code><code class="n">columns</code><code class="p">)),</code> <code class="n">X</code><code class="o">.</code><code class="n">columns</code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">plt</code><code class="o">.</code><code class="n">xticks</code><code class="p">(</code><code class="nb">range</code><code class="p">(</code><code class="mi">8</code><code class="p">),</code> <code class="nb">range</code><code class="p">(</code><code class="mi">1</code><code class="p">,</code> <code class="mi">9</code><code class="p">))</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">plt</code><code class="o">.</code><code class="n">xlabel</code><code class="p">(</code><code class="s">"Principal Component"</code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">plt</code><code class="o">.</code><code class="n">ylabel</code><code class="p">(</code><code class="s">"Contribution"</code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">plt</code><code class="o">.</code><code class="n">title</code><code class="p">(</code>&#13;
<code class="gp">... </code>    <code class="s">"Contribution of Features to Components"</code>&#13;
<code class="gp">... </code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">plt</code><code class="o">.</code><code class="n">colorbar</code><code class="p">()</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">fig</code><code class="o">.</code><code class="n">savefig</code><code class="p">(</code><code class="s">"images/mlpr_1703.png"</code><code class="p">,</code> <code class="n">dpi</code><code class="o">=</code><code class="mi">300</code><code class="p">)</code></pre>&#13;
&#13;
<figure><div class="figure" id="id50">&#13;
<img alt="PCA features in components." src="assets/mlpr_1703.png"/>&#13;
<h6><span class="label">Figure 17-3. </span>PCA features in components.</h6>&#13;
</div></figure>&#13;
&#13;
<p>An alternative view is to look at a bar plot (see <a data-type="xref" href="#id51">Figure 17-4</a>). Each component is shown with the contributions from the original data:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">fig</code><code class="p">,</code> <code class="n">ax</code> <code class="o">=</code> <code class="n">plt</code><code class="o">.</code><code class="n">subplots</code><code class="p">(</code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">8</code><code class="p">,</code> <code class="mi">4</code><code class="p">))</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">(</code>&#13;
<code class="gp">... </code>    <code class="n">pca</code><code class="o">.</code><code class="n">components_</code><code class="p">,</code> <code class="n">columns</code><code class="o">=</code><code class="n">X</code><code class="o">.</code><code class="n">columns</code>&#13;
<code class="gp">... </code><code class="p">)</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">kind</code><code class="o">=</code><code class="s">"bar"</code><code class="p">,</code> <code class="n">ax</code><code class="o">=</code><code class="n">ax</code><code class="p">)</code><code class="o">.</code><code class="n">legend</code><code class="p">(</code>&#13;
<code class="gp">... </code>    <code class="n">bbox_to_anchor</code><code class="o">=</code><code class="p">(</code><code class="mi">1</code><code class="p">,</code> <code class="mi">1</code><code class="p">)</code>&#13;
<code class="gp">... </code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">fig</code><code class="o">.</code><code class="n">savefig</code><code class="p">(</code><code class="s">"images/mlpr_1704.png"</code><code class="p">,</code> <code class="n">dpi</code><code class="o">=</code><code class="mi">300</code><code class="p">)</code></pre>&#13;
&#13;
<figure><div class="figure" id="id51">&#13;
<img alt="PCA features in components." src="assets/mlpr_1704.png"/>&#13;
<h6><span class="label">Figure 17-4. </span>PCA features in components.</h6>&#13;
</div></figure>&#13;
&#13;
<p>If we have many features, we may want to limit the plots above by&#13;
showing only features that meet a minimum weight. Here is code to&#13;
find all the features in the first two components that have absolute values of&#13;
at least .5:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">comps</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">(</code>&#13;
<code class="gp">... </code>    <code class="n">pca</code><code class="o">.</code><code class="n">components_</code><code class="p">,</code> <code class="n">columns</code><code class="o">=</code><code class="n">X</code><code class="o">.</code><code class="n">columns</code>&#13;
<code class="gp">... </code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">min_val</code> <code class="o">=</code> <code class="mf">0.5</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">num_components</code> <code class="o">=</code> <code class="mi">2</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">pca_cols</code> <code class="o">=</code> <code class="nb">set</code><code class="p">()</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="k">for</code> <code class="n">i</code> <code class="ow">in</code> <code class="nb">range</code><code class="p">(</code><code class="n">num_components</code><code class="p">):</code>&#13;
<code class="gp">... </code>    <code class="n">parts</code> <code class="o">=</code> <code class="n">comps</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="n">i</code><code class="p">][</code>&#13;
<code class="gp">... </code>        <code class="n">comps</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="n">i</code><code class="p">]</code><code class="o">.</code><code class="n">abs</code><code class="p">()</code> <code class="o">&gt;</code> <code class="n">min_val</code>&#13;
<code class="gp">... </code>    <code class="p">]</code>&#13;
<code class="gp">... </code>    <code class="n">pca_cols</code><code class="o">.</code><code class="n">update</code><code class="p">(</code><code class="nb">set</code><code class="p">(</code><code class="n">parts</code><code class="o">.</code><code class="n">index</code><code class="p">))</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">pca_cols</code>&#13;
<code class="go">{'fare', 'parch', 'pclass', 'sibsp'}</code></pre>&#13;
&#13;
<p>PCA is commonly used to visualize high dimension datasets in two components. Here we visualize the Titanic features in 2D. They are colored by survival status. Sometimes clusters may appear in the visualization. In this case, there doesn’t appear to be clustering of survivors (see <a data-type="xref" href="#id52">Figure 17-5</a>).</p>&#13;
&#13;
<p>We generate this visualization using Yellowbrick:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="kn">from</code> <code class="nn">yellowbrick.features.pca</code> <code class="kn">import</code> <code class="p">(</code>&#13;
<code class="gp">... </code>    <code class="n">PCADecomposition</code><code class="p">,</code>&#13;
<code class="gp">... </code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">fig</code><code class="p">,</code> <code class="n">ax</code> <code class="o">=</code> <code class="n">plt</code><code class="o">.</code><code class="n">subplots</code><code class="p">(</code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">6</code><code class="p">,</code> <code class="mi">4</code><code class="p">))</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">colors</code> <code class="o">=</code> <code class="p">[</code><code class="s">"rg"</code><code class="p">[</code><code class="n">j</code><code class="p">]</code> <code class="k">for</code> <code class="n">j</code> <code class="ow">in</code> <code class="n">y</code><code class="p">]</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">pca_viz</code> <code class="o">=</code> <code class="n">PCADecomposition</code><code class="p">(</code><code class="n">color</code><code class="o">=</code><code class="n">colors</code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">pca_viz</code><code class="o">.</code><code class="n">fit_transform</code><code class="p">(</code><code class="n">X</code><code class="p">,</code> <code class="n">y</code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">pca_viz</code><code class="o">.</code><code class="n">poof</code><code class="p">()</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">fig</code><code class="o">.</code><code class="n">savefig</code><code class="p">(</code><code class="s">"images/mlpr_1705.png"</code><code class="p">,</code> <code class="n">dpi</code><code class="o">=</code><code class="mi">300</code><code class="p">)</code></pre>&#13;
&#13;
<figure><div class="figure" id="id52">&#13;
<img alt="Yellowbrick PCA plot." src="assets/mlpr_1705.png"/>&#13;
<h6><span class="label">Figure 17-5. </span>Yellowbrick PCA plot.</h6>&#13;
</div></figure>&#13;
&#13;
<p>If you want to color the scatter plot by a column and add a legend (not a colorbar), you need to&#13;
loop over each color and plot that group individually in pandas or matplotlib (or use seaborn). Below we also set the aspect ratio to the ratio of the explained variances for the components we are looking at (see <a data-type="xref" href="#id53">Figure 17-6</a>). Because the second component only has 90% of the first component, it is a little shorter.</p>&#13;
&#13;
<p><a data-primary="seaborn" data-secondary="PCA" data-type="indexterm" id="idm46066884834328"/>Here is the seaborn version:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">fig</code><code class="p">,</code> <code class="n">ax</code> <code class="o">=</code> <code class="n">plt</code><code class="o">.</code><code class="n">subplots</code><code class="p">(</code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">6</code><code class="p">,</code> <code class="mi">4</code><code class="p">))</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">pca_df</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">(</code>&#13;
<code class="gp">... </code>    <code class="n">X_pca</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="n">columns</code><code class="o">=</code><code class="p">[</code>&#13;
<code class="gp">... </code>        <code class="n">f</code><code class="s">"PC{i+1}"</code>&#13;
<code class="gp">... </code>        <code class="k">for</code> <code class="n">i</code> <code class="ow">in</code> <code class="nb">range</code><code class="p">(</code><code class="n">X_pca</code><code class="o">.</code><code class="n">shape</code><code class="p">[</code><code class="mi">1</code><code class="p">])</code>&#13;
<code class="gp">... </code>    <code class="p">],</code>&#13;
<code class="gp">... </code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">pca_df</code><code class="p">[</code><code class="s">"status"</code><code class="p">]</code> <code class="o">=</code> <code class="p">[</code>&#13;
<code class="gp">... </code>    <code class="p">(</code><code class="s">"deceased"</code><code class="p">,</code> <code class="s">"survived"</code><code class="p">)[</code><code class="n">i</code><code class="p">]</code> <code class="k">for</code> <code class="n">i</code> <code class="ow">in</code> <code class="n">y</code>&#13;
<code class="gp">... </code><code class="p">]</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">evr</code> <code class="o">=</code> <code class="n">pca</code><code class="o">.</code><code class="n">explained_variance_ratio_</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">ax</code><code class="o">.</code><code class="n">set_aspect</code><code class="p">(</code><code class="n">evr</code><code class="p">[</code><code class="mi">1</code><code class="p">]</code> <code class="o">/</code> <code class="n">evr</code><code class="p">[</code><code class="mi">0</code><code class="p">])</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">sns</code><code class="o">.</code><code class="n">scatterplot</code><code class="p">(</code>&#13;
<code class="gp">... </code>    <code class="n">x</code><code class="o">=</code><code class="s">"PC1"</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="n">y</code><code class="o">=</code><code class="s">"PC2"</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="n">hue</code><code class="o">=</code><code class="s">"status"</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="n">data</code><code class="o">=</code><code class="n">pca_df</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="n">alpha</code><code class="o">=</code><code class="mf">0.5</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="n">ax</code><code class="o">=</code><code class="n">ax</code><code class="p">,</code>&#13;
<code class="gp">... </code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">fig</code><code class="o">.</code><code class="n">savefig</code><code class="p">(</code>&#13;
<code class="gp">... </code>    <code class="s">"images/mlpr_1706.png"</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="n">dpi</code><code class="o">=</code><code class="mi">300</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="n">bbox_inches</code><code class="o">=</code><code class="s">"tight"</code><code class="p">,</code>&#13;
<code class="gp">... </code><code class="p">)</code></pre>&#13;
&#13;
<figure><div class="figure" id="id53">&#13;
<img alt="Seaborn PCA with legend and relative aspect." src="assets/mlpr_1706.png"/>&#13;
<h6><span class="label">Figure 17-6. </span>Seaborn PCA with legend and relative aspect.</h6>&#13;
</div></figure>&#13;
&#13;
<p><a data-primary="loading plot" data-type="indexterm" id="idm46066884829752"/>Below, we augment the scatter plot by showing a <em>loading plot</em> on top of it. <a data-primary="biplot" data-type="indexterm" id="idm46066884657208"/>This plot is called a biplot because it has the scatter plot and the loadings (see <a data-type="xref" href="#idpca52">Figure 17-7</a>). The loadings indicate how strong features are and how they correlate. If their angles are close, they likely correlate. If the angles are at 90 degrees, they likely don’t correlate. Finally, if the angle between them is close to 180 degrees, they have a negative correlation:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">fig</code><code class="p">,</code> <code class="n">ax</code> <code class="o">=</code> <code class="n">plt</code><code class="o">.</code><code class="n">subplots</code><code class="p">(</code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">6</code><code class="p">,</code> <code class="mi">4</code><code class="p">))</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">pca_df</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">(</code>&#13;
<code class="gp">... </code>    <code class="n">X_pca</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="n">columns</code><code class="o">=</code><code class="p">[</code>&#13;
<code class="gp">... </code>        <code class="n">f</code><code class="s">"PC{i+1}"</code>&#13;
<code class="gp">... </code>        <code class="k">for</code> <code class="n">i</code> <code class="ow">in</code> <code class="nb">range</code><code class="p">(</code><code class="n">X_pca</code><code class="o">.</code><code class="n">shape</code><code class="p">[</code><code class="mi">1</code><code class="p">])</code>&#13;
<code class="gp">... </code>    <code class="p">],</code>&#13;
<code class="gp">... </code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">pca_df</code><code class="p">[</code><code class="s">"status"</code><code class="p">]</code> <code class="o">=</code> <code class="p">[</code>&#13;
<code class="gp">... </code>    <code class="p">(</code><code class="s">"deceased"</code><code class="p">,</code> <code class="s">"survived"</code><code class="p">)[</code><code class="n">i</code><code class="p">]</code> <code class="k">for</code> <code class="n">i</code> <code class="ow">in</code> <code class="n">y</code>&#13;
<code class="gp">... </code><code class="p">]</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">evr</code> <code class="o">=</code> <code class="n">pca</code><code class="o">.</code><code class="n">explained_variance_ratio_</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">x_idx</code> <code class="o">=</code> <code class="mi">0</code>  <code class="c"># x_pc</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">y_idx</code> <code class="o">=</code> <code class="mi">1</code>  <code class="c"># y_pc</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">ax</code><code class="o">.</code><code class="n">set_aspect</code><code class="p">(</code><code class="n">evr</code><code class="p">[</code><code class="n">y_idx</code><code class="p">]</code> <code class="o">/</code> <code class="n">evr</code><code class="p">[</code><code class="n">x_idx</code><code class="p">])</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">x_col</code> <code class="o">=</code> <code class="n">pca_df</code><code class="o">.</code><code class="n">columns</code><code class="p">[</code><code class="n">x_idx</code><code class="p">]</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">y_col</code> <code class="o">=</code> <code class="n">pca_df</code><code class="o">.</code><code class="n">columns</code><code class="p">[</code><code class="n">y_idx</code><code class="p">]</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">sns</code><code class="o">.</code><code class="n">scatterplot</code><code class="p">(</code>&#13;
<code class="gp">... </code>    <code class="n">x</code><code class="o">=</code><code class="n">x_col</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="n">y</code><code class="o">=</code><code class="n">y_col</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="n">hue</code><code class="o">=</code><code class="s">"status"</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="n">data</code><code class="o">=</code><code class="n">pca_df</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="n">alpha</code><code class="o">=</code><code class="mf">0.5</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="n">ax</code><code class="o">=</code><code class="n">ax</code><code class="p">,</code>&#13;
<code class="gp">... </code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">scale</code> <code class="o">=</code> <code class="mi">8</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">comps</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">(</code>&#13;
<code class="gp">... </code>    <code class="n">pca</code><code class="o">.</code><code class="n">components_</code><code class="p">,</code> <code class="n">columns</code><code class="o">=</code><code class="n">X</code><code class="o">.</code><code class="n">columns</code>&#13;
<code class="gp">... </code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="k">for</code> <code class="n">idx</code><code class="p">,</code> <code class="n">s</code> <code class="ow">in</code> <code class="n">comps</code><code class="o">.</code><code class="n">T</code><code class="o">.</code><code class="n">iterrows</code><code class="p">():</code>&#13;
<code class="gp">... </code>    <code class="n">plt</code><code class="o">.</code><code class="n">arrow</code><code class="p">(</code>&#13;
<code class="gp">... </code>        <code class="mi">0</code><code class="p">,</code>&#13;
<code class="gp">... </code>        <code class="mi">0</code><code class="p">,</code>&#13;
<code class="gp">... </code>        <code class="n">s</code><code class="p">[</code><code class="n">x_idx</code><code class="p">]</code> <code class="o">*</code> <code class="n">scale</code><code class="p">,</code>&#13;
<code class="gp">... </code>        <code class="n">s</code><code class="p">[</code><code class="n">y_idx</code><code class="p">]</code> <code class="o">*</code> <code class="n">scale</code><code class="p">,</code>&#13;
<code class="gp">... </code>        <code class="n">color</code><code class="o">=</code><code class="s">"k"</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="p">)</code>&#13;
<code class="gp">... </code>    <code class="n">plt</code><code class="o">.</code><code class="n">text</code><code class="p">(</code>&#13;
<code class="gp">... </code>        <code class="n">s</code><code class="p">[</code><code class="n">x_idx</code><code class="p">]</code> <code class="o">*</code> <code class="n">scale</code><code class="p">,</code>&#13;
<code class="gp">... </code>        <code class="n">s</code><code class="p">[</code><code class="n">y_idx</code><code class="p">]</code> <code class="o">*</code> <code class="n">scale</code><code class="p">,</code>&#13;
<code class="gp">... </code>        <code class="n">idx</code><code class="p">,</code>&#13;
<code class="gp">... </code>        <code class="n">weight</code><code class="o">=</code><code class="s">"bold"</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">fig</code><code class="o">.</code><code class="n">savefig</code><code class="p">(</code>&#13;
<code class="gp">... </code>    <code class="s">"images/mlpr_1707.png"</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="n">dpi</code><code class="o">=</code><code class="mi">300</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="n">bbox_inches</code><code class="o">=</code><code class="s">"tight"</code><code class="p">,</code>&#13;
<code class="gp">... </code><code class="p">)</code></pre>&#13;
&#13;
<figure><div class="figure" id="idpca52">&#13;
<img alt="Seaborn biplot with scatter plot and loading plot." src="assets/mlpr_1707.png"/>&#13;
<h6><span class="label">Figure 17-7. </span>Seaborn biplot with scatter plot and loading plot.</h6>&#13;
</div></figure>&#13;
&#13;
<p>From previous tree models, we know that age, fare, and sex are important for determining whether a passenger survived. The first principal component is influenced by pclass, age, and fare, while the fourth is influenced by sex. Let’s plot those components against each other.</p>&#13;
&#13;
<p>Again, this plot is scaling the aspect ratio of the plot based on the&#13;
ratios of variance of the components (see <a data-type="xref" href="#idpca6">Figure 17-8</a>).</p>&#13;
&#13;
<p>This plot appears to more accurately separate the survivors:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">fig</code><code class="p">,</code> <code class="n">ax</code> <code class="o">=</code> <code class="n">plt</code><code class="o">.</code><code class="n">subplots</code><code class="p">(</code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">6</code><code class="p">,</code> <code class="mi">4</code><code class="p">))</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">pca_df</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">(</code>&#13;
<code class="gp">... </code>    <code class="n">X_pca</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="n">columns</code><code class="o">=</code><code class="p">[</code>&#13;
<code class="gp">... </code>        <code class="n">f</code><code class="s">"PC{i+1}"</code>&#13;
<code class="gp">... </code>        <code class="k">for</code> <code class="n">i</code> <code class="ow">in</code> <code class="nb">range</code><code class="p">(</code><code class="n">X_pca</code><code class="o">.</code><code class="n">shape</code><code class="p">[</code><code class="mi">1</code><code class="p">])</code>&#13;
<code class="gp">... </code>    <code class="p">],</code>&#13;
<code class="gp">... </code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">pca_df</code><code class="p">[</code><code class="s">"status"</code><code class="p">]</code> <code class="o">=</code> <code class="p">[</code>&#13;
<code class="gp">... </code>    <code class="p">(</code><code class="s">"deceased"</code><code class="p">,</code> <code class="s">"survived"</code><code class="p">)[</code><code class="n">i</code><code class="p">]</code> <code class="k">for</code> <code class="n">i</code> <code class="ow">in</code> <code class="n">y</code>&#13;
<code class="gp">... </code><code class="p">]</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">evr</code> <code class="o">=</code> <code class="n">pca</code><code class="o">.</code><code class="n">explained_variance_ratio_</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">ax</code><code class="o">.</code><code class="n">set_aspect</code><code class="p">(</code><code class="n">evr</code><code class="p">[</code><code class="mi">3</code><code class="p">]</code> <code class="o">/</code> <code class="n">evr</code><code class="p">[</code><code class="mi">0</code><code class="p">])</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">sns</code><code class="o">.</code><code class="n">scatterplot</code><code class="p">(</code>&#13;
<code class="gp">... </code>    <code class="n">x</code><code class="o">=</code><code class="s">"PC1"</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="n">y</code><code class="o">=</code><code class="s">"PC4"</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="n">hue</code><code class="o">=</code><code class="s">"status"</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="n">data</code><code class="o">=</code><code class="n">pca_df</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="n">alpha</code><code class="o">=</code><code class="mf">0.5</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="n">ax</code><code class="o">=</code><code class="n">ax</code><code class="p">,</code>&#13;
<code class="gp">... </code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">fig</code><code class="o">.</code><code class="n">savefig</code><code class="p">(</code>&#13;
<code class="gp">... </code>    <code class="s">"images/mlpr_1708.png"</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="n">dpi</code><code class="o">=</code><code class="mi">300</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="n">bbox_inches</code><code class="o">=</code><code class="s">"tight"</code><code class="p">,</code>&#13;
<code class="gp">... </code><code class="p">)</code></pre>&#13;
&#13;
<figure><div class="figure" id="idpca6">&#13;
<img alt="PCA plot showing components 1 against 4." src="assets/mlpr_1708.png"/>&#13;
<h6><span class="label">Figure 17-8. </span>PCA plot showing components 1 against 4.</h6>&#13;
</div></figure>&#13;
&#13;
<p>Matplotlib can create pretty plots, but it is less useful for interactive&#13;
plots. <a data-primary="scatter plot" data-secondary="PCA and" data-type="indexterm" id="idm46066884294824"/>When performing PCA, it is often useful to view the data for scatter plots. <a data-primary="Bokeh" data-type="indexterm" id="idm46066884226936"/>I have included a function that uses the <a href="https://bokeh.pydata.org">Bokeh library</a> for interacting with scatter plots (see <a data-type="xref" href="#bok1">Figure 17-9</a>). <a data-primary="Jupyter" data-secondary="interactive scatter plots" data-type="indexterm" id="idm46066884224552"/>It works well in Jupyter:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="kn">from</code> <code class="nn">bokeh.io</code> <code class="kn">import</code> <code class="n">output_notebook</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="kn">from</code> <code class="nn">bokeh</code> <code class="kn">import</code> <code class="n">models</code><code class="p">,</code> <code class="n">palettes</code><code class="p">,</code> <code class="n">transform</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="kn">from</code> <code class="nn">bokeh.plotting</code> <code class="kn">import</code> <code class="n">figure</code><code class="p">,</code> <code class="n">show</code>&#13;
<code class="go">&gt;&gt;&gt;</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="k">def</code> <code class="nf">bokeh_scatter</code><code class="p">(</code>&#13;
<code class="gp">... </code>    <code class="n">x</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="n">y</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="n">data</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="n">hue</code><code class="o">=</code><code class="bp">None</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="n">label_cols</code><code class="o">=</code><code class="bp">None</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="n">size</code><code class="o">=</code><code class="bp">None</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="n">legend</code><code class="o">=</code><code class="bp">None</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="n">alpha</code><code class="o">=</code><code class="mf">0.5</code><code class="p">,</code>&#13;
<code class="gp">... </code><code class="p">):</code>&#13;
<code class="gp">... </code>    <code class="sd">"""</code>&#13;
<code class="gp">... </code><code class="sd">    x - x column name to plot</code>&#13;
<code class="gp">... </code><code class="sd">    y - y column name to plot</code>&#13;
<code class="gp">... </code><code class="sd">    data - pandas DataFrame</code>&#13;
<code class="gp">... </code><code class="sd">    hue - column name to color by (numeric)</code>&#13;
<code class="gp">... </code><code class="sd">    legend - column name to label by</code>&#13;
<code class="gp">... </code><code class="sd">    label_cols - columns to use in tooltip</code>&#13;
<code class="gp">... </code><code class="sd">                 (None all in DataFrame)</code>&#13;
<code class="gp">... </code><code class="sd">    size - size of points in screen space unigs</code>&#13;
<code class="gp">... </code><code class="sd">    alpha - transparency</code>&#13;
<code class="gp">... </code><code class="sd">    """</code>&#13;
<code class="gp">... </code>    <code class="n">output_notebook</code><code class="p">()</code>&#13;
<code class="gp">... </code>    <code class="n">circle_kwargs</code> <code class="o">=</code> <code class="p">{}</code>&#13;
<code class="gp">... </code>    <code class="k">if</code> <code class="n">legend</code><code class="p">:</code>&#13;
<code class="gp">... </code>        <code class="n">circle_kwargs</code><code class="p">[</code><code class="s">"legend"</code><code class="p">]</code> <code class="o">=</code> <code class="n">legend</code>&#13;
<code class="gp">... </code>    <code class="k">if</code> <code class="n">size</code><code class="p">:</code>&#13;
<code class="gp">... </code>        <code class="n">circle_kwargs</code><code class="p">[</code><code class="s">"size"</code><code class="p">]</code> <code class="o">=</code> <code class="n">size</code>&#13;
<code class="gp">... </code>    <code class="k">if</code> <code class="n">hue</code><code class="p">:</code>&#13;
<code class="gp">... </code>        <code class="n">color_seq</code> <code class="o">=</code> <code class="n">data</code><code class="p">[</code><code class="n">hue</code><code class="p">]</code>&#13;
<code class="gp">... </code>        <code class="n">mapper</code> <code class="o">=</code> <code class="n">models</code><code class="o">.</code><code class="n">LinearColorMapper</code><code class="p">(</code>&#13;
<code class="gp">... </code>            <code class="n">palette</code><code class="o">=</code><code class="n">palettes</code><code class="o">.</code><code class="n">viridis</code><code class="p">(</code><code class="mi">256</code><code class="p">),</code>&#13;
<code class="gp">... </code>            <code class="n">low</code><code class="o">=</code><code class="nb">min</code><code class="p">(</code><code class="n">color_seq</code><code class="p">),</code>&#13;
<code class="gp">... </code>            <code class="n">high</code><code class="o">=</code><code class="nb">max</code><code class="p">(</code><code class="n">color_seq</code><code class="p">),</code>&#13;
<code class="gp">... </code>        <code class="p">)</code>&#13;
<code class="gp">... </code>        <code class="n">circle_kwargs</code><code class="p">[</code>&#13;
<code class="gp">... </code>            <code class="s">"fill_color"</code>&#13;
<code class="gp">... </code>        <code class="p">]</code> <code class="o">=</code> <code class="n">transform</code><code class="o">.</code><code class="n">transform</code><code class="p">(</code><code class="n">hue</code><code class="p">,</code> <code class="n">mapper</code><code class="p">)</code>&#13;
<code class="gp">... </code>    <code class="n">ds</code> <code class="o">=</code> <code class="n">models</code><code class="o">.</code><code class="n">ColumnDataSource</code><code class="p">(</code><code class="n">data</code><code class="p">)</code>&#13;
<code class="gp">... </code>    <code class="k">if</code> <code class="n">label_cols</code> <code class="ow">is</code> <code class="bp">None</code><code class="p">:</code>&#13;
<code class="gp">... </code>        <code class="n">label_cols</code> <code class="o">=</code> <code class="n">data</code><code class="o">.</code><code class="n">columns</code>&#13;
<code class="gp">... </code>    <code class="n">tool_tips</code> <code class="o">=</code> <code class="nb">sorted</code><code class="p">(</code>&#13;
<code class="gp">... </code>        <code class="p">[</code>&#13;
<code class="gp">... </code>            <code class="p">(</code><code class="n">x</code><code class="p">,</code> <code class="s">"@{}"</code><code class="o">.</code><code class="n">format</code><code class="p">(</code><code class="n">x</code><code class="p">))</code>&#13;
<code class="gp">... </code>            <code class="k">for</code> <code class="n">x</code> <code class="ow">in</code> <code class="n">label_cols</code>&#13;
<code class="gp">... </code>        <code class="p">],</code>&#13;
<code class="gp">... </code>        <code class="n">key</code><code class="o">=</code><code class="k">lambda</code> <code class="n">tup</code><code class="p">:</code> <code class="n">tup</code><code class="p">[</code><code class="mi">0</code><code class="p">],</code>&#13;
<code class="gp">... </code>    <code class="p">)</code>&#13;
<code class="gp">... </code>    <code class="n">hover</code> <code class="o">=</code> <code class="n">models</code><code class="o">.</code><code class="n">HoverTool</code><code class="p">(</code>&#13;
<code class="gp">... </code>        <code class="n">tooltips</code><code class="o">=</code><code class="n">tool_tips</code>&#13;
<code class="gp">... </code>    <code class="p">)</code>&#13;
<code class="gp">... </code>    <code class="n">fig</code> <code class="o">=</code> <code class="n">figure</code><code class="p">(</code>&#13;
<code class="gp">... </code>        <code class="n">tools</code><code class="o">=</code><code class="p">[</code>&#13;
<code class="gp">... </code>            <code class="n">hover</code><code class="p">,</code>&#13;
<code class="gp">... </code>            <code class="s">"pan"</code><code class="p">,</code>&#13;
<code class="gp">... </code>            <code class="s">"zoom_in"</code><code class="p">,</code>&#13;
<code class="gp">... </code>            <code class="s">"zoom_out"</code><code class="p">,</code>&#13;
<code class="gp">... </code>            <code class="s">"reset"</code><code class="p">,</code>&#13;
<code class="gp">... </code>        <code class="p">],</code>&#13;
<code class="gp">... </code>        <code class="n">toolbar_location</code><code class="o">=</code><code class="s">"below"</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="p">)</code>&#13;
<code class="gp">...</code>&#13;
<code class="gp">... </code>    <code class="n">fig</code><code class="o">.</code><code class="n">circle</code><code class="p">(</code>&#13;
<code class="gp">... </code>        <code class="n">x</code><code class="p">,</code>&#13;
<code class="gp">... </code>        <code class="n">y</code><code class="p">,</code>&#13;
<code class="gp">... </code>        <code class="n">source</code><code class="o">=</code><code class="n">ds</code><code class="p">,</code>&#13;
<code class="gp">... </code>        <code class="n">alpha</code><code class="o">=</code><code class="n">alpha</code><code class="p">,</code>&#13;
<code class="gp">... </code>        <code class="o">**</code><code class="n">circle_kwargs</code>&#13;
<code class="gp">... </code>    <code class="p">)</code>&#13;
<code class="gp">... </code>    <code class="n">show</code><code class="p">(</code><code class="n">fig</code><code class="p">)</code>&#13;
<code class="gp">... </code>    <code class="k">return</code> <code class="n">fig</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">res</code> <code class="o">=</code> <code class="n">bokeh_scatter</code><code class="p">(</code>&#13;
<code class="gp">... </code>    <code class="s">"PC1"</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="s">"PC2"</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="n">data</code><code class="o">=</code><code class="n">pca_df</code><code class="o">.</code><code class="n">assign</code><code class="p">(</code>&#13;
<code class="gp">... </code>        <code class="n">surv</code><code class="o">=</code><code class="n">y</code><code class="o">.</code><code class="n">reset_index</code><code class="p">(</code><code class="n">drop</code><code class="o">=</code><code class="bp">True</code><code class="p">)</code>&#13;
<code class="gp">... </code>    <code class="p">),</code>&#13;
<code class="gp">... </code>    <code class="n">hue</code><code class="o">=</code><code class="s">"surv"</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="n">size</code><code class="o">=</code><code class="mi">10</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="n">legend</code><code class="o">=</code><code class="s">"surv"</code><code class="p">,</code>&#13;
<code class="gp">... </code><code class="p">)</code></pre>&#13;
&#13;
<figure><div class="figure" id="bok1">&#13;
<img alt="Bokeh scatter plot with tooltips." src="assets/mlpr_1709.png"/>&#13;
<h6><span class="label">Figure 17-9. </span>Bokeh scatter plot with tooltips.</h6>&#13;
</div></figure>&#13;
&#13;
<p><a data-primary="Yellowbrick" data-secondary="scatter plot for 3D PCA" data-type="indexterm" id="idm46066884221608"/>Yellowbrick can also plot in three dimensions (see <a data-type="xref" href="#id532">Figure 17-10</a>):</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="kn">from</code> <code class="nn">yellowbrick.features.pca</code> <code class="kn">import</code> <code class="p">(</code>&#13;
<code class="gp">... </code>    <code class="n">PCADecomposition</code><code class="p">,</code>&#13;
<code class="gp">... </code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">colors</code> <code class="o">=</code> <code class="p">[</code><code class="s">"rg"</code><code class="p">[</code><code class="n">j</code><code class="p">]</code> <code class="k">for</code> <code class="n">j</code> <code class="ow">in</code> <code class="n">y</code><code class="p">]</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">pca3_viz</code> <code class="o">=</code> <code class="n">PCADecomposition</code><code class="p">(</code>&#13;
<code class="gp">... </code>    <code class="n">proj_dim</code><code class="o">=</code><code class="mi">3</code><code class="p">,</code> <code class="n">color</code><code class="o">=</code><code class="n">colors</code>&#13;
<code class="gp">... </code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">pca3_viz</code><code class="o">.</code><code class="n">fit_transform</code><code class="p">(</code><code class="n">X</code><code class="p">,</code> <code class="n">y</code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">pca3_viz</code><code class="o">.</code><code class="n">finalize</code><code class="p">()</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">fig</code> <code class="o">=</code> <code class="n">plt</code><code class="o">.</code><code class="n">gcf</code><code class="p">()</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">plt</code><code class="o">.</code><code class="n">tight_layout</code><code class="p">()</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">fig</code><code class="o">.</code><code class="n">savefig</code><code class="p">(</code>&#13;
<code class="gp">... </code>    <code class="s">"images/mlpr_1710.png"</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="n">dpi</code><code class="o">=</code><code class="mi">300</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="n">bbox_inches</code><code class="o">=</code><code class="s">"tight"</code><code class="p">,</code>&#13;
<code class="gp">... </code><code class="p">)</code></pre>&#13;
&#13;
<figure><div class="figure" id="id532">&#13;
<img alt="Yellowbrick 3D PCA." src="assets/mlpr_1710.png"/>&#13;
<h6><span class="label">Figure 17-10. </span>Yellowbrick 3D PCA.</h6>&#13;
</div></figure>&#13;
&#13;
<p><a data-primary="scprep" data-type="indexterm" id="idm46066883386456"/>The <a href="https://oreil.ly/Jdq1s">scprep library</a> (which is a dependency for the PHATE library, which we discuss shortly) has a useful plotting function. The <code>rotate_scatter3d</code> function can generate a plot that will animate in Jupyter (see <a data-type="xref" href="#idpca_3d">Figure 17-11</a>). This makes it easier to understand 3D plots.</p>&#13;
&#13;
<p>You can use this library to visualize any 3D data, not just PHATE:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="kn">import</code> <code class="nn">scprep</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">scprep</code><code class="o">.</code><code class="n">plot</code><code class="o">.</code><code class="n">rotate_scatter3d</code><code class="p">(</code>&#13;
<code class="gp">... </code>    <code class="n">X_pca</code><code class="p">[:,</code> <code class="p">:</code><code class="mi">3</code><code class="p">],</code>&#13;
<code class="gp">... </code>    <code class="n">c</code><code class="o">=</code><code class="n">y</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="n">cmap</code><code class="o">=</code><code class="s">"Spectral"</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">8</code><code class="p">,</code> <code class="mi">6</code><code class="p">),</code>&#13;
<code class="gp">... </code>    <code class="n">label_prefix</code><code class="o">=</code><code class="s">"Principal Component"</code><code class="p">,</code>&#13;
<code class="gp">... </code><code class="p">)</code></pre>&#13;
&#13;
<figure><div class="figure" id="idpca_3d">&#13;
<img alt="scprep 3D PCA animation." src="assets/mlpr_1711.png"/>&#13;
<h6><span class="label">Figure 17-11. </span>scprep 3D PCA animation.</h6>&#13;
</div></figure>&#13;
&#13;
<p><a data-primary="Jupyter" data-secondary="interactive scatter plots" data-type="indexterm" id="ix_ch17-asciidoc3"/><a data-primary="matplotlib" data-secondary="interactive scatter plots" data-type="indexterm" id="ix_ch17-asciidoc4"/>If you change the matplotlib cell magic mode in Jupyter to <code>notebook</code>, you can get an interactive 3D plot from matplotlib (see <a data-type="xref" href="#idpca_3d2">Figure 17-12</a>).</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="kn">from</code> <code class="nn">mpl_toolkits.mplot3d</code> <code class="kn">import</code> <code class="n">Axes3D</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">fig</code> <code class="o">=</code> <code class="n">plt</code><code class="o">.</code><code class="n">figure</code><code class="p">(</code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">6</code><code class="p">,</code> <code class="mi">4</code><code class="p">))</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">ax</code> <code class="o">=</code> <code class="n">fig</code><code class="o">.</code><code class="n">add_subplot</code><code class="p">(</code><code class="mi">111</code><code class="p">,</code> <code class="n">projection</code><code class="o">=</code><code class="s">"3d"</code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">ax</code><code class="o">.</code><code class="n">scatter</code><code class="p">(</code>&#13;
<code class="gp">... </code>    <code class="n">xs</code><code class="o">=</code><code class="n">X_pca</code><code class="p">[:,</code> <code class="mi">0</code><code class="p">],</code>&#13;
<code class="gp">... </code>    <code class="n">ys</code><code class="o">=</code><code class="n">X_pca</code><code class="p">[:,</code> <code class="mi">1</code><code class="p">],</code>&#13;
<code class="gp">... </code>    <code class="n">zs</code><code class="o">=</code><code class="n">X_pca</code><code class="p">[:,</code> <code class="mi">2</code><code class="p">],</code>&#13;
<code class="gp">... </code>    <code class="n">c</code><code class="o">=</code><code class="n">y</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="n">cmap</code><code class="o">=</code><code class="s">"viridis"</code><code class="p">,</code>&#13;
<code class="gp">... </code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">ax</code><code class="o">.</code><code class="n">set_xlabel</code><code class="p">(</code><code class="s">"PC 1"</code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">ax</code><code class="o">.</code><code class="n">set_ylabel</code><code class="p">(</code><code class="s">"PC 2"</code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">ax</code><code class="o">.</code><code class="n">set_zlabel</code><code class="p">(</code><code class="s">"PC 3"</code><code class="p">)</code></pre>&#13;
&#13;
<figure><div class="figure" id="idpca_3d2">&#13;
<img alt="Matplotlib interactive 3D PCA with notebook mode." src="assets/mlpr_1712.png"/>&#13;
<h6><span class="label">Figure 17-12. </span>Matplotlib interactive 3D PCA with notebook mode.</h6>&#13;
</div></figure>&#13;
<div data-type="warning" epub:type="warning"><h6>Warning</h6>&#13;
<p>Note that switching the cell magic for matplotlib in Jupyter from:</p>&#13;
&#13;
<pre data-type="programlisting">% matplotlib inline</pre>&#13;
&#13;
<p>to:</p>&#13;
&#13;
<pre data-type="programlisting">% matplotlib notebook</pre>&#13;
&#13;
<p>can sometimes cause Jupyter to stop responding. Tread with caution<a data-startref="ix_ch17-asciidoc4" data-type="indexterm" id="idm46066883184152"/><a data-startref="ix_ch17-asciidoc3" data-type="indexterm" id="idm46066883183448"/>.<a data-startref="ix_ch17-asciidoc2" data-type="indexterm" id="idm46066883182648"/><a data-startref="ix_ch17-asciidoc1" data-type="indexterm" id="idm46066883181944"/></p>&#13;
</div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="UMAP" data-type="sect1"><div class="sect1" id="idm46066885735000">&#13;
<h1>UMAP</h1>&#13;
&#13;
<p><a data-primary="dimensionality reduction" data-secondary="UMAP" data-type="indexterm" id="ix_ch17-asciidoc5"/><a data-primary="Uniform Manifold Approximation and Projection (UMAP)" data-type="indexterm" id="ix_ch17-asciidoc6"/>Uniform Manifold Approximation and Projection <a href="https://oreil.ly/qF8RJ">(UMAP)</a> is a dimensionality reduction technique that uses manifold&#13;
learning. As such it tends to keeps similar items together&#13;
topologically. It tries to preserve both the global and the local&#13;
structure, as opposed to t-SNE (explained in <a data-type="xref" href="#tsne1">“t-SNE”</a>), which favors local structure.</p>&#13;
&#13;
<p>The Python implementation doesn’t have multicore support.</p>&#13;
&#13;
<p>Normalization of features is a good idea to get values on the same&#13;
scale.</p>&#13;
&#13;
<p><a data-primary="hyperparameters" data-secondary="UMAP and" data-type="indexterm" id="idm46066883175624"/>UMAP is very sensitive to hyperparameters (<code>n_neighbors</code>, <code>min_dist</code>, <code>n_components</code>, or&#13;
<code>metric</code>). Here are some examples:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="kn">import</code> <code class="nn">umap</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">u</code> <code class="o">=</code> <code class="n">umap</code><code class="o">.</code><code class="n">UMAP</code><code class="p">(</code><code class="n">random_state</code><code class="o">=</code><code class="mi">42</code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">X_umap</code> <code class="o">=</code> <code class="n">u</code><code class="o">.</code><code class="n">fit_transform</code><code class="p">(</code>&#13;
<code class="gp">... </code>    <code class="n">StandardScaler</code><code class="p">()</code><code class="o">.</code><code class="n">fit_transform</code><code class="p">(</code><code class="n">X</code><code class="p">)</code>&#13;
<code class="gp">... </code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">X_umap</code><code class="o">.</code><code class="n">shape</code>&#13;
<code class="go">(1309, 2)</code></pre>&#13;
&#13;
<p>Instance parameters:</p>&#13;
<dl>&#13;
<dt><code>n_neighbors=15</code></dt>&#13;
<dd>&#13;
<p>Local neighborhood size. Larger means use a global view, smaller means more local.</p>&#13;
</dd>&#13;
<dt><code>n_components=2</code></dt>&#13;
<dd>&#13;
<p>Number of dimensions for embedding.</p>&#13;
</dd>&#13;
<dt><code>metric='euclidean'</code></dt>&#13;
<dd>&#13;
<p>Metric to use for distance. Can be a function that accepts two 1D arrays and returns a float.</p>&#13;
</dd>&#13;
<dt><code>n_epochs=None</code></dt>&#13;
<dd>&#13;
<p>Number of training epochs. Default will be 200 or 500 (depending on size of data).</p>&#13;
</dd>&#13;
<dt><code>learning_rate=1.0</code></dt>&#13;
<dd>&#13;
<p>Learning rate for embedding optimization.</p>&#13;
</dd>&#13;
<dt><code>init='spectral'</code></dt>&#13;
<dd>&#13;
<p>Initialization type. Spectral embedding is the default. Can be <code>'random'</code> or a numpy array of locations.</p>&#13;
</dd>&#13;
<dt><code>min_dist=0.1</code></dt>&#13;
<dd>&#13;
<p>Between 0 and 1. Minimum distance between embedded points. Smaller means more clumps, larger means spread out.</p>&#13;
</dd>&#13;
<dt><code>spread=1.0</code></dt>&#13;
<dd>&#13;
<p>Determines distance of embedded points.</p>&#13;
</dd>&#13;
<dt><code>set_op_mix_ratio=1.0</code></dt>&#13;
<dd>&#13;
<p>Between 0 and 1: fuzzy union (1) or fuzzy intersection (0).</p>&#13;
</dd>&#13;
<dt><code>local_connectivity=1.0</code></dt>&#13;
<dd>&#13;
<p>Number of neighbors for local connectivity. As this goes up, more local connections are created.</p>&#13;
</dd>&#13;
<dt><code>repulsion_strength=1.0</code></dt>&#13;
<dd>&#13;
<p>Repulsion strength. Higher values give more weight to negative samples.</p>&#13;
</dd>&#13;
<dt><code>negative_sample_rate=5</code></dt>&#13;
<dd>&#13;
<p>Negative samples per positive sample. Higher value has more repulsion, more optimization costs, and better <span class="keep-together">accuracy.</span></p>&#13;
</dd>&#13;
<dt><code>transform_queue_size=4.0</code></dt>&#13;
<dd>&#13;
<p>Aggressiveness for nearest neighbors search. Higher value is lower performance but better accuracy.</p>&#13;
</dd>&#13;
<dt><code>a=None</code></dt>&#13;
<dd>&#13;
<p>Parameter to control embedding. If equal to <code>None</code>, UMAP determines these from <code>min_dist</code> and <code>spread</code>.</p>&#13;
</dd>&#13;
<dt><code>b=None</code></dt>&#13;
<dd>&#13;
<p>Parameter to control embedding. If equal to <code>None</code>, UMAP determines these from <code>min_dist</code> and <code>spread</code>.</p>&#13;
</dd>&#13;
<dt><code>random_state=None</code></dt>&#13;
<dd>&#13;
<p>Random seed.</p>&#13;
</dd>&#13;
<dt><code>metric_kwds=None</code></dt>&#13;
<dd>&#13;
<p>Metrics dictionary for additional parameters if function is used for <code>metric</code>. Also <code>minkowsi</code> (and other metrics) can be parameterized with this.</p>&#13;
</dd>&#13;
<dt><code>angular_rp_forest=False</code></dt>&#13;
<dd>&#13;
<p>Use angular random projection.</p>&#13;
</dd>&#13;
<dt><code>target_n_neighbors=-1</code></dt>&#13;
<dd>&#13;
<p>Number of neighbors for simplicity set.</p>&#13;
</dd>&#13;
<dt><code>target_metric='categorical'</code></dt>&#13;
<dd>&#13;
<p>For using supervised reduction. Can also be <code>'L1'</code> or <code>'L2'</code>. Also supports a function that takes two arrays from <code>X</code> as input and returns the distance value between them.</p>&#13;
</dd>&#13;
<dt><code>target_metric_kwds=None</code></dt>&#13;
<dd>&#13;
<p>Metrics dictionary to use if function is used for <span class="keep-together"><code>target_metric</code></span>.</p>&#13;
</dd>&#13;
<dt><code>target_weight=0.5</code></dt>&#13;
<dd>&#13;
<p>Weighting factor. Between 0.0 and 1.0, where 0 means base on data only, and 1 means base on target only.</p>&#13;
</dd>&#13;
<dt><code>transform_seed=42</code></dt>&#13;
<dd>&#13;
<p>Random seed for transform operations.</p>&#13;
</dd>&#13;
<dt><code>verbose=False</code></dt>&#13;
<dd>&#13;
<p>Verbosity.</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>Attributes:</p>&#13;
<dl>&#13;
<dt><code>embedding_</code></dt>&#13;
<dd>&#13;
<p>The embedding results</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>Let’s visualize the default results of UMAP on the Titanic dataset (see <a data-type="xref" href="#id54">Figure 17-13</a>):</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">fig</code><code class="p">,</code> <code class="n">ax</code> <code class="o">=</code> <code class="n">plt</code><code class="o">.</code><code class="n">subplots</code><code class="p">(</code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">8</code><code class="p">,</code> <code class="mi">4</code><code class="p">))</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">(</code><code class="n">X_umap</code><code class="p">)</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code>&#13;
<code class="gp">... </code>    <code class="n">kind</code><code class="o">=</code><code class="s">"scatter"</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="n">x</code><code class="o">=</code><code class="mi">0</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="n">y</code><code class="o">=</code><code class="mi">1</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="n">ax</code><code class="o">=</code><code class="n">ax</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="n">c</code><code class="o">=</code><code class="n">y</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="n">alpha</code><code class="o">=</code><code class="mf">0.2</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="n">cmap</code><code class="o">=</code><code class="s">"Spectral"</code><code class="p">,</code>&#13;
<code class="gp">... </code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">fig</code><code class="o">.</code><code class="n">savefig</code><code class="p">(</code><code class="s">"images/mlpr_1713.png"</code><code class="p">,</code> <code class="n">dpi</code><code class="o">=</code><code class="mi">300</code><code class="p">)</code></pre>&#13;
&#13;
<figure><div class="figure" id="id54">&#13;
<img alt="UMAP results." src="assets/mlpr_1713.png"/>&#13;
<h6><span class="label">Figure 17-13. </span>UMAP results.</h6>&#13;
</div></figure>&#13;
&#13;
<p><a data-primary="hyperparameters" data-secondary="UMAP and" data-type="indexterm" id="idm46066882954136"/>To adjust the results of UMAP, focus on the <code>n_neighbors</code> and <code>min_dist</code> hyperparameters first. Here are illustrations of changing those values (see Figures <a data-type="xref" data-xrefstyle="select:labelnumber" href="#idumap5">17-14</a> and <a data-type="xref" data-xrefstyle="select:labelnumber" href="#idumap6">17-15</a>):</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">X_std</code> <code class="o">=</code> <code class="n">StandardScaler</code><code class="p">()</code><code class="o">.</code><code class="n">fit_transform</code><code class="p">(</code><code class="n">X</code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">fig</code><code class="p">,</code> <code class="n">axes</code> <code class="o">=</code> <code class="n">plt</code><code class="o">.</code><code class="n">subplots</code><code class="p">(</code><code class="mi">2</code><code class="p">,</code> <code class="mi">2</code><code class="p">,</code> <code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">6</code><code class="p">,</code> <code class="mi">4</code><code class="p">))</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">axes</code> <code class="o">=</code> <code class="n">axes</code><code class="o">.</code><code class="n">reshape</code><code class="p">(</code><code class="mi">4</code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="k">for</code> <code class="n">i</code><code class="p">,</code> <code class="n">n</code> <code class="ow">in</code> <code class="nb">enumerate</code><code class="p">([</code><code class="mi">2</code><code class="p">,</code> <code class="mi">5</code><code class="p">,</code> <code class="mi">10</code><code class="p">,</code> <code class="mi">50</code><code class="p">]):</code>&#13;
<code class="gp">... </code>    <code class="n">ax</code> <code class="o">=</code> <code class="n">axes</code><code class="p">[</code><code class="n">i</code><code class="p">]</code>&#13;
<code class="gp">... </code>    <code class="n">u</code> <code class="o">=</code> <code class="n">umap</code><code class="o">.</code><code class="n">UMAP</code><code class="p">(</code>&#13;
<code class="gp">... </code>        <code class="n">random_state</code><code class="o">=</code><code class="mi">42</code><code class="p">,</code> <code class="n">n_neighbors</code><code class="o">=</code><code class="n">n</code>&#13;
<code class="gp">... </code>    <code class="p">)</code>&#13;
<code class="gp">... </code>    <code class="n">X_umap</code> <code class="o">=</code> <code class="n">u</code><code class="o">.</code><code class="n">fit_transform</code><code class="p">(</code><code class="n">X_std</code><code class="p">)</code>&#13;
<code class="gp">...</code>&#13;
<code class="gp">... </code>    <code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">(</code><code class="n">X_umap</code><code class="p">)</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code>&#13;
<code class="gp">... </code>        <code class="n">kind</code><code class="o">=</code><code class="s">"scatter"</code><code class="p">,</code>&#13;
<code class="gp">... </code>        <code class="n">x</code><code class="o">=</code><code class="mi">0</code><code class="p">,</code>&#13;
<code class="gp">... </code>        <code class="n">y</code><code class="o">=</code><code class="mi">1</code><code class="p">,</code>&#13;
<code class="gp">... </code>        <code class="n">ax</code><code class="o">=</code><code class="n">ax</code><code class="p">,</code>&#13;
<code class="gp">... </code>        <code class="n">c</code><code class="o">=</code><code class="n">y</code><code class="p">,</code>&#13;
<code class="gp">... </code>        <code class="n">cmap</code><code class="o">=</code><code class="s">"Spectral"</code><code class="p">,</code>&#13;
<code class="gp">... </code>        <code class="n">alpha</code><code class="o">=</code><code class="mf">0.5</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="p">)</code>&#13;
<code class="gp">... </code>    <code class="n">ax</code><code class="o">.</code><code class="n">set_title</code><code class="p">(</code><code class="n">f</code><code class="s">"nn={n}"</code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">plt</code><code class="o">.</code><code class="n">tight_layout</code><code class="p">()</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">fig</code><code class="o">.</code><code class="n">savefig</code><code class="p">(</code><code class="s">"images/mlpr_1714.png"</code><code class="p">,</code> <code class="n">dpi</code><code class="o">=</code><code class="mi">300</code><code class="p">)</code></pre>&#13;
&#13;
<figure><div class="figure" id="idumap5">&#13;
<img alt="UMAP results adjusting +n_neighbors+." src="assets/mlpr_1714.png"/>&#13;
<h6><span class="label">Figure 17-14. </span>UMAP results adjusting <code>n_neighbors</code>.</h6>&#13;
</div></figure>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">fig</code><code class="p">,</code> <code class="n">axes</code> <code class="o">=</code> <code class="n">plt</code><code class="o">.</code><code class="n">subplots</code><code class="p">(</code><code class="mi">2</code><code class="p">,</code> <code class="mi">2</code><code class="p">,</code> <code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">6</code><code class="p">,</code> <code class="mi">4</code><code class="p">))</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">axes</code> <code class="o">=</code> <code class="n">axes</code><code class="o">.</code><code class="n">reshape</code><code class="p">(</code><code class="mi">4</code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="k">for</code> <code class="n">i</code><code class="p">,</code> <code class="n">n</code> <code class="ow">in</code> <code class="nb">enumerate</code><code class="p">([</code><code class="mi">0</code><code class="p">,</code> <code class="mf">0.33</code><code class="p">,</code> <code class="mf">0.66</code><code class="p">,</code> <code class="mf">0.99</code><code class="p">]):</code>&#13;
<code class="gp">... </code>    <code class="n">ax</code> <code class="o">=</code> <code class="n">axes</code><code class="p">[</code><code class="n">i</code><code class="p">]</code>&#13;
<code class="gp">... </code>    <code class="n">u</code> <code class="o">=</code> <code class="n">umap</code><code class="o">.</code><code class="n">UMAP</code><code class="p">(</code><code class="n">random_state</code><code class="o">=</code><code class="mi">42</code><code class="p">,</code> <code class="n">min_dist</code><code class="o">=</code><code class="n">n</code><code class="p">)</code>&#13;
<code class="gp">... </code>    <code class="n">X_umap</code> <code class="o">=</code> <code class="n">u</code><code class="o">.</code><code class="n">fit_transform</code><code class="p">(</code><code class="n">X_std</code><code class="p">)</code>&#13;
<code class="gp">... </code>    <code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">(</code><code class="n">X_umap</code><code class="p">)</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code>&#13;
<code class="gp">... </code>        <code class="n">kind</code><code class="o">=</code><code class="s">"scatter"</code><code class="p">,</code>&#13;
<code class="gp">... </code>        <code class="n">x</code><code class="o">=</code><code class="mi">0</code><code class="p">,</code>&#13;
<code class="gp">... </code>        <code class="n">y</code><code class="o">=</code><code class="mi">1</code><code class="p">,</code>&#13;
<code class="gp">... </code>        <code class="n">ax</code><code class="o">=</code><code class="n">ax</code><code class="p">,</code>&#13;
<code class="gp">... </code>        <code class="n">c</code><code class="o">=</code><code class="n">y</code><code class="p">,</code>&#13;
<code class="gp">... </code>        <code class="n">cmap</code><code class="o">=</code><code class="s">"Spectral"</code><code class="p">,</code>&#13;
<code class="gp">... </code>        <code class="n">alpha</code><code class="o">=</code><code class="mf">0.5</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="p">)</code>&#13;
<code class="gp">... </code>    <code class="n">ax</code><code class="o">.</code><code class="n">set_title</code><code class="p">(</code><code class="n">f</code><code class="s">"min_dist={n}"</code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">plt</code><code class="o">.</code><code class="n">tight_layout</code><code class="p">()</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">fig</code><code class="o">.</code><code class="n">savefig</code><code class="p">(</code><code class="s">"images/mlpr_1715.png"</code><code class="p">,</code> <code class="n">dpi</code><code class="o">=</code><code class="mi">300</code><code class="p">)</code></pre>&#13;
&#13;
<figure><div class="figure" id="idumap6">&#13;
<img alt="UMAP results adjusting +min_dist+." src="assets/mlpr_1715.png"/>&#13;
<h6><span class="label">Figure 17-15. </span>UMAP results adjusting <code>min_dist</code>.</h6>&#13;
</div></figure>&#13;
&#13;
<p>Sometimes PCA is performed before UMAP to reduce the dimensions and speed up the computations.<a data-startref="ix_ch17-asciidoc6" data-type="indexterm" id="idm46066882501256"/><a data-startref="ix_ch17-asciidoc5" data-type="indexterm" id="idm46066882500552"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="t-SNE" data-type="sect1"><div class="sect1" id="tsne1">&#13;
<h1>t-SNE</h1>&#13;
&#13;
<p><a data-primary="dimensionality reduction" data-secondary="t-SNE" data-type="indexterm" id="ix_ch17-asciidoc7"/><a data-primary="t-Distributed Stochastic Neighboring Embedding (t-SNE)" data-type="indexterm" id="ix_ch17-asciidoc8"/>The t-Distributed Stochastic Neighboring Embedding (t-SNE) technique is a visualization and dimensionality reduction technique. It uses distributions of the input and low dimension embedding, and minimizes the joint probabilities between them. Because this is computationally intensive, you might not be able to use this technique with a large dataset.</p>&#13;
&#13;
<p><a data-primary="hyperparameters" data-secondary="t-SNE and" data-type="indexterm" id="idm46066882495272"/>One characteristic of t-SNE is that it is quite sensitive to hyperparameters. Also, while it preserves local clusters quite well, global information is not preserved. As such, the distance between clusters is meaningless. Finally, this is not a deterministic algorithm and may not converge.</p>&#13;
&#13;
<p>It is a good idea to standardize the data before using this <span class="keep-together">technique:</span></p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="kn">from</code> <code class="nn">sklearn.manifold</code> <code class="kn">import</code> <code class="n">TSNE</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">X_std</code> <code class="o">=</code> <code class="n">StandardScaler</code><code class="p">()</code><code class="o">.</code><code class="n">fit_transform</code><code class="p">(</code><code class="n">X</code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">ts</code> <code class="o">=</code> <code class="n">TSNE</code><code class="p">()</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">X_tsne</code> <code class="o">=</code> <code class="n">ts</code><code class="o">.</code><code class="n">fit_transform</code><code class="p">(</code><code class="n">X_std</code><code class="p">)</code></pre>&#13;
&#13;
<p>Instance parameters:</p>&#13;
<dl>&#13;
<dt><code>n_components=2</code></dt>&#13;
<dd>&#13;
<p>Number of dimensions for embedding.</p>&#13;
</dd>&#13;
<dt><code>perplexity=30.0</code></dt>&#13;
<dd>&#13;
<p>Suggested values are between 5 and 50. Smaller numbers tend to make tighter clumps.</p>&#13;
</dd>&#13;
<dt><code>early_exaggeration=12.0</code></dt>&#13;
<dd>&#13;
<p>Controls cluster tightness and spacing between them. Larger values mean larger spacing.</p>&#13;
</dd>&#13;
<dt><code>learning_rate=200.0</code></dt>&#13;
<dd>&#13;
<p>Usually between 10 and 1000. If data looks like a ball, lower it. If data looks compressed, raise it.</p>&#13;
</dd>&#13;
<dt><code>n_iter=1000</code></dt>&#13;
<dd>&#13;
<p>Number of iterations.</p>&#13;
</dd>&#13;
<dt><code>n_iter_without_progress=300</code></dt>&#13;
<dd>&#13;
<p>Abort if no progress after this number of iterations.</p>&#13;
</dd>&#13;
<dt><code>min_grad_norm=1e-07</code></dt>&#13;
<dd>&#13;
<p>Optimization stops if the gradient norm is below this value.</p>&#13;
</dd>&#13;
<dt><code>metric='euclidean'</code></dt>&#13;
<dd>&#13;
<p>Distance metric from <code>scipy.spatial.distance.pdist</code>, <code>pairwise.PAIRWISE_DISTANCE_METRIC</code>, or a function.</p>&#13;
</dd>&#13;
<dt><code>init='random'</code></dt>&#13;
<dd>&#13;
<p>Embedding initialization.</p>&#13;
</dd>&#13;
<dt><code>verbose=0</code></dt>&#13;
<dd>&#13;
<p>Verbosity.</p>&#13;
</dd>&#13;
<dt><code>random_state=None</code></dt>&#13;
<dd>&#13;
<p>Random seed.</p>&#13;
</dd>&#13;
<dt><code>method='barnes_hut'</code></dt>&#13;
<dd>&#13;
<p>Gradient calculation algorithm.</p>&#13;
</dd>&#13;
<dt><code>angle=0.5</code></dt>&#13;
<dd>&#13;
<p>For gradient calculation. Less than .2 increases runtime. Greater than .8 increases error.</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>Attributes:</p>&#13;
<dl>&#13;
<dt><code>embedding_</code></dt>&#13;
<dd>&#13;
<p>Embedding vectors</p>&#13;
</dd>&#13;
<dt><code>kl_divergence_</code></dt>&#13;
<dd>&#13;
<p>Kullback-Leibler divergence</p>&#13;
</dd>&#13;
<dt><code>n_iter_</code></dt>&#13;
<dd>&#13;
<p>Number of iterations</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p><a data-primary="matplotlib" data-secondary="t-SNE visualization" data-type="indexterm" id="idm46066882442824"/>Here’s a visualization of the results of t-SNE using matplotlib (see <a data-type="xref" href="#idtsne1">Figure 17-16</a>):</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">fig</code><code class="p">,</code> <code class="n">ax</code> <code class="o">=</code> <code class="n">plt</code><code class="o">.</code><code class="n">subplots</code><code class="p">(</code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">6</code><code class="p">,</code> <code class="mi">4</code><code class="p">))</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">colors</code> <code class="o">=</code> <code class="p">[</code><code class="s">"rg"</code><code class="p">[</code><code class="n">j</code><code class="p">]</code> <code class="k">for</code> <code class="n">j</code> <code class="ow">in</code> <code class="n">y</code><code class="p">]</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">scat</code> <code class="o">=</code> <code class="n">ax</code><code class="o">.</code><code class="n">scatter</code><code class="p">(</code>&#13;
<code class="gp">... </code>    <code class="n">X_tsne</code><code class="p">[:,</code> <code class="mi">0</code><code class="p">],</code>&#13;
<code class="gp">... </code>    <code class="n">X_tsne</code><code class="p">[:,</code> <code class="mi">1</code><code class="p">],</code>&#13;
<code class="gp">... </code>    <code class="n">c</code><code class="o">=</code><code class="n">colors</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="n">alpha</code><code class="o">=</code><code class="mf">0.5</code><code class="p">,</code>&#13;
<code class="gp">... </code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">ax</code><code class="o">.</code><code class="n">set_xlabel</code><code class="p">(</code><code class="s">"Embedding 1"</code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">ax</code><code class="o">.</code><code class="n">set_ylabel</code><code class="p">(</code><code class="s">"Embedding 2"</code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">fig</code><code class="o">.</code><code class="n">savefig</code><code class="p">(</code><code class="s">"images/mlpr_1716.png"</code><code class="p">,</code> <code class="n">dpi</code><code class="o">=</code><code class="mi">300</code><code class="p">)</code></pre>&#13;
&#13;
<figure><div class="figure" id="idtsne1">&#13;
<img alt="t-SNE result with matplotlib." src="assets/mlpr_1716.png"/>&#13;
<h6><span class="label">Figure 17-16. </span>t-SNE result with matplotlib.</h6>&#13;
</div></figure>&#13;
&#13;
<p>Changing the value of <code>perplexity</code> can have big effects on the plot (see <a data-type="xref" href="#idtsne2">Figure 17-17</a>). Here are a few different values:<a data-startref="ix_ch17-asciidoc8" data-type="indexterm" id="idm46066882298952"/><a data-startref="ix_ch17-asciidoc7" data-type="indexterm" id="idm46066882298280"/></p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">fig</code><code class="p">,</code> <code class="n">axes</code> <code class="o">=</code> <code class="n">plt</code><code class="o">.</code><code class="n">subplots</code><code class="p">(</code><code class="mi">2</code><code class="p">,</code> <code class="mi">2</code><code class="p">,</code> <code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">6</code><code class="p">,</code> <code class="mi">4</code><code class="p">))</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">axes</code> <code class="o">=</code> <code class="n">axes</code><code class="o">.</code><code class="n">reshape</code><code class="p">(</code><code class="mi">4</code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="k">for</code> <code class="n">i</code><code class="p">,</code> <code class="n">n</code> <code class="ow">in</code> <code class="nb">enumerate</code><code class="p">((</code><code class="mi">2</code><code class="p">,</code> <code class="mi">30</code><code class="p">,</code> <code class="mi">50</code><code class="p">,</code> <code class="mi">100</code><code class="p">)):</code>&#13;
<code class="gp">... </code>    <code class="n">ax</code> <code class="o">=</code> <code class="n">axes</code><code class="p">[</code><code class="n">i</code><code class="p">]</code>&#13;
<code class="gp">... </code>    <code class="n">t</code> <code class="o">=</code> <code class="n">TSNE</code><code class="p">(</code><code class="n">random_state</code><code class="o">=</code><code class="mi">42</code><code class="p">,</code> <code class="n">perplexity</code><code class="o">=</code><code class="n">n</code><code class="p">)</code>&#13;
<code class="gp">... </code>    <code class="n">X_tsne</code> <code class="o">=</code> <code class="n">t</code><code class="o">.</code><code class="n">fit_transform</code><code class="p">(</code><code class="n">X</code><code class="p">)</code>&#13;
<code class="gp">... </code>    <code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">(</code><code class="n">X_tsne</code><code class="p">)</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code>&#13;
<code class="gp">... </code>        <code class="n">kind</code><code class="o">=</code><code class="s">"scatter"</code><code class="p">,</code>&#13;
<code class="gp">... </code>        <code class="n">x</code><code class="o">=</code><code class="mi">0</code><code class="p">,</code>&#13;
<code class="gp">... </code>        <code class="n">y</code><code class="o">=</code><code class="mi">1</code><code class="p">,</code>&#13;
<code class="gp">... </code>        <code class="n">ax</code><code class="o">=</code><code class="n">ax</code><code class="p">,</code>&#13;
<code class="gp">... </code>        <code class="n">c</code><code class="o">=</code><code class="n">y</code><code class="p">,</code>&#13;
<code class="gp">... </code>        <code class="n">cmap</code><code class="o">=</code><code class="s">"Spectral"</code><code class="p">,</code>&#13;
<code class="gp">... </code>        <code class="n">alpha</code><code class="o">=</code><code class="mf">0.5</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="p">)</code>&#13;
<code class="gp">... </code>    <code class="n">ax</code><code class="o">.</code><code class="n">set_title</code><code class="p">(</code><code class="n">f</code><code class="s">"perplexity={n}"</code><code class="p">)</code>&#13;
<code class="gp">... </code><code class="n">plt</code><code class="o">.</code><code class="n">tight_layout</code><code class="p">()</code>&#13;
<code class="gp">... </code><code class="n">fig</code><code class="o">.</code><code class="n">savefig</code><code class="p">(</code><code class="s">"images/mlpr_1717.png"</code><code class="p">,</code> <code class="n">dpi</code><code class="o">=</code><code class="mi">300</code><code class="p">)</code></pre>&#13;
&#13;
<figure><div class="figure" id="idtsne2">&#13;
<img alt="Changing +perplexity+ for t-SNE." src="assets/mlpr_1717.png"/>&#13;
<h6><span class="label">Figure 17-17. </span>Changing <code>perplexity</code> for t-SNE.</h6>&#13;
</div></figure>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="PHATE" data-type="sect1"><div class="sect1" id="idm46066882499288">&#13;
<h1>PHATE</h1>&#13;
&#13;
<p><a data-primary="dimensionality reduction" data-secondary="PHATE" data-type="indexterm" id="ix_ch17-asciidoc9"/><a data-primary="PHATE (Potential of Heat-diffusion for Affinity-based Trajectory Embedding)" data-type="indexterm" id="ix_ch17-asciidoc10"/><a data-primary="Potential of Heat-diffusion for Affinity-based Trajectory Embedding (PHATE)" data-type="indexterm" id="ix_ch17-asciidoc11"/>Potential of Heat-diffusion for Affinity-based Trajectory Embedding (<a href="https://phate.readthedocs.io">PHATE</a>) is a tool for visualization of high dimensional data. It tends to keep both global structure (like PCA) and local structure (like t-SNE).</p>&#13;
&#13;
<p>PHATE first encodes local information (points close to each other should remain close). It uses “diffusion” to discover global data, then reduce dimensionality:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="kn">import</code> <code class="nn">phate</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">p</code> <code class="o">=</code> <code class="n">phate</code><code class="o">.</code><code class="n">PHATE</code><code class="p">(</code><code class="n">random_state</code><code class="o">=</code><code class="mi">42</code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">X_phate</code> <code class="o">=</code> <code class="n">p</code><code class="o">.</code><code class="n">fit_transform</code><code class="p">(</code><code class="n">X</code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">X_phate</code><code class="o">.</code><code class="n">shape</code></pre>&#13;
&#13;
<p class="pagebreak-before">Instance parameters:</p>&#13;
<dl>&#13;
<dt><code>n_components=2</code></dt>&#13;
<dd>&#13;
<p>Number of dimensions.</p>&#13;
</dd>&#13;
<dt><code>knn=5</code></dt>&#13;
<dd>&#13;
<p>Number of neighbors for the kernel. Increase if the embedding is disconnected or dataset is larger than 100,000 samples.</p>&#13;
</dd>&#13;
<dt><code>decay=40</code></dt>&#13;
<dd>&#13;
<p>Decay rate of kernel. Lowering this value increases graph connectivity.</p>&#13;
</dd>&#13;
<dt><code>n_landmark=2000</code></dt>&#13;
<dd>&#13;
<p>Landmarks to use.</p>&#13;
</dd>&#13;
<dt><code>t='auto'</code></dt>&#13;
<dd>&#13;
<p>Diffusion power. Smoothing is performed on the data. Increase if embedding lacks structure. Decrease if structure is tight and compact.</p>&#13;
</dd>&#13;
<dt><code>gamma=1</code></dt>&#13;
<dd>&#13;
<p>Log potential (between -1 and 1). If embeddings are concentrated around a single point, try setting this to 0.</p>&#13;
</dd>&#13;
<dt><code>n_pca=100</code></dt>&#13;
<dd>&#13;
<p>Number of principle components for neighborhood <span class="keep-together">calculation.</span></p>&#13;
</dd>&#13;
<dt><code>knn_dist='euclidean'</code></dt>&#13;
<dd>&#13;
<p>KNN metric.</p>&#13;
</dd>&#13;
<dt><code>mds_dist='euclidean'</code></dt>&#13;
<dd>&#13;
<p>Multidimensional scaling (MDS) metric.</p>&#13;
</dd>&#13;
<dt><code>mds='metric'</code></dt>&#13;
<dd>&#13;
<p>MDS algorithm for dimension reduction.</p>&#13;
</dd>&#13;
<dt><code>n_jobs=1</code></dt>&#13;
<dd>&#13;
<p>Number of CPUs to use.</p>&#13;
</dd>&#13;
<dt><code>random_state=None</code></dt>&#13;
<dd>&#13;
<p>Random seed.</p>&#13;
</dd>&#13;
<dt><code>verbose=1</code></dt>&#13;
<dd>&#13;
<p>Verbosity.</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>Attributes (note that these aren’t followed by <code>_</code>):</p>&#13;
<dl>&#13;
<dt><code>X</code></dt>&#13;
<dd>&#13;
<p>Input data</p>&#13;
</dd>&#13;
<dt><code>embedding</code></dt>&#13;
<dd>&#13;
<p>Embedding space</p>&#13;
</dd>&#13;
<dt><code>diff_op</code></dt>&#13;
<dd>&#13;
<p>Diffusion operator</p>&#13;
</dd>&#13;
<dt><code>graph</code></dt>&#13;
<dd>&#13;
<p>KNN graph built from input</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>Here is an example of using PHATE (see <a data-type="xref" href="#idphate1">Figure 17-18</a>):</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">fig</code><code class="p">,</code> <code class="n">ax</code> <code class="o">=</code> <code class="n">plt</code><code class="o">.</code><code class="n">subplots</code><code class="p">(</code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">6</code><code class="p">,</code> <code class="mi">4</code><code class="p">))</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">phate</code><code class="o">.</code><code class="n">plot</code><code class="o">.</code><code class="n">scatter2d</code><code class="p">(</code><code class="n">p</code><code class="p">,</code> <code class="n">c</code><code class="o">=</code><code class="n">y</code><code class="p">,</code> <code class="n">ax</code><code class="o">=</code><code class="n">ax</code><code class="p">,</code> <code class="n">alpha</code><code class="o">=</code><code class="mf">0.5</code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">fig</code><code class="o">.</code><code class="n">savefig</code><code class="p">(</code><code class="s">"images/mlpr_1718.png"</code><code class="p">,</code> <code class="n">dpi</code><code class="o">=</code><code class="mi">300</code><code class="p">)</code></pre>&#13;
&#13;
<figure><div class="figure" id="idphate1">&#13;
<img alt="PHATE results." src="assets/mlpr_1718.png"/>&#13;
<h6><span class="label">Figure 17-18. </span>PHATE results.</h6>&#13;
</div></figure>&#13;
&#13;
<p class="pagebreak-before">As noted in the instance parameters above, there are a few parameters that&#13;
we can adjust to change the behavior of the model.&#13;
Below is an example of adjusting the <code>knn</code> parameter (see <a data-type="xref" href="#idphate-nn">Figure 17-19</a>). Note that if we use&#13;
the <code>.set_params</code> method, it will speed up the calculation as it uses the&#13;
precomputed graph and diffusion operator<a data-startref="ix_ch17-asciidoc11" data-type="indexterm" id="idm46066881905784"/><a data-startref="ix_ch17-asciidoc10" data-type="indexterm" id="idm46066881905080"/><a data-startref="ix_ch17-asciidoc9" data-type="indexterm" id="idm46066881904408"/>:<a data-startref="ix_ch17-asciidoc0" data-type="indexterm" id="idm46066881903608"/></p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">fig</code><code class="p">,</code> <code class="n">axes</code> <code class="o">=</code> <code class="n">plt</code><code class="o">.</code><code class="n">subplots</code><code class="p">(</code><code class="mi">2</code><code class="p">,</code> <code class="mi">2</code><code class="p">,</code> <code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">6</code><code class="p">,</code> <code class="mi">4</code><code class="p">))</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">axes</code> <code class="o">=</code> <code class="n">axes</code><code class="o">.</code><code class="n">reshape</code><code class="p">(</code><code class="mi">4</code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">p</code> <code class="o">=</code> <code class="n">phate</code><code class="o">.</code><code class="n">PHATE</code><code class="p">(</code><code class="n">random_state</code><code class="o">=</code><code class="mi">42</code><code class="p">,</code> <code class="n">n_jobs</code><code class="o">=-</code><code class="mi">1</code><code class="p">)</code>&#13;
&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="k">for</code> <code class="n">i</code><code class="p">,</code> <code class="n">n</code> <code class="ow">in</code> <code class="nb">enumerate</code><code class="p">((</code><code class="mi">2</code><code class="p">,</code> <code class="mi">5</code><code class="p">,</code> <code class="mi">20</code><code class="p">,</code> <code class="mi">100</code><code class="p">)):</code>&#13;
<code class="gp">... </code>    <code class="n">ax</code> <code class="o">=</code> <code class="n">axes</code><code class="p">[</code><code class="n">i</code><code class="p">]</code>&#13;
<code class="gp">... </code>    <code class="n">p</code><code class="o">.</code><code class="n">set_params</code><code class="p">(</code><code class="n">knn</code><code class="o">=</code><code class="n">n</code><code class="p">)</code>&#13;
<code class="gp">... </code>    <code class="n">X_phate</code> <code class="o">=</code> <code class="n">p</code><code class="o">.</code><code class="n">fit_transform</code><code class="p">(</code><code class="n">X</code><code class="p">)</code>&#13;
<code class="gp">... </code>    <code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">(</code><code class="n">X_phate</code><code class="p">)</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code>&#13;
<code class="gp">... </code>        <code class="n">kind</code><code class="o">=</code><code class="s">"scatter"</code><code class="p">,</code>&#13;
<code class="gp">... </code>        <code class="n">x</code><code class="o">=</code><code class="mi">0</code><code class="p">,</code>&#13;
<code class="gp">... </code>        <code class="n">y</code><code class="o">=</code><code class="mi">1</code><code class="p">,</code>&#13;
<code class="gp">... </code>        <code class="n">ax</code><code class="o">=</code><code class="n">ax</code><code class="p">,</code>&#13;
<code class="gp">... </code>        <code class="n">c</code><code class="o">=</code><code class="n">y</code><code class="p">,</code>&#13;
<code class="gp">... </code>        <code class="n">cmap</code><code class="o">=</code><code class="s">"Spectral"</code><code class="p">,</code>&#13;
<code class="gp">... </code>        <code class="n">alpha</code><code class="o">=</code><code class="mf">0.5</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="p">)</code>&#13;
<code class="gp">... </code>    <code class="n">ax</code><code class="o">.</code><code class="n">set_title</code><code class="p">(</code><code class="n">f</code><code class="s">"knn={n}"</code><code class="p">)</code>&#13;
<code class="gp">... </code><code class="n">plt</code><code class="o">.</code><code class="n">tight_layout</code><code class="p">()</code>&#13;
<code class="gp">... </code><code class="n">fig</code><code class="o">.</code><code class="n">savefig</code><code class="p">(</code><code class="s">"images/mlpr_1719.png"</code><code class="p">,</code> <code class="n">dpi</code><code class="o">=</code><code class="mi">300</code><code class="p">)</code></pre>&#13;
&#13;
<figure><div class="figure" id="idphate-nn">&#13;
<img alt="Changing the +knn+ parameter for PHATE." src="assets/mlpr_1719.png"/>&#13;
<h6><span class="label">Figure 17-19. </span>Changing the <code>knn</code> parameter for PHATE.</h6>&#13;
</div></figure>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section></body></html>