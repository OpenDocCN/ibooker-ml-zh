<html><head></head><body>
<div id="sbo-rt-content"><section data-pdf-bookmark="Chapter 3. Data Wrangling" data-type="chapter" epub:type="chapter"><div class="chapter" id="data-wrangling">
<h1><span class="label">Chapter 3. </span>Data Wrangling</h1>
<section data-pdf-bookmark="3.0 Introduction" data-type="sect1"><div class="sect1" id="id59">
<h1>3.0 Introduction</h1>
<p><em>Data wrangling</em> is a broad term used, often informally, to describe the process of transforming raw data into a clean, organized format ready for use. For us, data wrangling is only one step in preprocessing our data, but it is an important step.</p>
<p>The most common data structure used to “wrangle” data is the <a data-primary="dataframes (DataFrame object)" data-type="indexterm" id="ix_dataframe_ch3"/>dataframe, which can be both intuitive and incredibly versatile. Dataframes are tabular, meaning that they are based on rows and columns like you would see in a spreadsheet. Here is a dataframe created from data about passengers on the <em>Titanic</em>:</p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># Load library</code>
<code class="kn">import</code> <code class="nn">pandas</code> <code class="k">as</code> <code class="nn">pd</code>

<code class="c1"># Create URL</code>
<code class="n">url</code> <code class="o">=</code> <code class="s1">'https://raw.githubusercontent.com/chrisalbon/sim_data/master/titanic.csv'</code>

<code class="c1"># Load data as a dataframe</code>
<code class="n">dataframe</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">read_csv</code><code class="p">(</code><code class="n">url</code><code class="p">)</code>

<code class="c1"># Show first five rows</code>
<code class="n">dataframe</code><code class="o">.</code><code class="n">head</code><code class="p">(</code><code class="mi">5</code><code class="p">)</code></pre>
<table>
<thead>
<tr>
<th/>
<th>Name</th>
<th>PClass</th>
<th>Age</th>
<th>Sex</th>
<th>Survived</th>
<th>SexCode</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>Allen, Miss Elisabeth Walton</td>
<td>1st</td>
<td>29.00</td>
<td>female</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<th>1</th>
<td>Allison, Miss Helen Loraine</td>
<td>1st</td>
<td>2.00</td>
<td>female</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<th>2</th>
<td>Allison, Mr Hudson Joshua Creighton</td>
<td>1st</td>
<td>30.00</td>
<td>male</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<th>3</th>
<td>Allison, Mrs Hudson JC (Bessie Waldo Daniels)</td>
<td>1st</td>
<td>25.00</td>
<td>female</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<th>4</th>
<td>Allison, Master Hudson Trevor</td>
<td>1st</td>
<td>0.92</td>
<td>male</td>
<td>1</td>
<td>0</td>
</tr>
</tbody>
</table>
<p>There are three important things to notice in this dataframe.</p>
<p>First, in a dataframe each row corresponds to one <a data-primary="observations" data-type="indexterm" id="id1054"/>observation (e.g., a
passenger) and each column corresponds to one feature (gender, age,
etc.). For example, by looking at the first observation we can see that
Miss Elisabeth Walton Allen stayed in first class, was 29 years old, was female, and survived the disaster.</p>
<p>Second, each column contains a name (e.g., <code>Name</code>, <code>PClass</code>, <code>Age</code>) and each row contains an index number (e.g., <code>0</code> for the lucky Miss Elisabeth Walton Allen). We will use these to select and manipulate observations and features.</p>
<p>Third, two columns, <code>Sex</code> and <code>SexCode</code>, contain the same information in different formats. In <code>Sex</code>, a woman is indicated by the string <code>female</code>, while in <code>SexCode</code>, a woman is indicated by using the integer <code>1</code>. We will want all our features to be unique, and therefore we will need to remove one of these columns.</p>
<p>In this chapter, we will cover a wide variety of techniques to
manipulate dataframes using the pandas library with the goal of
creating a clean, well-structured set of observations for further
preprocessing.</p>
</div></section>
<section data-pdf-bookmark="3.1 Creating a Dataframe" data-type="sect1"><div class="sect1" id="creating-a-data-frame">
<h1>3.1 Creating a Dataframe</h1>
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id468">
<h2>Problem</h2>
<p>You want to create a new <a data-primary="dataframes (DataFrame object)" data-secondary="creating DataFrame object" data-type="indexterm" id="ix_dataframe_cr_obj"/>dataframe.</p>
</div></section>
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id60">
<h2>Solution</h2>
<p>pandas has many methods for creating a new DataFrame object. One easy method is to instantiate a <code>DataFrame</code> using a Python <a data-primary="dictionaries of features, encoding" data-type="indexterm" id="id1055"/>dictionary. In the dictionary, each key is a column name and the value is a list, where each item corresponds to a row:</p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># Load library</code>
<code class="kn">import</code> <code class="nn">pandas</code> <code class="k">as</code> <code class="nn">pd</code>

<code class="c1"># Create a dictionary</code>
<code class="n">dictionary</code> <code class="o">=</code> <code class="p">{</code>
  <code class="s2">"Name"</code><code class="p">:</code> <code class="p">[</code><code class="s1">'Jacky Jackson'</code><code class="p">,</code> <code class="s1">'Steven Stevenson'</code><code class="p">],</code>
  <code class="s2">"Age"</code><code class="p">:</code> <code class="p">[</code><code class="mi">38</code><code class="p">,</code> <code class="mi">25</code><code class="p">],</code>
  <code class="s2">"Driver"</code><code class="p">:</code> <code class="p">[</code><code class="kc">True</code><code class="p">,</code> <code class="kc">False</code><code class="p">]</code>
<code class="p">}</code>

<code class="c1"># Create DataFrame</code>
<code class="n">dataframe</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">(</code><code class="n">dictionary</code><code class="p">)</code>

<code class="c1"># Show DataFrame</code>
<code class="n">dataframe</code></pre>
<table>
<thead>
<tr>
<th/>
<th>Name</th>
<th>Age</th>
<th>Driver</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>Jacky Jackson</td>
<td>38</td>
<td>True</td>
</tr>
<tr>
<th>1</th>
<td>Steven Stevenson</td>
<td>25</td>
<td>False</td>
</tr>
</tbody>
</table>
<p>It’s easy to add new columns to any dataframe using a list of values:</p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># Add a column for eye color</code>
<code class="n">dataframe</code><code class="p">[</code><code class="s2">"Eyes"</code><code class="p">]</code> <code class="o">=</code> <code class="p">[</code><code class="s2">"Brown"</code><code class="p">,</code> <code class="s2">"Blue"</code><code class="p">]</code>

<code class="c1"># Show DataFrame</code>
<code class="n">dataframe</code></pre>
<table>
<thead>
<tr>
<th/>
<th>Name</th>
<th>Age</th>
<th>Driver</th>
<th>Eyes</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>Jacky Jackson</td>
<td>38</td>
<td>True</td>
<td>Brown</td>
</tr>
<tr>
<th>1</th>
<td>Steven Stevenson</td>
<td>25</td>
<td>False</td>
<td>Blue</td>
</tr>
</tbody>
</table>
</div></section>
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id61">
<h2>Discussion</h2>
<p>pandas offers what can feel like an infinite number of ways to create
a DataFrame. In the real world, creating an empty DataFrame and then
populating it will almost never happen. Instead, our DataFrames will be
created from real data we have loaded from other sources (e.g., a CSV
file or database).<a data-primary="" data-startref="ix_dataframe_cr_obj" data-type="indexterm" id="id1056"/></p>
</div></section>
</div></section>
<section data-pdf-bookmark="3.2 Getting Information about the Data" data-type="sect1"><div class="sect1" id="getting-info-about-the-data">
<h1>3.2 Getting Information about the Data</h1>
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id469">
<h2>Problem</h2>
<p>You want to view some characteristics of a <a data-primary="dataframes (DataFrame object)" data-secondary="getting information about data from" data-type="indexterm" id="id1057"/>DataFrame.</p>
</div></section>
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id62">
<h2>Solution</h2>
<p>One of the easiest things we can do after loading the data is view the first few rows <a data-primary="head method" data-type="indexterm" id="id1058"/>using <code>head</code>:</p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># Load library</code>
<code class="kn">import</code> <code class="nn">pandas</code> <code class="k">as</code> <code class="nn">pd</code>

<code class="c1"># Create URL</code>
<code class="n">url</code> <code class="o">=</code> <code class="s1">'https://raw.githubusercontent.com/chrisalbon/sim_data/master/titanic.csv'</code>

<code class="c1"># Load data</code>
<code class="n">dataframe</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">read_csv</code><code class="p">(</code><code class="n">url</code><code class="p">)</code>

<code class="c1"># Show two rows</code>
<code class="n">dataframe</code><code class="o">.</code><code class="n">head</code><code class="p">(</code><code class="mi">2</code><code class="p">)</code></pre>
<table>
<thead>
<tr>
<th/>
<th>Name</th>
<th>PClass</th>
<th>Age</th>
<th>Sex</th>
<th>Survived</th>
<th>SexCode</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>Allen, Miss Elisabeth Walton</td>
<td>1st</td>
<td>29.0</td>
<td>female</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<th>1</th>
<td>Allison, Miss Helen Loraine</td>
<td>1st</td>
<td>2.0</td>
<td>female</td>
<td>0</td>
<td>1</td>
</tr>
</tbody>
</table>
<p>We can also take a look at the number of rows and columns:</p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># Show dimensions</code>
<code class="n">dataframe</code><code class="o">.</code><code class="n">shape</code></pre>
<pre data-type="programlisting">(1313, 6)</pre>
<p>We can get <a data-primary="describe method" data-type="indexterm" id="id1059"/>descriptive statistics for any numeric columns using <code>describe</code>:</p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># Show statistics</code>
<code class="n">dataframe</code><code class="o">.</code><code class="n">describe</code><code class="p">()</code></pre>
<table>
<thead>
<tr>
<th/>
<th>Age</th>
<th>Survived</th>
<th>SexCode</th>
</tr>
</thead>
<tbody>
<tr>
<th>count</th>
<td>756.000000</td>
<td>1313.000000</td>
<td>1313.000000</td>
</tr>
<tr>
<th>mean</th>
<td>30.397989</td>
<td>0.342727</td>
<td>0.351866</td>
</tr>
<tr>
<th>std</th>
<td>14.259049</td>
<td>0.474802</td>
<td>0.477734</td>
</tr>
<tr>
<th>min</th>
<td>0.170000</td>
<td>0.000000</td>
<td>0.000000</td>
</tr>
<tr>
<th>25%</th>
<td>21.000000</td>
<td>0.000000</td>
<td>0.000000</td>
</tr>
<tr>
<th>50%</th>
<td>28.000000</td>
<td>0.000000</td>
<td>0.000000</td>
</tr>
<tr>
<th>75%</th>
<td>39.000000</td>
<td>1.000000</td>
<td>1.000000</td>
</tr>
<tr>
<th>max</th>
<td>71.000000</td>
<td>1.000000</td>
<td>1.000000</td>
</tr>
</tbody>
</table>
<p>Additionally, the <code>info</code> method<a data-primary="info method" data-type="indexterm" id="id1060"/> can show some helpful information:</p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># Show info</code>
<code class="n">dataframe</code><code class="o">.</code><code class="n">info</code><code class="p">()</code></pre>
<pre data-type="programlisting">&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 1313 entries, 0 to 1312
Data columns (total 6 columns):
 #   Column    Non-Null Count  Dtype
---  ------    --------------  -----
 0   Name      1313 non-null   object
 1   PClass    1313 non-null   object
 2   Age       756 non-null    float64
 3   Sex       1313 non-null   object
 4   Survived  1313 non-null   int64
 5   SexCode   1313 non-null   int64
dtypes: float64(1), int64(2), object(3)
memory usage: 61.7+ KB</pre>
</div></section>
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id63">
<h2>Discussion</h2>
<p>After we load some data, it’s a good idea to understand how it’s
structured and what kind of information it contains. Ideally, we would
view the full data directly. But with most real-world cases, the data
could have thousands to hundreds of thousands to millions of rows and
columns. Instead, we have to rely on pulling samples to view small
slices and calculating summary <a data-primary="descriptive statistics" data-type="indexterm" id="id1061"/>statistics of the data.</p>
<p>In our solution, we are using a toy dataset of the passengers of
the <em>Titanic</em>. Using <code>head</code>, we can look at the first few rows (five by default) of the data. Alternatively, we can use <code>tail</code> to view the last few rows. With <code>shape</code> we can see how many rows and columns our DataFrame contains. With <code>describe</code> we can see some basic descriptive statistics for any numerical column. And, finally, <code>info</code> displays a number of helpful data points about the DataFrame, including index and column data types, non-null values, and memory usage.</p>
<p>It is worth noting that summary statistics do not always tell the full
story. For example, pandas treats the columns <code>Survived</code> and <code>SexCode</code>
as numeric columns because they contain 1s and 0s. However, in this
case the numerical values represent categories. For example, if
<code>Survived</code> equals 1, it indicates that the passenger survived the
disaster. For this reason, some of the summary statistics provided don’t make sense, such as the standard deviation of the <code>SexCode</code> column (an
indicator of the passenger’s gender).</p>
</div></section>
</div></section>
<section data-pdf-bookmark="3.3 Slicing DataFrames" data-type="sect1"><div class="sect1" id="slicing-dataframes">
<h1>3.3 Slicing DataFrames</h1>
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id470">
<h2>Problem</h2>
<p>You need to select a specific subset data or <a data-primary="dataframes (DataFrame object)" data-secondary="slicing" data-type="indexterm" id="ix_dataframe_slice"/><a data-primary="slicing" data-secondary="dataframes" data-type="indexterm" id="ix_slice_dataframe"/>slices of a DataFrame.</p>
</div></section>
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id64">
<h2>Solution</h2>
<p>Use <code>loc</code> or <code>iloc</code> to <a data-primary="iloc method" data-type="indexterm" id="id1062"/><a data-primary="loc method" data-type="indexterm" id="id1063"/>select one or more rows or values:</p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># Load library</code>
<code class="kn">import</code> <code class="nn">pandas</code> <code class="k">as</code> <code class="nn">pd</code>

<code class="c1"># Create URL</code>
<code class="n">url</code> <code class="o">=</code> <code class="s1">'https://raw.githubusercontent.com/chrisalbon/sim_data/master/titanic.csv'</code>

<code class="c1"># Load data</code>
<code class="n">dataframe</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">read_csv</code><code class="p">(</code><code class="n">url</code><code class="p">)</code>

<code class="c1"># Select first row</code>
<code class="n">dataframe</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code></pre>
<pre data-type="programlisting">Name        Allen, Miss Elisabeth Walton
PClass                               1st
Age                                   29
Sex                               female
Survived                               1
SexCode                                1
Name: 0, dtype: object</pre>
<p>We can use <code>:</code> to define the <a data-primary=": (colon), slicing a DataFrame" data-type="indexterm" id="id1064"/><a data-primary="colon (:), slicing a DataFrame" data-type="indexterm" id="id1065"/>slice of rows we want, such as selecting the
second, third, and fourth rows:</p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># Select three rows</code>
<code class="n">dataframe</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="mi">1</code><code class="p">:</code><code class="mi">4</code><code class="p">]</code></pre>
<table>
<thead>
<tr>
<th/>
<th>Name</th>
<th>PClass</th>
<th>Age</th>
<th>Sex</th>
<th>Survived</th>
<th>SexCode</th>
</tr>
</thead>
<tbody>
<tr>
<th>1</th>
<td>Allison, Miss Helen Loraine</td>
<td>1st</td>
<td>2.0</td>
<td>female</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<th>2</th>
<td>Allison, Mr Hudson Joshua Creighton</td>
<td>1st</td>
<td>30.0</td>
<td>male</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<th>3</th>
<td>Allison, Mrs Hudson JC (Bessie Waldo Daniels)</td>
<td>1st</td>
<td>25.0</td>
<td>female</td>
<td>0</td>
<td>1</td>
</tr>
</tbody>
</table>
<p>We can even use it to get all rows up to a point, such as all rows up to
and including the fourth row:</p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># Select four rows</code>
<code class="n">dataframe</code><code class="o">.</code><code class="n">iloc</code><code class="p">[:</code><code class="mi">4</code><code class="p">]</code></pre>
<table>
<thead>
<tr>
<th/>
<th>Name</th>
<th>PClass</th>
<th>Age</th>
<th>Sex</th>
<th>Survived</th>
<th>SexCode</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>Allen, Miss Elisabeth Walton</td>
<td>1st</td>
<td>29.0</td>
<td>female</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<th>1</th>
<td>Allison, Miss Helen Loraine</td>
<td>1st</td>
<td>2.0</td>
<td>female</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<th>2</th>
<td>Allison, Mr Hudson Joshua Creighton</td>
<td>1st</td>
<td>30.0</td>
<td>male</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<th>3</th>
<td>Allison, Mrs Hudson JC (Bessie Waldo Daniels)</td>
<td>1st</td>
<td>25.0</td>
<td>female</td>
<td>0</td>
<td>1</td>
</tr>
</tbody>
</table>
<p>DataFrames do not need to be numerically <a data-primary="index value, DataFrame" data-type="indexterm" id="id1066"/>indexed. We can set the index
of a DataFrame to any value where the value is unique to each row.<a data-primary="" data-startref="ix_dataframe_slice" data-type="indexterm" id="id1067"/><a data-primary="" data-startref="ix_slice_dataframe" data-type="indexterm" id="id1068"/> For
example, we can set the index to be passenger names and then select rows
using a name:</p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># Set index</code>
<code class="n">dataframe</code> <code class="o">=</code> <code class="n">dataframe</code><code class="o">.</code><code class="n">set_index</code><code class="p">(</code><code class="n">dataframe</code><code class="p">[</code><code class="s1">'Name'</code><code class="p">])</code>

<code class="c1"># Show row</code>
<code class="n">dataframe</code><code class="o">.</code><code class="n">loc</code><code class="p">[</code><code class="s1">'Allen, Miss Elisabeth Walton'</code><code class="p">]</code></pre>
<pre data-type="programlisting">Name        Allen, Miss Elisabeth Walton
PClass                               1st
Age                                   29
Sex                               female
Survived                               1
SexCode                                1
Name: Allen, Miss Elisabeth Walton, dtype: object</pre>
</div></section>
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id65">
<h2>Discussion</h2>
<p>All rows in a pandas DataFrame have a unique index value. By default, this index is an integer indicating the row position in the DataFrame; however, it does not have to be. DataFrame indexes can be set to be unique alphanumeric strings or customer numbers. To select individual rows and slices of rows, pandas provides two methods:</p>
<ul>
<li>
<p><code>loc</code> is useful <a data-primary="loc method" data-type="indexterm" id="id1069"/>when the index of the DataFrame is a label (e.g., a string).</p>
</li>
<li>
<p><code>iloc</code> works by <a data-primary="iloc method" data-type="indexterm" id="id1070"/>looking for the position in the DataFrame. For example, <code>iloc[0]</code> will return the first row regardless of whether the index is an integer or a label.</p>
</li>
</ul>
<p>It is useful to be comfortable with both <code>loc</code> and <code>iloc</code> since they will come up a lot during data cleaning.</p>
</div></section>
</div></section>
<section data-pdf-bookmark="3.4 Selecting Rows Based on Conditionals" data-type="sect1"><div class="sect1" id="selecting-rows-based-on-conditionals">
<h1>3.4 Selecting Rows Based on Conditionals</h1>
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id471">
<h2>Problem</h2>
<p>You want to <a data-primary="rows in dataframes" data-secondary="selecting based on conditionals" data-type="indexterm" id="ix_row_dataframe_sel_cond"/><a data-primary="dataframes (DataFrame object)" data-secondary="selecting rows based on conditionals in" data-type="indexterm" id="ix_dataframe_sel_row_cond"/>select DataFrame rows based on some condition.</p>
</div></section>
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id1071">
<h2>Solution</h2>
<p>This can be done easily in pandas. For example, if we wanted to select all the women on the <em>Titanic</em>:</p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># Load library</code>
<code class="kn">import</code> <code class="nn">pandas</code> <code class="k">as</code> <code class="nn">pd</code>

<code class="c1"># Create URL</code>
<code class="n">url</code> <code class="o">=</code> <code class="s1">'https://raw.githubusercontent.com/chrisalbon/sim_data/master/titanic.csv'</code>

<code class="c1"># Load data</code>
<code class="n">dataframe</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">read_csv</code><code class="p">(</code><code class="n">url</code><code class="p">)</code>

<code class="c1"># Show top two rows where column 'sex' is 'female'</code>
<code class="n">dataframe</code><code class="p">[</code><code class="n">dataframe</code><code class="p">[</code><code class="s1">'Sex'</code><code class="p">]</code> <code class="o">==</code> <code class="s1">'female'</code><code class="p">]</code><code class="o">.</code><code class="n">head</code><code class="p">(</code><code class="mi">2</code><code class="p">)</code></pre>
<table>
<thead>
<tr>
<th/>
<th>Name</th>
<th>PClass</th>
<th>Age</th>
<th>Sex</th>
<th>Survived</th>
<th>SexCode</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>Allen, Miss Elisabeth Walton</td>
<td>1st</td>
<td>29.0</td>
<td>female</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<th>1</th>
<td>Allison, Miss Helen Loraine</td>
<td>1st</td>
<td>2.0</td>
<td>female</td>
<td>0</td>
<td>1</td>
</tr>
</tbody>
</table>
<p>Take a moment to look at the format of this solution. Our conditional statement is <code>dataframe['Sex'] == 'female'</code>; by wrapping
that in <code>dataframe[]</code> we are telling pandas to “select all the rows in the
DataFrame where the value of <code>dataframe['Sex']</code> is <code>'female'</code>.” These conditions result in a pandas series of booleans.</p>
<p>Multiple conditions are easy as well. For example, here we select all
the rows where the passenger is a female 65 or older:</p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># Filter rows</code>
<code class="n">dataframe</code><code class="p">[(</code><code class="n">dataframe</code><code class="p">[</code><code class="s1">'Sex'</code><code class="p">]</code> <code class="o">==</code> <code class="s1">'female'</code><code class="p">)</code> <code class="o">&amp;</code> <code class="p">(</code><code class="n">dataframe</code><code class="p">[</code><code class="s1">'Age'</code><code class="p">]</code> <code class="o">&gt;=</code> <code class="mi">65</code><code class="p">)]</code></pre>
<table>
<thead>
<tr>
<th/>
<th>Name</th>
<th>PClass</th>
<th>Age</th>
<th>Sex</th>
<th>Survived</th>
<th>SexCode</th>
</tr>
</thead>
<tbody>
<tr>
<th>73</th>
<td>Crosby, Mrs Edward Gifford (Catherine Elizabet...</td>
<td>1st</td>
<td>69.0</td>
<td>female</td>
<td>1</td>
<td>1</td>
</tr>
</tbody>
</table>
</div></section>
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id66">
<h2>Discussion</h2>
<p>Conditionally selecting and filtering data is one of the most common
tasks in data wrangling. You rarely want all the raw data from the
source; instead, you are interested in only some subset of it. For
example, you might only be interested in stores in certain states or the
records of patients over a certain age.<a data-primary="" data-startref="ix_dataframe_sel_row_cond" data-type="indexterm" id="id1072"/><a data-primary="" data-startref="ix_row_dataframe_sel_cond" data-type="indexterm" id="id1073"/></p>
</div></section>
</div></section>
<section data-pdf-bookmark="3.5 Sorting Values" data-type="sect1"><div class="sect1" id="sorting-values">
<h1>3.5 Sorting Values</h1>
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id472">
<h2>Problem</h2>
<p>You need to <a data-primary="dataframes (DataFrame object)" data-secondary="sorting values in" data-type="indexterm" id="id1074"/>sort a dataframe by the values in a column.</p>
</div></section>
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id67">
<h2>Solution</h2>
<p>Use the <a data-primary="sort_values function" data-type="indexterm" id="id1075"/>pandas <code>sort_values</code> function:</p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># Load library</code>
<code class="kn">import</code> <code class="nn">pandas</code> <code class="k">as</code> <code class="nn">pd</code>

<code class="c1"># Create URL</code>
<code class="n">url</code> <code class="o">=</code> <code class="s1">'https://raw.githubusercontent.com/chrisalbon/sim_data/master/titanic.csv'</code>

<code class="c1"># Load data</code>
<code class="n">dataframe</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">read_csv</code><code class="p">(</code><code class="n">url</code><code class="p">)</code>

<code class="c1"># Sort the dataframe by age, show two rows</code>
<code class="n">dataframe</code><code class="o">.</code><code class="n">sort_values</code><code class="p">(</code><code class="n">by</code><code class="o">=</code><code class="p">[</code><code class="s2">"Age"</code><code class="p">])</code><code class="o">.</code><code class="n">head</code><code class="p">(</code><code class="mi">2</code><code class="p">)</code></pre>
<table>
<thead>
<tr>
<th/>
<th>Name</th>
<th>PClass</th>
<th>Age</th>
<th>Sex</th>
<th>Survived</th>
<th>SexCode</th>
</tr>
</thead>
<tbody>
<tr>
<th>763</th>
<td>Dean, Miss Elizabeth Gladys (Millvena)</td>
<td>3rd</td>
<td>0.17</td>
<td>female</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<th>751</th>
<td>Danbom, Master Gilbert Sigvard Emanuel</td>
<td>3rd</td>
<td>0.33</td>
<td>male</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>
</div></section>
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id1076">
<h2>Discussion</h2>
<p>During data analysis and exploration, it’s often useful to sort a DataFrame by a particular column or set of columns. The <code>by</code> argument to <code>sort_values</code> takes a list of columns by which to sort the DataFrame and will sort based on the order of column names in the list.</p>
<p>By default, the <code>ascending</code> argument is set to <code>True</code>, so it will sort the values lowest to highest. If we wanted the oldest passengers instead of the youngest, we could set it to <code>False</code>.</p>
</div></section>
</div></section>
<section data-pdf-bookmark="3.6 Replacing Values" data-type="sect1"><div class="sect1" id="replacing-values">
<h1>3.6 Replacing Values</h1>
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id1077">
<h2>Problem</h2>
<p>You need to replace values in a DataFrame.</p>
</div></section>
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id68">
<h2>Solution</h2>
<p>The <a data-primary="replace method" data-type="indexterm" id="ix_replace_meth"/>pandas <code>replace</code> method is an easy way to find and replace values. For example,
we can replace any instance of <code>"female"</code> in the <code>Sex</code> column with
<code>"Woman"</code>:</p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># Load library</code>
<code class="kn">import</code> <code class="nn">pandas</code> <code class="k">as</code> <code class="nn">pd</code>

<code class="c1"># Create URL</code>
<code class="n">url</code> <code class="o">=</code> <code class="s1">'https://raw.githubusercontent.com/chrisalbon/sim_data/master/titanic.csv'</code>

<code class="c1"># Load data</code>
<code class="n">dataframe</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">read_csv</code><code class="p">(</code><code class="n">url</code><code class="p">)</code>

<code class="c1"># Replace values, show two rows</code>
<code class="n">dataframe</code><code class="p">[</code><code class="s1">'Sex'</code><code class="p">]</code><code class="o">.</code><code class="n">replace</code><code class="p">(</code><code class="s2">"female"</code><code class="p">,</code> <code class="s2">"Woman"</code><code class="p">)</code><code class="o">.</code><code class="n">head</code><code class="p">(</code><code class="mi">2</code><code class="p">)</code></pre>
<pre data-type="programlisting">0    Woman
1    Woman
Name: Sex, dtype: object</pre>
<p>We can also replace multiple values at the same time:</p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># Replace "female" and "male" with "Woman" and "Man"</code>
<code class="n">dataframe</code><code class="p">[</code><code class="s1">'Sex'</code><code class="p">]</code><code class="o">.</code><code class="n">replace</code><code class="p">([</code><code class="s2">"female"</code><code class="p">,</code> <code class="s2">"male"</code><code class="p">],</code> <code class="p">[</code><code class="s2">"Woman"</code><code class="p">,</code> <code class="s2">"Man"</code><code class="p">])</code><code class="o">.</code><code class="n">head</code><code class="p">(</code><code class="mi">5</code><code class="p">)</code></pre>
<pre data-type="programlisting">0    Woman
1    Woman
2      Man
3    Woman
4      Man
Name: Sex, dtype: object</pre>
<p>We can also find and replace across the entire <code>DataFrame</code> object by specifying the whole dataframe instead of a single column:</p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># Replace values, show two rows</code>
<code class="n">dataframe</code><code class="o">.</code><code class="n">replace</code><code class="p">(</code><code class="mi">1</code><code class="p">,</code> <code class="s2">"One"</code><code class="p">)</code><code class="o">.</code><code class="n">head</code><code class="p">(</code><code class="mi">2</code><code class="p">)</code></pre>
<table class="pagebreak-before less_space">
<thead>
<tr>
<th/>
<th>Name</th>
<th>PClass</th>
<th>Age</th>
<th>Sex</th>
<th>Survived</th>
<th>SexCode</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>Allen, Miss Elisabeth Walton</td>
<td>1st</td>
<td>29</td>
<td>female</td>
<td>One</td>
<td>One</td>
</tr>
<tr>
<th>1</th>
<td>Allison, Miss Helen Loraine</td>
<td>1st</td>
<td>2</td>
<td>female</td>
<td>0</td>
<td>One</td>
</tr>
</tbody>
</table>
<p><code>replace</code> also accepts regular expressions:</p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># Replace values, show two rows</code>
<code class="n">dataframe</code><code class="o">.</code><code class="n">replace</code><code class="p">(</code><code class="sa">r</code><code class="s2">"1st"</code><code class="p">,</code> <code class="s2">"First"</code><code class="p">,</code> <code class="n">regex</code><code class="o">=</code><code class="kc">True</code><code class="p">)</code><code class="o">.</code><code class="n">head</code><code class="p">(</code><code class="mi">2</code><code class="p">)</code></pre>
<table>
<thead>
<tr>
<th/>
<th>Name</th>
<th>PClass</th>
<th>Age</th>
<th>Sex</th>
<th>Survived</th>
<th>SexCode</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>Allen, Miss Elisabeth Walton</td>
<td>First</td>
<td>29.0</td>
<td>female</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<th>1</th>
<td>Allison, Miss Helen Loraine</td>
<td>First</td>
<td>2.0</td>
<td>female</td>
<td>0</td>
<td>1</td>
</tr>
</tbody>
</table>
</div></section>
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id69">
<h2>Discussion</h2>
<p><code>replace</code> is a tool we use to replace values. It is simple and yet has
the powerful ability to accept regular expressions.<a data-primary="" data-startref="ix_replace_meth" data-type="indexterm" id="id1078"/></p>
</div></section>
</div></section>
<section data-pdf-bookmark="3.7 Renaming Columns" data-type="sect1"><div class="sect1" id="renaming-columns">
<h1>3.7 Renaming Columns</h1>
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id473">
<h2>Problem</h2>
<p>You want to <a data-primary="dataframes (DataFrame object)" data-secondary="renaming columns in" data-type="indexterm" id="ix_dataframes_renam_col"/><a data-primary="columns in dataframes" data-secondary="renaming" data-type="indexterm" id="ix_col_renam"/>rename a column in a pandas DataFrame.</p>
</div></section>
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id70">
<h2>Solution</h2>
<p>Rename <a data-primary="rename method" data-type="indexterm" id="ix_renam_meth"/>columns using the <code>rename</code> method:</p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># Load library</code>
<code class="kn">import</code> <code class="nn">pandas</code> <code class="k">as</code> <code class="nn">pd</code>

<code class="c1"># Create URL</code>
<code class="n">url</code> <code class="o">=</code> <code class="s1">'https://raw.githubusercontent.com/chrisalbon/sim_data/master/titanic.csv'</code>

<code class="c1"># Load data</code>
<code class="n">dataframe</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">read_csv</code><code class="p">(</code><code class="n">url</code><code class="p">)</code>

<code class="c1"># Rename column, show two rows</code>
<code class="n">dataframe</code><code class="o">.</code><code class="n">rename</code><code class="p">(</code><code class="n">columns</code><code class="o">=</code><code class="p">{</code><code class="s1">'PClass'</code><code class="p">:</code> <code class="s1">'Passenger Class'</code><code class="p">})</code><code class="o">.</code><code class="n">head</code><code class="p">(</code><code class="mi">2</code><code class="p">)</code></pre>
<table>
<thead>
<tr>
<th/>
<th>Name</th>
<th>Passenger Class</th>
<th>Age</th>
<th>Sex</th>
<th>Survived</th>
<th>SexCode</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>Allen, Miss Elisabeth Walton</td>
<td>1st</td>
<td>29.0</td>
<td>female</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<th>1</th>
<td>Allison, Miss Helen Loraine</td>
<td>1st</td>
<td>2.0</td>
<td>female</td>
<td>0</td>
<td>1</td>
</tr>
</tbody>
</table>
<p>Notice that the <code>rename</code> method can accept a dictionary as a parameter. We
can use the dictionary to change multiple column names at once:</p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># Rename columns, show two rows</code>
<code class="n">dataframe</code><code class="o">.</code><code class="n">rename</code><code class="p">(</code><code class="n">columns</code><code class="o">=</code><code class="p">{</code><code class="s1">'PClass'</code><code class="p">:</code> <code class="s1">'Passenger Class'</code><code class="p">,</code> <code class="s1">'Sex'</code><code class="p">:</code> <code class="s1">'Gender'</code><code class="p">})</code><code class="o">.</code><code class="n">head</code><code class="p">(</code><code class="mi">2</code><code class="p">)</code></pre>
<table>
<thead>
<tr>
<th/>
<th>Name</th>
<th>Passenger Class</th>
<th>Age</th>
<th>Gender</th>
<th>Survived</th>
<th>SexCode</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>Allen, Miss Elisabeth Walton</td>
<td>1st</td>
<td>29.0</td>
<td>female</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<th>1</th>
<td>Allison, Miss Helen Loraine</td>
<td>1st</td>
<td>2.0</td>
<td>female</td>
<td>0</td>
<td>1</td>
</tr>
</tbody>
</table>
</div></section>
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id71">
<h2>Discussion</h2>
<p>Using <code>rename</code> with a dictionary as an argument to the <code>columns</code>
parameter is my preferred way to rename columns because it works with
any number of columns. If we want to rename all columns at once, this
helpful snippet of code creates a dictionary with the old column names
as keys and empty strings as values:<a data-primary="" data-startref="ix_col_renam" data-type="indexterm" id="id1079"/><a data-primary="" data-startref="ix_dataframes_renam_col" data-type="indexterm" id="id1080"/><a data-primary="" data-startref="ix_renam_meth" data-type="indexterm" id="id1081"/></p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># Load library</code>
<code class="kn">import</code> <code class="nn">collections</code>

<code class="c1"># Create dictionary</code>
<code class="n">column_names</code> <code class="o">=</code> <code class="n">collections</code><code class="o">.</code><code class="n">defaultdict</code><code class="p">(</code><code class="nb">str</code><code class="p">)</code>

<code class="c1"># Create keys</code>
<code class="k">for</code> <code class="n">name</code> <code class="ow">in</code> <code class="n">dataframe</code><code class="o">.</code><code class="n">columns</code><code class="p">:</code>
    <code class="n">column_names</code><code class="p">[</code><code class="n">name</code><code class="p">]</code>

<code class="c1"># Show dictionary</code>
<code class="n">column_names</code></pre>
<pre data-type="programlisting">defaultdict(str,
            {'Age': '',
             'Name': '',
             'PClass': '',
             'Sex': '',
             'SexCode': '',
             'Survived': ''})</pre>
</div></section>
</div></section>
<section data-pdf-bookmark="3.8 Finding the Minimum, Maximum, Sum, Average, &#10;and Count" data-type="sect1"><div class="sect1" id="finding-the-minimum-maximum-sum-average-and-count">
<h1>3.8 Finding the Minimum, Maximum, Sum, Average, 
<span class="keep-together">and Count</span></h1>
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id474">
<h2>Problem</h2>
<p>You want to <a data-primary="dataframes (DataFrame object)" data-secondary="min, max, sum, average, count values of numeric column" data-type="indexterm" id="id1082"/><a data-primary="columns in dataframes" data-secondary="descriptive statistics values in" data-type="indexterm" id="id1083"/>find the min, max, sum, average, or count of a numeric
column.</p>
</div></section>
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id72">
<h2>Solution</h2>
<p>pandas <a data-primary="descriptive statistics" data-type="indexterm" id="id1084"/><a data-primary="max method" data-secondary="DataFrame" data-type="indexterm" id="id1085"/><a data-primary="mean method" data-secondary="DataFrame" data-type="indexterm" id="id1086"/><a data-primary="min method" data-secondary="DataFrame" data-type="indexterm" id="id1087"/><a data-primary="sum method, numeric column" data-type="indexterm" id="id1088"/><a data-primary="count method, numeric column" data-type="indexterm" id="id1089"/>comes with some built-in methods for commonly used descriptive
statistics such as <code>min</code>, <code>max</code>, <code>mean</code>, <code>sum</code>, and <code>count</code>:</p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># Load library</code>
<code class="kn">import</code> <code class="nn">pandas</code> <code class="k">as</code> <code class="nn">pd</code>

<code class="c1"># Create URL</code>
<code class="n">url</code> <code class="o">=</code> <code class="s1">'https://raw.githubusercontent.com/chrisalbon/sim_data/master/titanic.csv'</code>

<code class="c1"># Load data</code>
<code class="n">dataframe</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">read_csv</code><code class="p">(</code><code class="n">url</code><code class="p">)</code>

<code class="c1"># Calculate statistics</code>
<code class="nb">print</code><code class="p">(</code><code class="s1">'Maximum:'</code><code class="p">,</code> <code class="n">dataframe</code><code class="p">[</code><code class="s1">'Age'</code><code class="p">]</code><code class="o">.</code><code class="n">max</code><code class="p">())</code>
<code class="nb">print</code><code class="p">(</code><code class="s1">'Minimum:'</code><code class="p">,</code> <code class="n">dataframe</code><code class="p">[</code><code class="s1">'Age'</code><code class="p">]</code><code class="o">.</code><code class="n">min</code><code class="p">())</code>
<code class="nb">print</code><code class="p">(</code><code class="s1">'Mean:'</code><code class="p">,</code> <code class="n">dataframe</code><code class="p">[</code><code class="s1">'Age'</code><code class="p">]</code><code class="o">.</code><code class="n">mean</code><code class="p">())</code>
<code class="nb">print</code><code class="p">(</code><code class="s1">'Sum:'</code><code class="p">,</code> <code class="n">dataframe</code><code class="p">[</code><code class="s1">'Age'</code><code class="p">]</code><code class="o">.</code><code class="n">sum</code><code class="p">())</code>
<code class="nb">print</code><code class="p">(</code><code class="s1">'Count:'</code><code class="p">,</code> <code class="n">dataframe</code><code class="p">[</code><code class="s1">'Age'</code><code class="p">]</code><code class="o">.</code><code class="n">count</code><code class="p">())</code></pre>
<pre data-type="programlisting">Maximum: 71.0
Minimum: 0.17
Mean: 30.397989417989415
Sum: 22980.879999999997
Count: 756</pre>
</div></section>
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id1090">
<h2>Discussion</h2>
<p>In addition to the statistics used in the solution, pandas offers
variance (<code>var</code>), standard deviation (<code>std</code>), kurtosis (<code>kurt</code>),
skewness (<code>skew</code>), standard error of the mean (<code>sem</code>), mode (<code>mode</code>),
median (<code>median</code>), value counts, and a number of others.</p>
<p>Furthermore, we can also apply these methods to the whole DataFrame:</p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># Show counts</code>
<code class="n">dataframe</code><code class="o">.</code><code class="n">count</code><code class="p">()</code></pre>
<pre data-type="programlisting">Name        1313
PClass      1313
Age          756
Sex         1313
Survived    1313
SexCode     1313
dtype: int64</pre>
</div></section>
</div></section>
<section data-pdf-bookmark="3.9 Finding Unique Values" data-type="sect1"><div class="sect1" id="finding-unique-values">
<h1>3.9 Finding Unique Values</h1>
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id475">
<h2>Problem</h2>
<p>You want to select all <a data-primary="dataframes (DataFrame object)" data-secondary="finding unique values in" data-type="indexterm" id="ix_dataframe_unique_val"/><a data-primary="columns in dataframes" data-secondary="finding unique values in" data-type="indexterm" id="ix_col_dataframe_unique"/>unique values in a column.</p>
</div></section>
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id73">
<h2>Solution</h2>
<p>Use <code>unique</code> to view an array of all <a data-primary="unique method" data-type="indexterm" id="id1091"/>unique values in a column:</p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># Load library</code>
<code class="kn">import</code> <code class="nn">pandas</code> <code class="k">as</code> <code class="nn">pd</code>

<code class="c1"># Create URL</code>
<code class="n">url</code> <code class="o">=</code> <code class="s1">'https://raw.githubusercontent.com/chrisalbon/sim_data/master/titanic.csv'</code>

<code class="c1"># Load data</code>
<code class="n">dataframe</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">read_csv</code><code class="p">(</code><code class="n">url</code><code class="p">)</code>

<code class="c1"># Select unique values</code>
<code class="n">dataframe</code><code class="p">[</code><code class="s1">'Sex'</code><code class="p">]</code><code class="o">.</code><code class="n">unique</code><code class="p">()</code></pre>
<pre data-type="programlisting">array(['female', 'male'], dtype=object)</pre>
<p>Alternatively, <code>value_counts</code> will display all <a data-primary="value_counts method" data-type="indexterm" id="id1092"/>unique values with the
number of times each value appears:</p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># Show counts</code>
<code class="n">dataframe</code><code class="p">[</code><code class="s1">'Sex'</code><code class="p">]</code><code class="o">.</code><code class="n">value_counts</code><code class="p">()</code></pre>
<pre data-type="programlisting">male      851
female    462
Name: Sex, dtype: int64</pre>
</div></section>
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id74">
<h2>Discussion</h2>
<p>Both <code>unique</code> and <code>value_counts</code> are useful for manipulating and
exploring categorical columns. Very often in categorical columns there
will be classes that need to be handled in the data wrangling phase. For example, in the <em>Titanic</em> dataset, <code>PClass</code> is a column indicating the class of a passenger’s ticket. There were three classes on the <em>Titanic</em>; however, if we use <code>value_counts</code> we can see a problem:</p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># Show counts</code>
<code class="n">dataframe</code><code class="p">[</code><code class="s1">'PClass'</code><code class="p">]</code><code class="o">.</code><code class="n">value_counts</code><code class="p">()</code></pre>
<pre data-type="programlisting">3rd    711
1st    322
2nd    279
*        1
Name: PClass, dtype: int64</pre>
<p>While almost all passengers belong to one of three classes as expected,
a single passenger has the class <code>*</code>. There are a number of strategies
for handling this type of issue, which we will address in <a data-type="xref" href="ch05.xhtml#handling-categorical-data">Chapter 5</a>, but for now just realize that “extra” classes are common in categorical data and should not be ignored.</p>
<p>Finally, if we simply want to count the number of <a data-primary="nunique method" data-type="indexterm" id="id1093"/>unique values, we
can use <code>nunique</code>:<a data-primary="" data-startref="ix_col_dataframe_unique" data-type="indexterm" id="id1094"/><a data-primary="" data-startref="ix_dataframe_unique_val" data-type="indexterm" id="id1095"/></p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># Show number of unique values</code>
<code class="n">dataframe</code><code class="p">[</code><code class="s1">'PClass'</code><code class="p">]</code><code class="o">.</code><code class="n">nunique</code><code class="p">()</code></pre>
<pre data-type="programlisting">4</pre>
</div></section>
</div></section>
<section data-pdf-bookmark="3.10 Handling Missing Values" data-type="sect1"><div class="sect1" id="handling-missing-values">
<h1>3.10 Handling Missing Values</h1>
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id476">
<h2>Problem</h2>
<p>You want to select <a data-primary="missing data" data-secondary="values in DataFrames" data-type="indexterm" id="ix_miss_data_df_val"/><a data-primary="dataframes (DataFrame object)" data-secondary="missing values in" data-type="indexterm" id="ix_dataframe_miss_val"/>missing values in a DataFrame.</p>
</div></section>
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id75">
<h2>Solution</h2>
<p><code>isnull</code> and <code>notnull</code> return <a data-primary="isnull method" data-type="indexterm" id="id1096"/><a data-primary="notnull method" data-type="indexterm" id="id1097"/>booleans indicating whether a value is
missing:</p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># Load library</code>
<code class="kn">import</code> <code class="nn">pandas</code> <code class="k">as</code> <code class="nn">pd</code>

<code class="c1"># Create URL</code>
<code class="n">url</code> <code class="o">=</code> <code class="s1">'https://raw.githubusercontent.com/chrisalbon/sim_data/master/titanic.csv'</code>

<code class="c1"># Load data</code>
<code class="n">dataframe</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">read_csv</code><code class="p">(</code><code class="n">url</code><code class="p">)</code>

<code class="c1">## Select missing values, show two rows</code>
<code class="n">dataframe</code><code class="p">[</code><code class="n">dataframe</code><code class="p">[</code><code class="s1">'Age'</code><code class="p">]</code><code class="o">.</code><code class="n">isnull</code><code class="p">()]</code><code class="o">.</code><code class="n">head</code><code class="p">(</code><code class="mi">2</code><code class="p">)</code></pre>
<table>
<thead>
<tr>
<th/>
<th>Name</th>
<th>PClass</th>
<th>Age</th>
<th>Sex</th>
<th>Survived</th>
<th>SexCode</th>
</tr>
</thead>
<tbody>
<tr>
<th>12</th>
<td>Aubert, Mrs Leontine Pauline</td>
<td>1st</td>
<td>NaN</td>
<td>female</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<th>13</th>
<td>Barkworth, Mr Algernon H</td>
<td>1st</td>
<td>NaN</td>
<td>male</td>
<td>1</td>
<td>0</td>
</tr>
</tbody>
</table>
</div></section>
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id76">
<h2>Discussion</h2>
<p>Missing values are a ubiquitous problem in data wrangling, yet many
underestimate the difficulty of working with missing data. pandas uses NumPy’s <code>NaN</code> (Not a Number) <a data-primary="NumPy arrays" data-secondary="NaN value" data-type="indexterm" id="id1098"/>value to denote missing values, but it is important to note that <code>NaN</code> is not fully implemented natively in pandas. For example, if we wanted to replace all strings containing <code>male</code> with missing values, we get an error:</p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># Attempt to replace values with NaN</code>
<code class="n">dataframe</code><code class="p">[</code><code class="s1">'Sex'</code><code class="p">]</code> <code class="o">=</code> <code class="n">dataframe</code><code class="p">[</code><code class="s1">'Sex'</code><code class="p">]</code><code class="o">.</code><code class="n">replace</code><code class="p">(</code><code class="s1">'male'</code><code class="p">,</code> <code class="n">NaN</code><code class="p">)</code></pre>
<pre data-type="programlisting">
---------------------------------------------------------------------------

NameError                                 Traceback (most recent call last)

&lt;ipython-input-7-5682d714f87d&gt; in &lt;module&gt;()
      1 # Attempt to replace values with NaN
----&gt; 2 dataframe['Sex'] = dataframe['Sex'].replace('male', NaN)


NameError: name 'NaN' is not defined
---------------------------------------------------------------------------
</pre>
<p>To have full functionality with <code>NaN</code> we need to import the NumPy
library first:</p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># Load library</code>
<code class="kn">import</code> <code class="nn">numpy</code> <code class="k">as</code> <code class="nn">np</code>

<code class="c1"># Replace values with NaN</code>
<code class="n">dataframe</code><code class="p">[</code><code class="s1">'Sex'</code><code class="p">]</code> <code class="o">=</code> <code class="n">dataframe</code><code class="p">[</code><code class="s1">'Sex'</code><code class="p">]</code><code class="o">.</code><code class="n">replace</code><code class="p">(</code><code class="s1">'male'</code><code class="p">,</code> <code class="n">np</code><code class="o">.</code><code class="n">nan</code><code class="p">)</code></pre>
<p>Oftentimes a dataset uses a specific value to denote a missing
observation, such as <code>NONE</code>, <code>-999</code>, or <code>..</code>. The <a data-primary="read_csv function" data-type="indexterm" id="id1099"/>pandas <code>read_csv</code> function includes
a parameter allowing us to specify the values used to indicate missing
values:</p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># Load data, set missing values</code>
<code class="n">dataframe</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">read_csv</code><code class="p">(</code><code class="n">url</code><code class="p">,</code> <code class="n">na_values</code><code class="o">=</code><code class="p">[</code><code class="n">np</code><code class="o">.</code><code class="n">nan</code><code class="p">,</code> <code class="s1">'NONE'</code><code class="p">,</code> <code class="o">-</code><code class="mi">999</code><code class="p">])</code></pre>
<p>We can also use the <a data-primary="fillna function" data-type="indexterm" id="id1100"/>pandas <code>fillna</code> function to impute the missing values of a column. Here, we show the places where <code>Age</code> is null using the <code>isna</code> function and then fill those values with the mean age of passengers.<a data-primary="" data-startref="ix_dataframe_miss_val" data-type="indexterm" id="id1101"/><a data-primary="" data-startref="ix_miss_data_df_val" data-type="indexterm" id="id1102"/></p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># Get a single null row</code>
<code class="n">null_entry</code> <code class="o">=</code> <code class="n">dataframe</code><code class="p">[</code><code class="n">dataframe</code><code class="p">[</code><code class="s2">"Age"</code><code class="p">]</code><code class="o">.</code><code class="n">isna</code><code class="p">()]</code><code class="o">.</code><code class="n">head</code><code class="p">(</code><code class="mi">1</code><code class="p">)</code>

<code class="nb">print</code><code class="p">(</code><code class="n">null_entry</code><code class="p">)</code></pre>
<table>
<thead>
<tr>
<th/>
<th>Name</th>
<th>PClass</th>
<th>Age</th>
<th>Sex</th>
<th>Survived</th>
<th>SexCode</th>
</tr>
</thead>
<tbody>
<tr>
<th>12</th>
<td>Aubert, Mrs Leontine Pauline</td>
<td>1st</td>
<td>NaN</td>
<td>female</td>
<td>1</td>
<td>1</td>
</tr>
</tbody>
</table>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># Fill all null values with the mean age of passengers</code>
<code class="n">null_entry</code><code class="o">.</code><code class="n">fillna</code><code class="p">(</code><code class="n">dataframe</code><code class="p">[</code><code class="s2">"Age"</code><code class="p">]</code><code class="o">.</code><code class="n">mean</code><code class="p">())</code></pre>
<table>
<thead>
<tr>
<th/>
<th>Name</th>
<th>PClass</th>
<th>Age</th>
<th>Sex</th>
<th>Survived</th>
<th>SexCode</th>
</tr>
</thead>
<tbody>
<tr>
<th>12</th>
<td>Aubert, Mrs Leontine Pauline</td>
<td>1st</td>
<td>30.397989</td>
<td>female</td>
<td>1</td>
<td>1</td>
</tr>
</tbody>
</table>
</div></section>
</div></section>
<section data-pdf-bookmark="3.11 Deleting a Column" data-type="sect1"><div class="sect1" id="deleting-a-column">
<h1>3.11 Deleting a Column</h1>
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id77">
<h2>Problem</h2>
<p>You want to <a data-primary="dataframes (DataFrame object)" data-secondary="deleting a column" data-type="indexterm" id="ix_dataframe_del_col"/><a data-primary="deleting columns, dataframes" data-type="indexterm" id="ix_del_col_dataframe"/><a data-primary="columns in dataframes" data-secondary="deleting" data-type="indexterm" id="ix_col_df_del"/>delete a column from your DataFrame.</p>
</div></section>
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id78">
<h2>Solution</h2>
<p>The best way to delete a column is to <a data-primary="drop method" data-type="indexterm" id="id1103"/>use <code>drop</code> with the parameter
<code>axis=1</code> (i.e., the column axis):</p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># Load library</code>
<code class="kn">import</code> <code class="nn">pandas</code> <code class="k">as</code> <code class="nn">pd</code>

<code class="c1"># Create URL</code>
<code class="n">url</code> <code class="o">=</code> <code class="s1">'https://raw.githubusercontent.com/chrisalbon/sim_data/master/titanic.csv'</code>

<code class="c1"># Load data</code>
<code class="n">dataframe</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">read_csv</code><code class="p">(</code><code class="n">url</code><code class="p">)</code>

<code class="c1"># Delete column</code>
<code class="n">dataframe</code><code class="o">.</code><code class="n">drop</code><code class="p">(</code><code class="s1">'Age'</code><code class="p">,</code> <code class="n">axis</code><code class="o">=</code><code class="mi">1</code><code class="p">)</code><code class="o">.</code><code class="n">head</code><code class="p">(</code><code class="mi">2</code><code class="p">)</code></pre>
<table>
<thead>
<tr>
<th/>
<th>Name</th>
<th>PClass</th>
<th>Sex</th>
<th>Survived</th>
<th>SexCode</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>Allen, Miss Elisabeth Walton</td>
<td>1st</td>
<td>female</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<th>1</th>
<td>Allison, Miss Helen Loraine</td>
<td>1st</td>
<td>female</td>
<td>0</td>
<td>1</td>
</tr>
</tbody>
</table>
<p>You can also use a list of column names as the main argument to drop
multiple columns at once:</p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># Drop columns</code>
<code class="n">dataframe</code><code class="o">.</code><code class="n">drop</code><code class="p">([</code><code class="s1">'Age'</code><code class="p">,</code> <code class="s1">'Sex'</code><code class="p">],</code> <code class="n">axis</code><code class="o">=</code><code class="mi">1</code><code class="p">)</code><code class="o">.</code><code class="n">head</code><code class="p">(</code><code class="mi">2</code><code class="p">)</code></pre>
<table>
<thead>
<tr>
<th/>
<th>Name</th>
<th>PClass</th>
<th>Survived</th>
<th>SexCode</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>Allen, Miss Elisabeth Walton</td>
<td>1st</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<th>1</th>
<td>Allison, Miss Helen Loraine</td>
<td>1st</td>
<td>0</td>
<td>1</td>
</tr>
</tbody>
</table>
<p>If a column does not have a name (which can sometimes happen), you can
drop it by its column index using <code>dataframe.columns</code>:</p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># Drop column</code>
<code class="n">dataframe</code><code class="o">.</code><code class="n">drop</code><code class="p">(</code><code class="n">dataframe</code><code class="o">.</code><code class="n">columns</code><code class="p">[</code><code class="mi">1</code><code class="p">],</code> <code class="n">axis</code><code class="o">=</code><code class="mi">1</code><code class="p">)</code><code class="o">.</code><code class="n">head</code><code class="p">(</code><code class="mi">2</code><code class="p">)</code></pre>
<table>
<thead>
<tr>
<th/>
<th>Name</th>
<th>Age</th>
<th>Sex</th>
<th>Survived</th>
<th>SexCode</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>Allen, Miss Elisabeth Walton</td>
<td>29.0</td>
<td>female</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<th>1</th>
<td>Allison, Miss Helen Loraine</td>
<td>2.0</td>
<td>female</td>
<td>0</td>
<td>1</td>
</tr>
</tbody>
</table>
</div></section>
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id79">
<h2>Discussion</h2>
<p><code>drop</code> is the idiomatic method of deleting a column. An alternative
method is 
<span class="keep-together"><code>del dataframe['Age']</code>,</span> which works most of the time but is
not recommended because of how it is called within pandas (the details
of which are outside the scope of this book).</p>
<p>I recommend that you avoid using the pandas <code>inplace=True</code>
argument. Many pandas methods include an <code>inplace</code> parameter that, when set to <code>True</code>, edits the DataFrame directly. This can lead to problems in more
complex data processing pipelines because we are treating the DataFrames
as mutable objects (which they technically are). I recommend treating
DataFrames as <a data-primary="dataframes (DataFrame object)" data-secondary="as immutable objects" data-secondary-sortas="immutable objects" data-type="indexterm" id="id1104"/>immutable objects. For example:</p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># Create a new DataFrame</code>
<code class="n">dataframe_name_dropped</code> <code class="o">=</code> <code class="n">dataframe</code><code class="o">.</code><code class="n">drop</code><code class="p">(</code><code class="n">dataframe</code><code class="o">.</code><code class="n">columns</code><code class="p">[</code><code class="mi">0</code><code class="p">],</code> <code class="n">axis</code><code class="o">=</code><code class="mi">1</code><code class="p">)</code></pre>
<p>In this example, we are not mutating the DataFrame <code>dataframe</code> but
instead are making a new DataFrame that is an altered version of
<code>dataframe</code> called 
<span class="keep-together"><code>dataframe_name_dropped</code>.</span> If you treat your
DataFrames as immutable objects, you will save yourself a lot of
headaches down the road.<a data-primary="" data-startref="ix_col_df_del" data-type="indexterm" id="id1105"/><a data-primary="" data-startref="ix_dataframe_del_col" data-type="indexterm" id="id1106"/><a data-primary="" data-startref="ix_del_col_dataframe" data-type="indexterm" id="id1107"/></p>
</div></section>
</div></section>
<section data-pdf-bookmark="3.12 Deleting a Row" data-type="sect1"><div class="sect1" id="deleting-a-row">
<h1>3.12 Deleting a Row</h1>
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id80">
<h2>Problem</h2>
<p>You want to <a data-primary="dataframes (DataFrame object)" data-secondary="deleting a row" data-type="indexterm" id="id1108"/><a data-primary="deleting rows, dataframes" data-type="indexterm" id="id1109"/><a data-primary="rows in dataframes" data-secondary="deleting" data-type="indexterm" id="id1110"/>delete one or more rows from a DataFrame.</p>
</div></section>
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id477">
<h2>Solution</h2>
<p>Use a <a data-primary="boolean conditions" data-secondary="deleting DataFrame row" data-type="indexterm" id="id1111"/>boolean condition to create a new DataFrame excluding the rows you
want to delete:</p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># Load library</code>
<code class="kn">import</code> <code class="nn">pandas</code> <code class="k">as</code> <code class="nn">pd</code>

<code class="c1"># Create URL</code>
<code class="n">url</code> <code class="o">=</code> <code class="s1">'https://raw.githubusercontent.com/chrisalbon/sim_data/master/titanic.csv'</code>

<code class="c1"># Load data</code>
<code class="n">dataframe</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">read_csv</code><code class="p">(</code><code class="n">url</code><code class="p">)</code>

<code class="c1"># Delete rows, show first three rows of output</code>
<code class="n">dataframe</code><code class="p">[</code><code class="n">dataframe</code><code class="p">[</code><code class="s1">'Sex'</code><code class="p">]</code> <code class="o">!=</code> <code class="s1">'male'</code><code class="p">]</code><code class="o">.</code><code class="n">head</code><code class="p">(</code><code class="mi">3</code><code class="p">)</code></pre>
<table>
<thead>
<tr>
<th/>
<th>Name</th>
<th>PClass</th>
<th>Age</th>
<th>Sex</th>
<th>Survived</th>
<th>SexCode</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>Allen, Miss Elisabeth Walton</td>
<td>1st</td>
<td>29.0</td>
<td>female</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<th>1</th>
<td>Allison, Miss Helen Loraine</td>
<td>1st</td>
<td>2.0</td>
<td>female</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<th>3</th>
<td>Allison, Mrs Hudson JC (Bessie Waldo Daniels)</td>
<td>1st</td>
<td>25.00</td>
<td>female</td>
<td>0</td>
<td>1</td>
</tr>
</tbody>
</table>
</div></section>
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id81">
<h2>Discussion</h2>
<p>While technically you can use the <code>drop</code> method<a data-primary="drop method" data-type="indexterm" id="id1112"/> (for example, <code>dataframe.drop([0, 1], axis=0)</code> to drop the first two rows), a more practical method is simply to wrap a boolean condition inside <code>dataframe[]</code>. This enables us to use the power of conditionals to delete either a single row or (far more likely) many rows at once.</p>
<p>We can use boolean conditions to easily delete single rows by matching a unique value:</p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># Delete row, show first two rows of output</code>
<code class="n">dataframe</code><code class="p">[</code><code class="n">dataframe</code><code class="p">[</code><code class="s1">'Name'</code><code class="p">]</code> <code class="o">!=</code> <code class="s1">'Allison, Miss Helen Loraine'</code><code class="p">]</code><code class="o">.</code><code class="n">head</code><code class="p">(</code><code class="mi">2</code><code class="p">)</code></pre>
<table>
<thead>
<tr>
<th/>
<th>Name</th>
<th>PClass</th>
<th>Age</th>
<th>Sex</th>
<th>Survived</th>
<th>SexCode</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>Allen, Miss Elisabeth Walton</td>
<td>1st</td>
<td>29.0</td>
<td>female</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<th>2</th>
<td>Allison, Mr Hudson Joshua Creighton</td>
<td>1st</td>
<td>30.0</td>
<td>male</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>
<p>We can even use it to delete a single row by specifying the row index:</p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># Delete row, show first two rows of output</code>
<code class="n">dataframe</code><code class="p">[</code><code class="n">dataframe</code><code class="o">.</code><code class="n">index</code> <code class="o">!=</code> <code class="mi">0</code><code class="p">]</code><code class="o">.</code><code class="n">head</code><code class="p">(</code><code class="mi">2</code><code class="p">)</code></pre>
<table>
<thead>
<tr>
<th/>
<th>Name</th>
<th>PClass</th>
<th>Age</th>
<th>Sex</th>
<th>Survived</th>
<th>SexCode</th>
</tr>
</thead>
<tbody>
<tr>
<th>1</th>
<td>Allison, Miss Helen Loraine</td>
<td>1st</td>
<td>2.0</td>
<td>female</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<th>2</th>
<td>Allison, Mr Hudson Joshua Creighton</td>
<td>1st</td>
<td>30.0</td>
<td>male</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>
</div></section>
</div></section>
<section data-pdf-bookmark="3.13 Dropping Duplicate Rows" data-type="sect1"><div class="sect1" id="dropping-duplicate-rows">
<h1>3.13 Dropping Duplicate Rows</h1>
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id82">
<h2>Problem</h2>
<p>You want to <a data-primary="duplicate rows, dropping in dataframes" data-type="indexterm" id="ix_dup_row_drop_df"/><a data-primary="rows in dataframes" data-secondary="dropping duplicates" data-type="indexterm" id="ix_row_drop_dup"/><a data-primary="dataframes (DataFrame object)" data-secondary="dropping duplicate rows in a" data-type="indexterm" id="ix_dataframe_drop_dup"/>drop duplicate rows from your DataFrame.</p>
</div></section>
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id83">
<h2>Solution</h2>
<p>Use <code>drop_duplicates</code>, but be <a data-primary="drop_duplicates function" data-type="indexterm" id="id1113"/>mindful of the parameters:</p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># Load library</code>
<code class="kn">import</code> <code class="nn">pandas</code> <code class="k">as</code> <code class="nn">pd</code>

<code class="c1"># Create URL</code>
<code class="n">url</code> <code class="o">=</code> <code class="s1">'https://raw.githubusercontent.com/chrisalbon/sim_data/master/titanic.csv'</code>

<code class="c1"># Load data</code>
<code class="n">dataframe</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">read_csv</code><code class="p">(</code><code class="n">url</code><code class="p">)</code>

<code class="c1"># Drop duplicates, show first two rows of output</code>
<code class="n">dataframe</code><code class="o">.</code><code class="n">drop_duplicates</code><code class="p">()</code><code class="o">.</code><code class="n">head</code><code class="p">(</code><code class="mi">2</code><code class="p">)</code></pre>
<table>
<thead>
<tr>
<th/>
<th>Name</th>
<th>PClass</th>
<th>Age</th>
<th>Sex</th>
<th>Survived</th>
<th>SexCode</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>Allen, Miss Elisabeth Walton</td>
<td>1st</td>
<td>29.0</td>
<td>female</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<th>1</th>
<td>Allison, Miss Helen Loraine</td>
<td>1st</td>
<td>2.0</td>
<td>female</td>
<td>0</td>
<td>1</td>
</tr>
</tbody>
</table>
</div></section>
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id84">
<h2>Discussion</h2>
<p>A keen reader will notice that the solution didn’t actually drop
any rows:</p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># Show number of rows</code>
<code class="nb">print</code><code class="p">(</code><code class="s2">"Number Of Rows In The Original DataFrame:"</code><code class="p">,</code> <code class="nb">len</code><code class="p">(</code><code class="n">dataframe</code><code class="p">))</code>
<code class="nb">print</code><code class="p">(</code><code class="s2">"Number Of Rows After Deduping:"</code><code class="p">,</code> <code class="nb">len</code><code class="p">(</code><code class="n">dataframe</code><code class="o">.</code><code class="n">drop_duplicates</code><code class="p">()))</code></pre>
<pre data-type="programlisting">Number Of Rows In The Original DataFrame: 1313
Number Of Rows After Deduping: 1313</pre>
<p>This is because <code>drop_duplicates</code> defaults to dropping only rows
that match perfectly across all columns. Because every row
in our DataFrame is unique, none will be dropped. However, often we
want to consider only a subset of columns to check for duplicate rows.
We can accomplish this using the <code>subset</code> parameter:</p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># Drop duplicates</code>
<code class="n">dataframe</code><code class="o">.</code><code class="n">drop_duplicates</code><code class="p">(</code><code class="n">subset</code><code class="o">=</code><code class="p">[</code><code class="s1">'Sex'</code><code class="p">])</code></pre>
<table>
<thead>
<tr>
<th/>
<th>Name</th>
<th>PClass</th>
<th>Age</th>
<th>Sex</th>
<th>Survived</th>
<th>SexCode</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>Allen, Miss Elisabeth Walton</td>
<td>1st</td>
<td>29.0</td>
<td>female</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<th>2</th>
<td>Allison, Mr Hudson Joshua Creighton</td>
<td>1st</td>
<td>30.0</td>
<td>male</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>
<p>Take a close look at the preceding output: we told <code>drop_duplicates</code> to only consider any two rows with the same value for <code>Sex</code> to be duplicates and to drop them. Now we are left with a DataFrame of only two rows: one woman and one man. You might be asking why <code>drop_duplicates</code> decided to keep these two rows instead of two different rows. The answer is that <code>drop_duplicates</code> defaults to keeping the first occurrence of a duplicated row and dropping the rest. We can control this behavior using the <code>keep</code> parameter:</p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># Drop duplicates</code>
<code class="n">dataframe</code><code class="o">.</code><code class="n">drop_duplicates</code><code class="p">(</code><code class="n">subset</code><code class="o">=</code><code class="p">[</code><code class="s1">'Sex'</code><code class="p">],</code> <code class="n">keep</code><code class="o">=</code><code class="s1">'last'</code><code class="p">)</code></pre>
<table>
<thead>
<tr style="text-align: right;">
<th/>
<th>Name</th>
<th>PClass</th>
<th>Age</th>
<th>Sex</th>
<th>Survived</th>
<th>SexCode</th>
</tr>
</thead>
<tbody>
<tr>
<th>1307</th>
<td>Zabour, Miss Tamini</td>
<td>3rd</td>
<td>NaN</td>
<td>female</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<th>1312</th>
<td>Zimmerman, Leo</td>
<td>3rd</td>
<td>29.0</td>
<td>male</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>
<p>A related <a data-primary="duplicated method" data-type="indexterm" id="id1114"/>method is <code>duplicated</code>, which returns a boolean series denoting
whether a row is a duplicate or not.<a data-primary="" data-startref="ix_dataframe_drop_dup" data-type="indexterm" id="id1115"/><a data-primary="" data-startref="ix_dup_row_drop_df" data-type="indexterm" id="id1116"/><a data-primary="" data-startref="ix_row_drop_dup" data-type="indexterm" id="id1117"/> This is a good option if you don’t want
to simply drop duplicates:</p>
<pre data-code-language="python" data-type="programlisting"><code class="n">dataframe</code><code class="o">.</code><code class="n">duplicated</code><code class="p">()</code></pre>
<pre data-type="programlisting">0       False
1       False
2       False
3       False
4       False
        ...
1308    False
1309    False
1310    False
1311    False
1312    False
Length: 1313, dtype: bool</pre>
</div></section>
</div></section>
<section data-pdf-bookmark="3.14 Grouping Rows by Values" data-type="sect1"><div class="sect1" id="grouping-rows-by-values">
<h1>3.14 Grouping Rows by Values</h1>
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id478">
<h2>Problem</h2>
<p>You want to <a data-primary="rows in dataframes" data-secondary="grouping by value" data-type="indexterm" id="ix_row_group_val"/><a data-primary="grouping rows in dataframes" data-secondary="by values" data-secondary-sortas="values" data-type="indexterm" id="ix_group_row_val"/><a data-primary="dataframes (DataFrame object)" data-secondary="grouping rows by values in" data-type="indexterm" id="ix_dataframe_group_row"/>group individual rows according to some shared value.</p>
</div></section>
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id85">
<h2>Solution</h2>
<p><code>groupby</code> is one of the most <a data-primary="groupby function" data-type="indexterm" id="ix_groupby_func"/>powerful features in pandas:</p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># Load library</code>
<code class="kn">import</code> <code class="nn">pandas</code> <code class="k">as</code> <code class="nn">pd</code>

<code class="c1"># Create URL</code>
<code class="n">url</code> <code class="o">=</code> <code class="s1">'https://raw.githubusercontent.com/chrisalbon/sim_data/master/titanic.csv'</code>

<code class="c1"># Load data</code>
<code class="n">dataframe</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">read_csv</code><code class="p">(</code><code class="n">url</code><code class="p">)</code>

<code class="c1"># Group rows by the values of the column 'Sex', calculate mean # of each group</code>
<code class="n">dataframe</code><code class="o">.</code><code class="n">groupby</code><code class="p">(</code><code class="s1">'Sex'</code><code class="p">)</code><code class="o">.</code><code class="n">mean</code><code class="p">(</code><code class="n">numeric_only</code><code class="o">=</code><code class="kc">True</code><code class="p">)</code></pre>
<table>
<thead>
<tr>
<th>Sex</th>
<th>Age</th>
<th>Survived</th>
<th>SexCode</th>
</tr>
</thead>
<tbody>
<tr>
<th>female</th>
<td>29.396424</td>
<td>0.666667</td>
<td>1.0</td>
</tr>
<tr>
<th>male</th>
<td>31.014338</td>
<td>0.166863</td>
<td>0.0</td>
</tr>
</tbody>
</table>
</div></section>
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id86">
<h2>Discussion</h2>
<p><code>groupby</code> is where data wrangling really starts to take shape. It is
very common to have a DataFrame where each row is a person or an event
and we want to group them according to some criterion and then calculate
a statistic. For example, you can imagine a DataFrame where each row is
an individual sale at a national restaurant chain and we want the total
sales per restaurant. We can accomplish this by grouping rows by
individual restaurants and then calculating the sum of each group.</p>
<p>Users new to <code>groupby</code> often write a line like this and are confused by
what is returned:</p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># Group rows</code>
<code class="n">dataframe</code><code class="o">.</code><code class="n">groupby</code><code class="p">(</code><code class="s1">'Sex'</code><code class="p">)</code></pre>
<pre data-type="programlisting">&lt;pandas.core.groupby.DataFrameGroupBy object at 0x10efacf28&gt;</pre>
<p>Why didn’t it return something more useful? The reason is that <code>groupby</code> needs to be paired with some operation that we want to apply to
each group, such as calculating an aggregate statistic (e.g., mean,
median, sum). When talking about grouping we often use shorthand and say “group by gender,” but that is incomplete. For grouping to be useful, we need to group by something and then apply a function to each of those groups:</p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># Group rows, count rows</code>
<code class="n">dataframe</code><code class="o">.</code><code class="n">groupby</code><code class="p">(</code><code class="s1">'Survived'</code><code class="p">)[</code><code class="s1">'Name'</code><code class="p">]</code><code class="o">.</code><code class="n">count</code><code class="p">()</code></pre>
<pre data-type="programlisting">Survived
0    863
1    450
Name: Name, dtype: int64</pre>
<p>Notice <code>Name</code> added after the <code>groupby</code>? That is because particular
summary statistics are meaningful only to certain types of data. For
example, while calculating the average age by gender makes sense,
calculating the total age by gender does not. In this case, we group the
data into survived or not, and then count the number of names (i.e.,
passengers) in each group.<a data-primary="" data-startref="ix_dataframe_group_row" data-type="indexterm" id="id1118"/><a data-primary="" data-startref="ix_groupby_func" data-type="indexterm" id="id1119"/><a data-primary="" data-startref="ix_group_row_val" data-type="indexterm" id="id1120"/><a data-primary="" data-startref="ix_row_group_val" data-type="indexterm" id="id1121"/></p>
<p>We can also group by a first column, then group that grouping by a
second column:</p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># Group rows, calculate mean</code>
<code class="n">dataframe</code><code class="o">.</code><code class="n">groupby</code><code class="p">([</code><code class="s1">'Sex'</code><code class="p">,</code><code class="s1">'Survived'</code><code class="p">])[</code><code class="s1">'Age'</code><code class="p">]</code><code class="o">.</code><code class="n">mean</code><code class="p">()</code></pre>
<pre data-type="programlisting">Sex     Survived
female  0           24.901408
        1           30.867143
male    0           32.320780
        1           25.951875
Name: Age, dtype: float64</pre>
</div></section>
</div></section>
<section data-pdf-bookmark="3.15 Grouping Rows by Time" data-type="sect1"><div class="sect1" id="grouping-rows-by-time">
<h1>3.15 Grouping Rows by Time</h1>
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id479">
<h2>Problem</h2>
<p>You need to <a data-primary="grouping rows in dataframes" data-secondary="by time" data-secondary-sortas="time" data-type="indexterm" id="ix_group_row_time"/><a data-primary="dataframes (DataFrame object)" data-secondary="grouping rows by time in" data-type="indexterm" id="ix_dataframe_group_row_time"/><a data-primary="rows in dataframes" data-secondary="grouping by time" data-type="indexterm" id="ix_row_dataframe_grp_time"/>group individual rows by time periods.</p>
</div></section>
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id87">
<h2>Solution</h2>
<p>Use <code>resample</code> to <a data-primary="resample function" data-type="indexterm" id="id1122"/>group rows by chunks of time:</p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># Load libraries</code>
<code class="kn">import</code> <code class="nn">pandas</code> <code class="k">as</code> <code class="nn">pd</code>
<code class="kn">import</code> <code class="nn">numpy</code> <code class="k">as</code> <code class="nn">np</code>

<code class="c1"># Create date range</code>
<code class="n">time_index</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">date_range</code><code class="p">(</code><code class="s1">'06/06/2017'</code><code class="p">,</code> <code class="n">periods</code><code class="o">=</code><code class="mi">100000</code><code class="p">,</code> <code class="n">freq</code><code class="o">=</code><code class="s1">'30S'</code><code class="p">)</code>

<code class="c1"># Create DataFrame</code>
<code class="n">dataframe</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">(</code><code class="n">index</code><code class="o">=</code><code class="n">time_index</code><code class="p">)</code>

<code class="c1"># Create column of random values</code>
<code class="n">dataframe</code><code class="p">[</code><code class="s1">'Sale_Amount'</code><code class="p">]</code> <code class="o">=</code> <code class="n">np</code><code class="o">.</code><code class="n">random</code><code class="o">.</code><code class="n">randint</code><code class="p">(</code><code class="mi">1</code><code class="p">,</code> <code class="mi">10</code><code class="p">,</code> <code class="mi">100000</code><code class="p">)</code>

<code class="c1"># Group rows by week, calculate sum per week</code>
<code class="n">dataframe</code><code class="o">.</code><code class="n">resample</code><code class="p">(</code><code class="s1">'W'</code><code class="p">)</code><code class="o">.</code><code class="n">sum</code><code class="p">()</code></pre>
<table>
<thead>
<tr>
<th/>
<th>Sale_Amount</th>
</tr>
</thead>
<tbody>
<tr>
<th>2017-06-11</th>
<td>86423</td>
</tr>
<tr>
<th>2017-06-18</th>
<td>101045</td>
</tr>
<tr>
<th>2017-06-25</th>
<td>100867</td>
</tr>
<tr>
<th>2017-07-02</th>
<td>100894</td>
</tr>
<tr>
<th>2017-07-09</th>
<td>100438</td>
</tr>
<tr>
<th>2017-07-16</th>
<td>10297</td>
</tr>
</tbody>
</table>
</div></section>
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id88">
<h2>Discussion</h2>
<p>Our standard <em>Titanic</em> dataset does not contain a datetime column, so for this recipe we have generated a simple DataFrame where each row is an individual sale. For each sale we know its date and time and its dollar amount (this data isn’t realistic because the sales take place precisely 30 seconds apart and are exact dollar amounts, but for the sake of simplicity let’s pretend).</p>
<p>The raw data looks like this:</p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># Show three rows</code>
<code class="n">dataframe</code><code class="o">.</code><code class="n">head</code><code class="p">(</code><code class="mi">3</code><code class="p">)</code></pre>
<table>
<thead>
<tr>
<th/>
<th>Sale_Amount</th>
</tr>
</thead>
<tbody>
<tr>
<th>2017-06-06 00:00:00</th>
<td>7</td>
</tr>
<tr>
<th>2017-06-06 00:00:30</th>
<td>2</td>
</tr>
<tr>
<th>2017-06-06 00:01:00</th>
<td>7</td>
</tr>
</tbody>
</table>
<p>Notice that the date and time of each sale is the index of the
DataFrame; this is because <code>resample</code> requires the index to be a datetime-like value.</p>
<p>Using <code>resample</code> we can group the rows by a wide array of time periods
(offsets) and then we can calculate statistics on each time group:</p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># Group by two weeks, calculate mean</code>
<code class="n">dataframe</code><code class="o">.</code><code class="n">resample</code><code class="p">(</code><code class="s1">'2W'</code><code class="p">)</code><code class="o">.</code><code class="n">mean</code><code class="p">()</code></pre>
<table>
<thead>
<tr>
<th/>
<th>Sale_Amount</th>
</tr>
</thead>
<tbody>
<tr>
<th>2017-06-11</th>
<td>5.001331</td>
</tr>
<tr>
<th>2017-06-25</th>
<td>5.007738</td>
</tr>
<tr>
<th>2017-07-09</th>
<td>4.993353</td>
</tr>
<tr>
<th>2017-07-23</th>
<td>4.950481</td>
</tr>
</tbody>
</table>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># Group by month, count rows</code>
<code class="n">dataframe</code><code class="o">.</code><code class="n">resample</code><code class="p">(</code><code class="s1">'M'</code><code class="p">)</code><code class="o">.</code><code class="n">count</code><code class="p">()</code></pre>
<table>
<thead>
<tr style="text-align: right;">
<th/>
<th>Sale_Amount</th>
</tr>
</thead>
<tbody>
<tr>
<th>2017-06-30</th>
<td>72000</td>
</tr>
<tr>
<th>2017-07-31</th>
<td>28000</td>
</tr>
</tbody>
</table>
<p>You might notice that in the two outputs the datetime index is a date even though we are grouping by weeks and months, respectively.<a data-primary="" data-startref="ix_dataframe_group_row_time" data-type="indexterm" id="id1123"/><a data-primary="" data-startref="ix_group_row_time" data-type="indexterm" id="id1124"/><a data-primary="" data-startref="ix_row_dataframe_grp_time" data-type="indexterm" id="id1125"/> The reason is that by default <code>resample</code> returns the
label of the right “edge” (the last label) of the time group. We can control this behavior using the <code>label</code> parameter:</p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># Group by month, count rows</code>
<code class="n">dataframe</code><code class="o">.</code><code class="n">resample</code><code class="p">(</code><code class="s1">'M'</code><code class="p">,</code> <code class="n">label</code><code class="o">=</code><code class="s1">'left'</code><code class="p">)</code><code class="o">.</code><code class="n">count</code><code class="p">()</code></pre>
<table>
<thead>
<tr style="text-align: right;">
<th/>
<th>Sale_Amount</th>
</tr>
</thead>
<tbody>
<tr>
<th>2017-05-31</th>
<td>72000</td>
</tr>
<tr>
<th>2017-06-30</th>
<td>28000</td>
</tr>
</tbody>
</table>
</div></section>
<section data-pdf-bookmark="See Also" data-type="sect2"><div class="sect2" id="id1126">
<h2>See Also</h2>
<ul>
<li>
<p><a href="https://oreil.ly/BURbR">List of pandas time offset aliases</a></p>
</li>
</ul>
</div></section>
</div></section>
<section data-pdf-bookmark="3.16 Aggregating Operations and Statistics" data-type="sect1"><div class="sect1" id="aggregating-operations-and-statistics">
<h1>3.16 Aggregating Operations and Statistics</h1>
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id480">
<h2>Problem</h2>
<p>You need to <a data-primary="dataframes (DataFrame object)" data-secondary="aggregating operations and statistics in" data-type="indexterm" id="ix_df_agg_ops"/>aggregate an operation over each column (or a set of columns) in a dataframe.</p>
</div></section>
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id89">
<h2>Solution</h2>
<p>Use the <a data-primary="agg method" data-type="indexterm" id="ix_agg_meth"/>pandas <code>agg</code> method. Here, we can easily get the minimum value of every column:</p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># Load library</code>
<code class="kn">import</code> <code class="nn">pandas</code> <code class="k">as</code> <code class="nn">pd</code>

<code class="c1"># Create URL</code>
<code class="n">url</code> <code class="o">=</code> <code class="s1">'https://raw.githubusercontent.com/chrisalbon/sim_data/master/titanic.csv'</code>

<code class="c1"># Load data</code>
<code class="n">dataframe</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">read_csv</code><code class="p">(</code><code class="n">url</code><code class="p">)</code>

<code class="c1"># Get the minimum of every column</code>
<code class="n">dataframe</code><code class="o">.</code><code class="n">agg</code><code class="p">(</code><code class="s2">"min"</code><code class="p">)</code></pre>
<pre data-type="programlisting">Name        Abbing, Mr Anthony
PClass                       *
Age                       0.17
Sex                     female
Survived                     0
SexCode                      0
dtype: object</pre>
<p>Sometimes, we want to apply specific functions to specific sets of columns:</p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># Mean Age, min and max SexCode</code>
<code class="n">dataframe</code><code class="o">.</code><code class="n">agg</code><code class="p">({</code><code class="s2">"Age"</code><code class="p">:[</code><code class="s2">"mean"</code><code class="p">],</code> <code class="s2">"SexCode"</code><code class="p">:[</code><code class="s2">"min"</code><code class="p">,</code> <code class="s2">"max"</code><code class="p">]})</code></pre>
<table>
<thead>
<tr>
<th/>
<th>Age</th>
<th>SexCode</th>
</tr>
</thead>
<tbody>
<tr>
<th>mean</th>
<td>30.397989</td>
<td>NaN</td>
</tr>
<tr>
<th>min</th>
<td>NaN</td>
<td>0.0</td>
</tr>
<tr>
<th>max</th>
<td>NaN</td>
<td>1.0</td>
</tr>
</tbody>
</table>
<p>We can also apply aggregate functions to groups to get more specific, descriptive <a data-primary="descriptive statistics" data-type="indexterm" id="id1127"/>statistics:</p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># Number of people who survived and didn't survive in each class</code>
<code class="n">dataframe</code><code class="o">.</code><code class="n">groupby</code><code class="p">(</code>
    <code class="p">[</code><code class="s2">"PClass"</code><code class="p">,</code><code class="s2">"Survived"</code><code class="p">])</code><code class="o">.</code><code class="n">agg</code><code class="p">({</code><code class="s2">"Survived"</code><code class="p">:[</code><code class="s2">"count"</code><code class="p">]}</code>
  <code class="p">)</code><code class="o">.</code><code class="n">reset_index</code><code class="p">()</code></pre>
<table>
<thead>
<tr>
<th>PClass</th>
<th colspan="2">Survived</th>
<th>Count</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>*</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<th>1</th>
<td>1st</td>
<td>0</td>
<td>129</td>
</tr>
<tr>
<th>2</th>
<td>1st</td>
<td>1</td>
<td>193</td>
</tr>
<tr>
<th>3</th>
<td>2nd</td>
<td>0</td>
<td>160</td>
</tr>
<tr>
<th>4</th>
<td>2nd</td>
<td>1</td>
<td>119</td>
</tr>
<tr>
<th>5</th>
<td>3rd</td>
<td>0</td>
<td>573</td>
</tr>
<tr>
<th>6</th>
<td>3rd</td>
<td>1</td>
<td>138</td>
</tr>
</tbody>
</table>
</div></section>
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id90">
<h2>Discussion</h2>
<p>Aggregate functions are especially useful during exploratory data analysis to learn information about different subpopulations of data and the relationship between variables. By grouping the data and applying aggregate statistics, you can view patterns in the data that may prove useful during the machine learning or feature engineering process. While visual charts are also helpful, it’s often useful to have such specific, descriptive statistics as a reference to better understand the data.<a data-primary="" data-startref="ix_agg_meth" data-type="indexterm" id="id1128"/><a data-primary="" data-startref="ix_df_agg_ops" data-type="indexterm" id="id1129"/></p>
</div></section>
<section data-pdf-bookmark="See Also" data-type="sect2"><div class="sect2" id="id1130">
<h2>See Also</h2>
<ul>
<li>
<p><a href="https://oreil.ly/5xing">pandas agg documentation</a></p>
</li>
</ul>
</div></section>
</div></section>
<section data-pdf-bookmark="3.17 Looping over a Column" data-type="sect1"><div class="sect1" id="looping-over-a-column">
<h1>3.17 Looping over a Column</h1>
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id91">
<h2>Problem</h2>
<p>You want to <a data-primary="looping over a column, dataframes" data-type="indexterm" id="id1131"/><a data-primary="columns in dataframes" data-secondary="looping over" data-type="indexterm" id="id1132"/><a data-primary="dataframes (DataFrame object)" data-secondary="looping over a column in" data-type="indexterm" id="id1133"/>iterate over every element in a column and apply some
action.</p>
</div></section>
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id92">
<h2>Solution</h2>
<p>You can treat a <a data-primary="for loops" data-type="indexterm" id="id1134"/>pandas column like any other sequence in Python and loop over it using the standard Python syntax:</p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># Load library</code>
<code class="kn">import</code> <code class="nn">pandas</code> <code class="k">as</code> <code class="nn">pd</code>

<code class="c1"># Create URL</code>
<code class="n">url</code> <code class="o">=</code> <code class="s1">'https://raw.githubusercontent.com/chrisalbon/sim_data/master/titanic.csv'</code>

<code class="c1"># Load data</code>
<code class="n">dataframe</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">read_csv</code><code class="p">(</code><code class="n">url</code><code class="p">)</code>

<code class="c1"># Print first two names uppercased</code>
<code class="k">for</code> <code class="n">name</code> <code class="ow">in</code> <code class="n">dataframe</code><code class="p">[</code><code class="s1">'Name'</code><code class="p">][</code><code class="mi">0</code><code class="p">:</code><code class="mi">2</code><code class="p">]:</code>
    <code class="nb">print</code><code class="p">(</code><code class="n">name</code><code class="o">.</code><code class="n">upper</code><code class="p">())</code></pre>
<pre data-type="programlisting">ALLEN, MISS ELISABETH WALTON
ALLISON, MISS HELEN LORAINE</pre>
</div></section>
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id93">
<h2>Discussion</h2>
<p>In addition to loops (often called <code>for</code> loops), we can also use <a data-primary="list comprehensions" data-type="indexterm" id="id1135"/>list
comprehensions:</p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># Show first two names uppercased</code>
<code class="p">[</code><code class="n">name</code><code class="o">.</code><code class="n">upper</code><code class="p">()</code> <code class="k">for</code> <code class="n">name</code> <code class="ow">in</code> <code class="n">dataframe</code><code class="p">[</code><code class="s1">'Name'</code><code class="p">][</code><code class="mi">0</code><code class="p">:</code><code class="mi">2</code><code class="p">]]</code></pre>
<pre data-type="programlisting">['ALLEN, MISS ELISABETH WALTON', 'ALLISON, MISS HELEN LORAINE']</pre>
<p>Despite the temptation to fall back on <code>for</code> loops, a more Pythonic
solution would use the <a data-primary="apply method" data-type="indexterm" id="id1136"/>pandas <code>apply</code> method, described in <a data-type="xref" href="#applying-a-function-over-all-elements-in-a-column">Recipe 3.18</a>.</p>
</div></section>
</div></section>
<section data-pdf-bookmark="3.18 Applying a Function over All Elements in a Column" data-type="sect1"><div class="sect1" id="applying-a-function-over-all-elements-in-a-column">
<h1>3.18 Applying a Function over All Elements in a Column</h1>
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id481">
<h2>Problem</h2>
<p>You want to <a data-primary="dataframes (DataFrame object)" data-secondary="applying function over all elements in a column" data-type="indexterm" id="id1137"/>apply some function over all elements in a column.</p>
</div></section>
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id1138">
<h2>Solution</h2>
<p>Use <code>apply</code> to apply a built-in or custom function on every element in a column:</p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># Load library</code>
<code class="kn">import</code> <code class="nn">pandas</code> <code class="k">as</code> <code class="nn">pd</code>

<code class="c1"># Create URL</code>
<code class="n">url</code> <code class="o">=</code> <code class="s1">'https://raw.githubusercontent.com/chrisalbon/sim_data/master/titanic.csv'</code>

<code class="c1"># Load data</code>
<code class="n">dataframe</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">read_csv</code><code class="p">(</code><code class="n">url</code><code class="p">)</code>

<code class="c1"># Create function</code>
<code class="k">def</code> <code class="nf">uppercase</code><code class="p">(</code><code class="n">x</code><code class="p">):</code>
    <code class="k">return</code> <code class="n">x</code><code class="o">.</code><code class="n">upper</code><code class="p">()</code>

<code class="c1"># Apply function, show two rows</code>
<code class="n">dataframe</code><code class="p">[</code><code class="s1">'Name'</code><code class="p">]</code><code class="o">.</code><code class="n">apply</code><code class="p">(</code><code class="n">uppercase</code><code class="p">)[</code><code class="mi">0</code><code class="p">:</code><code class="mi">2</code><code class="p">]</code></pre>
<pre data-type="programlisting">0    ALLEN, MISS ELISABETH WALTON
1    ALLISON, MISS HELEN LORAINE
Name: Name, dtype: object</pre>
</div></section>
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id1139">
<h2>Discussion</h2>
<p><code>apply</code> is a great way to do data cleaning and wrangling. It is common
to write a function to perform some useful operation (separate
first and last names, convert strings to floats, etc.) and then map
that function to every element in a column.</p>
</div></section>
</div></section>
<section data-pdf-bookmark="3.19 Applying a Function to Groups" data-type="sect1"><div class="sect1" id="applying-a-function-to-groups">
<h1>3.19 Applying a Function to Groups</h1>
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id94">
<h2>Problem</h2>
<p>You have <a data-primary="dataframes (DataFrame object)" data-secondary="applying function to groups of rows" data-type="indexterm" id="id1140"/><a data-primary="groupby function" data-type="indexterm" id="id1141"/>grouped rows using <code>groupby</code> and want to <a data-primary="apply method" data-type="indexterm" id="id1142"/>apply a function to
each group.</p>
</div></section>
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id1143">
<h2>Solution</h2>
<p>Combine <code>groupby</code> and <code>apply</code>:</p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># Load library</code>
<code class="kn">import</code> <code class="nn">pandas</code> <code class="k">as</code> <code class="nn">pd</code>

<code class="c1"># Create URL</code>
<code class="n">url</code> <code class="o">=</code> <code class="s1">'https://raw.githubusercontent.com/chrisalbon/sim_data/master/titanic.csv'</code>

<code class="c1"># Load data</code>
<code class="n">dataframe</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">read_csv</code><code class="p">(</code><code class="n">url</code><code class="p">)</code>

<code class="c1"># Group rows, apply function to groups</code>
<code class="n">dataframe</code><code class="o">.</code><code class="n">groupby</code><code class="p">(</code><code class="s1">'Sex'</code><code class="p">)</code><code class="o">.</code><code class="n">apply</code><code class="p">(</code><code class="k">lambda</code> <code class="n">x</code><code class="p">:</code> <code class="n">x</code><code class="o">.</code><code class="n">count</code><code class="p">())</code></pre>
<table>
<thead>
<tr>
<th>Sex</th>
<th>Name</th>
<th>PClass</th>
<th>Age</th>
<th>Sex</th>
<th>Survived</th>
<th>SexCode</th>
</tr>
</thead>
<tbody>
<tr>
<th>female</th>
<td>462</td>
<td>462</td>
<td>288</td>
<td>462</td>
<td>462</td>
<td>462</td>
</tr>
<tr>
<th>male</th>
<td>851</td>
<td>851</td>
<td>468</td>
<td>851</td>
<td>851</td>
<td>851</td>
</tr>
</tbody>
</table>
</div></section>
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id1144">
<h2>Discussion</h2>
<p>In <a data-type="xref" href="#applying-a-function-over-all-elements-in-a-column">Recipe 3.18</a> I mentioned <code>apply</code>. <code>apply</code> is particularly useful when you want to apply a function to groups. By combining <code>groupby</code> and <code>apply</code> we can calculate custom statistics or apply any function to each group separately.</p>
</div></section>
</div></section>
<section data-pdf-bookmark="3.20 Concatenating DataFrames" data-type="sect1"><div class="sect1" id="concatenating-dataframes">
<h1>3.20 Concatenating DataFrames</h1>
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id482">
<h2>Problem</h2>
<p>You want to <a data-primary="dataframes (DataFrame object)" data-secondary="concatenating" data-type="indexterm" id="ix_df_concat"/>concatenate two DataFrames.</p>
</div></section>
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id95">
<h2>Solution</h2>
<p>Use <code>concat</code> with <code>axis=0</code> to <a data-primary="concat function" data-type="indexterm" id="id1145"/>concatenate along the row axis:</p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># Load library</code>
<code class="kn">import</code> <code class="nn">pandas</code> <code class="k">as</code> <code class="nn">pd</code>

<code class="c1"># Create DataFrame</code>
<code class="n">data_a</code> <code class="o">=</code> <code class="p">{</code><code class="s1">'id'</code><code class="p">:</code> <code class="p">[</code><code class="s1">'1'</code><code class="p">,</code> <code class="s1">'2'</code><code class="p">,</code> <code class="s1">'3'</code><code class="p">],</code>
          <code class="s1">'first'</code><code class="p">:</code> <code class="p">[</code><code class="s1">'Alex'</code><code class="p">,</code> <code class="s1">'Amy'</code><code class="p">,</code> <code class="s1">'Allen'</code><code class="p">],</code>
          <code class="s1">'last'</code><code class="p">:</code> <code class="p">[</code><code class="s1">'Anderson'</code><code class="p">,</code> <code class="s1">'Ackerman'</code><code class="p">,</code> <code class="s1">'Ali'</code><code class="p">]}</code>
<code class="n">dataframe_a</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">(</code><code class="n">data_a</code><code class="p">,</code> <code class="n">columns</code> <code class="o">=</code> <code class="p">[</code><code class="s1">'id'</code><code class="p">,</code> <code class="s1">'first'</code><code class="p">,</code> <code class="s1">'last'</code><code class="p">])</code>

<code class="c1"># Create DataFrame</code>
<code class="n">data_b</code> <code class="o">=</code> <code class="p">{</code><code class="s1">'id'</code><code class="p">:</code> <code class="p">[</code><code class="s1">'4'</code><code class="p">,</code> <code class="s1">'5'</code><code class="p">,</code> <code class="s1">'6'</code><code class="p">],</code>
          <code class="s1">'first'</code><code class="p">:</code> <code class="p">[</code><code class="s1">'Billy'</code><code class="p">,</code> <code class="s1">'Brian'</code><code class="p">,</code> <code class="s1">'Bran'</code><code class="p">],</code>
          <code class="s1">'last'</code><code class="p">:</code> <code class="p">[</code><code class="s1">'Bonder'</code><code class="p">,</code> <code class="s1">'Black'</code><code class="p">,</code> <code class="s1">'Balwner'</code><code class="p">]}</code>
<code class="n">dataframe_b</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">(</code><code class="n">data_b</code><code class="p">,</code> <code class="n">columns</code> <code class="o">=</code> <code class="p">[</code><code class="s1">'id'</code><code class="p">,</code> <code class="s1">'first'</code><code class="p">,</code> <code class="s1">'last'</code><code class="p">])</code>

<code class="c1"># Concatenate DataFrames by rows</code>
<code class="n">pd</code><code class="o">.</code><code class="n">concat</code><code class="p">([</code><code class="n">dataframe_a</code><code class="p">,</code> <code class="n">dataframe_b</code><code class="p">],</code> <code class="n">axis</code><code class="o">=</code><code class="mi">0</code><code class="p">)</code></pre>
<table>
<thead>
<tr>
<th/>
<th>id</th>
<th>first</th>
<th>last</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>1</td>
<td>Alex</td>
<td>Anderson</td>
</tr>
<tr>
<th>1</th>
<td>2</td>
<td>Amy</td>
<td>Ackerman</td>
</tr>
<tr>
<th>2</th>
<td>3</td>
<td>Allen</td>
<td>Ali</td>
</tr>
<tr>
<th>0</th>
<td>4</td>
<td>Billy</td>
<td>Bonder</td>
</tr>
<tr>
<th>1</th>
<td>5</td>
<td>Brian</td>
<td>Black</td>
</tr>
<tr>
<th>2</th>
<td>6</td>
<td>Bran</td>
<td>Balwner</td>
</tr>
</tbody>
</table>
<p>You can use <code>axis=1</code> to concatenate along the column axis:</p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># Concatenate DataFrames by columns</code>
<code class="n">pd</code><code class="o">.</code><code class="n">concat</code><code class="p">([</code><code class="n">dataframe_a</code><code class="p">,</code> <code class="n">dataframe_b</code><code class="p">],</code> <code class="n">axis</code><code class="o">=</code><code class="mi">1</code><code class="p">)</code></pre>
<table>
<thead>
<tr>
<th/>
<th>id</th>
<th>first</th>
<th>last</th>
<th>id</th>
<th>first</th>
<th>last</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>1</td>
<td>Alex</td>
<td>Anderson</td>
<td>4</td>
<td>Billy</td>
<td>Bonder</td>
</tr>
<tr>
<th>1</th>
<td>2</td>
<td>Amy</td>
<td>Ackerman</td>
<td>5</td>
<td>Brian</td>
<td>Black</td>
</tr>
<tr>
<th>2</th>
<td>3</td>
<td>Allen</td>
<td>Ali</td>
<td>6</td>
<td>Bran</td>
<td>Balwner</td>
</tr>
</tbody>
</table>
</div></section>
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id96">
<h2>Discussion</h2>
<p>Concatenating is not a word you hear much outside of computer science
and programming, so if you have not heard it before, do not worry.
The informal definition of <em>concatenate</em> is to glue two objects together. In the solution we glued together two small DataFrames using the <code>axis</code> parameter to indicate whether we wanted to stack the two DataFrames on top of each other or place them side by side.<a data-primary="" data-startref="ix_df_concat" data-type="indexterm" id="id1146"/></p>
</div></section>
</div></section>
<section data-pdf-bookmark="3.21 Merging DataFrames" data-type="sect1"><div class="sect1" id="merging-dataframes">
<h1>3.21 Merging DataFrames</h1>
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id97">
<h2>Problem</h2>
<p>You want to <a data-primary="joins (merging operations" data-type="indexterm" id="ix_joins_merge"/><a data-primary="merging operations (joins)" data-type="indexterm" id="ix_merge_joins"/><a data-primary="dataframes (DataFrame object)" data-secondary="merging" data-type="indexterm" id="ix_df_merge"/>merge two DataFrames.</p>
</div></section>
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id98">
<h2>Solution</h2>
<p>To <a data-primary="inner join" data-type="indexterm" id="id1147"/>inner join, use <code>merge</code> with the <code>on</code> parameter to specify the column to merge on:</p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># Load library</code>
<code class="kn">import</code> <code class="nn">pandas</code> <code class="k">as</code> <code class="nn">pd</code>

<code class="c1"># Create DataFrame</code>
<code class="n">employee_data</code> <code class="o">=</code> <code class="p">{</code><code class="s1">'employee_id'</code><code class="p">:</code> <code class="p">[</code><code class="s1">'1'</code><code class="p">,</code> <code class="s1">'2'</code><code class="p">,</code> <code class="s1">'3'</code><code class="p">,</code> <code class="s1">'4'</code><code class="p">],</code>
                 <code class="s1">'name'</code><code class="p">:</code> <code class="p">[</code><code class="s1">'Amy Jones'</code><code class="p">,</code> <code class="s1">'Allen Keys'</code><code class="p">,</code> <code class="s1">'Alice Bees'</code><code class="p">,</code>
                 <code class="s1">'Tim Horton'</code><code class="p">]}</code>
<code class="n">dataframe_employees</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">(</code><code class="n">employee_data</code><code class="p">,</code> <code class="n">columns</code> <code class="o">=</code> <code class="p">[</code><code class="s1">'employee_id'</code><code class="p">,</code>
                                                              <code class="s1">'name'</code><code class="p">])</code>

<code class="c1"># Create DataFrame</code>
<code class="n">sales_data</code> <code class="o">=</code> <code class="p">{</code><code class="s1">'employee_id'</code><code class="p">:</code> <code class="p">[</code><code class="s1">'3'</code><code class="p">,</code> <code class="s1">'4'</code><code class="p">,</code> <code class="s1">'5'</code><code class="p">,</code> <code class="s1">'6'</code><code class="p">],</code>
              <code class="s1">'total_sales'</code><code class="p">:</code> <code class="p">[</code><code class="mi">23456</code><code class="p">,</code> <code class="mi">2512</code><code class="p">,</code> <code class="mi">2345</code><code class="p">,</code> <code class="mi">1455</code><code class="p">]}</code>
<code class="n">dataframe_sales</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">(</code><code class="n">sales_data</code><code class="p">,</code> <code class="n">columns</code> <code class="o">=</code> <code class="p">[</code><code class="s1">'employee_id'</code><code class="p">,</code>
                                                      <code class="s1">'total_sales'</code><code class="p">])</code>

<code class="c1"># Merge DataFrames</code>
<code class="n">pd</code><code class="o">.</code><code class="n">merge</code><code class="p">(</code><code class="n">dataframe_employees</code><code class="p">,</code> <code class="n">dataframe_sales</code><code class="p">,</code> <code class="n">on</code><code class="o">=</code><code class="s1">'employee_id'</code><code class="p">)</code></pre>
<table>
<thead>
<tr>
<th/>
<th>employee_id</th>
<th>name</th>
<th>total_sales</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>3</td>
<td>Alice Bees</td>
<td>23456</td>
</tr>
<tr>
<th>1</th>
<td>4</td>
<td>Tim Horton</td>
<td>2512</td>
</tr>
</tbody>
</table>
<p><code>merge</code> defaults to inner joins. If we want to do an <a data-primary="outer join" data-type="indexterm" id="id1148"/>outer join, we can
specify that with the <code>how</code> parameter:</p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># Merge DataFrames</code>
<code class="n">pd</code><code class="o">.</code><code class="n">merge</code><code class="p">(</code><code class="n">dataframe_employees</code><code class="p">,</code> <code class="n">dataframe_sales</code><code class="p">,</code> <code class="n">on</code><code class="o">=</code><code class="s1">'employee_id'</code><code class="p">,</code> <code class="n">how</code><code class="o">=</code><code class="s1">'outer'</code><code class="p">)</code></pre>
<table>
<thead>
<tr>
<th/>
<th>employee_id</th>
<th>name</th>
<th>total_sales</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>1</td>
<td>Amy Jones</td>
<td>NaN</td>
</tr>
<tr>
<th>1</th>
<td>2</td>
<td>Allen Keys</td>
<td>NaN</td>
</tr>
<tr>
<th>2</th>
<td>3</td>
<td>Alice Bees</td>
<td>23456.0</td>
</tr>
<tr>
<th>3</th>
<td>4</td>
<td>Tim Horton</td>
<td>2512.0</td>
</tr>
<tr>
<th>4</th>
<td>5</td>
<td>NaN</td>
<td>2345.0</td>
</tr>
<tr>
<th>5</th>
<td>6</td>
<td>NaN</td>
<td>1455.0</td>
</tr>
</tbody>
</table>
<p>The same parameter can be used to specify <a data-primary="left join" data-type="indexterm" id="id1149"/><a data-primary="right join" data-type="indexterm" id="id1150"/>left and right joins:</p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># Merge DataFrames</code>
<code class="n">pd</code><code class="o">.</code><code class="n">merge</code><code class="p">(</code><code class="n">dataframe_employees</code><code class="p">,</code> <code class="n">dataframe_sales</code><code class="p">,</code> <code class="n">on</code><code class="o">=</code><code class="s1">'employee_id'</code><code class="p">,</code> <code class="n">how</code><code class="o">=</code><code class="s1">'left'</code><code class="p">)</code></pre>
<table>
<thead>
<tr>
<th/>
<th>employee_id</th>
<th>name</th>
<th>total_sales</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>1</td>
<td>Amy Jones</td>
<td>NaN</td>
</tr>
<tr>
<th>1</th>
<td>2</td>
<td>Allen Keys</td>
<td>NaN</td>
</tr>
<tr>
<th>2</th>
<td>3</td>
<td>Alice Bees</td>
<td>23456.0</td>
</tr>
<tr>
<th>3</th>
<td>4</td>
<td>Tim Horton</td>
<td>2512.0</td>
</tr>
</tbody>
</table>
<p>We can also specify the column name in each DataFrame to merge on:</p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># Merge DataFrames</code>
<code class="n">pd</code><code class="o">.</code><code class="n">merge</code><code class="p">(</code><code class="n">dataframe_employees</code><code class="p">,</code>
         <code class="n">dataframe_sales</code><code class="p">,</code>
         <code class="n">left_on</code><code class="o">=</code><code class="s1">'employee_id'</code><code class="p">,</code>
         <code class="n">right_on</code><code class="o">=</code><code class="s1">'employee_id'</code><code class="p">)</code></pre>
<table>
<thead>
<tr>
<th/>
<th>employee_id</th>
<th>name</th>
<th>total_sales</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>3</td>
<td>Alice Bees</td>
<td>23456</td>
</tr>
<tr>
<th>1</th>
<td>4</td>
<td>Tim Horton</td>
<td>2512</td>
</tr>
</tbody>
</table>
<p>If, instead of merging on two columns, we want to merge on the indexes of
each DataFrame, we can replace the <code>left_on</code> and <code>right_on</code> parameters
with <code>left_index=True</code> and <code>right_index=True</code>.</p>
</div></section>
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id99">
<h2>Discussion</h2>
<p>The data we need to use is often complex; it doesn’t always come
in one piece. Instead, in the real world, we’re usually faced with
disparate datasets from multiple database queries or files. To get all
that data into one place, we can load each data query or data file into
pandas as individual DataFrames and then merge them into a
single DataFrame.</p>
<p>This process might be familiar to anyone who has used SQL, a popular
language for doing merging operations (called <em>joins</em>). While the exact
parameters used by pandas will be different, they follow the same
general patterns used by other software languages and tools.</p>
<p>There are three aspects to specify with any <code>merge</code> operation. First, we have to specify the two DataFrames we want to merge. In the
solution, we named them <code>dataframe_employees</code> and <code>dataframe_sales</code>. Second, we have to specify the name(s) of the columns to merge on—​that is, the columns whose values are shared between the two DataFrames. For example, in our solution both DataFrames have a column named <code>employee_id</code>. To merge the two DataFrames we will match the values in each DataFrame’s <code>employee_id</code> column. If these two columns use the same name, we can use the <code>on</code> parameter. However, if they have different names, we can use <code>left_on</code> and <code>right_on</code>.</p>
<p>What is the left and right DataFrame? The left
DataFrame is the first one we specified in <code>merge</code>, and the right
DataFrame is the second one. This language comes up again in the next
sets of parameters we will need.</p>
<p>The last aspect, and most difficult for some people to grasp, is the
type of merge operation we want to conduct. This is specified by the
<code>how</code> parameter. <code>merge</code> supports the four main types of joins:</p>
<dl>
<dt>Inner</dt>
<dd>
<p>  Return <a data-primary="inner join" data-type="indexterm" id="id1151"/>only the rows that match in both DataFrames (e.g.,
return any row with an <code>employee_id</code> value appearing in both
<code>dataframe_employees</code> and 
<span class="keep-together"><code>dataframe_sales</code>).</span></p>
</dd>
<dt>Outer</dt>
<dd>
<p>  Return all <a data-primary="outer join" data-type="indexterm" id="id1152"/>rows in both DataFrames. If a row exists in one
DataFrame but not in the other DataFrame, fill NaN values for the
missing values (e.g., return all rows in both <code>dataframe_employee</code> and
<code>dataframe_sales</code>).</p>
</dd>
</dl>
<dl class="less_space pagebreak-before">
<dt>Left</dt>
<dd>
<p>  Return all <a data-primary="left join" data-type="indexterm" id="id1153"/>rows from the left DataFrame but only rows from the
right DataFrame that match with the left DataFrame. Fill <code>NaN</code> values
for the missing values (e.g., return all rows from 
<span class="keep-together"><code>dataframe_employees</code></span> but only rows from <code>dataframe_sales</code> that have a value for <code>employee_id</code> that appears in 
<span class="keep-together"><code>dataframe_employees</code>).</span></p>
</dd>
<dt>Right</dt>
<dd>
<p>  Return all <a data-primary="right join" data-type="indexterm" id="id1154"/>rows from the right DataFrame but only rows from
the left DataFrame that match with the right DataFrame. Fill <code>NaN</code>
values for the missing values (e.g., return all rows from <code>dataframe_sales</code> but only rows from 
<span class="keep-together"><code>dataframe_employees</code></span> that have a
value for <code>employee_id</code> that appears in 
<span class="keep-together"><code>dataframe_sales</code>).</span></p>
</dd>
</dl>
<p>If you did not understand all of that, I encourage you to play around with the <code>how</code> parameter in your code and see how it affects what <code>merge</code> returns.<a data-primary="" data-startref="ix_dataframe_ch3" data-type="indexterm" id="id1155"/><a data-primary="" data-startref="ix_df_merge" data-type="indexterm" id="id1156"/><a data-primary="" data-startref="ix_joins_merge" data-type="indexterm" id="id1157"/><a data-primary="" data-startref="ix_merge_joins" data-type="indexterm" id="id1158"/></p>
</div></section>
<section data-pdf-bookmark="See Also" data-type="sect2"><div class="sect2" id="id1159">
<h2>See Also</h2>
<ul>
<li>
<p><a href="https://oreil.ly/J1A4u">A Visual Explanation of SQL Joins</a></p>
</li>
<li>
<p><a href="https://oreil.ly/eNalU">pandas documentation: Merge, join, concatenate and compare</a></p>
</li>
</ul>
</div></section>
</div></section>
</div></section></div></body></html>