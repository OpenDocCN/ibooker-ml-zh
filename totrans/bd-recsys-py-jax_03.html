<html><head></head><body><section data-pdf-bookmark="Chapter 2. User-Item Ratings and Framing the Problem" data-type="chapter" epub:type="chapter"><div class="chapter" id="ch:user-item">&#13;
<h1><span class="label">Chapter 2. </span>User-Item Ratings and <span class="keep-together">Framing the Problem</span></h1>&#13;
&#13;
&#13;
<p>If you were asked to curate the selection for a cheese plate at a local café, you might start with your favorites. You might also spend a bit of time asking for your friends’ favorites. Before you order a large stock in these cheeses for the café, you would probably want to run a small experiment—maybe asking a group of friends to taste your selections and tell you their preferences.</p>&#13;
&#13;
<p>In addition to receiving your friends’ feedback, you’d also learn about your friends and the cheeses. You’d learn which kinds of cheeses your friends like and which friends have similar tastes. You can also learn which cheeses are the most popular and which cheeses are liked by the same people.</p>&#13;
&#13;
<p>This data would start to give you hints about your first cheese recommender. In this chapter, we’ll talk about how to turn this idea into the right stuff for a recommendation system. By way of this example, we’ll discuss one of the underlying notions of a recommender: how to predict a user’s affinity for things they’ve never seen.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="The User-Item Matrix" data-type="sect1"><div class="sect1" id="id13">&#13;
<h1>The User-Item Matrix</h1>&#13;
&#13;
<p>It’s<a data-primary="user-item ratings" data-secondary="user-item matrix" data-type="indexterm" id="UIRuim02"/> extremely common to hear those who work on recommendation systems talk about matrices, and in particular the user-item matrix. While linear algebra  <span class="keep-together">is deep, both</span> mathematically and as it applies to RecSys, we will begin with simple relationships.</p>&#13;
&#13;
<p class="less_space pagebreak-before">Before we get to the matrix forms, let’s write down some binary relationships between a set of users and a set of items. For the sake of this example, think of a group of five friends (mysteriously named <em>A</em>, <em>B</em>, <em>C</em>, <em>D</em>, <em>E</em>) and a blind cheese tasting where of <span class="keep-together">four cheeses </span> (<em>gouda</em>, <em>chèvre</em>, <em>emmentaler</em>, <em>brie</em>). The friends are asked to rate the cheeses, 1–4:</p>&#13;
<ol>&#13;
<li>&#13;
<p><em>A</em> starts,  “OK, I really enjoy <em>gouda</em>, so give that a 5; <em>chèvre</em> and <em>emmentaler</em> are yummy too, 4; and <em>brie</em> is awful, 1.”</p>&#13;
</li>&#13;
<li>&#13;
<p><em>B</em> replies, “What?! <em>brie</em> is my favorite! 4.5! <em>chèvre</em> and <em>emmentaler</em> are fine, 3; and <em>gouda</em> is just OK, 2.”</p>&#13;
</li>&#13;
<li>&#13;
<p><em>C</em> gives ratings of 3, 2, 3, and 4, respectively.</p>&#13;
</li>&#13;
<li>&#13;
<p><em>D</em> gives 4, 4, 5, but we run out of <em>brie</em> before <em>D</em> can try it.</p>&#13;
</li>&#13;
<li>&#13;
<p><em>E</em> starts to not feel well, and tries only <em>gouda</em>, giving it a 3.</p>&#13;
</li>&#13;
&#13;
</ol>&#13;
&#13;
<p>The first thing you may notice is that such expository writing is a bit tedious to read and parse. Let’s summarize these results in a convenient table (<a data-type="xref" href="#table_2_1">Table 2-1</a>):</p>&#13;
<table id="table_2_1">&#13;
<caption><span class="label">Table 2-1. </span>Cheeses and ratings</caption>&#13;
<thead>&#13;
<tr>&#13;
<th>Cheese taster</th>&#13;
<th>Gouda</th>&#13;
<th>Chèvre</th>&#13;
<th>Emmentaler</th>&#13;
<th>Brie</th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td><p>A</p></td>&#13;
<td><p>5</p></td>&#13;
<td><p>4</p></td>&#13;
<td><p>4</p></td>&#13;
<td><p>1</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>B</p></td>&#13;
<td><p>2</p></td>&#13;
<td><p>3</p></td>&#13;
<td><p>3</p></td>&#13;
<td><p>4.5</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>C</p></td>&#13;
<td><p>3</p></td>&#13;
<td><p>2</p></td>&#13;
<td><p>3</p></td>&#13;
<td><p>4</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>D</p></td>&#13;
<td><p>4</p></td>&#13;
<td><p>4</p></td>&#13;
<td><p>5</p></td>&#13;
<td><p>-</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>E</p></td>&#13;
<td><p>3</p></td>&#13;
<td><p>-</p></td>&#13;
<td><p>-</p></td>&#13;
<td><p>-</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
&#13;
<p>Your first instinct may be to write this in a form more appropriate for computers. You might create a collection of lists:</p>&#13;
<div data-type="equation">&#13;
<math alttext="StartLayout 1st Row 1st Column upper A 2nd Column colon 3rd Column left-bracket 5 comma 4 comma 4 comma 1 right-bracket 2nd Row 1st Column upper B 2nd Column colon 3rd Column left-bracket 2 comma 3 comma 3 comma 4.5 right-bracket 3rd Row 1st Column upper C 2nd Column colon 3rd Column left-bracket 3 comma 2 comma 3 comma 4 right-bracket 4th Row 1st Column upper D 2nd Column colon 3rd Column left-bracket 4 comma 4 comma 5 comma minus right-bracket 5th Row 1st Column upper E 2nd Column colon 3rd Column left-bracket 3 comma minus comma minus comma minus right-bracket EndLayout" display="block">&#13;
  <mtable displaystyle="true">&#13;
    <mtr>&#13;
      <mtd columnalign="right">&#13;
        <mi>A</mi>&#13;
      </mtd>&#13;
      <mtd>&#13;
        <mo>:</mo>&#13;
      </mtd>&#13;
      <mtd columnalign="left">&#13;
        <mrow>&#13;
          <mo>[</mo>&#13;
          <mn>5</mn>&#13;
          <mo>,</mo>&#13;
          <mn>4</mn>&#13;
          <mo>,</mo>&#13;
          <mn>4</mn>&#13;
          <mo>,</mo>&#13;
          <mn>1</mn>&#13;
          <mo>]</mo>&#13;
        </mrow>&#13;
      </mtd>&#13;
    </mtr>&#13;
    <mtr>&#13;
      <mtd columnalign="right">&#13;
        <mi>B</mi>&#13;
      </mtd>&#13;
      <mtd>&#13;
        <mo>:</mo>&#13;
      </mtd>&#13;
      <mtd columnalign="left">&#13;
        <mrow>&#13;
          <mo>[</mo>&#13;
          <mn>2</mn>&#13;
          <mo>,</mo>&#13;
          <mn>3</mn>&#13;
          <mo>,</mo>&#13;
          <mn>3</mn>&#13;
          <mo>,</mo>&#13;
          <mn>4</mn>&#13;
          <mo>.</mo>&#13;
          <mn>5</mn>&#13;
          <mo>]</mo>&#13;
        </mrow>&#13;
      </mtd>&#13;
    </mtr>&#13;
    <mtr>&#13;
      <mtd columnalign="right">&#13;
        <mi>C</mi>&#13;
      </mtd>&#13;
      <mtd>&#13;
        <mo>:</mo>&#13;
      </mtd>&#13;
      <mtd columnalign="left">&#13;
        <mrow>&#13;
          <mo>[</mo>&#13;
          <mn>3</mn>&#13;
          <mo>,</mo>&#13;
          <mn>2</mn>&#13;
          <mo>,</mo>&#13;
          <mn>3</mn>&#13;
          <mo>,</mo>&#13;
          <mn>4</mn>&#13;
          <mo>]</mo>&#13;
        </mrow>&#13;
      </mtd>&#13;
    </mtr>&#13;
    <mtr>&#13;
      <mtd columnalign="right">&#13;
        <mi>D</mi>&#13;
      </mtd>&#13;
      <mtd>&#13;
        <mo>:</mo>&#13;
      </mtd>&#13;
      <mtd columnalign="left">&#13;
        <mrow>&#13;
          <mo>[</mo>&#13;
          <mn>4</mn>&#13;
          <mo>,</mo>&#13;
          <mn>4</mn>&#13;
          <mo>,</mo>&#13;
          <mn>5</mn>&#13;
          <mo>,</mo>&#13;
          <mo>-</mo>&#13;
          <mo>]</mo>&#13;
        </mrow>&#13;
      </mtd>&#13;
    </mtr>&#13;
    <mtr>&#13;
      <mtd columnalign="right">&#13;
        <mi>E</mi>&#13;
      </mtd>&#13;
      <mtd>&#13;
        <mo>:</mo>&#13;
      </mtd>&#13;
      <mtd columnalign="left">&#13;
        <mrow>&#13;
          <mo>[</mo>&#13;
          <mn>3</mn>&#13;
          <mo>,</mo>&#13;
          <mo>-</mo>&#13;
          <mo>,</mo>&#13;
          <mo>-</mo>&#13;
          <mo>,</mo>&#13;
          <mo>-</mo>&#13;
          <mo>]</mo>&#13;
        </mrow>&#13;
      </mtd>&#13;
    </mtr>&#13;
  </mtable>&#13;
</math>&#13;
</div>&#13;
&#13;
<p>This may work in some scenarios, but you might want to more clearly indicate the positional meaning in each list. You could simply visualize this data with a heatmap (<a data-type="xref" href="#fig:cheese-ratings">Figure 2-1</a>):</p>&#13;
&#13;
<pre class="less_space pagebreak-before" data-code-language="python" data-type="programlisting"><code class="kn">import</code> <code class="nn">seaborn</code> <code class="k">as</code> <code class="nn">sns</code>&#13;
&#13;
<code class="n">_</code> <code class="o">=</code> <code class="n">np</code><code class="o">.</code><code class="n">nan</code>&#13;
<code class="n">scores</code> <code class="o">=</code> <code class="n">np</code><code class="o">.</code><code class="n">array</code><code class="p">([[</code><code class="mi">5</code><code class="p">,</code><code class="mi">4</code><code class="p">,</code><code class="mi">4</code><code class="p">,</code><code class="mi">1</code><code class="p">],</code>&#13;
    <code class="p">[</code><code class="mi">2</code><code class="p">,</code><code class="mi">3</code><code class="p">,</code><code class="mi">3</code><code class="p">,</code><code class="mf">4.5</code><code class="p">],</code>&#13;
    <code class="p">[</code><code class="mi">3</code><code class="p">,</code><code class="mi">2</code><code class="p">,</code><code class="mi">3</code><code class="p">,</code><code class="mi">4</code><code class="p">],</code>&#13;
    <code class="p">[</code><code class="mi">4</code><code class="p">,</code><code class="mi">4</code><code class="p">,</code><code class="mi">5</code><code class="p">,</code><code class="n">_</code><code class="p">],</code>&#13;
    <code class="p">[</code><code class="mi">3</code><code class="p">,</code><code class="n">_</code><code class="p">,</code><code class="n">_</code><code class="p">,</code><code class="n">_</code><code class="p">]])</code>&#13;
<code class="n">sns</code><code class="o">.</code><code class="n">heatmap</code><code class="p">(</code>&#13;
    <code class="n">scores</code><code class="p">,</code>&#13;
    <code class="n">annot</code><code class="o">=</code><code class="kc">True</code><code class="p">,</code>&#13;
    <code class="n">fmt</code><code class="o">=</code><code class="s2">".1f"</code><code class="p">,</code>&#13;
    <code class="n">xticklabels</code><code class="o">=</code><code class="p">[</code><code class="s1">'Gouda'</code><code class="p">,</code> <code class="s1">'Chevre'</code><code class="p">,</code> <code class="s1">'Emmentaler'</code><code class="p">,</code> <code class="s1">'Brie'</code><code class="p">,],</code>&#13;
    <code class="n">yticklabels</code><code class="o">=</code><code class="p">[</code><code class="s1">'A'</code><code class="p">,</code><code class="s1">'B'</code><code class="p">,</code><code class="s1">'C'</code><code class="p">,</code><code class="s1">'D'</code><code class="p">,</code><code class="s1">'E'</code><code class="p">,]</code>&#13;
<code class="p">)</code></pre>&#13;
&#13;
<figure><div class="figure" id="fig:cheese-ratings">&#13;
<img alt="Ratings Heatmap" src="assets/brpj_0201.png"/>&#13;
<h6><span class="label">Figure 2-1. </span>Cheese ratings matrix</h6>&#13;
</div></figure>&#13;
&#13;
<p>As we observe datasets with huge numbers of users or items, and with more and more sparsity, we will need to employ a data structure more well suited to representing only the necessary data. A variety of so-called<a data-primary="dense representations" data-type="indexterm" id="id364"/> <em>dense representations</em> exists, but for now we will use the simplest form: tuples of <code>user_id</code>, <code>item_id</code>, and <code>rating</code>. In practice, the structure is often a dictionary with indices provided by the IDs.</p>&#13;
<div data-type="note" epub:type="note"><h1>Dense and Sparse Representations</h1>&#13;
<p>Two types of structures for these kinds of data are dense and sparse representations. Loosely, a<a data-primary="sparsity" data-type="indexterm" id="id365"/> <em>sparse representation</em> is one such that a datum exists for each nontrivial observation. A <em>dense representation</em> always contains a datum for each possibility even when trivial (<code>null</code> or zero).</p>&#13;
</div>&#13;
&#13;
<p class="less_space pagebreak-before">Let’s see what this data looks like as a dictionary:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="s1">'indices'</code><code class="p">:</code> <code class="p">[</code>&#13;
  <code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">0</code><code class="p">),(</code><code class="mi">0</code><code class="p">,</code><code class="mi">1</code><code class="p">),(</code><code class="mi">0</code><code class="p">,</code><code class="mi">2</code><code class="p">),(</code><code class="mi">0</code><code class="p">,</code><code class="mi">3</code><code class="p">),</code>&#13;
  <code class="p">(</code><code class="mi">1</code><code class="p">,</code><code class="mi">0</code><code class="p">),(</code><code class="mi">1</code><code class="p">,</code><code class="mi">1</code><code class="p">),(</code><code class="mi">1</code><code class="p">,</code><code class="mi">2</code><code class="p">),(</code><code class="mi">1</code><code class="p">,</code><code class="mi">3</code><code class="p">),</code>&#13;
  <code class="p">(</code><code class="mi">2</code><code class="p">,</code><code class="mi">0</code><code class="p">),(</code><code class="mi">2</code><code class="p">,</code><code class="mi">1</code><code class="p">),(</code><code class="mi">2</code><code class="p">,</code><code class="mi">2</code><code class="p">),(</code><code class="mi">2</code><code class="p">,</code><code class="mi">3</code><code class="p">),</code>&#13;
  <code class="p">(</code><code class="mi">3</code><code class="p">,</code><code class="mi">0</code><code class="p">),(</code><code class="mi">3</code><code class="p">,</code><code class="mi">1</code><code class="p">),(</code><code class="mi">3</code><code class="p">,</code><code class="mi">2</code><code class="p">),</code>&#13;
  <code class="p">(</code><code class="mi">4</code><code class="p">,</code><code class="mi">0</code><code class="p">)</code>&#13;
<code class="p">]</code>&#13;
<code class="s1">'values'</code><code class="p">:</code> <code class="p">[</code>&#13;
  <code class="mi">5</code><code class="p">,</code><code class="mi">4</code><code class="p">,</code><code class="mi">4</code><code class="p">,</code><code class="mi">1</code><code class="p">,</code>&#13;
  <code class="mi">2</code><code class="p">,</code><code class="mi">3</code><code class="p">,</code><code class="mi">3</code><code class="p">,</code><code class="mf">4.5</code><code class="p">,</code>&#13;
  <code class="mi">3</code><code class="p">,</code><code class="mi">2</code><code class="p">,</code><code class="mi">3</code><code class="p">,</code><code class="mi">4</code><code class="p">,</code>&#13;
  <code class="mi">4</code><code class="p">,</code><code class="mi">4</code><code class="p">,</code><code class="mi">5</code><code class="p">,</code>&#13;
  <code class="mi">3</code>&#13;
<code class="p">]</code></pre>&#13;
&#13;
<p>A few natural questions emerge:</p>&#13;
<ol>&#13;
<li>&#13;
<p>What’s the most popular cheese? From the observations so far, it’s looking like <em>emmentaler</em> is potentially the favorite, but <em>E</em> didn’t try <em>emmentaler</em>.</p>&#13;
</li>&#13;
<li>&#13;
<p>Would <em>D</em> like <em>brie</em>? It seems to be a contentious cheese.</p>&#13;
</li>&#13;
<li>&#13;
<p>If you were asked to buy only two cheeses, which should you buy to best satisfy everyone?</p>&#13;
</li>&#13;
&#13;
</ol>&#13;
&#13;
<p>This example and associated questions are intentionally simple, but the point is clear that this matrix representation is at least convenient for capturing these ratings.</p>&#13;
&#13;
<p>What may not be obvious is that beyond the convenience of this data visualization is the mathematical utility of this representation. Question 2 suggests an inherent RecSys problem: “predict how much a user will like an item they haven’t seen.” This question may also be recognizable as a problem from a linear algebra class: “How can we fill in unknown elements of a matrix from the ones we know?” This is called<a data-primary="matrix completion" data-type="indexterm" id="id366"/> <em>matrix completion.</em></p>&#13;
&#13;
<p>The back-and-forth between creating user experiences that capture their needs and the mathematical formulations to model this data and needs is at the heart of recommendation systems.<a data-primary="" data-startref="UIRuim02" data-type="indexterm" id="id367"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="User-User Versus Item-Item Collaborative Filtering" data-type="sect1"><div class="sect1" id="id14">&#13;
<h1>User-User Versus Item-Item Collaborative Filtering</h1>&#13;
&#13;
<p>Before<a data-primary="user-item ratings" data-secondary="user-user versus item-item collaborative filtering" data-type="indexterm" id="id368"/><a data-primary="item-item recommendations" data-type="indexterm" id="id369"/> we dive into the linear algebra, let’s consider the purely data science perspective called<a data-primary="collaborative filtering (CF)" data-secondary="basics of" data-type="indexterm" id="id370"/> <em>collaborative filtering</em> (<em>CF</em>), a term originally used by David Goldberg et al. in their 1992 paper <a href="https://oreil.ly/Nd3oe">“Using Collaborative Filtering to Weave an Information Tapestry”</a>.</p>&#13;
&#13;
<p>The underlying idea of CF is that those with similar tastes help others to know what they like without having to try it themselves. The <em>collaboration</em> terminology was originally intended to mean among similar-taste users, and <em>filtering</em> was originally intended to mean filtering out choices people will not like.</p>&#13;
&#13;
<p>You can think of this CF strategy in two ways:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Two users with similar tastes will continue to have similar tastes.</p>&#13;
</li>&#13;
<li>&#13;
<p>Two items with similar user fans will continue to be popular with other users who are similar to those fans.</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>These may sound identical, but they appear differently in the mathematical interpretations. At a high level, the difference is in deciding which kind of similarity your recommender should prioritize: user similarity or item similarity.</p>&#13;
&#13;
<p>If you prioritize<a data-primary="similarity" data-secondary="user similarity" data-type="indexterm" id="id371"/><a data-primary="user similarity" data-secondary="in collaborative filtering" data-secondary-sortas="collaborative filtering" data-type="indexterm" id="id372"/> <em>user similarity</em>, then to provide a recommendation for a user <em>A</em>, you find a similar user <em>B</em> and then choose a recommendation from <em>B</em>’s list of liked content that <em>A</em> hasn’t seen yet.</p>&#13;
&#13;
<p>If you prioritize<a data-primary="similarity" data-secondary="item similarity" data-type="indexterm" id="id373"/><a data-primary="item similarity" data-type="indexterm" id="id374"/> <em>item similarity</em>, then to provide a recommendation for a user <em>A</em>, you find an item that <em>A</em> liked, <em>chèvre</em>, and then you find an item similar to <em>chèvre</em> that <em>A</em> hasn’t seen, <em>emmentaler</em>, and recommend it for <em>A</em>.</p>&#13;
&#13;
<p>Later we will dive deeper into similarity, but let’s quickly link these ideas to our preceding discussion. <em>Similar users</em> are rows of the user-item matrix that are similar as vectors; <em>similar items</em> are columns of the user-item matrix that are similar as vectors.</p>&#13;
<div data-type="tip"><h1>Vector Similarity</h1>&#13;
<p><em>Dot product similarity</em> is more precisely defined in <a data-type="xref" href="ch10.html#ch10">Chapter 10</a>. For now, consider<a data-primary="similarity" data-secondary="computing" data-type="indexterm" id="id375"/> similarity to be computed by normalizing the vectors and then taking their cosine similarity. Given entities of any kind that you’ve associated to vectors (lists of numbers),<a data-primary="vector similarity" data-type="indexterm" id="id376"/><a data-primary="similarity" data-secondary="vector similarity" data-type="indexterm" id="id377"/> <em>vector similarity</em> compares which entities are most alike with respect to the characteristics captured by those lists of numbers (called<a data-primary="latent space" data-secondary="definition of term" data-type="indexterm" id="id378"/> the <em>latent space</em>).</p>&#13;
</div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="The Netflix Challenge" data-type="sect1"><div class="sect1" id="id15">&#13;
<h1>The Netflix Challenge</h1>&#13;
&#13;
<p>In 2006, Netflix<a data-primary="Netflix online competition" data-type="indexterm" id="id379"/><a data-primary="user-item ratings" data-secondary="Netflix online competition" data-type="indexterm" id="id380"/> kicked off an online competition called the Netflix Prize. This competition challenged teams to improve on the performance of Netflix CF algorithms on a dataset released as open source by the company. While such a competition is common today via websites like Kaggle or conference, at that time, it was very exciting and novel for those interested in RecSys.</p>&#13;
&#13;
<p>The competition consisted of several intermediate rounds awarding a Progress Prize and the final Netflix Prize awarded in 2009. The data provided was a collection of 2,817,131 triples consisting of (<code>user, movie, date_rated</code>). And half of these additionally included the rating itself. Notice that as in our preceding example, the user-item information is nearly enough to specify the problem. In this particular dataset, the date was provided. Later, we will dig into how time might be a factor, and in particular, for sequential recommendation systems.</p>&#13;
&#13;
<p>The stakes were quite high in this competition. Requirements for beating the internal performance were a 10% increase in root mean square error (RMSE); we will discuss this loss function later. And the spoils added up to over $1.1 million. The final winners were BellKor’s Pragmatic Chaos (which incidentally won the two previous Progress Prizes) with a test RMSE of 0.8567. In the end, only a 20-minute earlier submission time kept BellKor ahead of the competitors The Ensemble.</p>&#13;
&#13;
<p>To read in detail about the winning submissions, check out  <a href="https://oreil.ly/joaqu">“The BigChaos Solution to the Netflix Grand Prize”</a> by Andreas Töscher and Michael Jahrer and <a href="https://oreil.ly/D51iM">“The BigChaos Solution to the Netflix Prize 2008”</a> by the same authors. Meanwhile, let’s review a few important lessons from this competition:</p>&#13;
&#13;
<p>First, we see that the user-item matrix we’ve discussed appears in these solutions as the critical mathematical data structure. The model selection and training is important, but parameter tuning provided a huge improvement in several algorithms. We will return to parameter tuning in later chapters. The authors state that several model innovations came from reflecting on the business use case and human behavior and trying to capture those patterns in the model architectures. Next, linear-algebraic approaches resulted in the first reasonably performant solutions, and building on top of them led to the winning model. Finally, eking out the performance that Netflix originally demanded to win the competition took so long that business circumstances changed and the <a href="https://oreil.ly/fz6rz">solution was no longer useful</a>.</p>&#13;
&#13;
<p>That last point might be the <em>most</em> important thing an ML developer needs to learn about recommendation systems; see the following tip.</p>&#13;
<div data-type="tip"><h1>Start with Simplicity</h1>&#13;
<p>Build<a data-primary="recommendation systems" data-secondary="tips for building" data-type="indexterm" id="id381"/> a working usable model quickly and iterate while the model is still relevant to the needs of the business.</p>&#13;
</div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section class="less_space pagebreak-before" data-pdf-bookmark="Soft Ratings" data-type="sect1"><div class="sect1" id="id16">&#13;
<h1>Soft Ratings</h1>&#13;
&#13;
<p>In<a data-primary="user-item ratings" data-secondary="soft ratings" data-type="indexterm" id="id382"/><a data-primary="soft ratings" data-type="indexterm" id="id383"/><a data-primary="hard rankings/ratings" data-type="indexterm" id="id384"/><a data-primary="business logic" data-secondary="hard rankings" data-type="indexterm" id="id385"/><a data-primary="ratings" data-secondary="hard and soft ratings" data-type="indexterm" id="id386"/> our cheese-tasting example, each cheese either received a numerical rating or was not tried by a guest. These are <em>hard ratings</em>: regardless of whether the cheese is a brie or a chèvre, the ratings are explicit, and their absence indicates a lack of interaction between the user and item. In some contexts, we’ll want to accommodate data indicating a user does interact with an item and yet provides no rating.</p>&#13;
&#13;
<p>A common example is a movies app; a user may have watched a movie with the app but not provided a star rating. This indicates that the item (in this case, a movie) has been observed, but we don’t have the rating for our algorithms to learn from. However, we can still use this implicit data to do the following:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Exclude this item from future recommendations</p>&#13;
</li>&#13;
<li>&#13;
<p>Use this data as a separate term in our learner</p>&#13;
</li>&#13;
<li>&#13;
<p>Assign a default rating value to indicate “interesting enough to watch, not significant enough to rate”</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>It turns out that<a data-primary="implicit ratings" data-type="indexterm" id="id387"/><a data-primary="ratings" data-secondary="implicit ratings" data-type="indexterm" id="id388"/> implicit ratings are critical for training effective recommendation systems, not only because users often don’t give hard ratings, but also because implicit ratings provide a different level of signal. Later, when we wish to train multilevel models to predict both click likelihood and buy likelihood, these two levels will prove extremely important.</p>&#13;
&#13;
<p>To sum up:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>A hard rating occurs when the user directly responds to a prompt for feedback on an item.</p>&#13;
</li>&#13;
<li>&#13;
<p>A soft rating occurs when the user’s behavior implicitly communicates feedback on an item without responding to a direct prompt.</p>&#13;
</li>&#13;
</ul>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Data Collection and User Logging" data-type="sect1"><div class="sect1" id="id197">&#13;
<h1>Data Collection and User Logging</h1>&#13;
&#13;
<p>We’ve<a data-primary="user-item ratings" data-secondary="data collection and user logging" data-type="indexterm" id="UIRdata02"/><a data-primary="data collection and user logging" data-secondary="what to log" data-type="indexterm" id="DCLuser02"/> established that we learn from both explicit ratings and implicit ratings, so how and where do we get this data? To dive into this, we’ll need to start worrying about application code. In many businesses, the data scientists and ML engineers are separate from the software engineers, but working with recommendation systems requires alignment between the two functions.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section class="less_space pagebreak-before" data-pdf-bookmark="What to Log" data-type="sect2"><div class="sect2" id="id301">&#13;
<h2>What to Log</h2>&#13;
&#13;
<p>The simplest and most obvious data collection is user ratings. If users are given the option to provide ratings, or even a thumbs-up or thumbs-down, that component will need to be built and that data will need to be stored. These ratings must be stored not only for the opportunity to build recommendations, but also to prevent the bad user experience of rating something and then shortly thereafter not having the rating appear when revisiting the page.</p>&#13;
&#13;
<p>Similarly, it’s useful to understand a few other key interactions that can improve and expand your recommendation system: page loads, page views, clicks, and add-to-bag.</p>&#13;
&#13;
<p>For these types of data, let’s use a slightly more complicated example: the ecommerce website <a class="orm:hideurl" href="https://www.bookshop.org">Bookshop.org</a>. This one site has multiple applications of recommendation systems, almost all of which we will return to in time. For now, let’s focus on some interactions (<a data-type="xref" href="#fig:bookshop-landing">Figure 2-2</a>).</p>&#13;
&#13;
<figure><div class="figure" id="fig:bookshop-landing">&#13;
<img alt="Bookshop Landing Page" src="assets/brpj_0202.png"/>&#13;
<h6><span class="label">Figure 2-2. </span>Bookshop.org landing page</h6>&#13;
</div></figure>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section class="less_space pagebreak-before" data-pdf-bookmark="Page loads" data-type="sect3"><div class="sect3" id="id17">&#13;
<h3>Page loads</h3>&#13;
&#13;
<p>When<a data-primary="page loads, logging" data-type="indexterm" id="id389"/> you first load up Bookshop.org, it starts with items on the page. The Best Sellers of the Week are all clickable images to those book listings. Despite the user having no choice in loading this initial page, it’s actually quite important to log the contents of this initial page load.</p>&#13;
&#13;
<p>These options represent the population of books that the user has seen. If a user has seen an option, they have the opportunity to click it, which will ultimately be an important implicit signal.</p>&#13;
<div data-type="note" epub:type="note"><h1>Propensity Scores</h1>&#13;
<p>The consideration of the population of all items a user has seen is deeply tied to propensity score matching. In<a data-primary="propensity scores" data-type="indexterm" id="id390"/> mathematics, <em>propensity scores</em> are the probability that an observational unit will be assigned to the treatment group versus the control group.</p>&#13;
</div>&#13;
&#13;
<p>Compare this setup to the simple 50-50 A/B test: every unit has a 50% chance of being exposed to your treatment. In a feature-stratified A/B test, you purposely change the probability of exposure dependent on a certain feature or collection of features (often called<a data-primary="covariates" data-type="indexterm" id="id391"/> <em>covariates</em> in this context). Those probabilities of exposure are the propensity scores.</p>&#13;
&#13;
<p>Why bring up A/B testing here? Later, we’ll be interested in mining our soft ratings for signal on user preference, but we must consider the possibility that the lack of a soft rating is not an implicit bad rating. Thinking back to the cheeses: taster <em>D</em> never had a chance to rate <em>brie</em>, so there’s no reason to think <em>D</em> has a preference for aversion on <em>brie</em>. This is because <em>D</em> was not <em>exposed to</em> <em>brie</em>.</p>&#13;
&#13;
<p>Now thinking back to Bookshop.org: the landing page does not show <em>The Hitchhiker’s Guide to the Galaxy</em>, so the user has no way to click it and implicitly communicate interest in that book. The user could use the search option, but that’s a different kind of signal—which we’ll talk about later and is, in fact, a much stronger signal.</p>&#13;
&#13;
<p>When understanding implicit ratings like “did the user look at something,” we need to properly account for the entire population of choices they were exposed to, and use the inverse of that population size to weigh the importance of clicking. For this reason, understanding <em>all</em> page loads is important.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Page views and hover" data-type="sect3"><div class="sect3" id="id18">&#13;
<h3>Page views and hover</h3>&#13;
&#13;
<p>Websites<a data-primary="page views, logging" data-type="indexterm" id="id392"/><a data-primary="hover action, logging" data-type="indexterm" id="id393"/> have gotten much more complicated, and now users must contend with a variety of interactions. <a data-type="xref" href="#fig:bookshop-top-sellers">Figure 2-3</a> demonstrates what happens if the user clicks the right arrow in the Best Sellers of the Week carousel and then moves their mouse over the Cooking at Home option.</p>&#13;
&#13;
<figure><div class="figure" id="fig:bookshop-top-sellers">&#13;
<img alt="Bookshop Top Sellers" src="assets/brpj_0203.png"/>&#13;
<h6><span class="label">Figure 2-3. </span>Bookshop.org top sellers</h6>&#13;
</div></figure>&#13;
&#13;
<p>The user has unveiled a new option, and by mousing over it, has made it larger and given it a visual effect. These are ways to communicate more information to the user, and remind the user that these options are clickable. To the recommender, these clicks can be used as more implicit feedback.</p>&#13;
&#13;
<p>First, the user clicked the carousel scroll—so some of what they saw in the carousel was interesting enough to dig further. Second, they moused over <em>Cooking at Home</em>, which they might click or might just want to see if additional information becomes available when hovering. Many websites use a hover interaction to provide a pop-up detail. While Bookshop.org doesn’t implement something like this, internet users have been trained to expect this behavior by all the websites that do, and so the signal is still meaningful. Third, the user has now uncovered a new potential item in their carousel scroll—which we should add to our page loads but with a higher rating because it required interaction to uncover.</p>&#13;
&#13;
<p>All this and more can be encoded into the website’s logging. Rich and verbose logging is one of the most important ways to improve a recommendation system. Having more logging data than you need is almost always better than having the opposite.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Clicks" data-type="sect3"><div class="sect3" id="id19">&#13;
<h3>Clicks</h3>&#13;
&#13;
<p>If<a data-primary="clicks, logging" data-type="indexterm" id="id394"/> you thought hovering meant interest, wait until you consider clicking! Not in all cases, but in the large majority, clicking is a strong indicator of product interest. For ecommerce, clicking often is computed as part of the recommendation team’s core key performance indicators (KPIs).</p>&#13;
&#13;
<p class="less_space pagebreak-before">This is for two reasons:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Clicking is almost always required to purchase, so it’s an upstream filter for most business transactions.</p>&#13;
</li>&#13;
<li>&#13;
<p>Clicking requires explicit user action, so it’s a good measure of intent.</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>Noise will always exist of course, but clicks are the go-to indicator of a client’s interest. Many production recommendation systems are trained on click data—not ratings data—because of the much higher data volume and the strong correlation between click behavior and purchase behavior.</p>&#13;
<div data-type="note" epub:type="note"><h1>Click-Stream Data</h1>&#13;
<p>Sometimes in recommendation systems you hear people talk about<a data-primary="clickstream data" data-type="indexterm" id="id395"/> <em>click-stream</em> data. This important view into click data also considers the order of a user’s clicks in a single <em>session</em>. Modern recommendation systems put a lot of effort into utilizing the order of items a user clicks, calling this<a data-primary="sequential recommenders" data-secondary="order of items and" data-type="indexterm" id="id396"/> <em>sequential recommendations</em>, and have shown dramatic improvements via this additional dimension. We will discuss sequence-based recommendations in <a data-type="xref" href="ch07.html#serving-and-architecture">Chapter 7</a>.</p>&#13;
</div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Add-to-bag" data-type="sect3"><div class="sect3" id="id20">&#13;
<h3>Add-to-bag</h3>&#13;
&#13;
<p>We’ve<a data-primary="add-to-bag action, logging" data-type="indexterm" id="id397"/> finally arrived; the user has added an item to their bag or cart or queue. This is an extremely strong indicator of interest and is often quite correlated with purchasing. There are even reasons to argue that add-to-bag is a better signal than purchase/order/watch. Add-to-bag is essentially the end of the line for soft ratings, and usually beyond this you’d want to start collecting ratings and reviews.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Impressions" data-type="sect3"><div class="sect3" id="id21">&#13;
<h3>Impressions</h3>&#13;
&#13;
<p>We<a data-primary="impressions, logging" data-type="indexterm" id="id398"/> might also wish to log <em>impressions</em> of an item that wasn’t clicked. This supplies the recommendation system with negative feedback on items that the user isn’t interested in. For example, if the cheeses <em>gouda</em>, <em>chèvre</em> and <em>emmentaler</em> are offered to the user but the user tastes only <em>chèvre</em>, perhaps the user doesn’t like <em>gouda</em>. They might not have gotten around to tasting <em>emmentaler</em>, on the other hand, so these impressions may carry only noisy signal.<a data-primary="" data-startref="DCLuser02" data-type="indexterm" id="id399"/></p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Collection and Instrumentation" data-type="sect2"><div class="sect2" id="id22">&#13;
<h2>Collection and Instrumentation</h2>&#13;
&#13;
<p>Web applications frequently instrument<a data-primary="data collection and user logging" data-secondary="collection and instrumentation" data-type="indexterm" id="id400"/> all the interactions we’ve discussed via events. If you don’t yet know what events are, maybe ask a buddy in your engineering org—but we’ll also give you the skinny. Like<a data-primary="events, definition of term" data-type="indexterm" id="id401"/> logging, <em>events</em> are specially formatted messages that the application sends out when a certain block of code is executed.</p>&#13;
&#13;
<p>As in the example of a click, the application needs to make a call to get the next content to show the user, it’s common to also “fire an event” at this moment, indicating information about the user, what they clicked, the session-ID for later reference, the time, and various other useful details. This event can be handled downstream in any number of ways, but there’s an increasingly prevalent pattern of path bifurcation to the following:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>A log database, like a mySQL application database tied to the service</p>&#13;
</li>&#13;
<li>&#13;
<p>An event stream for real-time handling</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>The latter will be interesting: event streams are often connected to listeners via technologies like Apache Kafka. This kind of infrastructure can get complicated fast (consult your local data engineer or MLOps person), but a simple model for what happens is that all of a particular kind of log are sent to several destinations that you think can make use of these events.</p>&#13;
&#13;
<p>In the recommender case, an event stream can be connected up to a sequence of transformations to process the data for downstream learning tasks. This will be enormously useful if you want to build a recommendation system that uses those logs. Other important uses are real-time metrics logging for what is going on at any given time on the website.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Funnels" data-type="sect2"><div class="sect2" id="id23">&#13;
<h2>Funnels</h2>&#13;
&#13;
<p>We’ve<a data-primary="data collection and user logging" data-secondary="funnels" data-type="indexterm" id="id402"/><a data-primary="funnels" data-type="indexterm" id="id403"/><a data-primary="onboarding funnels" data-type="indexterm" id="id404"/> just worked through our first example of a funnel, which no good data scientist can avoid thinking about. Like them or hate them, funnel analyses are crucial for critical evaluation of your website, and by extension your recommendation system.</p>&#13;
<div data-type="note" epub:type="note"><h1>Click-Streams</h1>&#13;
<p>A <em>funnel</em> is<a data-primary="clickstream data" data-type="indexterm" id="id405"/> a collection of steps a user must take to get from one state to another; it’s called a funnel because at each of the discrete steps, a user may stop proceeding through, or<a data-primary="drop offs" data-type="indexterm" id="id406"/> <em>drop off</em>, thus reducing the population size at each step.</p>&#13;
</div>&#13;
&#13;
<p>In our discussion of events and user logging, each step is relevant for a subset of the previous. This means that the process is a funnel, as shown in <a data-type="xref" href="#fig:funnel">Figure 2-4</a>. Understanding the drop-off rate at each step reveals important characteristics of your website and your recommendations.</p>&#13;
&#13;
<figure><div class="figure" id="fig:funnel">&#13;
<img alt="An onboarding funnel" src="assets/brpj_0204.png"/>&#13;
<h6><span class="label">Figure 2-4. </span>An onboarding funnel</h6>&#13;
</div></figure>&#13;
&#13;
<p>Three important funnel analyses can be considered in <a data-type="xref" href="#fig:funnel">Figure 2-4</a>:</p>&#13;
<ol>&#13;
<li>&#13;
<p>Page view to add-to-bag user flow</p>&#13;
</li>&#13;
<li>&#13;
<p>Page view to add-to-bag per recommendation</p>&#13;
</li>&#13;
<li>&#13;
<p>Add-to-bag to complete purchase</p>&#13;
</li>&#13;
&#13;
</ol>&#13;
&#13;
<p>The first funnel is merely identifying, at a high level, the percentage of users who take each step in the flow. This is a high-level measure of your website optimization, the general interestingness of your product offering, and the quality of your user leads.</p>&#13;
&#13;
<p>The second funnel, which is more fine-grained, takes into consideration the recommendations themselves. As mentioned previously in terms of propensity scoring, users can proceed through the funnel for a particular item only if they’re shown the item. This concept intersects with the use of funnels because you want to understand at a high level how certain recommendations correlate with funnel drop-off, but also, when using a recommendation system, the confidence in your recommendations should correlate well with the funnel metrics. We will return to this in more detail in <a data-type="xref" href="part03.html#ranking">Part III</a>, but for now you should remember to think about different categories of recommendation-user pairs and how their funnels may look compared to the average.</p>&#13;
&#13;
<p>Finally, we can consider add-to-bag to completion. This actually isn’t part of the RecSys problem but should be on your mind as a data scientist or ML engineer trying to improve the product.<a data-primary="recommendation systems" data-secondary="tips for building" data-type="indexterm" id="id407"/> <em>No matter how good your recommendations are, this funnel may destroy any of your hard work.</em> Before working on a recommender problem, you should almost always investigate the funnel performance in getting a user from add-to-bag to check-out-completed. If there’s something cumbersome or difficult about this flow, it will almost certainly provide a bigger bang for your buck to fix this than to improve recommendations. Investigate the drop-offs, do user studies to understand what might be confusing, and work with product and engineering teams to ensure that everyone is aligned on this flow before you start building a recommender for ecommerce.<a data-primary="" data-startref="UIRdata02" data-type="indexterm" id="id408"/></p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Business Insight and What People Like" data-type="sect1"><div class="sect1" id="id24">&#13;
<h1>Business Insight and What People Like</h1>&#13;
&#13;
<p>In<a data-primary="user-item ratings" data-secondary="business insight and what people like" data-type="indexterm" id="id409"/> the previous example from Bookshop.org, Top Sellers of the Week is the primary carousel on the page. Recall our earlier work on <code>get_most_popular_recs</code>; what powers the carousel is simply that recommender but applied to a specific collector—one that looks only in the last week.</p>&#13;
&#13;
<p>This carousel is an example of a recommender providing<a data-primary="business insight" data-type="indexterm" id="id410"/> business insight in addition to driving recommendations. A common mission of a growth team is to understand weekly trends and KPIs, often metrics like weekly active users and new sign-ups. For many digital-first companies, growth teams are additionally interested in understanding the primary drivers of engagement.</p>&#13;
&#13;
<p>Let’s take an example: as of this writing, the Netflix show <em>Squid Game</em> became the company’s most popular series of all time, breaking a huge number of records in the process. <em>Squid Game</em> reached 111 million viewers in the first month. Most obviously, <em>Squid Game</em> needs to be featured in the Top Shows of the Week or Hottest Titles carousels, but where else should a breakout hit like this matter?</p>&#13;
&#13;
<p>The first important insight companies almost always ask for is<a data-primary="attribution" data-type="indexterm" id="id411"/> <em>attribution</em>: if the numbers go up in a week, what led to that? Is there something important or special about launches that drove additional growth? How can we learn from those signals to do better in the future? In the case of <em>Squid Game</em>—a foreign-language show that saw massive interest from an English-speaking audience—executives might take away the inclination to invest more in shows from South Korea or in subtitled shows with high drama. The flip side of this coin is also important: when growth metrics lag, executives nearly always ask why. Being able to point to what was the most popular, and how it may have deviated from expectation, helps a lot.</p>&#13;
&#13;
<p>The other important insight can feed back into recommendations; during exciting debuts like <em>Squid Game</em>, it’s easy to get caught up in the excitement as you see all your metrics go up and to the right, but might this negatively affect metrics also? If you have a show debuting the same week or two as <em>Squid Game</em>, you’ll be less enthusiastic about all this success. Overall, successes like this usually drive <em>incremental</em> growth, which is great for business, and in total, metrics will all probably look up. Other items, however, may have less successful launches due to a zero-sum game among the core user base. This can have a negative effect on longer-term metrics and can even make later recommendations less effective.</p>&#13;
&#13;
<p>Later, you will learn about diversity of recommendations; there are many reasons to care about diversifying your recommendations, but here we observe one: diversifying can increase the overall ability to match your users with items. As you keep a broad base of users highly engaged, you increase your future opportunity for growth.</p>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="id412">&#13;
<h1>Incremental Gains</h1>&#13;
<p><em>Incremental gains</em> is<a data-primary="incremental gains" data-type="indexterm" id="id413"/> an economics term now used in growth marketing and growth analytics. Incremental gains refer to a margin of increase in addition to the gains expected from an expended effort.</p>&#13;
&#13;
<p>A simple example is a business that usually adds a user for every $100 in marketing spending, gets some positive press, and the next week gets a user for every $80 in marketing spending. By keeping the marketing budget fixed that week at $1,600, the business would get 20 new users instead of 16—an incremental gain of 4 users. This framework is especially common when testing new treatments or programs.</p>&#13;
</div></aside>&#13;
&#13;
<p>Finally, beyond surfacing the trending hits, another benefit of knowing what’s really hot on your platform or service is advertising. When a phenomenon starts, a huge advantage can result from priming the pump—making noise and driving publicity of the success. This sometimes leads to a network effect, and in these days of viral content and easy distribution, this can have multiplicative impacts on your platform’s growth.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Summary" data-type="sect1"><div class="sect1" id="id302">&#13;
<h1>Summary</h1>&#13;
&#13;
<p>This constitutes the most basic aspects of formulating your recommendation problems and preparing yourself to solve them.</p>&#13;
&#13;
<p>The user-item matrix gave us a tool to summarize the relationship between users and items in the simplest case of numerical ratings and will generalize to more complicated models later. We saw our first notion of vector similarity, which will be expanded to a deep geometric notion of relevance. Next, we learned about the kinds of signals that users can provide via explicit and implicit actions. Finally, we learned how to capture these actions for training models.</p>&#13;
&#13;
<p>Now that we’ve finished our problem framing, we’ve got a bit of a math review for you. Don’t worry, you can keep your ruler and compass packed away, and you won’t be required to prove anything or compute any integrals. You will, however, see some important mathematical notions that will help you think clearly about expectations for your recommendation systems and ensure you’re asking the right questions.</p>&#13;
</div></section>&#13;
</div></section></body></html>