<html><head></head><body><section data-pdf-bookmark="Chapter 5. Cleaning Data" data-type="chapter" epub:type="chapter"><div class="chapter" id="idm46066902040184">&#13;
<h1><span class="label">Chapter 5. </span>Cleaning Data</h1>&#13;
&#13;
&#13;
<p><a data-primary="cleaning data" data-type="indexterm" id="ix_ch05-asciidoc0"/><a data-primary="data" data-secondary="cleaning" data-seealso="cleaning data" data-type="indexterm" id="ix_ch05-asciidoc1"/>We can use generic tools like pandas and specialized tools like&#13;
pyjanitor to help with cleaning data.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Column Names" data-type="sect1"><div class="sect1" id="idm46066902083112">&#13;
<h1>Column Names</h1>&#13;
&#13;
<p><a data-primary="cleaning data" data-secondary="Python-friendly column names" data-type="indexterm" id="idm46066902081704"/><a data-primary="columns" data-secondary="Python-friendly names" data-type="indexterm" id="idm46066902080760"/><a data-primary="pandas" data-secondary="column names" data-type="indexterm" id="idm46066902079816"/>When using pandas, having Python-friendly column names makes attribute&#13;
access possible. <a data-primary="pyjanitor" data-secondary="cleaning data" data-type="indexterm" id="ix_ch05-asciidoc2"/>The pyjanitor <code>clean_names</code> function will return a DataFrame with&#13;
columns in lowercase and spaces replaced by underscores:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="kn">import</code> <code class="nn">janitor</code> <code class="kn">as</code> <code class="nn">jn</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">Xbad</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">(</code>&#13;
<code class="gp">... </code>    <code class="p">{</code>&#13;
<code class="gp">... </code>        <code class="s">"A"</code><code class="p">:</code> <code class="p">[</code><code class="mi">1</code><code class="p">,</code> <code class="bp">None</code><code class="p">,</code> <code class="mi">3</code><code class="p">],</code>&#13;
<code class="gp">... </code>        <code class="s">"  sales numbers "</code><code class="p">:</code> <code class="p">[</code><code class="mf">20.0</code><code class="p">,</code> <code class="mf">30.0</code><code class="p">,</code> <code class="bp">None</code><code class="p">],</code>&#13;
<code class="gp">... </code>    <code class="p">}</code>&#13;
<code class="gp">... </code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">jn</code><code class="o">.</code><code class="n">clean_names</code><code class="p">(</code><code class="n">Xbad</code><code class="p">)</code>&#13;
<code class="go">     a  _sales_numbers_</code>&#13;
<code class="go">0  1.0             20.0</code>&#13;
<code class="go">1  NaN             30.0</code>&#13;
<code class="go">2  3.0              NaN</code></pre>&#13;
<div data-type="tip"><h6>Tip</h6>&#13;
<p><a data-primary="columns" data-secondary="updating" data-type="indexterm" id="idm46066901992216"/><a data-primary="index assignment" data-type="indexterm" id="idm46066901991336"/><a data-primary="pandas" data-secondary="updating columns" data-type="indexterm" id="idm46066901990664"/>I recommend updating columns using index assignment, the <code>.assign</code> method, <code>.loc</code> or <code>.iloc</code> assignment. I also recommend not using attribute assignment to update columns in pandas. Due to the risk of overwriting existing methods with the same name as a column, attribute assignment is not guaranteed to work.</p>&#13;
</div>&#13;
&#13;
<p>The pyjanitor library is handy, but doesnâ€™t allow us to strip whitespace around columns. We can use pandas to have more fine-grained control of the column renaming:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="k">def</code> <code class="nf">clean_col</code><code class="p">(</code><code class="n">name</code><code class="p">):</code>&#13;
<code class="gp">... </code>    <code class="k">return</code> <code class="p">(</code>&#13;
<code class="gp">... </code>        <code class="n">name</code><code class="o">.</code><code class="n">strip</code><code class="p">()</code><code class="o">.</code><code class="n">lower</code><code class="p">()</code><code class="o">.</code><code class="n">replace</code><code class="p">(</code><code class="s">" "</code><code class="p">,</code> <code class="s">"_"</code><code class="p">)</code>&#13;
<code class="gp">... </code>    <code class="p">)</code>&#13;
&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">Xbad</code><code class="o">.</code><code class="n">rename</code><code class="p">(</code><code class="n">columns</code><code class="o">=</code><code class="n">clean_col</code><code class="p">)</code>&#13;
<code class="go">     a  sales_numbers</code>&#13;
<code class="go">0  1.0           20.0</code>&#13;
<code class="go">1  NaN           30.0</code>&#13;
<code class="go">2  3.0            NaN</code></pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Replacing Missing Values" data-type="sect1"><div class="sect1" id="idm46066901986760">&#13;
<h1>Replacing Missing Values</h1>&#13;
&#13;
<p><a data-primary="cleaning data" data-secondary="replacing missing values" data-type="indexterm" id="idm46066901909672"/><a data-primary="missing data" data-secondary="replacing" data-type="indexterm" id="idm46066901908792"/>The <code>coalesce</code> function in pyjanitor takes a DataFrame and a list of&#13;
columns to consider. This is similar to functionality found in Excel and SQL databases. It returns the first nonnull value for each row:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">jn</code><code class="o">.</code><code class="n">coalesce</code><code class="p">(</code>&#13;
<code class="gp">... </code>    <code class="n">Xbad</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="n">columns</code><code class="o">=</code><code class="p">[</code><code class="s">"A"</code><code class="p">,</code> <code class="s">"  sales numbers "</code><code class="p">],</code>&#13;
<code class="gp">... </code>    <code class="n">new_column_name</code><code class="o">=</code><code class="s">"val"</code><code class="p">,</code>&#13;
<code class="gp">... </code><code class="p">)</code>&#13;
<code class="go">    val</code>&#13;
<code class="go">0   1.0</code>&#13;
<code class="go">1  30.0</code>&#13;
<code class="go">2   3.0</code></pre>&#13;
&#13;
<p>If we want to fill missing values with a particular value, we can use&#13;
the DataFrame <code>.fillna</code> method:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">Xbad</code><code class="o">.</code><code class="n">fillna</code><code class="p">(</code><code class="mi">10</code><code class="p">)</code>&#13;
<code class="go">      A    sales numbers</code>&#13;
<code class="go">0   1.0              20.0</code>&#13;
<code class="go">1  10.0              30.0</code>&#13;
<code class="go">2   3.0              10.0</code></pre>&#13;
&#13;
<p>or the pyjanitor <code>fill_empty</code> function:<a data-startref="ix_ch05-asciidoc2" data-type="indexterm" id="idm46066901893288"/></p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">jn</code><code class="o">.</code><code class="n">fill_empty</code><code class="p">(</code>&#13;
<code class="gp">... </code>    <code class="n">Xbad</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="n">columns</code><code class="o">=</code><code class="p">[</code><code class="s">"A"</code><code class="p">,</code> <code class="s">"  sales numbers "</code><code class="p">],</code>&#13;
<code class="gp">... </code>    <code class="n">value</code><code class="o">=</code><code class="mi">10</code><code class="p">,</code>&#13;
<code class="gp">... </code><code class="p">)</code>&#13;
<code class="go">      A    sales numbers</code>&#13;
<code class="go">0   1.0              20.0</code>&#13;
<code class="go">1  10.0              30.0</code>&#13;
<code class="go">2   3.0              10.0</code></pre>&#13;
&#13;
<p>Often, we will use finer-grained imputations in pandas, scikit-learn, or fancyimpute to perform per-column null replacement.</p>&#13;
&#13;
<p>As a sanity check before creating models, you can use pandas to ensure that you have dealt with all missing values. The following code returns a single boolean if there is any cell that is missing in a DataFrame:<a data-startref="ix_ch05-asciidoc1" data-type="indexterm" id="idm46066901768744"/><a data-startref="ix_ch05-asciidoc0" data-type="indexterm" id="idm46066901768136"/></p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">df</code><code class="o">.</code><code class="n">isna</code><code class="p">()</code><code class="o">.</code><code class="n">any</code><code class="p">()</code><code class="o">.</code><code class="n">any</code><code class="p">()</code>&#13;
<code class="go">True</code></pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section></body></html>