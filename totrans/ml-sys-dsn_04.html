<html><head></head><body><div id="book-content"><div id="sbo-rt-content"><div class="readable-text" id="p1"> 
   <h1 class="readable-text-h1"><span class="chapter-title-numbering"><span class="num-string">4</span> </span> <span class="chapter-title-text">Design document</span></h1> 
  </div> 
  <div class="introduction-summary"> 
   <h3 class="introduction-header sigil_not_in_toc">This chapter covers</h3> 
   <ul> 
    <li class="readable-text" id="p2">The most common myths around the design document</li> 
    <li class="readable-text" id="p3">Defining antigoals for an even sharper focus on core objectives</li> 
    <li class="readable-text" id="p4">Drafting a design document based on the information available</li> 
    <li class="readable-text" id="p5">Reviewing a design document</li> 
    <li class="readable-text" id="p6">The evolution of a design document</li> 
   </ul> 
  </div> 
  <div class="readable-text" id="p7"> 
   <p>Once you have defined the problem your system should solve, as well as a list of stakeholders, and have a rough understanding of what technologies and solutions would be most appropriate for the product, as described in chapter 3, it is time to prepare a design document.</p> 
  </div> 
  <div class="readable-text intended-text" id="p8"> 
   <p>It is worth noting here that there is no set-in-stone order of actions at the early stage of creating a machine learning (ML) system. You can start preparing a design document as soon as you’ve identified the problem and goals (especially if you work in a startup, where the speed of delivery is often more important than following processes). But since this book is presented as a checklist, the list of actions is also displayed in a traditional sequence.</p> 
  </div> 
  <div class="readable-text intended-text" id="p9"> 
   <p>As one of the authors’ managers once said, no fancy recommendation algorithm can beat a customer with a shopping list. These people have a goal and a plan for achieving it. Nothing can stop them.</p> 
  </div> 
  <div class="readable-text intended-text" id="p10"> 
   <p>If you think about it, writing code is just providing a specific set of instructions to achieve a particular goal. In a sense, a design document is a meta-algorithm set to accomplish a specific goal, with the involvement of many subalgorithms. Still, the design document is being regularly challenged by many as either one of the horsemen of bureaucratization or a rudiment used out of inertia.</p> 
  </div> 
  <div class="readable-text intended-text" id="p11"> 
   <p>In this chapter, we will examine the most common myths around the design document. We will introduce and define the concept of antigoals as additional guidelines that lead you toward the project’s objectives, and we will start the practical part of this book, represented by two design documents based on close-to-real-life scenarios.</p> 
  </div> 
  <div class="readable-text" id="p12"> 
   <h2 class="readable-text-h2" id="sigil_toc_id_25"><span class="num-string">4.1</span> Common myths surrounding the design document</h2> 
  </div> 
  <div class="readable-text" id="p13"> 
   <p>Over the years, the design document has seen a number of false assumptions and misinterpretations that may prevent you from putting together a well-organized paper appropriate for your project. Next we’ll examine the most common misconceptions and explain why you shouldn’t dwell on them.</p> 
  </div> 
  <div class="readable-text" id="p14"> 
   <h3 class="readable-text-h3" id="sigil_toc_id_26"><span class="num-string">4.1.1</span> Myth #1. Design documents work only for big companies but not startups</h3> 
  </div> 
  <div class="readable-text" id="p15"> 
   <p>You could argue that dedicating part of your workload to preparing design documents would make only sense for big companies. There is a fair premise in this counterpoint: mature organizations need to invest more time and resources into writing design documents compared to a startup with a dozen employees. It doesn’t mean, though, that small companies should prepare no design documents at all: as a well-known quote says, “Plan is nothing; planning is everything.” The beauty of writing a design document lies in revealing blind spots in your vision, on both the product side and the technical side, which will save you a lot in the midterm, especially if you cut off irrelevant data. For the latter, we recommend applying the method we call “antigoals,” which we will dedicate a separate section to later.</p> 
  </div> 
  <div class="readable-text intended-text" id="p16"> 
   <p>When the book was in early access, there was a common comment shared by our early readers: “Well, this is good, but that is not how it works in startups.” While agreeing that startups’ delivery cadence is different, we still stick to the idea that the design phase is necessary. It is true that cofounders and early engineers can find their consensus during a coffee break, whereas a massive corporation would waste 6 months on the same scope. We also agree that writing formal docs may be inefficient, but that is not what we advocate for. A simple note with a short description can be enough as soon as you are sure it gets all collaborators on the same page. Ignoring good practices of software and ML engineering is fine while you’re hunting for a prize at a hackathon, but the hackathon style barely works at longer distances.</p> 
  </div> 
  <div class="readable-text" id="p17"> 
   <h3 class="readable-text-h3" id="sigil_toc_id_27"><span class="num-string">4.1.2</span> Myth #2. Design documents are efficient only for complex projects</h3> 
  </div> 
  <div class="readable-text" id="p18"> 
   <p>There’s a grain of truth to this statement if you look at a design document in its classic sense: a large, labor-intensive effort involving every detail of the final product, from general scope to risk validation upon deployment. After all, the compilation of such a document alone can take more time than the lifetime of the project itself! </p> 
  </div> 
  <div class="readable-text intended-text" id="p19"> 
   <p>Typically, such an argument can come either from a person with a lack of flexibility or from an ardent opponent of the design document who is eager to use any argument in their favor.</p> 
  </div> 
  <div class="readable-text intended-text" id="p20"> 
   <p>Practice shows that even for smaller projects, a well-structured design document ensures early identification of potential risks, serves as a reference for future enhancements if the project eventually expands, and, most importantly, helps prevent scope creep when every other stakeholder is tempted to add just one more feature.</p> 
  </div> 
  <div class="readable-text intended-text" id="p21"> 
   <p>Even simple initiatives can benefit from a design document with a proportional level of detail.</p> 
  </div> 
  <div class="readable-text" id="p22"> 
   <h3 class="readable-text-h3" id="sigil_toc_id_28"><span class="num-string">4.1.3</span> Myth #3. Every design document should be based on a template</h3> 
  </div> 
  <div class="readable-text" id="p23"> 
   <p>Many companies, especially well-established enterprises, maintain their recommended templates with a strict, rigid structure, and it can be useful, considering the scale of their businesses. However, we recommend avoiding setting design docs templates in stone. Based on our experience, the template should never be a sacred dogma. Such templates may try to serve too many goals all at once, thus getting bloated and discouraging people from preparing and studying those documents. That is why we recommend keeping the core template minimalistic and extending parts here and there depending on system-specific requirements and context.</p> 
  </div> 
  <div class="readable-text intended-text" id="p24"> 
   <p>At first glance, the process of creating a design document may seem straightforward and simple. In reality, right from the start, you will encounter a whole load of factors that will interfere with the process and set you several steps back if ignored.</p> 
  </div> 
  <div class="readable-text intended-text" id="p25"> 
   <p>Remember: your task is not to create a draft document and convince everyone of its purity and correctness. Your task is to find as many weak points as possible (including motivating your stakeholders to find them) so that eventually, after a number of iterations, you have a document that allows you to start developing your ML system.</p> 
  </div> 
  <div class="readable-text" id="p26"> 
   <h3 class="readable-text-h3" id="sigil_toc_id_29"><span class="num-string">4.1.4</span> Myth #4. Every design document should lead to a deployed system</h3> 
  </div> 
  <div class="readable-text" id="p27"> 
   <p>If you are an engineer and need to build a machine, you need to start with a blueprint. Other engineers will review it and provide feedback, which will probably lead to another iteration of blueprints—and another and another until your design is finally ready to be brought to life. </p> 
  </div> 
  <div class="readable-text intended-text" id="p28"> 
   <p>The same principle applies to designing ML systems. An ML system is a highly complex machine of interconnected domains that requires thorough preparation when your design document undergoes multiple iterations before implementation. Still, more often than not, a good design document leads to no ML project at all. </p> 
  </div> 
  <div class="readable-text" id="p29"> 
   <p>This might sound absurd, but let’s imagine you’re set to choose between two options:</p> 
  </div> 
  <ul> 
   <li class="readable-text" id="p30"> Spending 6 months working relentlessly on models, features, loss functions, and datasets, only to put your project on the shelf (where most ML projects end up finding themselves) </li> 
   <li class="readable-text buletless-item" id="p31"> Spending 2 to 4 weeks trying to describe 
    <ul> 
     <li> Why are we doing this project? </li> 
     <li> How do we do it? </li> 
     <li> Do we have everything we need? </li> 
     <li> Can we have a less efficient solution with less effort? </li> 
     <li> Is the desired result achievable? </li> 
    </ul></li> 
  </ul> 
  <div class="readable-text" id="p32"> 
   <p>Realizing that 90% of results can be derived from two IF statements can be frustrating, but it is still much better than the first of the two options.</p> 
  </div> 
  <div class="readable-text" id="p33"> 
   <h2 class="readable-text-h2" id="sigil_toc_id_30"><span class="num-string">4.2</span> Goals and antigoals</h2> 
  </div> 
  <div class="readable-text" id="p34"> 
   <p>One of the goals of a design document is to reduce uncertainty about a problem by setting cornerstones and boundaries. Before the document is drafted, the level of understanding of both the problem and the solution is low and inconsistent among all involved parties. A technique that can help address such a problem is using antigoals—inverse statements that can help us narrow down both the problem space and the solution space. </p> 
  </div> 
  <div class="readable-text intended-text" id="p35"> 
   <p>Each part of a design document can be viewed as an answer to multiple questions: what are the goals of a potential system, what are the key success criteria, what tech aspects should we focus on, how do we solve a given subproblem, etc. A rookie mistake would be to miss tradeoffs and enumerate endless goals for the system: for example, it should do X, Y, and Z; have high performance; be precise; be easy to maintain and cheap to develop; and be intuitively understandable. Obviously, it’s impossible to successfully fit all the good properties into one system, and you will require an approach to counterbalance this possible excessiveness. </p> 
  </div> 
  <div class="readable-text intended-text" id="p36"> 
   <p>Setting antigoals allows us to strike out the aspects we don’t really care about that much and additionally highlight those we see as crucial. Let’s say we’re building a system that will be used internally, and the output artifacts are various reports to be read by the executive team and analysts. We can assume right off the bat that processing time won’t be critical for such a system—it’s only necessary to make it work fast enough that reports are ready by morning. Thus, “processing time” will be the first to join the list of antigoals so that we don’t bother ourselves with this parameter. Or imagine building a recommendation engine for a boutique store: you sure won’t need to support millions of items if the current number of goods contains only three digits (see figure 4.1), meaning excessive productivity is a no-go for the end solution.<span class="aframe-location"/></p> 
  </div> 
  <div class="browsable-container figure-container" id="p37">  
   <img alt="figure" src="../Images/CH04_F01_Babushkin.png" width="691" height="388"/> 
   <h5 class="figure-container-h5 sigil_not_in_toc"><span class="num-string">Figure 4.1</span> A shop with &lt;1,000 goods for sale and low traffic should not aim for scalability when building a recommendation system, as almost any tech solution can handle its load these days.</h5>
  </div> 
  <div class="readable-text" id="p38"> 
   <p>Antigoals like this help us focus only on important aspects and drop the ones that have no positive effect on reaching the main goal of the system. </p> 
  </div> 
  <div class="readable-text intended-text" id="p39"> 
   <p>The following example suggests what the lists of goals and antigoals would look like for a boutique store’s recommendation engine:</p> 
  </div> 
  <ul> 
   <li class="readable-text buletless-item" id="p40"> Goals: 
    <ul> 
     <li> Increased conversion from View to Add to Basket steps </li> 
     <li> Diverse recommendations for users </li> 
     <li> Low latency for users </li> 
    </ul></li> 
   <li class="readable-text buletless-item" id="p41"> Antigoals: 
    <ul> 
     <li> Scalability in terms of the number of goods processed </li> 
     <li> Scalability in terms of concurrent users </li> 
     <li> Support for new goods categories </li> 
    </ul></li> 
  </ul> 
  <div class="readable-text" id="p42"> 
   <p>A similar logic is applicable to other blocks of a design document. If you formed an idea on implementation and later realized it had an intrinsic critical flaw, it would make sense to mention this issue in the document as a counterexample. Imagine you are designing a scalable system and considered using cloud infrastructure intensively until you learned that the biggest potential customer has strict limitations on using its own hardware for privacy reasons. In this case, a single sentence like “Cloud solution X could be a good option for data storage, but not applicable in this case because of Y’s cloud privacy restrictions” can set important limitations and may spark ideas on alternative tech implementations: “If X is fine from the technical perspective, are there open source X alternatives that can be installed on our own servers?” </p> 
  </div> 
  <div class="readable-text intended-text" id="p43"> 
   <p>Antigoals should not be considered the main source of information in your design document but can become a spice that adds a missing flavor, growing into an essential part of the document’s structure.</p> 
  </div> 
  <div class="callout-container sidebar-container"> 
   <div class="readable-text" id="p44"> 
    <h5 class="callout-container-h5 readable-text-h5 sigil_not_in_toc">Questionable goals and their effect on the end result</h5> 
   </div> 
   <div class="readable-text" id="p45"> 
    <p>We have two stories to highlight how unclear goal setting can affect the development of an ML system.</p> 
   </div> 
   <div class="readable-text" id="p46"> 
    <p>In 2016, Valerii worked in the collection department of a large bank. By that time, the bank’s management had decided to introduce ML into its daily routine and lean on algorithmic support instead of operating with a set of rigid rules and gut feelings. One of Valerii’s first tasks was to create a model picking the next user the bank must reach to maximize output—a user who can be activated by an incentive (a promise to pay, fee waiver, discount). The existing process involved a lot of manual work, yielding a conversion ratio of around 50%. The new process involving a pretty basic nonlinear model on a set of around 100 engineered features that provided astonishingly better results of 80% conversion was tested within the next 2 months, while the old process was still providing 50%. </p> 
   </div> 
   <div class="readable-text" id="p47"> 
    <p>The team was happy and excited to present the results to their senior vice president. The second after we finished the presentation, she said, “What’s so special about these clients? I want to know their motivation.” Addressing such a question in 2016 with a nonlinear model on 100 features was not an easy task, not to mention that <em>what people do</em> and <em>why they do it</em> are two completely different things. For example, from the very beginning, the goal of a senior vice president is to understand <em>why</em>, and the goal of the business is to understand <em>who.</em> As such, the team must design the system and model completely differently, aiming to answer both questions, even if it would be less efficient than answering just one. Thus, a bad (or improper) goal at the very beginning set the team 3 months back.</p> 
   </div> 
   <div class="readable-text" id="p48"> 
    <p>The second example covers the pricing algorithm we discussed in chapter 2. At the very beginning, our goal was to maximize gross merchandise volume based on turnover while keeping the margin at a given level. </p> 
   </div> 
   <div class="readable-text" id="p49"> 
    <p>At some point, the model found an ingenious way to achieve the goal. There was a boombox speaker in the product catalog, which the model started selling at a price lower than the purchase price. As a result, more speakers were sold in 24 hours than in the previous 90 days. To be fair, this was still within the margin limit because we didn’t mind the margin being negative as part of the task. </p> 
   </div> 
   <div class="readable-text" id="p50"> 
    <p>However, you can imagine it was completely different from what we really wanted (the proper goal would be to increase the revenue while maintaining margin, affecting X% categories with Y% of SKUs in them with cannibalization no higher than Z). Sure, the revenue went up, and margins stayed within given limits, but in the end, everyone just ran to buy exactly that one model. No other speakers were bought. </p> 
   </div> 
   <div class="readable-text" id="p51"> 
    <p>Luckily, that was a test launch with a small number of items under dynamic pricing, showing that the initial goal was badly designed and we needed to develop a more thorough approach to goal setting. Fortunately, the overall design was decoupled and easy to adjust.</p> 
   </div> 
  </div> 
  <div class="readable-text" id="p52"> 
   <h2 class="readable-text-h2" id="sigil_toc_id_31"><span class="num-string">4.3</span> Design document structure</h2> 
  </div> 
  <div class="readable-text" id="p53"> 
   <p>In this section, we could have focused on theoretical information about the contents and structure of the classic design document, but the truth is, a design document you prepare for an ML system will hardly rely on practices applied in traditional software development. On top of that, its structure may vary from company to company, so we do not think it makes sense to dwell on layout nuances. Instead, we recommend focusing more on what items need to be covered. Plus, our goal is to showcase the design document as an entity within ML system design. For that reason, starting with this section and for the rest of the book, at the end of each chapter there will be a large practical block representing a part of a design document that incorporates the main message from the given chapter. We see it as a crucial component of this book, which will go side by side with theory and campfire stories while offering an example of applying real-life solutions to problems.</p> 
  </div> 
  <div class="readable-text intended-text" id="p54"> 
   <p>In what follows, we will introduce you to two fictional cases, each with its own specifics, features, problems, and context. These two cases will form the basis of two different design documents, which will gradually grow and evolve from chapter to chapter, adding more depth and complexity. Eventually we will have two fully formed documents at our disposal.</p> 
  </div> 
  <div class="readable-text intended-text" id="p55"> 
   <p>In this section, we start to outline a design document for a project as it might have been written in real life. For this purpose, we introduce a fictional company, Supermegaretail, a retail company with a demand forecast project to launch.</p> 
  </div> 
  <div class="readable-text intended-text" id="p56"> 
   <p>In section 4.4, we give a very brief example of what the first chapter of a design document can look like. We will include only major topics; otherwise, it would not fit into a single book.</p> 
  </div> 
  <div class="readable-text print-book-callout" id="p57"> 
   <p><span class="print-book-callout-head">NOTE</span>  Any text in the body of the design doc written in <em>italics</em> contains our supporting comments and is not part of the document itself.</p> 
  </div> 
  <div class="callout-container sidebar-container"> 
   <div class="readable-text" id="p58"> 
    <h4 class="readable-text-h4 sigil_not_in_toc">Design document: Supermegaretail</h4> 
   </div> 
   <div class="readable-text" id="p59"> 
    <h4 class="readable-text-h4 sigil_not_in_toc">Problem definition</h4> 
   </div> 
   <div class="readable-text" id="p60"> 
    <h4 class="readable-text-h4 sigil_not_in_toc">i. Origin</h4> 
   </div> 
   <div class="readable-text" id="p61"> 
    <p>Supermegaretail is a retail chain operating through a network of thousands of stores across different countries in various regions. The chain’s customers buy various goods, primarily groceries, household essentials, personal care, sports supplements, and many more.</p> 
   </div> 
   <div class="readable-text intended-text" id="p62"> 
    <p>To sell these goods, Supermegaretail must purchase or produce them before delivering them to a store’s location. The number of purchased goods is the key figure that needs to be defined, and there are different possible scenarios here.</p> 
   </div> 
   <div class="readable-text intended-text" id="p63"> 
    <p>For easier calculations, we assume that Supermegaretail bought 1,000 units of item A for the specific store:</p> 
   </div> 
   <ol> 
    <li class="readable-text" id="p64"> Supermegaretail bought 1,000 units and sold 999 before the next delivery. This is an optimal situation. With only 0.1% left over, the retailer is close to the optimal revenue and margin. </li> 
    <li class="readable-text" id="p65"> Supermegaretail bought 1,000 units and sold 100 before the next delivery. This is usually an awful situation for an apparent reason. Supermegaretail wants to sell almost as many units as it purchased without going out of stock. The more significant the gap, the larger Supermegaretail’s losses. </li> 
    <li class="readable-text" id="p66"> Supermegaretail bought 1,000 units and sold 1,000. This should be considered a terrible situation because we don’t know how many units people would buy had they had the opportunity. It could be 1,001, 2,000, or 10,000. An out-of-stock situation like that obscures our understanding of the world. Even worse—it drives customers from Supermegaretail to its competitors, where they can buy the goods with no shortages. </li> 
   </ol> 
   <div class="readable-text" id="p67"> 
    <p>An additional constraint is that we have a lot of perishable foods that can’t stay on store shelves for long: they’re either sold or wasted. </p> 
   </div> 
   <div class="readable-text intended-text" id="p68"> 
    <p>The project goal is to reduce the gap between delivered and sold items, making it as narrow as possible, while avoiding an out-of-stock situation with a specific service-level agreement to be specified further. To do that, we plan to forecast the demand for a specific item in a specific store during a particular period with the help of an ML system.</p> 
   </div> 
   <div class="readable-text" id="p69"> 
    <h4 class="readable-text-h4 sigil_not_in_toc">ii. Relevance and reasons</h4> 
   </div> 
   <div class="readable-text" id="p70"> 
    <p><em>This section highlights the problem’s relevance, backed by exploratory data analysis.</em></p> 
   </div> 
   <div class="readable-text" id="p71"> 
    <h5 class="callout-container-h5 readable-text-h5 sigil_not_in_toc">A. Existing flow analysis</h5> 
   </div> 
   <div class="readable-text" id="p72"> 
    <p>What is the current way of ordering, delivering, and selling goods in Supermegaretail? </p> 
   </div> 
   <div class="readable-text intended-text" id="p73"> 
    <p>For Supermegaretail, the possible list might be as follows:</p> 
   </div> 
   <ol> 
    <li class="readable-text buletless-item" id="p74"> Planning horizon for making a deal with goods manufacturers: 
     <ul> 
      <li> It’s a 1-year deal with the opportunity to adjust 90 days ahead within the first 9 months. </li> 
     </ul></li> 
    <li class="readable-text buletless-item" id="p75"> Additional discount with an increased volume: 
     <ul> 
      <li> It’s an extra 2% off for every additional $20 million. </li> 
     </ul></li> 
    <li class="readable-text buletless-item" id="p76"> The number of distribution centers serving as logistics hubs between manufacturers and stores: 
     <ul> 
      <li> There are 47 distribution centers around the country, making them a point of presence and aggregated entity for the forecast. </li> 
     </ul></li> 
    <li class="readable-text buletless-item" id="p77"> Delivery cadence between distribution centers and stores: 
     <ul> 
      <li> Usually, every 2 days, there is a truck connecting the distribution center and the store. </li> 
     </ul></li> 
    <li class="readable-text buletless-item" id="p78"> Presence or absence of in-store warehouses: 
     <ul> 
      <li> There are no warehouses in most of the stores. However, the loading bay zone can be (and is) effectively used to store offloaded items for 2 to 3 days. </li> 
     </ul></li> 
    <li class="readable-text buletless-item" id="p79"> Who and at what stage decides what and where to deliver? 
     <ul> 
      <li> There’s a delivery plan coming down from the distribution center. A store’s manager can override and adjust it. </li> 
     </ul></li> 
    <li class="readable-text buletless-item" id="p80"> Forecast horizon: 
     <ul> 
      <li> The primary forecast horizon is week-long and month-long. However, a 1-year horizon is needed when dealing with goods manufacturers. </li> 
     </ul></li> 
    <li class="readable-text buletless-item" id="p81"> Business owner of the process: 
     <ul> 
      <li> Logistics department </li> 
      <li> Procurement department </li> 
      <li> Operational department (store managers) </li> 
     </ul></li> 
   </ol> 
   <div class="readable-text" id="p82"> 
    <h5 class="callout-container-h5 readable-text-h5 sigil_not_in_toc">B. How much does Supermegaretail lose on the gap between forecasted and factual demand?</h5> 
   </div> 
   <div class="readable-text" id="p83"> 
    <p>Although it is relatively easy to calculate the loss due to overstock and expired items, it is much harder to calculate the loss due to out-of-stock situations. The latter can be estimated through either a series of A/B tests or an expert opinion, which is usually much quicker and cheaper than running those tests.</p> 
   </div> 
   <div class="readable-text intended-text" id="p84"> 
    <p>The overall loss can be approximated by summing up the two, providing an estimate of the gain with an ideal and nonachievable solution.</p> 
   </div> 
   <div class="readable-text intended-text" id="p85"> 
    <p>The initial calculation showed the loss to be around $800 million during the last year.</p> 
   </div> 
   <div class="readable-text intended-text" id="p86"> 
    <p><em>Starting from the following section of the design document (but only for this chapter), we’ve sketched questions to avoid this being too voluminous. Answering these questions will help you decide on further actions, and the answers are revealed in the later chapters as we go through the different stages of the system.</em></p> 
   </div> 
   <div class="readable-text" id="p87"> 
    <h5 class="callout-container-h5 readable-text-h5 sigil_not_in_toc">C. Other reasons</h5> 
   </div> 
   <ul> 
    <li class="readable-text" id="p88"> Can other teams use our solution, making development more appealing and reasonable? </li> 
    <li class="readable-text" id="p89"> Perhaps we can sell demand forecast solutions to other retail companies (obviously not to direct competitors). </li> 
   </ul> 
   <div class="readable-text" id="p90"> 
    <h4 class="readable-text-h4 sigil_not_in_toc">iii. Previous work</h4> 
   </div> 
   <div class="readable-text" id="p91"> 
    <p><em>This section covers whether this is an entirely new problem or something has been done before. Usually, it is a list of questions you ask to avoid doing double work or repeating previous mistakes.</em></p> 
   </div> 
   <ul> 
    <li class="readable-text buletless-item" id="p92"> What if Supermegaretail was aware of this issue and had already implemented some demand forecast approach? It has various stores in different locations; its demand forecast is probably already pretty efficient. How does the company do it? 
     <ul> 
      <li> Rolling window? </li> 
      <li> Experts committee? </li> 
      <li> Rule of thumb + extra quick delivery? </li> 
      <li> Do we have some limitations to consider that we can’t avoid, like minimum or maximum order size? </li> 
     </ul></li> 
    <li class="readable-text" id="p93"> Can we quickly improve the existing solution, or do we need an entirely new one? </li> 
    <li class="readable-text" id="p94"> What if the Supermegaretail current forecasting is good enough for some categories and useless for others? In other words, can we use a hybrid approach here, at least in the very beginning, and start from the least successful categories, where the existing gap between predictions and actual sales is the widest? </li> 
    <li class="readable-text" id="p95"> If our approach unintentionally breaks something, it is not that dangerous. We are testing it for categories where we always had problems while not touching categories where everything is good. </li> 
    <li class="readable-text" id="p96"> In other words, we need to run an extensive and fresh exploratory data analysis of the existing solution. </li> 
   </ul> 
   <div class="readable-text" id="p97"> 
    <h4 class="readable-text-h4 sigil_not_in_toc">iv. Other issues and risks</h4> 
   </div> 
   <ul> 
    <li class="readable-text" id="p98"> Do we have a required infrastructure, or do we need to build it? </li> 
    <li class="readable-text" id="p99"> If we pick something sophisticated, it can go crazy. What necessary checks and balances do we need to implement to avoid a disaster? Do we have a fallback in case something is broken? </li> 
    <li class="readable-text" id="p100"> How sure are we that we can significantly improve the quality and reduce the manual load? Can we really solve this? </li> 
    <li class="readable-text" id="p101"> What is the price of a mistake? Out-of-stock and overstock most likely have different costs of errors. </li> 
    <li class="readable-text" id="p102"> If we deal with an out-of-stock situation, can we handle increased traffic? </li> 
    <li class="readable-text" id="p103"> How often and on what granularity do we need to perform predictions? </li> 
   </ul> 
  </div> 
  <div class="readable-text" id="p104"> 
   <p>As you can see, even a brief overview of the problem to solve and research using the previously gathered data can easily force us to write a 10-page doc. This draft will help us decide if we need to go further or if it is better to stop right now and avoid a complicated ML solution.</p> 
  </div> 
  <div class="readable-text intended-text" id="p105"> 
   <p>The next section of this chapter is no less important: it gives a practical example of how to review a design document. If you’re new to ML system design, you probably haven’t reached the stage of your career where you have enough experience and credibility to be involved in this kind of working routine. However, stepping up to review your first design doc is just a matter of time, so it’s better to be prepared beforehand, and you will see some practical advice on the reviewing basics.</p> 
  </div> 
  <div class="readable-text" id="p106"> 
   <h2 class="readable-text-h2" id="sigil_toc_id_32"><span class="num-string">4.4</span> Reviewing a design document</h2> 
  </div> 
  <div class="readable-text" id="p107"> 
   <blockquote>
    <div>
     <em>Audi alteram partem</em> [Let the other side be heard as well] 
     <div class=" quote-cite">
       —Latin proverb 
     </div>
    </div>
   </blockquote> 
  </div> 
  <div class="readable-text" id="p108"> 
   <p>So far, we haven’t seen a draft design doc written by a single person that would be complete enough to implement right from the start. However, we’ve come across some really decent drafts, which is more than enough after the first iteration. </p> 
  </div> 
  <div class="readable-text intended-text" id="p109"> 
   <p>This fact is essential and quite easily explained. Complex systems require input from many people with diverse expertise and backgrounds. As a design document author, part of your job is to make it more manageable for all the involved parties to navigate. Outlining your doc with chapters and subchapters will help domain experts see where to go from the beginning. Otherwise, the natural reaction for most people when they see a 10+ page doc is to close it and forget it.</p> 
  </div> 
  <div class="readable-text intended-text" id="p110"> 
   <p>Here come the first two critical points: the design doc must be accessible and visible to as many people as possible and easy to navigate for all participants.</p> 
  </div> 
  <div class="readable-text intended-text" id="p111"> 
   <p>As soon as people start reviewing any kind of content, they begin to criticize and offer alternatives. As an author, you want to encourage this type of behavior. After all, what are the chances you had the best and most appropriate design after the first iteration?</p> 
  </div> 
  <div class="readable-text intended-text" id="p112"> 
   <p>Try to derive an explanation for each proposition/fixture, as they could emerge from different conditions:</p> 
  </div> 
  <ul> 
   <li class="readable-text" id="p113"> Reviewers have used this tool before and think it is the best tool for everything. </li> 
   <li class="readable-text" id="p114"> There are limitations in the current infrastructure. For example, we can’t provide real-time support but can do batch jobs every 60 seconds. Does it affect the flow? </li> 
   <li class="readable-text" id="p115"> We have people who can maintain technology A, but there’s nobody to maintain technology B. Thus, it is better to move from technology B, mentioned in the design, to technology A. </li> 
   <li class="readable-text" id="p116"> Reviewers want to boast about their knowledge of technologies and demonstrate this knowledge to a broader audience. </li> 
   <li class="readable-text" id="p117"> Reviewers see another way to solve a given task and offer an alternative solution. </li> 
  </ul> 
  <div class="readable-text" id="p118"> 
   <p>Try to understand the reasoning behind every input and solicit additional information until you fully understand the reasons. From our personal experience, the least helpful input (on the first iteration) would sound like “looks good to me.” Try to find a part that looks the most questionable to you and ask the reviewer about it, expressing your concerns. A generally good practice would be to have a list of concerns, including things you are not sure of, to target reviewers’ attention and facilitate requests.</p> 
  </div> 
  <div class="readable-text intended-text" id="p119"> 
   <p>A popular failure mode for design documents is writing too generically. That is a huge drawback for a design doc, and often it is caused by the fact that a single person may not have enough context to fill in all the gaps. As an initial author, you need to facilitate the others’ inputs—for example, highlight some problematic areas with a lack of required information and encourage the reviewers to add missing parts of the puzzle.</p> 
  </div> 
  <div class="readable-text intended-text" id="p120"> 
   <p>We discussed how to create a design doc and what to expect from reviewers, but because the title of this section is “Reviewing a design document,” let’s try to reverse our suggestions and apply them from the reviewer’s standpoint:</p> 
  </div> 
  <ul> 
   <li class="readable-text" id="p121"> Take a look at the design doc and try to navigate through the outline. Which chapters do where you feel most confident about? </li> 
   <li class="readable-text" id="p122"> If the outline does not exist, check if there are open questions/things to consider at the end of the doc. </li> 
   <li class="readable-text" id="p123"> Ask the design doc owner to provide those if they don’t exist. </li> 
   <li class="readable-text" id="p124"> When adding a comment, try to answer for yourself what value you are adding and what you want to achieve with it. </li> 
   <li class="readable-text" id="p125"> If you’re tempted to write “Looks good to me,” think twice. Are you doing that because it indeed looks good to you or because you just want to save time or rely on others’ opinions? If so, maybe it makes sense not to comment at all. </li> 
  </ul> 
  <div class="readable-text" id="p126"> 
   <h3 class="readable-text-h3" id="sigil_toc_id_33"><span class="num-string">4.4.1</span> Design document review example</h3> 
  </div> 
  <div class="readable-text" id="p127"> 
   <p>The case we’ve chosen for the our second example design document is the stock photo company we mentioned in chapter 3. Meet PhotoStock Inc., where we’ve been hired to build a modern search tool that will be able to find the most relevant shots upon customer text queries while providing excellent performance and displaying the most relevant images in stock.</p> 
  </div> 
  <div class="readable-text intended-text" id="p128"> 
   <p>The business is effectively a marketplace: photographers join the platform and upload their shots; customers who are looking for specific images for illustrative purposes (editors, designers, ad professionals) purchase rights for these photos. The marketplace makes money through commission from sales. The company is highly interested in making an effective search system on its website.</p> 
  </div> 
  <div class="readable-text intended-text" id="p129"> 
   <p>We provide part of a raw and poorly written design document based on what we discussed in the previous chapters and comment on it as if we were reviewing the document. This time, text highlighted in <em>italics</em> represents reviewers’ comments.</p> 
  </div> 
  <div class="callout-container sidebar-container"> 
   <div class="readable-text" id="p130"> 
    <h4 class="readable-text-h4 sigil_not_in_toc">Design document: PhotoStock Inc.</h4> 
   </div> 
   <div class="readable-text" id="p131"> 
    <h4 class="readable-text-h4 sigil_not_in_toc">I. Problem</h4> 
   </div> 
   <div class="readable-text" id="p132"> 
    <p>Ninety percent of PhotoStock Inc. users find images via the search bar on our website. It makes the search bar a core component of the user experience.</p> 
   </div> 
   <div class="readable-text intended-text" id="p133"> 
    <p>Currently, the search engine is based on a fuzzy search algorithm powered by Elasticsearch, with its index updated automatically every Monday night. We assume it processes synonyms poorly. In addition, users can apply additional filters from presets that are manually created by the product team. </p> 
   </div> 
   <div class="readable-text intended-text" id="p134"> 
    <p>Many users are not happy with the search quality, which is proven by customer interviews and analysis based on clickstream. Only a small portion of search sessions leads to a purchase. </p> 
   </div> 
   <div class="readable-text intended-text" id="p135"> 
    <p><em>Reviewer: How many users exactly? Please add links to existing reports and dashboards for more context. </em></p> 
   </div> 
   <div class="readable-text intended-text" id="p136"> 
    <p><em>Reviewer: The search-to-purchase conversion is a function of many variables, and the relevancy of search results is just one of the factors. I suggest decomposing the problem further so we can estimate the missed revenue caused by poor search results more efficiently. </em></p> 
   </div> 
   <div class="readable-text intended-text" id="p137"> 
    <p><em>Reviewer: Please provide more information on the current search solution, as it’s not clear how it works and interacts with other systems. What are the main failure modes? </em></p> 
   </div> 
   <div class="readable-text intended-text" id="p138"> 
    <p><em>Reviewer: How do we measure user happiness? Please add specific criteria.</em></p> 
   </div> 
   <div class="readable-text" id="p139"> 
    <h4 class="readable-text-h4 sigil_not_in_toc">II. Goals</h4> 
   </div> 
   <div class="readable-text" id="p140"> 
    <p>Increase the search-to-purchase conversion rate by 100%. </p> 
   </div> 
   <div class="readable-text intended-text" id="p141"> 
    <p><em>Reviewer: Why by 100%? Are there any reasons for this exact level of increase?</em></p> 
   </div> 
   <div class="readable-text intended-text" id="p142"> 
    <p><em>Reviewer: As mentioned before, the search-to-purchase funnel is not only determined by search quality. Let’s narrow down the goals. </em></p> 
   </div> 
   <div class="readable-text intended-text" id="p143"> 
    <p><em>Reviewer: Are there any important nontechnical requirements like latency? </em></p> 
   </div> 
   <div class="readable-text intended-text" id="p144"> 
    <p><em>Reviewer: How do we currently measure conversion? How can we measure that it has been increased by this effort?</em></p> 
   </div> 
   <div class="readable-text intended-text" id="p145"> 
    <p><em>Reviewer: Have you defined antigoals to highlight the zones we don’t need to focus on?</em></p> 
   </div> 
   <div class="readable-text" id="p146"> 
    <h4 class="readable-text-h4 sigil_not_in_toc">III. Risks</h4> 
   </div> 
   <div class="readable-text" id="p147"> 
    <p>We can lose many loyal existing customers as they can’t follow their current behavior patterns. </p> 
   </div> 
   <div class="readable-text intended-text" id="p148"> 
    <p>If we release defective software, we can lose a significant source of revenue.</p> 
   </div> 
   <div class="readable-text intended-text" id="p149"> 
    <p><em>Reviewer: Interesting point on behavior patterns. Are there any examples of how users have to adapt to dysfunctions of the search engine? </em></p> 
   </div> 
   <div class="readable-text intended-text" id="p150"> 
    <p><em>Reviewer: With our infrastructure of blue-green deployment and A/B tests platform, we should be able to roll out the new system gradually; we should use it to mitigate such risks.</em></p> 
   </div> 
   <div class="readable-text" id="p151"> 
    <h4 class="readable-text-h4 sigil_not_in_toc">IV. References</h4> 
   </div> 
   <ul> 
    <li class="readable-text" id="p152"> [Link to YourPowerfulSearch, an enterprise-grade search system for marketplaces] </li> 
    <li class="readable-text" id="p153"> [Link to an academic paper from the Bing Search Relevancy team] </li> 
    <li class="readable-text" id="p154"> [Link to a Google Analytics dashboard showing various metrics related to a PhotoStock search] </li> 
   </ul> 
   <div class="readable-text" id="p155"> 
    <p><em>Reviewer: Please add more internal search-related artifacts, such as PhotoStock BI dashboard and UX research.</em></p> 
   </div> 
   <div class="readable-text intended-text" id="p156"> 
    <p><em>Reviewer: I believe that YourPowerfulSearch is not the only relevant solution in the market; can we get a wider overview? The same applies to the paper from Bing.</em></p> 
   </div> 
   <div class="readable-text intended-text" id="p157"> 
    <p><em>Reviewer: How can we estimate the influence of search relevancy on our commercial metrics? This can affect a possible budget a lot.</em></p> 
   </div> 
  </div> 
  <div class="readable-text" id="p158"> 
   <p>You can see some patterns in the comments, such as </p> 
  </div> 
  <ul> 
   <li class="readable-text" id="p159"> Raising legitimate questions as early as possible </li> 
   <li class="readable-text" id="p160"> Suggesting missing parts either as questions or statements </li> 
  </ul> 
  <div class="readable-text" id="p161"> 
   <p>Early feedback at the design review stage can save a lot of time in the later stages. Questions should initiate and facilitate a healthy discussion and unlock better solutions and should never be aggressive or toxic.</p> 
  </div> 
  <div class="readable-text" id="p162"> 
   <h2 class="readable-text-h2" id="sigil_toc_id_34"><span class="num-string">4.5</span> A design doc is a living thing</h2> 
  </div> 
  <div class="readable-text" id="p163"> 
   <p>This section was initially planned to be myth #5 in the list from the beginning of this chapter, but we believe this point is important enough to have its own spot as a separate section.</p> 
  </div> 
  <div class="readable-text intended-text" id="p164"> 
   <p>So why should there be no fear or hesitation in editing or criticizing a design doc at any stage? The answer is that a design doc is truly a living thing.</p> 
  </div> 
  <div class="readable-text intended-text" id="p165"> 
   <p>Usually, the evolution of design docs looks like this:</p> 
  </div> 
  <ol> 
   <li class="readable-text" id="p166"> First iteration </li> 
   <li class="readable-text" id="p167"> Feedback from peers </li> 
   <li class="readable-text" id="p168"> Rewrite 60% of the doc </li> 
   <li class="readable-text" id="p169"> Feedback from peers </li> 
   <li class="readable-text" id="p170"> Rewrite 30% of the doc </li> 
   <li class="readable-text" id="p171"> Feedback from peers </li> 
   <li class="readable-text" id="p172"> Rewrite 10% of the doc </li> 
   <li class="readable-text" id="p173"> Start implementing the system </li> 
   <li class="readable-text" id="p174"> (Three months later) input from the real world </li> 
   <li class="readable-text" id="p175"> Rewrite 30% of the doc </li> 
  </ol> 
  <div class="readable-text" id="p176"> 
   <p>With an evolution like that, you need to expect that the only time you could complete the design doc would be if you finished implementing the system, but even this is not guaranteed.</p> 
  </div> 
  <div class="readable-text intended-text" id="p177"> 
   <p>As soon as your system is implemented, life will expose its flaws, which you will have to address; or product managers decide they need new features, and the system has to be extended; or the government issues a new piece of legislation, which you have to consider; or there is an infrastructure migration or a new use case. You name it. To perform these changes, engineers need to understand the system and read design documents. By that time, a new pattern or technology could arise that perfectly fits the system.</p> 
  </div> 
  <div class="readable-text intended-text" id="p178"> 
   <p>If this is not the case, new features and refactoring need to be reflected in the design doc, bringing us to the design doc evolution mentioned earlier.</p> 
  </div> 
  <div class="readable-text intended-text" id="p179"> 
   <p>That is why a design document is never over. It is a living thing, as long as you have a service it describes. Even if you leave the company, others need to take the banner from you, if they don’t want to end up with a completely unsupportable system.</p> 
  </div> 
  <div class="readable-text intended-text" id="p180"> 
   <p>Rewriting a solid share of the design doc may seem discouraging, but it is something you can benefit from in the long run. For complex systems, it even makes sense to practice the “design it twice” approach—admit that your first design is likely not the best one, and design it twice, taking two radically different approaches. As practice shows, this approach can reveal hidden problems and opportunities. Let us quote <em>A Philosophy of Software Design</em> (Yaknyam, 2018) by John Outerhout (a nice book we recommend to feel the spirit of a good design): </p> 
  </div> 
  <div class="readable-text" id="p181"> 
   <blockquote>
    <div>
     I have noticed that the design-it-twice principle is sometimes hard for really smart people to embrace. When they are growing up, smart people discover that their first quick idea about any problem is sufficient for a good grade; there is no need to consider a second or third possibility. This makes it easy to develop bad work habits. However, as these people get older, they get promoted into environments with harder and harder problems. Eventually, everyone reaches a point where your first ideas are no longer good enough; if you want to get really great results, you have to consider a second possibility, or perhaps a third, no matter how smart you are. The design of large software systems falls in this category: no-one is good enough to get it right with their first try.
    </div>
   </blockquote> 
  </div> 
  <div class="readable-text" id="p182"> 
   <p>A good design (and a good design doc, respectively) should reduce various complexity aspects of the system, be it understanding, building, modifying, or maintaining. And if the system promises to be complex from the very beginning, spending additional time to reduce this complexity in advance via multiple iterations is often a good investment. </p> 
  </div> 
  <div class="readable-text intended-text" id="p183"> 
   <p>People who prefer building over thinking may feel irritated by this point: “Come on, first you suggest writing docs instead of writing code, and now you suggest doing it over and over again?” Well, it makes little sense to run many iterations once you no longer receive new information, and sometimes you can’t improve the design before some proof of concept is written. However, designing things twice is often a fair tradeoff between agility and preparedness.</p> 
  </div> 
  <div class="readable-text" id="p184"> 
   <h2 class="readable-text-h2" id="sigil_toc_id_35">Summary</h2> 
  </div> 
  <ul> 
   <li class="readable-text" id="p185"> Just like correctly set goals are the benchmark for your system, antigoals represent areas to avoid. Make sure to keep them in mind and have them pointed out. </li> 
   <li class="readable-text" id="p186"> A design document that is well put together will help you understand whether you need an ML system at all. </li> 
   <li class="readable-text" id="p187"> Involve all your stakeholders in reviewing the draft design document. </li> 
   <li class="readable-text" id="p188"> When you see a “looks good to me” answer, always contact your colleague once again for clearer, more precise feedback. Vagueness at the draft stage will very likely lead to change requests at later stages. </li> 
   <li class="readable-text" id="p189"> If you’re initiating a review for your design document, encourage people to criticize the current ideas and suggest alternatives. </li> 
   <li class="readable-text" id="p190"> Consider inviting reviewers with various backgrounds and experiences to gather varied feedback. </li> 
   <li class="readable-text" id="p191"> While reviewing a design document, ask specifying questions to point out weak or unneeded parts. </li> 
   <li class="readable-text" id="p192"> Don’t be afraid of multiple iterations, as no first draft will ever reach the final stage without edits. </li> 
   <li class="readable-text" id="p193"> Remember, a design doc is a living thing and will be subject to edits even after the launch of your system. </li> 
  </ul>
 </div></div></body></html>