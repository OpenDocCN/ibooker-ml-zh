- en: 1 Essentials of machine learning system design
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 1 机器学习系统设计的基本要素
- en: This chapter covers
  id: totrans-1
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 本章涵盖
- en: What machine learning (ML) system design is, why it is so difficult to define,
    and where you may first encounter it
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 机器学习（ML）系统设计是什么，为什么它如此难以定义，你可能在何处首次遇到它
- en: Who we believe will benefit most from reading this book, what information we’re
    about to give you, and how it will be structured
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们认为谁将最从阅读这本书中受益，我们将提供哪些信息，以及它的结构将如何安排
- en: What principles of ML system design can be helpful and the best time to apply
    them
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 机器学习系统设计有哪些原则是有帮助的，以及何时应用它们最合适
- en: Machine learning (ML) system design is a relatively new term that often gets
    people from the industry puzzled. Many find it hard to compile a certain scope
    of responsibilities behind this term, not to mention trying to find a proper name
    for a respective role or position. The job may be done with various efficiency
    by ML engineers, software engineers, or even data scientists, depending on the
    scope of their role.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 机器学习（ML）系统设计是一个相对较新的术语，常常让行业人士感到困惑。许多人发现很难确定这个术语背后的特定职责范围，更不用说尝试为相应的角色或职位找到一个合适的名字了。根据其职责范围的不同，这项工作可能由机器学习工程师、软件工程师，甚至数据科学家以不同的效率完成。
- en: While all of the positions are valid, we believe that to become a seasoned expert
    in ML system design, you have to encapsulate expertise from each of the backgrounds.
    Note that while some of the things we discuss in this book are specific to ML
    systems, others will be familiar to those readers who have already built non-ML
    software systems (you will find this information in chapters 2, 13, and 16). This
    is because ML system design, although a new phenomenon, is still based on the
    classic fundamentals of software development.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然所有这些观点都是有效的，但我们认为，要成为一名经验丰富的机器学习系统设计专家，你必须将每个背景领域的专业知识封装起来。请注意，虽然本书中我们讨论的一些内容是针对机器学习系统的，但其他内容对于那些已经构建过非机器学习软件系统的读者来说可能很熟悉（你可以在第2章、第13章和第16章中找到这些信息）。这是因为机器学习系统设计，尽管是一种新的现象，但仍然基于软件开发的经典基础。
- en: But first we need to discover what ML system design is as a whole. In this opening
    chapter, we will suggest our take on the definition of ML system design and support
    it with examples from personal experience, both our own and those of our colleagues;
    we will describe the perfect persona for the position and share cases from our
    personal experience of why a coherent and consistent approach to designing an
    ML system will save you a lot of time in the long run and will help in delivering
    short-term business wins, which is crucial to gain the trust of colleagues in
    this new working method from the early stages.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 但首先，我们需要发现机器学习系统设计作为一个整体究竟是什么。在本章的开头，我们将提出我们对机器学习系统设计定义的看法，并用我们自己和同事的个人经验中的例子来支持它；我们将描述这个职位的理想人格，并分享我们个人经验中的案例，说明为什么采用连贯一致的方法来设计机器学习系统将节省你大量的时间，并有助于实现短期业务胜利，这对于在早期阶段赢得同事对这种新工作方法的信任至关重要。
- en: '1.1 ML system design: What are you?'
  id: totrans-8
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 1.1 机器学习系统设计：你是谁？
- en: ML system design might sound familiar if you have ever tried interviewing at
    deep tech/big tech companies (the first term commonly stands for startups or R&D
    units within large corporations that either work with or develop cutting-edge
    technology, and the second term refers to the largest and most dominant tech companies
    of the world that are often known for their high bar in talent acquisition and
    advanced engineering culture) for ML engineer/manager positions. Both of us have
    vast, deep tech experience, so while planning to write this book, we were convinced
    the definition was clear enough to everyone, and there was no reason to dwell
    on it.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你曾经尝试过在深度技术/大科技公司（第一个术语通常指初创公司或大公司内部从事或开发尖端技术的研发部门，第二个术语指世界上最大、最具主导地位的科技公司，它们通常以人才招聘的高标准和先进的工程文化而闻名）的机器学习工程师/经理职位面试，那么你可能会对机器学习系统设计感到熟悉。我们两人都有丰富的深度技术经验，所以在计划写这本书的时候，我们确信定义对每个人来说都很清晰，没有必要过多地纠结于此。
- en: However, after reaching out to a variety of people for their opinions on the
    outline, we saw that the term itself caused discord in opinions and interpretations.
    Perhaps this is due to the fact that the industry has long had a definite list
    of job titles, which gives candidates a relatively clear understanding of what
    set of functions and responsibilities they are applying for. The positions of
    software engineer, research engineer, ML engineer, and so on each entail a certain
    classic set of functions enshrined in textbooks and eloquently stated in job descriptions.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，在向各种人征求他们对大纲的意见后，我们发现这个术语本身在意见和解释上引起了分歧。也许这是因为该行业长期以来一直有一个明确的职位列表，这为求职者提供了一个相对清晰的理解，即他们申请的是哪些功能和责任。软件工程师、研究工程师、机器学习工程师等职位都包含了一定经典的功能集合，这些功能在教科书中被神圣化，并在职位描述中被巧妙地陈述。
- en: So, is there a job title associated directly with the term *ML system design*?
    Currently, there’s no position completely tied to the scope we’ll be describing
    in this book, but if you meet a person fulfilling this scope, their position will
    most certainly be data scientist.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，是否存在与“机器学习系统设计”直接相关的职位？目前，没有完全符合我们将在本书中描述的范围的职位，但如果遇到符合这一范围的人，他们的职位肯定会是数据科学家。
- en: 'In our attempts to understand the nature of this connection, we reached various
    people working in data scientist positions and eventually realized that the role
    implies a rather vast and vague list of responsibilities. Indeed, you can find
    10 different people working in 10 different companies as a data scientist and
    ask them what they do—and you’ll end up hearing about 10 completely different
    things:'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们试图理解这种联系的本质时，我们接触了在数据科学家职位上工作的人，最终意识到这个角色意味着一个非常广泛且模糊的责任列表。确实，你可以在 10 家不同的公司找到
    10 个不同的数据科学家，并询问他们做什么——你最终会听到 10 件完全不同的事情：
- en: Create pivot tables in Excel.
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在 Excel 中创建数据透视表。
- en: Set up a 10 PB distributed cluster.
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 设置一个 10 PB 的分布式集群。
- en: Build a real-time computer vision system.
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 构建实时计算机视觉系统。
- en: Deploy numerous chatbots.
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 部署众多聊天机器人。
- en: Visualize data in Tableau/Metabase/Looker/PowerBI.
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在 Tableau/Metabase/Looker/PowerBI 中可视化数据。
- en: Write SQL scripts.
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 编写 SQL 脚本。
- en: Run A/B tests.
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 进行 A/B 测试。
- en: Create recommender systems.
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建推荐系统。
- en: Handle communication with stakeholders.
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 处理与利益相关者的沟通。
- en: Answer questions from top management.
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 回答来自高层管理的问题。
- en: As you can see, a short, crisp-sounding title carries a rather mottled set of
    functions, having grown into a unifying “jack-of-all-trades” term for anything
    that goes beyond the commonly accepted scope of work behind the roles of data
    engineer, ML engineer, and research engineer.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 如您所见，一个简短、听起来清晰明了的标题包含了一系列相当混乱的功能，它已经成长为一个“万能手”的术语，用于任何超出数据工程师、机器学习工程师和研究工程师通常工作范围的事情。
- en: 'While contemplating this, we found that in the case of ML system design (or
    rather what later received such a name), the situation is quite the opposite:
    there is a phenomenon without a common name but with a clear set of functions
    and responsibilities, and what needs to be done is to organize them and bring
    them to a coherent structure of interrelated functions.'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 在思考这个问题时，我们发现，在机器学习系统设计（或者更确切地说，后来得到这个名字的情况）中，情况正好相反：存在一种没有共同名称但具有明确的功能和责任的现象，需要做的是组织它们，并将它们纳入一个相互关联的功能结构中。
- en: 'In the following chapters, we will be giving our own perspective on ML system
    design and even suggesting unconventional ideas and solutions, but before we dive
    in, we’d like to suggest our own definition:'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 在接下来的章节中，我们将提供我们自己对机器学习系统设计的看法，甚至提出非传统想法和解决方案，但在深入探讨之前，我们想提出我们自己的定义：
- en: Machine learning system design is a complex, multistep process of designing,
    implementing, and *maintaining* ML-based systems that involves a combination of
    techniques and skills from various fields and roles, including ML, software engineering,
    project management, product management, and leadership.
  id: totrans-26
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 机器学习系统设计是一个复杂的多步骤过程，涉及设计、实施和维护基于机器学习的系统，这需要结合来自各个领域和角色的技术和技能，包括机器学习、软件工程、项目管理、产品管理和领导力。
- en: Figure 1.1 illustrates this definition.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 图 1.1 展示了此定义。
- en: '![figure](../Images/CH01_F01_Babushkin.png)'
  id: totrans-28
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/CH01_F01_Babushkin.png)'
- en: Figure 1.1 The variety of skills one should possess to succeed in ML system
    design
  id: totrans-29
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图 1.1 成功进行机器学习系统设计所需具备的各种技能
- en: The reason we’ve highlighted *maintaining* in italics is that we believe that
    ML system design does not end at the release of an ML system. Apart from providing
    accurate predictions and ensuring efficient decision-making, your system must
    be scalable and flexible enough to be easily adjusted to changing business environments
    or any other factors, both internal and external. Thus, right after you go live,
    maintenance and fine-tuning your ML system will secure its efficiency in the long
    run, which can be crucial, especially when working under strict budget or capacity
    limitations.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 我们之所以用斜体强调“维护”，是因为我们认为机器学习系统设计并不随着机器学习系统的发布而结束。除了提供准确的预测和确保高效的决策外，你的系统必须足够可扩展和灵活，以便能够轻松适应不断变化的企业环境或任何其他内部和外部因素。因此，在你上线后，维护和微调你的机器学习系统将确保其在长期内的效率，这在严格预算或容量限制下尤其重要。
- en: 'But it is not only the term *machine learning system design* itself that has
    been questioned by those who have seen this book’s synopsis or walked through
    the table of contents. We received a host of questions on various aspects of the
    book; the following are those we found the most notable:'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 但质疑的不仅仅是书简介或浏览目录的人对“机器学习系统设计”这个术语本身。我们收到了大量关于本书各个方面的提问；以下是我们认为最引人注目的几个问题：
- en: “Data scientist, machine learning engineer, and software engineer are different
    roles; why are you fusing them together?”
  id: totrans-32
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: “数据科学家、机器学习工程师和软件工程师是不同的角色；为什么你要将它们融合在一起？”
- en: “It confuses me a little that a book about ML systems covers things like data
    gathering and reporting, as this is exactly what separates classical machine learning
    from data science.”
  id: totrans-33
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: “我对一本关于机器学习系统的书涵盖数据收集和报告等内容感到有些困惑，因为这正是将传统机器学习与数据科学区分开来的地方。”
- en: “I was surprised there was no mention of MLOps in the outline, which is the
    common industry term for many of the components you’re describing (reproducibility,
    testing, pipelines, etc.).”
  id: totrans-34
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: “我很惊讶在概述中没有提到MLOps，这是描述你描述的许多组件（可重复性、测试、管道等）的通用行业术语。”
- en: For us, these questions became an additional indicator of the confusion between
    ML and data science, as well as between ML engineers and data scientists in the
    general public. We have our own perspective on that, but first, let us try to
    clarify our statements.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 对于我们来说，这些问题成为了公众对机器学习与数据科学之间，以及机器学习工程师和数据科学家之间混淆的额外指标。我们对此有自己的看法，但首先，让我们尝试澄清我们的观点。
- en: Coming from deep tech companies, we got used to calling people who do ML *machine
    learning engineers*, but the difference between ML engineer and software engineer
    is getting slimmer, especially since some prominent people call machine learning
    *software 2.0* ([https://mng.bz/yoNe](https://mng.bz/yoNe)). At the same time,
    *data scientist* is a job title mostly tied to people who do product analytics
    and work with metrics, insights, etc. (Please note we are speaking about our experience
    in deep tech companies, but since these companies employ thousands of highly qualified
    pros and gradually set standards for the whole industry, we tend to take this
    approach as a benchmark.)
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 来自深度技术公司，我们习惯了称呼那些做机器学习的人为“机器学习工程师”，但机器学习工程师和软件工程师之间的区别正在缩小，尤其是在一些显赫人物将机器学习称为“软件2.0”([https://mng.bz/yoNe](https://mng.bz/yoNe))之后。同时，“数据科学家”这个职位通常与那些从事产品分析和与指标、见解等工作的人相关联。（请注意，我们在这里谈论的是我们在深度技术公司的经验，但由于这些公司雇佣了数千名高素质的专业人士，并逐渐为整个行业设定标准，我们倾向于将这种方法作为基准。）
- en: When people interview for an ML engineer position, they mostly walk through
    the software engineer hiring loop topped with additional sections, with ML system
    design being one of the most important. It is used to draw out signals about a
    candidate’s expertise, maturity, and ability to overview complex systems and decompose
    them into blocks of interdependent tasks. This is not an easy exercise, as a candidate
    has only 40–45 minutes to present their design of a system randomly picked by
    the interviewer.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 当人们面试机器学习工程师职位时，他们通常会走过软件工程师招聘流程，并在此基础上增加额外的部分，其中机器学习系统设计是最重要的之一。这被用来提取关于候选人专业知识、成熟度和概述复杂系统以及将其分解为相互依赖的任务块的能力的信号。这并不是一件容易的事情，因为候选人只有40-45分钟的时间来展示由面试官随机挑选的系统设计。
- en: 'Eliezer Yudkowsky, a modern AI writer and philosopher, wrote, “The most dangerous
    habit of thought taught in schools is that even if you don’t really understand
    something, you should parrot it back anyway” ([https://mng.bz/r1Zy](https://mng.bz/r1Zy)).
    It is very applicable to the tech interview flow in some companies: the interviewer
    provides a puzzle and expects a particular answer to be parroted back. After the
    interviewee is hired and becomes an interviewer of their own, the bad practice
    gets reinforced, and the company continues hiring people with perfectly memorized
    knowledge fragmentarily drawn from various fields. There is no guarantee these
    people understand the whole picture, and this is what we came across while conducting
    interviews ourselves.'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 现代人工智能作家和哲学家埃利泽·尤德科夫斯基写道：“学校里教授的最危险的思想习惯是，即使你真的不理解某件事，也应该鹦鹉学舌地把它复述出来” ([https://mng.bz/r1Zy](https://mng.bz/r1Zy))。这在一些公司的技术面试流程中非常适用：面试官提供一个谜题，并期望应聘者鹦鹉学舌地给出特定答案。应聘者被录用并成为自己公司的面试官后，这种不良习惯得到强化，公司继续招聘那些从各个领域零散记忆的知识片段的人。这些人是否真正理解全局没有保证，这正是我们在进行面试时遇到的情况。
- en: 'We interviewed and hired ML engineers for various companies. Some were at the
    start of their career, some were seasoned experts, and some were solid software
    engineers switching to ML. However, there was a specific commonality among those
    who didn’t get through the interview: while working on the ML system design section,
    they were concentrating too much on details, never getting to the bigger picture.'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 我们为多家公司面试和招聘机器学习工程师。有些人处于职业生涯的初期，有些人是有经验的专家，还有一些人是从软件工程师转向机器学习的。然而，那些未能通过面试的人中有一个共同点：在机器学习系统设计部分工作时，他们过于关注细节，从未触及更大的图景。
- en: For us, these failures indicated an expectations mismatch; as young hiring managers,
    we were convinced that a person who knew all the algorithms, tools, and patterns
    would be a good fit for the role by default. But later we saw that sometimes people
    just couldn’t combine their pieces of knowledge into an integrated vision.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 对我们来说，这些失败表明了期望不匹配；作为年轻的招聘经理，我们坚信，一个了解所有算法、工具和模式的人会自然而然地适合这个角色。但后来我们发现，有时人们无法将他们的知识碎片整合成一个整体愿景。
- en: In addition, building systems in a real environment is overwhelmingly different
    from discussing them during interviews. One can learn dozens of popular ML system
    design questions (“How would you design a job recommendation system for a LinkedIn-like
    website”?) and be puzzled when a similar problem occurs in real work.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，在现实环境中构建系统与在面试中讨论它们截然不同。一个人可以学习数十个流行的机器学习系统设计问题（“你将如何为LinkedIn类似的网站设计一个职位推荐系统？”），当类似的问题在实际工作中出现时，可能会感到困惑。
- en: 'But let’s ignore the interview part for a while. ML experts get hired for a
    reason: companies need them to build, maintain, operate, and improve systems—and
    not just for the sake of writing some code or closing Jira tickets. Businesses
    need reliable ML systems to reach objectives and solve problems.'
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 但让我们暂时忽略面试的部分。雇佣机器学习专家是有原因的：公司需要他们来构建、维护、运营和改进系统——而不仅仅是编写一些代码或关闭Jira工单。企业需要可靠的机器学习系统来实现目标和解决问题。
- en: 'Building ML systems requires a wide scope of skills. To put it briefly, a person
    in charge must be able to answer three questions:'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 构建机器学习系统需要广泛的技术技能。简单来说，负责人必须能够回答以下三个问题：
- en: What are we building?
  id: totrans-44
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们在构建什么？
- en: What is the purpose of the system?
  id: totrans-45
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 系统的目的是什么？
- en: How should it be built?
  id: totrans-46
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 它应该如何构建？
- en: 'In practice, it requires a combination of skills from multiple roles: a bit
    of a product manager to understand the main goal and communicate it to peers and
    stakeholders, a fair share of ML researcher to empower the system, and, of course,
    a solid software engineering background to make the product usable, maintainable,
    and reliable. An ML system design expert should be able to think globally and
    dive deep enough locally if needed.'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 实际上，这需要多个角色的技能组合：一点产品经理的技能来理解主要目标并将其传达给同事和利益相关者，相当一部分机器学习研究者的技能来赋能系统，当然，还需要坚实的软件工程背景来使产品可用、可维护和可靠。机器学习系统设计专家应该能够全局思考，并在必要时深入到足够的地方。
- en: There are few people who can combine all these skills at the proper level. However,
    a lot of ML systems are being built these days, and someone has to design them.
    From our experience, it is common for an ML system to be designed by either a
    bright ML expert (because it’s ML) or an experienced software engineer (because
    it’s a system). They do the job but often struggle in the areas where they don’t
    shine.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 很少有人能够以适当水平结合所有这些技能。然而，如今正在构建大量机器学习系统，而有人必须设计它们。根据我们的经验，机器学习系统通常由一位聪明的机器学习专家（因为它是机器学习）或一位经验丰富的软件工程师（因为它是系统）设计。他们完成了这项工作，但往往在他们的强项之外领域感到挣扎。
- en: To sum it up, the confusion around ML system design is more typical for candidates
    with less expertise on the one hand and hiring managers or recruiters who are
    looking for that jack of all trades on the other. However, if we look at it from
    the point of view of an executive officer or an expert, a much broader picture
    appears. They know that you hire these specialists to build, maintain, and improve
    ML systems, and their end performance working on ML systems becomes the ultimate
    benchmark of their career growth.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 总结来说，围绕机器学习系统设计的困惑对于一方面缺乏专业知识的人才和另一方面寻找全能手型招聘经理或招聘人员来说更为典型。然而，如果我们从高级管理人员或专家的角度来看，就会出现一个更广阔的图景。他们知道你聘请这些专家来构建、维护和改进机器学习系统，他们在机器学习系统上的最终表现成为他们职业成长的终极标准。
- en: We believe that it’s the fusion of data scientist and software engineer with
    experience in academic ML that constitutes an expert in ML system design. People
    who end up designing ML systems may come from various backgrounds—software, practical
    ML, academic ML, data research—and we hope our hands-on experience aided by small
    bits of theory will help them close the gaps, systemize their knowledge in the
    areas they’re familiar with, and feel more confident in the areas where they’re
    lacking precious experience.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 我们认为，数据科学家和软件工程师的结合，以及他们在学术机器学习方面的经验，构成了机器学习系统设计方面的专家。最终设计机器学习系统的人可能来自各种背景——软件、实践机器学习、学术机器学习、数据研究——我们希望我们的小块理论辅助的实践经验能帮助他们填补差距，系统化他们在熟悉领域的知识，并在缺乏宝贵经验的地方更加自信。
- en: 1.1.1 Why ML system design is so important
  id: totrans-51
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 1.1.1 为什么机器学习系统设计如此重要
- en: While you have MLOps as a set of tools to use for building and maintaining your
    ML system, you can consider ML system design a blueprint that you can rely on
    and refer to at any moment that will give you scalability and flexibility (a proper
    understanding of building blocks and their connections helps to identify bottlenecks
    and address other problems fluently). Most importantly, though, it provides a
    framework that will weld your whole system together.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 当你拥有MLOps作为一套用于构建和维护你的机器学习系统的工具集时，你可以将机器学习系统设计视为一个蓝图，你可以在任何时刻依赖和参考它，这将为你提供可扩展性和灵活性（对构建块及其连接的正确理解有助于识别瓶颈和流畅地解决其他问题）。然而，最重要的是，它提供了一个框架，将你的整个系统焊接在一起。
- en: Some projects are simple enough that they don’t require that thorough of an
    approach. Let’s take construction as an example. You could probably build a shed
    without an initial blueprint. But when your ambitions spread further to the level
    of a house or a skyscraper, you can’t get away with not using a prearranged, detailed
    plan. ML system design is an architectural approach to engineering ML systems
    that incorporates the experiences of hundreds of experts who have worked in dozens
    of companies on a multitude of projects.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 有些项目足够简单，以至于不需要那么彻底的方法。以建筑为例。你可能不需要初始蓝图就能建造一个棚屋。但当你雄心勃勃地扩展到房屋或摩天大楼的水平时，你不能不使用预先安排的详细计划。机器学习系统设计是一种工程方法，它结合了数百位在数十家公司和众多项目上工作的专家的经验，用于构建机器学习系统。
- en: 1.1.2 Roots of ML system design
  id: totrans-54
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 1.1.2 机器学习系统设计的根源
- en: 'Building complicated software systems has always been a challenge, and organizations
    had to crystallize the process somehow. People used a general principle for managing
    complexity through abstraction: build low-level blocks with complexity encapsulated
    into them, treat them as magic black boxes, use them to build higher-level blocks,
    and so on.'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 构建复杂的软件系统一直是一个挑战，组织必须以某种方式使过程结晶化。人们使用一个通用原则来通过抽象管理复杂性：构建低级块，将复杂性封装在其中，将它们视为魔法黑盒，使用它们来构建更高级的块，依此类推。
- en: 'This process worked, but it had a weak spot: someone had to decide the structure
    of all these blocks (what are the highest-level components, what’s their structure
    inside, and so on to the lowest level of implementation). The most responsible
    decisions were made by software architects—experienced engineers who worked with
    many systems.'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 这个流程是有效的，但它有一个弱点：有人必须决定所有这些块的结构（最高级别的组件是什么，它们内部的结构是什么，等等，直到最低层的实现）。最负责任的决策是由软件架构师做出的——经验丰富的工程师，他们与许多系统一起工作。
- en: This kind of approach is usually associated with the Waterfall methodology and
    Big Design Upfront paradigm. In other words, it assumes software projects start
    slowly and are deeply analyzed and documented before the first line of a real
    system code is written. This approach was and continues to be reliable but inertial
    and bureaucratic. In a world of rapid changes, the project could lose its initial
    sense before finishing.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 这种方法通常与瀑布方法和“大设计前期”范式相关联。换句话说，它假设软件项目开始缓慢，在真正系统代码的第一行被编写之前，进行深入的分析和文档记录。这种方法曾经并且继续是可靠的，但却是惰性和官僚的。在一个快速变化的世界里，项目在完成之前可能会失去其最初的意义。
- en: 'Opponents of such slow but steady approaches are often enthusiasts of something
    called the agile software development paradigm. The authors of *Manifesto for
    Agile Software Development* ([https://agilemanifesto.org/](https://agilemanifesto.org/))
    stated four main values:'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 这种缓慢但稳定方法的反对者通常是敏捷软件开发范式的热衷者。《敏捷软件开发宣言》（[https://agilemanifesto.org/](https://agilemanifesto.org/））的作者提出了四个主要价值观：
- en: Individuals and interactions over processes and tools
  id: totrans-59
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 个人和互动胜过流程和工具
- en: Working software over comprehensive documentation
  id: totrans-60
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 工作软件胜过全面文档
- en: Customer collaboration over contract negotiation
  id: totrans-61
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 客户协作胜过合同谈判
- en: Responding to change over following a plan
  id: totrans-62
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对变化的响应胜过遵循计划
- en: In other words, these people fairly state that many software systems can’t be
    effective while trying to plan and document everything. Of course, sometimes such
    bureaucracy makes sense—e.g., for building software controlling medical devices
    or airplanes. But most software engineers work on other types of applications—office
    software, entertainment, websites, and mobile apps. That’s how the software architect’s
    role became associated with something slow and old school—the opposite of swift
    hackers changing the world rapidly without a software specification approved by
    the whole hierarchy of architects, managers, and other experts. This agile approach
    was popularized by the Silicon Valley hacker culture and thousands of successful
    startups. Even big companies like Meta try to keep such a culture—their internal
    motto is “Move fast and break things.”
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 换句话说，这些人公正地指出，许多软件系统在试图规划和记录一切时无法有效运作。当然，有时这种官僚主义是有道理的——例如，在构建控制医疗设备或飞机的软件时。但大多数软件工程师从事其他类型的应用——办公软件、娱乐、网站和移动应用。这就是软件架构师的角色与缓慢且过时的东西相关联的原因——与迅速改变世界的黑客相反，他们不需要整个架构师、经理和其他专家的软件规范批准。这种敏捷方法被硅谷黑客文化和数千家成功的初创公司普及。甚至像Meta这样的大公司也试图保持这种文化——他们的内部座右铭是“快速行动，打破事物。”
- en: 'Let’s summarize this little historical overview: at some point, industry faced
    a spectrum of software engineering processes, from a heavily regulated one led
    by software architects to the chaotic, anarchist “screw the hierarchy” hacker-style
    way of building things. And, as it often happens, things got mixed. More traditional
    companies tend to become more agile, and most anarchist startups mature, introducing
    processes and separate roles.'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们总结一下这个小历史概述：在某个时刻，工业界面临了一系列的软件工程流程，从由软件架构师领导的严格监管的流程，到混乱的无政府主义“无视等级”黑客风格的构建方式。而且，正如常发生的那样，事情变得复杂。更多传统公司倾向于变得更加敏捷，而大多数无政府主义初创公司成熟起来，引入了流程和独立的角色。
- en: 'This mixture leads to a consensus that dominates tech companies these days:
    instead of delegating all the decisions to dedicated people like software architects,
    we will keep it the responsibility of regular software engineers; let them both
    design systems *and* write code for these systems. But this level of freedom didn’t
    wipe out the initial need for decisions: someone still has to have a final word
    on how things are structured. Someone has to be responsible for the system design.
    Every engineer may be involved here and there, but seeing the whole picture is
    critical.'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 这种混合导致了一种共识，这种共识现在主导着科技公司：我们不会将所有决策委托给专门的软件架构师等人，我们将保持常规软件工程师的责任；让他们既设计系统*又*为这些系统编写代码。但这种自由程度并没有消除最初对决策的需求：仍然有人必须对事物的结构做出最终决定。有人必须对系统设计负责。每个工程师都可能在这里或那里参与其中，但看到整体图景是至关重要的。
- en: 'Skills in implementing low-level pieces of a designed system are not the same
    as skills in designing a proper system. That’s why deep tech companies tend to
    have separate interview sections to check a candidate’s skills in writing effective
    code (aka algorithms section) and designing systems: it’s expected that engineers
    will wear both hats. The split between those two can be different: usually, junior
    engineers are silent readers of design documents, and senior engineers are authors
    or active contributors.'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 实现设计系统低级组件的技能与设计适当系统的技能不同。这就是为什么深度技术公司往往有单独的面试部分来检查候选人在编写有效代码（即算法部分）和设计系统方面的技能：预计工程师将同时扮演这两个角色。这两个角色之间的划分可能不同：通常，初级工程师是设计文档的沉默读者，而高级工程师是作者或积极贡献者。
- en: 'In a nutshell, there is a consensus: a solid software engineer should be able
    to operate on different levels of abstraction, from low-level implementation to
    high-level architecture decisions.'
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 简而言之，有一个共识：一个优秀的软件工程师应该能够在不同的抽象级别上操作，从低级实现到高级架构决策。
- en: Everything we have said so far about the definition of system design is fair
    for any software—we didn’t mention something ML related. However, not everyone
    who can successfully design a software system will succeed in designing an ML
    system—it’s a very specific subset of systems. While designing an ML system, the
    person in charge should keep in mind many aspects that are not relevant to regular
    software. In this book, we’ll focus on these aspects; readers interested in more
    general system design questions can look into other literature.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 我们到目前为止所说的关于系统设计定义的一切都适用于任何软件——我们没有提到与机器学习相关的内容。然而，并非每个人都能成功设计软件系统，就能成功设计机器学习系统——这是一个非常特定的系统子集。在设计机器学习系统时，负责人应该牢记许多与常规软件无关的方面。在这本书中，我们将关注这些方面；对更普遍的系统设计问题感兴趣的读者可以查阅其他文献。
- en: 1.2 How this book is structured
  id: totrans-69
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 1.2 本书结构
- en: There are several books covering system design, but literature on ML system
    design is scarce. We decided to contribute to this field and bridge the gap between
    supply and demand. Our goal is to share our knowledge and experience to help you
    convert the many things you know into a holistic system.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 覆盖系统设计的书籍有几本，但关于机器学习系统设计的文献却很少。我们决定为这个领域做出贡献，弥合供需之间的差距。我们的目标是分享我们的知识和经验，帮助你将你所知道的各种事物转化为一个完整的系统。
- en: This book is structured as a comprehensive practical guideline on how to build
    complex, properly functioning ML systems in various domains, regardless of the
    size of the company you work for. This guideline includes
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 这本书的结构是一个全面的实用指南，介绍了如何在各个领域构建复杂、功能正常的机器学习系统，无论你所在公司的规模大小。本指南包括
- en: The overall landscape with an overview of general structural principles and
    all the components that make up such systems, as well as the pitfalls you may
    get trapped in
  id: totrans-72
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 整体格局，概述一般结构原则和构成这些系统的所有组件，以及你可能陷入的陷阱
- en: Low-level checklists of the tools that might come in handy at each step, with
    a brief reminder of why they are important
  id: totrans-73
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在每个步骤中可能派上用场的工具的低级清单，以及简要说明为什么它们很重要
- en: The book structure tends to resemble that of a checklist or manual, with an
    infusion of campfire stories from our own experience. It can be read at once or
    used at any moment while working on a specific aspect of an ML system.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 书的结构类似于清单或手册，融入了我们自己经验中的篝火故事。它可以一次性阅读，也可以在工作过程中针对机器学习系统的特定方面随时使用。
- en: Each chapter is a high-level checklist mandatory for every ML system. Note that
    while not all the items must be fulfilled, each of them must be remembered and
    considered.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 每一章都是每个机器学习系统必须遵守的高级清单。请注意，虽然并非所有项目都必须完成，但每个项目都必须记住并考虑。
- en: In addition, each chapter answers the question regarding why and when the given
    item is important. It also includes a description of the landscape (what techniques
    and tools are suitable for the item). The description is systematized (not just
    a list of 100 buzzwords), although not necessarily exhaustive, as we believe that
    an experienced reader will be able to compare the example case with something
    from their background and draw their own conclusions. At the same time, we try
    not to slip into a typical textbook or course on classic ML or deep learning.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，每一章都回答了为什么以及何时给定项目重要的问题。它还包括对该领域（适合该项目的技术和工具）的描述。描述是系统化的（不仅仅是100个流行词汇的列表），尽管不一定详尽，因为我们相信有经验的读者能够将示例案例与他们的背景进行比较，并得出自己的结论。同时，我们尽量避免陷入典型的教科书或经典机器学习或深度学习课程。
- en: 'We come from quite different (and therefore, very intercomplementary) backgrounds:
    both of us have been involved in ML projects with over 20 years of combined “mileage”
    in a variety of roles, companies, and environments—from pre-seed startups to multibillion-dollar
    international corporations. Sometimes we worked long hours as individual contributors.
    Other times, our work primarily implied rapid team growth and coaching talented
    and aspiring young engineers. We have witnessed and have been part of successes
    and failures, big acquisitions, and massive job cuts. And, of course, we’ve discussed
    a lot of the successes and failures of ML projects with our friends.'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 我们来自截然不同的（因此，非常互补的）背景：我们两人都参与了超过20年的机器学习项目，涉及各种角色、公司和环境——从种子前初创公司到价值数十亿美元的国际公司。有时我们作为个人贡献者工作很长时间。其他时候，我们的工作主要意味着快速团队增长和指导有才华和有抱负的年轻工程师。我们见证了成功和失败、大规模收购和大量裁员。当然，我们也与朋友们讨论了许多机器学习项目的成功和失败。
- en: 'But no matter how different our backgrounds are, there’s one thing we strongly
    agree on: ML projects almost never fail because their participants can’t use algorithms
    properly. There may be multiple reasons for a failure: a misdirected or completely
    unnecessary task, sloppy data handling, an unscalable solution with no growth
    potential—this list could go on and on.'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 但无论我们的背景有多么不同，有一点我们强烈认同：机器学习项目几乎从未因为参与者无法正确使用算法而失败。失败可能有多个原因：一个误导性的或完全不必要的任务、数据处理不当、一个无法扩展且没有增长潜力的解决方案——这个列表可以一直列下去。
- en: 'There is a pattern so popular that we’ll have to repeat some stories in different
    parts of the book: a deep expert in a narrow area focuses a lot on their area
    of expertise—maybe picks some similar areas but still doesn’t get the big picture.
    As a result, some important nuances are missed, and it leads to project failure,
    missed deadlines, and violated budgets.'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 存在一个如此流行的模式，以至于我们不得不在不同的部分重复一些故事：一个在狭窄领域的深度专家过于关注他们的专业领域——可能选择一些类似领域，但仍然没有看到大局。结果，一些重要的细微差别被忽略，导致项目失败、错过截止日期和违反预算。
- en: While books on ML usually provide the “right” answers, our main objective is
    quite the opposite. What we’d like to do is to teach you how to ask the right
    questions. These might be the questions you ask yourself, your teammates, users,
    stakeholders—you name it. Each one of us, as tech industry professionals, accumulates
    tons of valuable information but can’t always connect the dots. This is where
    timely questions help structure all the knowledge around us.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管机器学习方面的书籍通常提供“正确”的答案，但我们的主要目标正好相反。我们想要教给你的，是如何提出正确的问题。这些问题可能是你问自己的、问你的队友、用户、利益相关者——无论是什么。作为科技行业的专业人士，我们每个人都积累了大量的宝贵信息，但并不总是能够将这些信息串联起来。这就是及时提问有助于构建我们周围所有知识结构的地方。
- en: We’ve split the book into four main parts so that its structure is in line with
    the life cycle of any system—research, creation, improvement, and maintenance.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将本书分为四个主要部分，以便其结构与任何系统的生命周期保持一致——研究、创建、改进和维护。
- en: The first two parts are based on the early stages of machine learning system
    design. Throughout part 1, we’ll focus on the overall awareness and understanding
    of the problem your system needs to solve and define the steps needed before system
    development has started. This phase rarely involves writing code and mostly focuses
    on small prototypes or proofs of concepts. Part 2 delves into the technical details
    of the early-stage work. This stage requires a lot of reading and communicating,
    which is crucial for understanding a problem, defining a landscape for possible
    solutions, and aligning expectations with other project participants. If we compare
    an ML system to a human body, it’s about forming a skeleton.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 前两部分基于机器学习系统设计的早期阶段。在整个第一部分中，我们将关注你对系统需要解决的问题的整体意识和理解，并定义在系统开发开始之前所需的步骤。这个阶段很少涉及编写代码，主要关注小型原型或概念验证。第二部分深入探讨了早期工作的技术细节。这个阶段需要大量的阅读和沟通，这对于理解问题、定义可能的解决方案的范围以及与其他项目参与者协调期望至关重要。如果我们把一个机器学习系统比作人体，那么它就是形成骨骼的过程。
- en: 'The third part is focused on intermediate steps. In this stage of a system
    life cycle, the schedule of responsible engineers is usually flipped. There is
    much less research and communication and more hands-on work implementing and improving
    the system. Here we focus on questions such as how to make the system powerful
    in multiple dimensions: solid, accurate, and reliable. Continuing our human body
    metaphor, the system grows its muscles.'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 第三部分专注于中间步骤。在系统生命周期的这个阶段，负责工程师的时间表通常会被颠倒。在这个阶段，研究和沟通较少，而实际操作、实施和改进系统的工作更多。在这里，我们关注的问题是如何使系统在多个维度上变得强大：坚实、准确和可靠。继续使用人体比喻，系统正在增长肌肉。
- en: The final part is all about integration and growth. For an inexperienced observer,
    the system may seem ready to go, but this impression is tricky. There are multiple
    (engineering, mostly) aspects that need to be taken into account before the system
    goes live successfully. In the software world, a system failure is rarely a disaster
    like in civil engineering, but it’s still an unwanted scenario. So, at this stage,
    you will learn how to make your system reliable, maintainable, and future-proof.
    If you’re not tired of human body metaphors, this is where the system gets a mind
    and gains wisdom because untamed strength can lead to nothing but trouble.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 最后的部分全部关于整合和增长。对于一个没有经验的观察者来说，系统可能看起来已经准备就绪，但这种印象是复杂的。在系统成功上线之前，需要考虑多个（主要是工程方面）的方面。在软件领域，系统故障很少像土木工程那样是一场灾难，但它仍然是一个不受欢迎的场景。因此，在这个阶段，你将学习如何使你的系统可靠、可维护和面向未来。如果你不厌倦使用人体比喻，那么这就是系统获得思维和智慧的地方，因为不受控制的强大只会带来麻烦。
- en: Overall, the opening chapters will contain more general information, which is
    nonetheless crucial for framing the problem and sets the core fundamentals for
    building a well-functioning ML system. The further you go into the book, though,
    the more complex and in-depth the material becomes, providing you with practical
    examples and exercises. Starting from the very next chapter, we will introduce
    two fictional cases, radically different from one another, that we will carry
    through the whole book. Both will require an ML system to solve their problems,
    and both will evolve as you continue exploring.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 总体而言，开篇章节将包含更多一般性信息，尽管如此，这些信息对于界定问题和构建一个高效运行的机器学习系统的基础核心至关重要。然而，随着你深入阅读本书，内容将变得更加复杂和深入，为你提供实际案例和练习。从下一章开始，我们将介绍两个截然不同的虚构案例，我们将贯穿整本书来探讨它们。这两个案例都需要机器学习系统来解决问题，并且随着你继续探索，这两个案例也将不断演变。
- en: In every part of the book, we always prefer intuition over comprehensiveness.
    There are many aspects to building ML systems, and each one deserves a book of
    its own. However, we don’t plan on writing a separate book on data gathering and
    preparation, another one on feature engineering, and another one on metrics. Instead,
    we describe the top of the iceberg and review the landscape structure while supporting
    our thoughts and points with links to noteworthy papers so readers can both familiarize
    themselves with top-level examples and add their own specific knowledge to the
    provided framework. We also do not aim to explain details related to particular
    libraries or engines. We will mention notable examples in certain chapters, but
    they are only for illustrative purposes in favor of higher-level abstractions.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 在本书的每一部分，我们总是更倾向于直观性而不是全面性。构建机器学习系统有许多方面，每个方面都值得一本自己的书。然而，我们并不打算写一本关于数据收集和准备的书，另一本关于特征工程的书，还有一本关于指标的书。相反，我们描述冰山一角，并回顾景观结构，同时用指向值得注意论文的链接来支持我们的思想和观点，这样读者既可以熟悉高级示例，也可以将他们自己的特定知识添加到提供的框架中。我们也不旨在解释与特定库或引擎相关的细节。我们将在某些章节中提到值得注意的例子，但它们只是为了说明更高层次的抽象。
- en: 'Real systems are always more complicated than examples we see in blog posts,
    conference talks, and, of course, interviews. For all of these scenarios, people
    talk about high-level abstractions, but in reality, the devil is in the details.
    That’s why we believe getting some intuition on problem-solving is so important:
    a successful ML system designer should be able not only to recognize some recipe
    from the cookbook and reproduce it but also to adapt themselves for company-specific
    details that can flip the table sometimes.'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 实际系统总是比我们在博客文章、会议演讲和当然还有访谈中看到的例子要复杂得多。对于所有这些场景，人们都在谈论高级抽象，但在现实中，魔鬼藏在细节中。这就是为什么我们认为对问题解决有一些直观理解如此重要的原因：一个成功的机器学习系统设计师不仅应该能够从烹饪手册中识别出一些食谱并重现它，而且应该能够适应公司特定的细节，这些细节有时可能会颠覆一切。
- en: We hope this book will be useful for
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 我们希望这本书对以下人群有用：
- en: People preparing for an interview for an ML engineer/manager position
  id: totrans-89
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 准备面试机器学习工程师/经理职位的求职者
- en: Software engineers, engineering managers, and ML practitioners working with
    an existing complex system who want to either understand or improve it
  id: totrans-90
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 与现有复杂系统一起工作的软件工程师、工程经理和机器学习实践者，他们想要理解或改进它
- en: People who plan to design their own ML system or have designed one already and
    want to be sure they didn’t forget anything critical
  id: totrans-91
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 计划设计自己的机器学习系统或已经设计了一个系统并想要确保他们没有忘记任何关键内容的人
- en: Due to the philosophy described here, the book is not beginner-friendly. We
    expect our readers to be familiar with ML basics (e.g., you can understand an
    ML textbook for undergraduate students) and fluent in applied programming (e.g.,
    you’ve faced some real programming challenges outside the studying sandbox). Otherwise,
    this book is better read after studying basic material.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 由于这里描述的哲学，这本书并不适合初学者。我们期望我们的读者熟悉机器学习基础知识（例如，你可以理解一本本科生机器学习教科书），并且精通应用编程（例如，你在学习沙盒之外面临过一些真实的编程挑战）。否则，这本书最好在学习基本材料之后再阅读。
- en: 1.3 When principles of ML system design can be helpful
  id: totrans-93
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 1.3 机器学习系统设计原则何时有用
- en: As we said earlier, applying these principles is critical to build a system
    complex enough to have multiple failure modes. Ignoring them leads to high chances
    of delivering something with feet of clay—a system that may work right now but
    is not sustainable enough to survive a challenge from the dynamic environment
    of reality. The challenge can be purely technical (what if we face 10 times more
    data?), product-related (how do we adapt for changed user scenarios?), business-driven
    (what if the system is to be included into a third-party software stack after
    an acquisition?), legal (what if the government puts forward a new regulation
    on personal data management?), or anything else. Recent years have only proved
    we can’t foresee every possible risk.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 正如我们之前所说的，应用这些原则对于构建一个具有多种故障模式的复杂系统至关重要。忽视它们会导致有很大可能性交付一个有缺陷的系统——一个现在可能工作得很好，但不足以在现实世界的动态环境中生存下来的系统。挑战可能是纯粹的技术性的（如果我们面临10倍多的数据怎么办？），与产品相关的（我们如何适应变化后的用户场景？），由商业驱动的（如果系统在收购后要集成到第三方软件堆栈中怎么办？），法律方面的（如果政府提出关于个人数据管理的新规定怎么办？），或者任何其他方面。近年来只证明我们无法预见每一个可能的风险。
- en: 'Improving the system is even more important. As we’ll describe in more detail
    in the upcoming chapters, building systems from scratch is a relatively rare event.
    People outside the industry may think software engineers spend most of their time
    writing code, while in reality, as we all know, way more time is dedicated to
    *reading* code. The same goes for systems: much more effort is usually spent improving
    and maintaining existing systems (which requires an in-depth understanding of
    system internals), not building them from scratch.'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 改进系统甚至更重要。正如我们将在接下来的章节中更详细地描述的那样，从头开始构建系统是一个相对罕见的事件。行业外的人可能认为软件工程师大部分时间都在写代码，而实际上，正如我们所知，更多的时间是花在*阅读*代码上。对于系统也是如此：通常，更多的努力是花在改进和维护现有系统上（这需要深入了解系统内部），而不是从头开始构建。
- en: The difference between improving and maintaining is somewhat blurry. For the
    sake of clarity here, we define *improvements* as adding new functionality or
    changing existing functionality significantly and *maintenance* as keeping existing
    functionality working in a constantly changing environment (new customers, new
    datasets, infrastructure evolution, etc.).
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 改进和维护之间的区别有些模糊。为了清晰起见，我们在这里将*改进*定义为添加新功能或显著改变现有功能，而*维护*则是指在不断变化的环境中保持现有功能运行（新客户、新数据集、基础设施演变等）。
- en: Some principles included in the book are mostly focused on ML system improvement.
    They help identify weak spots and growth points of a system and even new applications
    sometimes.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 书中包含的一些原则主要关注机器学习系统改进。它们有助于识别系统的薄弱环节和增长点，有时甚至能发现新的应用。
- en: 'Finally, some principles are more oriented toward ML system maintenance. The
    sad truth is that very often systems are maintained by teams who didn’t participate
    in building them. So it’s a double-edged sword: the building team should keep
    some principles in mind to simplify the lives of their followers, and the maintenance
    team should understand the principles to be able to understand the whole system
    logic in a timely manner and find proper workarounds to keep the system alive
    over a long period of time.'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，一些原则更倾向于面向机器学习系统维护。一个令人悲伤的事实是，很多时候系统是由那些没有参与构建它们的团队来维护的。因此，这是一把双刃剑：构建团队应该牢记一些原则，以简化后继者的生活，而维护团队应该理解这些原则，以便能够及时理解整个系统逻辑，并找到适当的解决方案，以使系统能够长期运行。
- en: It is safe to say that close to 100% of ML projects that didn’t have a well-written
    design document have failed, whereas a sweeping majority of those systems that
    were thoroughly planned found success. Although it should not necessarily be a
    complex, multipage piece of documentation, and it is often enough to have several
    pages of condensed information, the design document, in this case, plays two major
    roles. Not only does it set proper priorities within a project, but it also helps
    explain whether you actually need this project in the first place and drags your
    gaze away from the core idea (you might be too focused on the project itself)
    to see the whole picture. Please see chapter 4 for details.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 可以说，近100%的没有良好设计文档的机器学习项目都失败了，而绝大多数经过充分规划的系统都取得了成功。虽然它不一定是复杂的多页文档，通常几页浓缩的信息就足够了，但在这个案例中，设计文档扮演了两个主要角色。它不仅在一个项目中设定了适当的优先级，还帮助解释你是否真正需要这个项目，并使你的注意力从核心想法（你可能过于专注于项目本身）转移到整体图景。请参阅第4章以获取详细信息。
- en: After working for multiple businesses, we can firmly say that once there’s structured
    documentation describing all aspects of your system functionality, any activity,
    from onboarding newly hired employees to applying core changes, is implemented
    many times faster. Instead of searching for the one and only loremaster who keeps
    all the knowledge to themselves (but still won’t guarantee precision), you can
    address a certain document in the library.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 在为多家企业工作后，我们可以肯定地说，一旦有了描述系统功能所有方面的结构化文档，任何活动，从入职新员工到应用核心变更，都可以实施得更快。你不必寻找那个唯一的知识大师，他把自己所有的知识都保留在自己手中（但仍然不能保证精确性），你可以在图书馆中找到特定的文档。
- en: Campfire story from Arseny
  id: totrans-101
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 来自阿列克谢的篝火故事
- en: 'A long time ago, I worked for a ride-hailing company. One of its ambitious
    projects was to build a system for ride fare estimates. The regular pricing model
    was exactly like the one old-school cabs used for charging passengers: fare =
    X * time + Y * distance. The company needed to estimate the fare before the actual
    ride happened to inform both the driver and the passenger.'
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 很久以前，我为一家打车公司工作。它的一个雄心勃勃的项目是建立一个用于打车费用估算的系统。常规定价模型与老式出租车用于向乘客收费的模型完全一样：费用 =
    X * 时间 + Y * 距离。公司在实际乘车发生之前需要估算费用，以便通知司机和乘客。
- en: The project seemed clear and straightforward from the very start. All we needed
    to do was to fit a simple model that used geo features from the map service and
    wrap it as a microservice. It seemed so simple I didn’t even think about writing
    a design document.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 项目一开始看起来就很清晰直接。我们所需做的只是拟合一个简单的模型，该模型使用来自地图服务的地理特征，并将其封装为微服务。这看起来如此简单，以至于我甚至没有考虑过写一个设计文档。
- en: '![sidebar figure](../Images/CH01_F02_Babushkin.png)'
  id: totrans-104
  prefs: []
  type: TYPE_IMG
  zh: '![侧边栏图片](../Images/CH01_F02_Babushkin.png)'
- en: 'How the system initially looked in Arseny’s imagination: a simple step-by-step
    algorithm'
  id: totrans-105
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 系统最初在阿列克谢想象中的样子：一个简单的逐步算法
- en: 'In reality, there were multiple pitfalls (we will cover most of them respectively
    in the following chapters):'
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 实际上，存在多个陷阱（我们将在以下章节中分别介绍大部分）：
- en: Geo features weren’t enough for precise estimation, and more complicated features
    required advanced infrastructure (aka *feature store*, although back in the day,
    this was not a popular wording or pattern). This will be covered in chapter 11\.
  id: totrans-107
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 地理特征不足以进行精确估计，更复杂的特征需要先进的基础设施（即*特征存储库*，尽管在当年，这并不是一个流行的词汇或模式）。这将在第11章中介绍。
- en: As the model became more sophisticated, its predictions became less reliable
    (a certain number of results would turn out to be outliers—values that were either
    too big or too small).
  id: totrans-108
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 随着模型变得更加复杂，其预测的可靠性降低（一定数量的结果最终会变成异常值——要么太大，要么太小）。
- en: Errors were not uniformly distributed, so the model was biased. We touch on
    this topic in chapter 9\.
  id: totrans-109
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 错误并非均匀分布，因此模型存在偏差。我们将在第9章中讨论这个话题。
- en: The executives wanted to override fare estimations sometimes with some promo
    activities or heuristics-based shortcuts. This subject is discussed in chapter
    13\.
  id: totrans-110
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 高管们有时想用一些促销活动或基于启发式算法的捷径来覆盖费用估算。这个话题将在第13章中讨论。
- en: Too much time was spent building a model that didn’t really solve the exact
    problem. We touch on this topic in chapter 2\.
  id: totrans-111
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 过多的时间被花在了构建一个实际上并没有解决确切问题的模型上。我们将在第2章中讨论这个话题。
- en: The whole problem was prone to distribution drift and thus required smart monitoring.
    We cover more of the subject in chapter 14\.
  id: totrans-112
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 整个问题容易受到分布漂移的影响，因此需要智能监控。我们将在第14章中更详细地介绍这个话题。
- en: The infrastructure was not ready for the scenario, which led to unacceptable
    latency in peak hours. This topic is covered in chapter 15\.
  id: totrans-113
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 基础设施没有准备好应对这种情况，导致高峰时段的延迟无法接受。这个话题将在第15章中介绍。
- en: Some other teams were not aware that the system was being developed, and it
    led to API mismatches. This topic is discussed in chapter 16.
  id: totrans-114
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一些其他团队并不知道系统正在开发中，这导致了API不匹配。这个话题将在第16章中讨论。
- en: '![sidebar figure](../Images/CH01_F03_Babushkin.png)'
  id: totrans-115
  prefs: []
  type: TYPE_IMG
  zh: '![侧边栏图片](../Images/CH01_F03_Babushkin.png)'
- en: How the system looked after several iterations
  id: totrans-116
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 系统在多次迭代后的样子
- en: 'The system was not deployed after all—before all the problems were fixed, the
    market situation changed significantly, and the need for the initial system faded.
    While the original idea for the system was great (some competitors used similar
    ideas), my colleagues and I failed to implement it in a proper way: some key aspects,
    both tech and product-related, were totally missed and were discovered only in
    the late stages of the project when the price of changes skyrocketed. At the same
    time, if some aspects had been taken into account at earlier stages, addressing
    them would have been trivial. If only I, my boss, or my teammates had read a book
    like this, we could have avoided this failure.'
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 最终系统并没有部署——在所有问题都得到解决之前，市场情况发生了显著变化，对初始系统的需求减弱。虽然系统最初的想法很棒（一些竞争对手使用了类似的想法），但我和我的同事们未能以适当的方式实施它：一些关键方面，无论是技术还是产品相关的，都被完全忽略了，直到项目后期才发现，这时改变的成本已经飙升。同时，如果一些方面在早期阶段就被考虑到，解决它们将变得微不足道。如果只有我、我的老板或我的队友读过这样一本书，我们本可以避免这次失败。
- en: Still, for every few stories of failures, there’s a story of success. The next
    story has less drama and might seem boring, but it’s worth sharing for the sake
    of balance. Back in the day, Valeriy used to work at the Russian tech giant Yandex,
    when it acquired a startup providing real-time recommendations. When mergers like
    this happen, it takes time to fine-tune cooperation between the existing and new
    units, onboard new staff, sync business processes, etc. In this case, however,
    he was amazed at how smoothly and seamlessly a new business was integrated into
    a massive corporation. The reason behind it was a well-built design document that
    made this transition possible.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，对于每几个失败的案例，总有一个成功的案例。接下来的故事可能没有太多戏剧性，看起来可能有些无聊，但为了平衡起见，分享它是值得的。回想起来，瓦列里曾经在一家人工智能巨头Yandex工作，当时它收购了一家提供实时推荐服务的初创公司。在这种情况下，当发生这样的合并时，需要时间来微调现有单位和新单位之间的合作，吸纳新员工，同步业务流程等。然而，在这种情况下，他惊讶地发现，一个新业务是如何如此顺利和无缝地融入一个大型企业的。背后的原因是有一个精心构建的设计文档，使得这种过渡成为可能。
- en: To summarize, we strongly believe that arranging a design document, preceded
    by asking your business the right guiding questions and setting up proper goals,
    is the key to success for your ML system—or a reason to cancel the project at
    the earliest stage, which is also a positive outcome, considering how much time,
    effort, and money you can save by dropping an unwanted activity. We’ll dedicate
    at least three chapters to this stage of the project, as this is the most crucial
    part you’ll have to deal with.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 总结来说，我们坚信，在正确引导问题的指导下安排设计文档，并设定适当的目标，是机器学习系统成功的关键——或者说是尽早取消项目的理由，这也是一个积极的成果，考虑到你可以通过取消一项不受欢迎的活动来节省多少时间、精力和金钱。我们将至少用三章的篇幅来探讨这个项目阶段，因为这是你必须应对的最关键的部分。
- en: Summary
  id: totrans-120
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 摘要
- en: While it’s a relatively new term, *ML system design* is based on the classic
    fundamentals of software development, incorporating the existing knowledge from
    related disciplines. In this book, we will try to reorganize this knowledge base
    into a set of working algorithms.
  id: totrans-121
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 虽然这是一个相对较新的术语，但*机器学习系统设计*基于软件开发的传统基础，结合了相关学科现有的知识。在这本书中，我们将尝试将这个知识库重新组织成一套工作算法。
- en: Whereas MLOps can be considered a set of tools for building and maintaining
    your ML system, think of ML system design as a framework that will weld the whole
    system together.
  id: totrans-122
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 虽然MLOps可以被视为构建和维护你的机器学习系统的一套工具，但将机器学习系统设计视为一个将整个系统焊接在一起的框架。
- en: To succeed in designing ML systems, it is crucial to be equally experienced
    in such disciplines as ML, software engineering, project management, product management,
    and leadership.
  id: totrans-123
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 要在机器学习系统设计中取得成功，至关重要的是在机器学习、软件工程、项目管理、产品管理和领导力等学科中拥有同等经验。
- en: Before designing an ML system, you should know what you are building, what the
    purpose of the system is, and how it should be built.
  id: totrans-124
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在设计一个机器学习系统之前，你应该清楚你正在构建什么，系统的目的是什么，以及它应该如何构建。
- en: The pillars of a successfully designed ML system are a consistent approach,
    a well-planned roadmap, and a list of preliminary actions that will organize your
    work and save time in the long term.
  id: totrans-125
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个成功设计的机器学习系统的支柱是一致的途径、周密的路线图以及一系列初步行动，这些行动将组织你的工作并在长期内节省时间。
