- en: 'Chapter 10\. MLOps in Practice: Marketing Recommendation Engines'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第10章 MLOps 实践：营销推荐引擎
- en: Makoto Miyazaki
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: Makoto Miyazaki
- en: Recommendation engines have become very popular in the last 20 years, from the
    first Amazon book recommendations to today’s generalized use in digital shops,
    advertisements, and music and video streaming. We have all become accustomed to
    them. However, throughout the years, the underlying technologies behind these
    recommendation engines have evolved.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 推荐引擎在过去20年里变得非常流行，从亚马逊的第一本书推荐到今天在数字商店、广告和音乐视频流媒体中的普遍应用。我们都已经习惯了它们。然而，多年来，这些推荐引擎背后的技术已经发展和演变。
- en: This chapter covers a use case that illustrates the adaption of and need for
    MLOps strategies given the particularities of a fast-paced and rapidly changing
    machine learning model life cycle.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 本章涵盖了一个使用案例，说明了在快节奏和快速变化的机器学习模型生命周期中，MLOps 策略的适应和需求。
- en: The Rise of Recommendation Engines
  id: totrans-4
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 推荐引擎的崛起
- en: Historically, marketing recommendations were human-built. Based on qualitative
    and quantitative marketing studies, marketing moguls would set up rules that statically
    defined the impression (in the sense of advertising views) sent to a customer
    with given characteristics. This technique gave rise to the [marketing data mining
    urban legend](https://oreil.ly/HDPpE) that a grocery chain discovered that men
    who bought diapers on Thursdays and Saturdays were more likely to buy beer as
    well and hence placing the two next to each other will increase beer sales.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 历史上，营销推荐是由人工构建的。基于定性和定量营销研究，营销大亨们会制定静态定义印象（即广告展示视图）的规则，发送给具有特定特征的顾客。这种技术催生了[营销数据挖掘的都市传说](https://oreil.ly/HDPpE)，即一家杂货连锁店发现，周四和周六购买尿布的男性更有可能购买啤酒，因此将这两种商品摆放在一起将增加啤酒的销量。
- en: 'Overall, recommendation engines created manually presented numerous bottlenecks
    that resulted in a significant amount of wasted money: it was hard to build rules
    based on many different customer features because the rule creation process was
    manual, it was hard to set up experiments to test many different kinds of impressions,
    and it was hard to update the rules when the behavior of the customers changed.'
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 总体而言，手动创建的推荐引擎呈现了许多瓶颈，导致大量资金浪费：由于规则创建过程是手动的，很难基于许多不同的顾客特征制定规则；很难设置实验来测试多种不同的印象；当顾客行为发生变化时，更新规则也很困难。
- en: The Role of Machine Learning
  id: totrans-7
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 机器学习的角色
- en: The rise of ML has brought a new paradigm to recommendation engines, allowing
    for the elimination of rules based on human insight. A new class of algorithm
    called *collaborative filtering* dominates the field. This algorithm is able to
    analyze customer and purchase data with millions of customers and tens of thousands
    of products to perform recommendations without any prior marketing knowledge.
    By identifying efficiently what customers that look like the current customer
    bought, marketers can rely on automatic strategies that outperform traditional
    ones both in cost and efficiency.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 机器学习的兴起为推荐引擎带来了新的范式，允许消除基于人类洞察力的规则。一种称为*协同过滤*的新类算法主导了这一领域。这种算法能够分析数以百万计的顾客和成千上万种产品的购买数据，进行推荐，而无需任何先前的营销知识。通过有效地识别像当前顾客购买过的顾客，营销人员可以依赖于优于传统方法的自动化策略，无论是在成本还是效率上。
- en: Because the process of building strategies is automatic, it is possible to update
    them regularly and to compare them using A/B testing or shadow scoring schemes
    (including the way to choose the impression among all possibilities). Note that
    these algorithms may be combined with more classical business rules for various
    reasons—e.g., avoiding the filtering bubble, not selling a product in a given
    geographical area, or preventing the use of a specific association that is statistically
    meaningful but unethical to use (like proposing alcohol to a recovering alcoholic),
    to name a few.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 由于策略构建的自动化过程，可以定期更新它们，并使用A/B测试或影子评分方案进行比较（包括在所有可能性中选择印象的方式）。请注意，这些算法可以与更经典的业务规则结合使用，出于各种原因——例如，避免过滤泡泡，在特定地理区域内不销售产品，或防止使用某些统计上显著但不道德的关联（比如向戒酒者推荐酒精制品），等等。
- en: Push or Pull?
  id: totrans-10
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 推送还是拉动？
- en: When implementing a recommendation engine, it is important to keep in mind that
    its structure will depend on whether the recommendations are pushed or pulled.
    Push channels are the easiest to handle; for example, they can consist of sending
    emails or making outbound calls.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 在实施推荐引擎时，重要的是要记住其结构将取决于推送或拉取推荐。推送通道最易处理；例如，可以包括发送电子邮件或进行外呼。
- en: The recommendation engine can be run on a regular basis in batch mode (typically
    between once a day and once a month), and it is easy to split the customer dataset
    into several parts to perform analysis within a sound experimental design. The
    regularity of the process allows for regular review and optimization of the strategy.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 推荐引擎可以定期以批处理模式运行（通常是每天一次到每月一次），并且可以轻松地将客户数据集分成几部分，以在健全的实验设计中进行分析。该过程的规律性允许定期审查和优化策略。
- en: Pull channels are often more effective because they provide information to customers
    when they need it—for example, when doing an online search or when calling a customer
    service line. Specific information from the session can be used (e.g., what the
    user has searched for) to precisely tailor the recommendation. Music streaming
    platforms, for instance, provide pull-channel recommendations for playlists.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 拉取通道通常更有效，因为它们在客户需要时提供信息，例如在线搜索或打电话给客服。可以利用会话中的具体信息（例如用户搜索了什么）来精确地定制推荐。例如，音乐流媒体平台为播放列表提供了拉取通道推荐。
- en: Recommendations can be prebaked, as illustrated in the in-depth example in this
    chapter, or made in real time. In the latter case, a special architecture has
    to be set up to compute recommendations on the fly.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 推荐可以预先计算，就像本章的深入示例中所说明的那样，也可以实时生成。在后一种情况下，必须设置特殊的架构来动态计算推荐。
- en: Comparing strategies in a pull context is more challenging. First, the customers
    who call in on a given channel are likely to differ from the average customer.
    In simple cases, it is possible to randomly choose the strategy to use for each
    recommendation, but it also happens that the strategy needs to be used consistently
    over a given period for a given customer. This usually results in an unbalanced
    proportion of recommendations made with each strategy, which makes the statistical
    treatment to decide which one is the best more complex. However, once a good framework
    is set, this allows a very quick improvement cycle, as many strategies can be
    tested in real time.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 在拉取上下文中比较策略更具挑战性。首先，在给定渠道上打进电话的客户可能与普通客户不同。在简单情况下，可以随机选择每个推荐所使用的策略，但也可能需要在给定客户的特定期间内一致使用某种策略。这通常导致使用每种策略生成的推荐比例不平衡，这使得决定哪种策略最好的统计处理更复杂。然而，一旦建立了良好的框架，这允许非常快速的改进周期，因为可以实时测试许多策略。
- en: Data Preparation
  id: totrans-16
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 数据准备
- en: 'The customer data that is usually accessible to a recommendation engine is
    composed of the following:'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 推荐引擎通常可以访问的客户数据包括以下内容：
- en: Structural information about the customer (e.g., age, gender, location)
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 关于客户的结构信息（例如年龄、性别、地点）
- en: Information about historical activities (e.g., past views, purchases, searches)
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 关于历史活动的信息（例如，过去的浏览、购买、搜索）
- en: Current context (e.g., current search, viewed product)
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 当前上下文（例如当前搜索、浏览的产品）
- en: 'Whatever the technique used, all customer information has to be aggregated
    into a vector (a list of fixed size) of characteristics. For example, from the
    historical activities, the following characteristics could be extracted:'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 无论使用何种技术，所有客户信息都必须聚合为特征向量（固定大小的列表）。例如，可以从历史活动中提取以下特征：
- en: Amount of purchases during the last week or the last month
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在最近一周或一个月内的购买金额
- en: Number of views during past periods
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在过去一段时间内的浏览次数
- en: Increase in spending or in views during the last month
  id: totrans-24
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在过去一个月内支出或浏览量的增加
- en: Previously seen impressions and customer’s response
  id: totrans-25
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 先前看到的印象和客户的响应
- en: In addition to customer data, the recommendation context can also be taken into
    account. For example, days to summer for seasonal products like above-ground swimming
    pools or days to monthly pay day, as some customers delay purchases for cash flow
    reasons.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 除了客户数据外，推荐的上下文还可以考虑。例如，对于季节性产品如地面游泳池，可以考虑到夏季的天数，或者到每月发薪日的天数，因为一些客户会因现金流问题延迟购买。
- en: Once the customer and context data is formatted, it is important to define the
    set of possible recommendations, and there are many choices to make. The same
    product may be presented with different offers, which may be communicated in different
    ways.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦客户和上下文数据格式化完成，定义一组可能的推荐内容是非常重要的，而且有很多选择要做。同一产品可能以不同的方式呈现，可以用不同的方式进行传播。
- en: It is of the utmost importance not to forget the “do not recommend anything”
    option. Indeed, most of us have the personal experience that not all recommendations
    have a positive impact. Sometimes not showing anything might be better than the
    alternatives. It’s also important to consider that some customers may not be entitled
    to see certain recommendations, for example depending on their geographical origin.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 必须铭记“不推荐任何内容”选项的重要性。事实上，我们大多数人都有这样的个人经历，不是所有的推荐都有积极的影响。有时，不显示任何内容可能比其他选择更好。还要考虑到，某些客户可能没有资格看到某些推荐内容，例如取决于其地理来源。
- en: Design and Manage Experiments
  id: totrans-29
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 设计和管理实验
- en: To leverage the continuous improvement potential of recommendation engines,
    it is necessary to experiment with different strategies within a sound framework.
    When designing a prediction model for a recommendation engine, the data scientist
    might well focus on a simple strategy, such as predicting the probability that
    a given customer clicks on a given recommendation.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 为了利用推荐引擎的持续改进潜力，有必要在一个健全的框架内尝试不同的策略。在设计推荐引擎的预测模型时，数据科学家可能会专注于一种简单的策略，如预测给定客户点击给定推荐的概率。
- en: This may seem a reasonable compromise compared to the more precise approach
    of trying to gather information about whether the customer purchased the product
    and whether to attribute this purchase to a given recommendation. However, this
    is not adequate from a business perspective, as phenomena like cannibalization
    may occur (i.e., by showing a low-margin product to a customer, one might prevent
    them from buying a high-margin product). As a result, even if the predictions
    were good and resulted in increased sales volume, the overall revenue might be
    reduced.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 与尝试收集关于客户是否购买产品及是否将此次购买归因于某个推荐的更精确方法相比，这可能看起来是一个合理的妥协。然而，从商业角度来看，这并不足够，因为可能会发生像自相残杀这样的现象（即通过向客户展示低毛利产品，可能会阻止其购买高毛利产品）。因此，即使预测准确且导致销售量增加，总体收入可能会减少。
- en: On the other hand, bluntly promoting the organization’s interest and not the
    customer’s could also have detrimental long-term consequences. The overarching
    KPI that is used to assess if a given strategy yields better results should be
    carefully chosen, together with the time period over which it is evaluated. Choosing
    the revenue over a two-week period after the recommendation as the main KPI is
    common practice.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 另一方面，直接推广组织的利益而不是客户的利益，长期来看也可能带来不利后果。应谨慎选择用于评估特定战略是否带来更好结果的最重要KPI，以及评估的时间段。选择推荐后两周内的收入作为主要KPI是常见做法。
- en: 'To be as close as possible to an experimental setting, also called A/B testing,
    the control group and the experimental groups have to be carefully chosen. Ideally,
    the groups are defined before the start of the experiment by randomly splitting
    the customer base. If possible, customers should not have been involved in another
    experimentation recently so that their historical data is not polluted by its
    impact. However, this may not be possible in a pull setting in which many new
    customers are coming in. In this case, the assignment could be decided on the
    fly. The size of the groups as well as the duration of the experiments depend
    on the expected magnitude of the KPI difference between the two groups: the larger
    the expected effect, the smaller the group size and the shorter the duration.'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 为了尽可能接近实验设置，也称为A/B测试，必须仔细选择对照组和实验组。理想情况下，在实验开始前通过随机分割客户群体来定义这些组。如果可能，客户最近不应参与其他实验，以免其历史数据受到其影响的污染。然而，在许多新客户涌入的情况下，这可能不可行。在这种情况下，分组分配可以动态决定。组的大小以及实验的持续时间取决于预期的KPI差异的大小：预期效果越大，组大小越小，实验持续时间越短。
- en: 'The experimentation could also be done in two steps: in the first one, two
    groups of equal but limited size could be selected. If the experimentation is
    positive, the deployment could start with 10% on the new strategy, a proportion
    that can be raised progressively if results are in line with expectations.'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 实验也可以分两步进行：首先，在第一步中，可以选择两组相等但有限的规模。如果实验结果积极，可以从新策略上开始部署10%的比例，这一比例可以逐步提高，如果结果符合预期的话。
- en: Model Training and Deployment
  id: totrans-35
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 模型训练和部署
- en: To better illustrate the MLOps process for this type of use case, the following
    sections focus on the specific example of a hypothetical company deploying an
    automated pipeline to train and deploy recommendation engines. The company is
    a global software company (let’s call it MarketCloud) headquartered in Silicon
    Valley.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 为了更好地说明针对这种用例的 MLOps 过程，以下几节重点介绍一个假想公司部署自动化流水线来训练和部署推荐引擎的具体示例。该公司是一家全球软件公司（我们称之为
    MarketCloud），总部位于硅谷。
- en: One of MarketCloud’s products is a software-as-a-service (SaaS) platform called
    SalesCore. SalesCore is a B2B product that allows its users (businesses) to drive
    sales to customers in a simple manner by keeping track of deals, clearing tedious
    administration tasks off their desks, and creating customized product offers for
    each customer (see [Figure 10-1](#mock_up_of_the_salescore_platformcomma)).
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: MarketCloud 的产品之一是一个名为 SalesCore 的软件即服务（SaaS）平台。SalesCore 是一款面向企业的B2B产品，允许用户（企业）通过跟踪交易、清理繁琐的行政任务，并为每个客户创建定制产品报价来简单地推动销售（见[图10-1](#mock_up_of_the_salescore_platformcomma)）。
- en: From time to time, MarketCloud’s clients use the cloud-based SalesCore while
    on a call with their customers, adjusting their sales strategy by looking at past
    interactions with the customers as well as at the product offers and discounts
    suggested by SalesCore.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 有时，MarketCloud 的客户在与客户通话时使用基于云的 SalesCore，通过查看与客户的过去互动以及由 SalesCore 建议的产品报价和折扣，调整其销售策略。
- en: MarketCloud is a mid-sized company with an annual revenue of around $200 million
    and a few thousand employees. From salespeople at a brewing company to those in
    a telecommunication entity, MarketCloud’s clients represent a range of businesses.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: MarketCloud 是一家年收入约2亿美元、员工数以千计的中型公司。从酿酒公司的销售人员到电信实体的人员，MarketCloud 的客户代表了各种类型的企业。
- en: '![](assets/imlo_1001.png)'
  id: totrans-40
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/imlo_1001.png)'
- en: Figure 10-1\. Mock-up of the SalesCore platform, the basis of the theoretical
    company on which this section’s example is based
  id: totrans-41
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图10-1\. SalesCore 平台的示意图，本节示例的理论公司的基础
- en: MarketCloud would like to automatically display product suggestions on SalesCore
    to the salespeople trying to sell products to the customers. Suggestions would
    be made based on customers’ information and their past interaction records with
    the salesperson; suggestions would therefore be customized for each customer.
    In other words, SalesCore is based on a recommendation engine used in a pull (inbound
    calls) or push (outbound calls) context. Salespeople would be able to incorporate
    in their sales strategy the suggested products while on a call with their customers.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: MarketCloud 希望能够自动向 SalesCore 的销售人员显示产品建议，以帮助他们向客户销售产品。建议将基于客户的信息以及他们与销售人员的过去互动记录进行，因此每个客户的建议将是定制的。换句话说，SalesCore
    基于推荐引擎，在拉（入站电话）或推（出站电话）的情境中使用。销售人员可以在与客户通话时将建议产品纳入其销售策略中。
- en: To implement this idea, MarketCloud needs to build a recommendation engine and
    embed it into SalesCore’s platform, which, from a model training and deployment
    standpoint, presents several challenges. We’ll present these challenges in this
    section, and in the next section we’ll show MLOps strategies that allow the company
    to handle each of them.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 为了实现这一想法，MarketCloud 需要构建一个推荐引擎并将其嵌入到 SalesCore 平台中，从模型训练和部署的角度来看，这提出了几个挑战。我们将在本节中介绍这些挑战，而在下一节中，我们将展示
    MLOps 策略，使公司能够处理每一个挑战。
- en: Scalability and Customizability
  id: totrans-44
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 可扩展性和可定制性
- en: MarketCloud’s business model (selling software for client companies to help
    them sell their own products) presents an interesting situation. Each client company
    has its own dataset, mainly about its products and customers, and it doesn’t wish
    to share the data with other companies.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: MarketCloud 的商业模式（为客户公司销售软件，帮助它们销售自己的产品）呈现了一个有趣的情况。每家客户公司都有自己的数据集，主要是关于其产品和客户，而且不希望与其他公司共享这些数据。
- en: If MarketCloud has around four thousand clients using SalesCore, that means
    instead of having a universal recommender system for all the clients, it would
    need to create four thousand different systems. MarketCloud needs to come up with
    a way to build four thousand recommendation systems as efficiently as possible
    since there is no way it can handcraft that many systems one by one.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 如果 MarketCloud 有大约四千个客户在使用 SalesCore，这意味着与为所有客户创建一个通用的推荐系统相比，它需要创建四千个不同的系统。MarketCloud
    需要想出一种方法，以尽可能高效的方式建立四千个推荐系统，因为无法一一手工制作那么多系统。
- en: Monitoring and Retraining Strategy
  id: totrans-47
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 监控和重新训练策略
- en: Each of the four thousand recommendation engines would be trained on the customer
    data of the corresponding client. Therefore, each of them would be a different
    model, yielding a different performance result and making it nearly impossible
    for the company to manually keep an eye on all four thousand. For example, the
    recommendation engine for client A in the beverage industry might consistently
    give good product suggestions, while the engine for client B in the telecommunication
    sector might seldom provide good suggestions. MarketCloud needed to come up with
    a way to automate the monitoring and the subsequent model retraining strategy
    in case the performance degraded.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 四千个推荐引擎中的每一个都将根据相应客户的客户数据进行训练。因此，它们中的每一个都将是一个不同的模型，产生不同的性能结果，并且几乎不可能手动监控所有四千个。例如，饮料行业客户A的推荐引擎可能会持续给出良好的产品建议，而电信行业客户B的引擎则很少提供良好的建议。MarketCloud
    需要想出一种方法，自动化监控和随后的模型重新训练策略，以防性能下降。
- en: Real-Time Scoring
  id: totrans-49
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 实时评分
- en: In many situations, MarketCloud’s clients use SalesCore when they are talking
    to their customers on the phone. The sales negotiation evolves every single minute
    during the call, and the salesperson needs to adjust the strategy during the interaction
    with the customer, so the recommendation engine has to be responsive to real-time
    requests.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 在许多情况下，MarketCloud 的客户在电话沟通时使用 SalesCore。销售谈判在通话期间每一分钟都在发展，销售人员需要在与客户互动过程中调整策略，因此推荐引擎必须能够响应实时请求。
- en: For example, imagine you as a salesperson are on a call with your customer to
    sell telecommunication devices. The customer tells you what his office looks like,
    the existing infrastructure at the office such as an optic fiber, the type of
    WiFi network, and so forth. Upon entering this information in SalesCore, you want
    the platform to give you a suggestion for the products that your customer could
    feasibly purchase. This response from the platform needs to be in real time, not
    10 minutes later, after the call, or on the following day.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，想象一下你作为销售人员与客户通话，以销售电信设备为例。客户告诉您他的办公室的情况，办公室现有的基础设施，比如光纤、WiFi网络类型等等。在 SalesCore
    中输入这些信息后，您希望平台能即时为您推荐客户可能购买的产品。平台的响应需要是实时的，而不是在通话结束后10分钟后或第二天。
- en: Ability to Turn Recommendations On and Off
  id: totrans-52
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 可以打开和关闭推荐功能
- en: Responsible AI principles acknowledge that retaining human involvement is important.
    This can be done through a human-in-command design,^([1](ch10.html#ch01fn8)) by
    which it should be possible *not* to use the AI. In addition, adoption is likely
    to be low if users cannot override AI recommendations. Some clients value using
    their own intuition about which products to recommend to their customers. For
    this reason, MarketCloud wants to give its clients full control to turn the recommendation
    engine on and off so that the clients can use the recommendations when they want.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 负责任的AI原则承认保留人类参与的重要性。这可以通过人类在命令设计中实现，^([1](ch10.html#ch01fn8))即应该有可能*不*使用AI。此外，如果用户不能覆盖AI建议，采用可能会很低。一些客户重视使用他们自己的直觉来推荐产品给他们的客户。因此，MarketCloud
    希望为其客户提供完全控制权，可以随时打开和关闭推荐引擎，以便客户在需要时使用推荐。
- en: Pipeline Structure and Deployment Strategy
  id: totrans-54
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 管道结构和部署策略
- en: To efficiently build four thousand recommendation engines, MarketCloud decided
    to make one data pipeline as a prototype and duplicate it four thousand times.
    This prototype pipeline consists of the necessary data preprocessing steps and
    a single recommendation engine, built on an example dataset. The algorithms used
    in the recommendation engines will be the same across all four thousand pipelines,
    but they will be trained with the specific data associated with each client (see
    [Figure 10-2](#image_of_data_pipeline_structure_for_ma)).
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 为了高效构建四千个推荐引擎，MarketCloud 决定创建一个数据流水线原型，并将其复制四千次。这个原型流水线包括必要的数据预处理步骤和一个单一的推荐引擎，建立在示例数据集上。所有四千个流水线中使用的推荐引擎算法是相同的，但它们将根据每个客户的特定数据进行训练（见
    [图 10-2](#image_of_data_pipeline_structure_for_ma)）。
- en: '![](assets/imlo_1002.png)'
  id: totrans-56
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/imlo_1002.png)'
- en: Figure 10-2\. Image of data pipeline structure for MarketCloud’s recommendation
    engine project
  id: totrans-57
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 10-2\. MarketCloud 推荐引擎项目的数据流水线结构图像
- en: In this way, MarketCloud can efficiently launch four thousand recommendation
    systems. The users will still retain some room for customization, because the
    engine is trained with their own data, and each algorithm will work with different
    parameters—i.e., it’s adopted to the customer and product information of each
    client.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 这样一来，MarketCloud 可以高效地启动四千个推荐系统。用户仍然保留一定的定制空间，因为引擎是使用他们自己的数据训练的，每个算法将使用不同的参数——即适应每个客户和产品信息。
- en: What makes it possible to scale up a single pipeline to four thousand pipelines
    is the universal schema of the dataset. If a dataset from client A has 100 columns
    whereas client B has 50, or if the column “number of purchased items” from client
    A is an integer whereas the same column from client B is a string, they would
    need to go through different preprocessing pipelines.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 能够将单一流水线扩展为四千个流水线的关键在于数据集的通用模式。如果客户 A 的数据集有 100 列，而客户 B 只有 50 列，或者客户 A 的“购买商品数量”列是整数，而客户
    B 的同一列是字符串，它们需要经过不同的预处理流水线。
- en: Although each client has different customer and product data, at the point that
    this data is registered on SalesCore, it acquires the same number of columns and
    the same data types for each column. This makes things easier, as MarketCloud
    simply needs to copy a single pipeline four thousand times.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管每个客户具有不同的客户和产品数据，但在这些数据被注册到 SalesCore 时，每列获得相同的列数和相同的数据类型。这简化了事务，因为 MarketCloud
    只需复制一条流水线四千次。
- en: Each recommendation system embedded in the four thousand pipelines will have
    different API endpoints. On the surface, it looks like when a user clicks the
    “show product recommendations” button, SalesCore displays a list of suggested
    products. But in the background, what is happening is that by clicking the button,
    the user is hitting the specific API endpoint associated with the ranked product
    lists for the specific customer.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 嵌入在四千个流水线中的每个推荐系统将具有不同的 API 终点。表面上看，当用户点击“显示产品推荐”按钮时，SalesCore 显示建议产品列表。但实际上，通过点击按钮，用户是触发了与特定客户的排名产品列表相关联的特定
    API 终点。
- en: Monitoring and Feedback
  id: totrans-62
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 监控与反馈
- en: Maintaining four thousand recommendation systems is not an easy task, and while
    there have already been many MLOps considerations until this point, this is maybe
    the most complex part. Each system’s performance needs to be monitored and updated
    as needed. To implement this monitoring strategy at a large scale, MarketCloud
    can automate the scenario for retraining and updating the models.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 维护四千个推荐系统并非易事，虽然在此之前已经考虑了许多 MLOps 问题，但这可能是最复杂的部分。每个系统的性能需要根据需要进行监控和更新。为了在大规模上实施这一监控策略，MarketCloud
    可以自动化重新训练和更新模型的情景。
- en: Retraining Models
  id: totrans-64
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 重新训练模型
- en: Clients obtain  new customers, some of the customers churn, every once in a
    while new products are added to or dropped from their catalogs; the bottom line
    is that customer and product data are constantly changing, and recommendation
    systems have to reflect the latest data. It’s the only way they can maintain the
    quality of the recommendation, and, more importantly, avoid a situation such as
    recommending a WiFi router that is outdated and no longer supported.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 客户获取新客户，一些客户流失，每隔一段时间就会向其目录添加新产品或删除产品；底线是客户和产品数据不断变化，推荐系统必须反映最新数据。这是它们保持推荐质量的唯一方式，更重要的是，避免出现推荐过时且不再支持的
    WiFi 路由器等情况。
- en: To reflect the latest data, the team could program a scenario to automatically
    update the database with the newest customer and product data, retraining the
    model with the latest datasets every day at midnight. This automation scenario
    could then be implemented in all four thousand data pipelines.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 为了反映最新的数据，团队可以编写一个方案自动更新数据库，使用最新的客户和产品数据，每天午夜重新训练模型。这种自动化方案然后可以在所有四千个数据管道中实施。
- en: The retraining frequency can differ depending on the use case. Thanks to the
    high degree of automation, retraining every night in this case is possible. In
    other contexts, retraining could be triggered by various signals (e.g., signification
    volume of new information or drift in customer behavior, be it aperiodic or seasonal).
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 重新训练的频率可以根据使用情况而有所不同。在这种情况下，由于高度自动化，每晚重新训练是可能的。在其他情境中，重新训练可能会受到各种信号的触发（例如新信息的显著量或客户行为的漂移，无论是非周期性的还是季节性的）。
- en: In addition, the delay between the recommendation and the point in time at which
    its effect is evaluated has to be taken into account. If the impact is only known
    with a delay of several months, it is unlikely that retraining every day is adequate.
    Indeed, if the behavior changes so fast that retraining it every day is needed,
    it is likely that the model is completely outdated when it is used to make recommendations
    several months after the most recent ones in the training data.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，必须考虑推荐与其效果评估的时间间隔。如果仅在几个月后才知道影响，每天重新训练显然是不够的。事实上，如果行为变化如此迅速，每天重新训练是必要的，那么在训练数据中最新数据几个月后使用模型做推荐时，模型很可能已经完全过时。
- en: Updating Models
  id: totrans-69
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 更新模型
- en: Updating models is also one of the key features of automation strategies at
    scale. In this case, for each of the four thousand pipelines, retrained models
    must be compared to the existing models. Their performances can be compared using
    metrics such as RMSE (root-mean-square error), and only when the performance of
    the retrained model beats the prior one does the retrained model get deployed
    to SalesCore.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 更新模型也是规模化自动化策略的关键特性之一。在这种情况下，对于四千条管道中的每一条，重新训练的模型必须与现有模型进行比较。可以使用诸如 RMSE（均方根误差）之类的指标比较它们的性能，只有当重新训练的模型的性能优于先前的模型时，重新训练的模型才会被部署到
    SalesCore。
- en: Runs Overnight, Sleeps During Daytime
  id: totrans-71
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 晚间运行，白天休眠
- en: Although the model is retrained every day, users do not interact directly with
    the model. Using the updated model, the platform actually finishes calculating
    the ranked list of products for all the customers during the night. On the following
    day, when a user hits the “show product recommendations” button, the platform
    simply looks at the customer ID and returns the ranked list of products for the
    specific customer.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管模型每天重新训练，用户并不直接与模型互动。使用更新后的模型，平台实际上在夜间完成为所有客户计算产品排名列表。在第二天，当用户点击“显示产品推荐”按钮时，平台只需查看客户
    ID，并返回特定客户的产品排名列表。
- en: To the user, it looks as if the recommendation engine is running in real time.
    In reality, however, everything is already prepared overnight, and the engine
    is sleeping during daytime. This makes it possible to get the recommendation instantly
    without any downtime.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 对用户来说，推荐引擎看起来是实时运行的。然而实际上，一切都是在夜间准备好的，白天引擎处于休眠状态。这样可以实现即时推荐，没有任何停机时间。
- en: Option to Manually Control Models
  id: totrans-74
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 手动控制模型的选项
- en: 'Although the monitoring, retraining, and updating of the models is fully automated,
    MarketCloud still leaves room for its clients to turn the models on and off. More
    precisely, MarketCloud allows the users to choose from three options to interact
    with the models:'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管模型的监控、重新训练和更新是完全自动化的，MarketCloud 仍然为其客户留有关闭和打开模型的空间。更确切地说，MarketCloud 允许用户从三个选项中选择与模型互动的方式：
- en: Turn on to get the recommendation based on the most updated dataset
  id: totrans-76
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 打开以基于最新数据集获取推荐
- en: Freeze to stop retraining with the new data, but keep using the same model
  id: totrans-77
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 冻结以停止使用新数据进行重新训练，但继续使用相同的模型
- en: Turn off to completely stop using the recommendation functionality of SalesCore
  id: totrans-78
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 关闭以完全停止使用 SalesCore 的推荐功能
- en: Machine learning algorithms attempt to convert practical knowledge into meaningful
    algorithms to automate processing tasks. However, it is still good practice to
    leave room for users to rely on their domain knowledge, as they are presumed to
    be far more capable of identifying, articulating, and demonstrating day-to-day
    process problems in business.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 机器学习算法试图将实际知识转化为有意义的算法，以自动化处理任务。然而，让用户依赖他们的领域知识仍然是良好的实践，因为他们被认为能够更好地识别、表达和展示日常业务过程中的问题。
- en: The second option is important because it allows users to stay in the current
    quality of the recommendation without having the recommendation engines updated
    with the newer data. Whether the current model is replaced with a retrained one
    depends on the mathematical evaluation based on metrics such as the RMSE. However,
    if users feel that the product recommendations on SalesCore are already working
    well for pushing sales, they have the choice not to risk changing the recommendation
    quality.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 第二个选项很重要，因为它允许用户保持当前推荐的质量，而无需推荐引擎使用更新的数据。当前模型是否被重新训练取决于基于诸如RMSE之类的度量标准的数学评估。然而，如果用户觉得SalesCore上的产品推荐已经有效促进销售，他们可以选择不冒险改变推荐质量。
- en: Option to Automatically Control Models
  id: totrans-81
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 自动控制模型的选项
- en: For those that don’t want to manually handle the models, the platform could
    also propose A/B testing so that the impact of new versions is tested before fully
    switching to them. Multi-armed bandit algorithms (an algorithm that allows for
    maximization of the revenue of a user facing multiple slot machines, each with
    a different probability to win and a different proportion of the money given back
    on average) are used for this purpose.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 对于那些不想手动处理模型的人，平台也可以提出A/B测试，以便在完全切换之前测试新版本的影响。多臂赌博算法（一种允许最大化用户面对多个老虎机的收入的算法，每个老虎机的赢取概率和平均返还的钱的比例都不同）用于此目的。
- en: 'Let’s assume that several model versions are available. The goal is to use
    the most efficient one, but to do that, the algorithm obviously has to first learn
    which is the most efficient. Therefore, it balances these two objectives: sometimes,
    it tries algorithms that may not be the most efficient to learn if they are efficient
    (exploration), and sometimes it uses the version that is likely to be the most
    efficient to maximize the revenue (exploitation). In addition, it forgets past
    information, as the algorithm knows the most efficient today may not be the most
    efficient tomorrow.'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 假设有多个模型版本可用。目标是使用最有效的一个，但要做到这一点，算法显然必须首先学习哪个是最有效的。因此，它平衡这两个目标：有时它尝试可能不是最有效的算法来学习它们是否有效（探索），有时它使用可能是最有效的版本来最大化收入（利用）。此外，它会忘记过去的信息，因为算法知道今天最有效的可能明天就不是最有效的了。
- en: The most advanced option consists in training different models for different
    KPIs (click, buy, expected revenue, etc.). A method inspired from ensemble models
    would then allow for the solving of conflicts between models.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 最先进的选项是为不同的KPI（点击、购买、预期收入等）训练不同的模型。然后，受集成模型启发的方法将允许解决模型之间的冲突。
- en: Monitoring Performance
  id: totrans-85
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 性能监控
- en: When a salesperson suggests a customer buy the products recommended by SalesCore,
    the interaction of the customer with the recommended products as well as whether
    the customer bought them or not is recorded. This record can then be used to keep
    track of the performance of the recommender system, overwriting the customer and
    product dataset with this record to feed the most updated information to the model
    when it is retrained.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 当销售人员建议客户购买SalesCore推荐的产品时，记录客户与推荐产品的互动以及客户是否购买了这些产品。然后可以使用这些记录来跟踪推荐系统的性能，将这些记录覆盖客户和产品数据集，以在重新训练模型时提供最新的信息。
- en: Thanks to this ground truth recording process, dashboards showing model performance
    can be presented to the user, including performance comparison from A/B testing.
    Because the ground truth is obtained quickly, data drift monitoring is secondary.
    A version of the model is trained every night, but, thanks to the freeze mechanism,
    the user can choose the active version based on the quantitative information.
    It is customary to keep the human in the loop on these high-impact decisions where
    the performance metrics have a hard time capturing the full context around the
    decision.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 由于这种地面真实记录过程，可以向用户展示显示模型性能的仪表板，包括来自A/B测试的性能比较。由于地面真实很快就可以获得，数据漂移监控是次要的。模型的一个版本每晚训练一次，但由于冻结机制，用户可以根据定量信息选择活跃版本。在这些性能指标难以捕捉决策背后完整背景的高影响决策中，保持人类参与是惯例。
- en: In the case of A/B testing, it is important that only one experiment be done
    at a time on a group of customers; the impact of combined strategies cannot be
    simply added. With such considerations in mind, it is possible to build a sound
    baseline to perform a counterfactual analysis and derive the increased revenue
    and/or the decreased churn linked to a new strategy.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 在A/B测试的情况下，重要的是一次只对一组客户进行一个实验；无法简单地加总组合策略的影响。考虑到这些因素，可以建立一个坚实的基线来进行反事实分析，并推导出与新策略相关的增加收入和/或减少流失。
- en: Apart from this, MarketCloud can also monitor the algorithm performance at a
    macro level, by checking how many clients froze or turned off the recommender
    systems. If many clients turned off the recommender systems, that’s a strong indicator
    that they are not satisfied with the recommendation quality.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 除此之外，MarketCloud还可以通过检查多少客户冻结或关闭推荐系统来监控算法的宏观性能。如果许多客户关闭了推荐系统，这表明他们对推荐质量不满意的强烈指示。
- en: Closing Thoughts
  id: totrans-90
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结思考
- en: This use case is peculiar in the sense that MarketCloud built a sales platform
    that many other companies use to sell products, where the ownership of the data
    belongs to each company, and the data cannot be shared across companies. This
    brings a challenging situation where MarketCloud must create different recommender
    systems for each of the users instead of pooling all the data to create a universal
    recommendation engine.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 这个用例在某种意义上很特别，因为MarketCloud建立了一个销售平台，许多其他公司用来销售产品，其中数据的所有权归每家公司所有，不能在公司之间共享。这带来了一个具有挑战性的情况，即MarketCloud必须为每个用户创建不同的推荐系统，而不是汇集所有数据创建一个通用推荐引擎。
- en: MarketCloud can overcome this obstacle by creating a single pipeline into which
    data from many different companies can be fed. By having the data go through an
    automated recommendation engine training scenario, MarketCloud created many recommendation
    engines trained on different datasets. Good MLOps processes are what allow the
    company to do this at scale.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: MarketCloud可以通过创建一个单一的管道来克服这个障碍，将来自许多不同公司的数据输入其中。通过让数据经过自动化推荐引擎训练场景，MarketCloud创建了许多针对不同数据集训练的推荐引擎。良好的MLOps流程使公司能够在规模上做到这一点。
- en: It’s worth noting that though this use case is fictionalized, it is based on
    reality. The real-life team that tackled a similar project took around three months
    to finish. The team used a data science and machine learning platform to orchestrate
    the duplication of a single pipeline to four thousand copies and to automate the
    processes to feed corresponding datasets to each pipeline and train the models.
    Of necessity, they accepted trade-offs between the recommendation quality and
    scalability to efficiently launch the product. If the team had carefully crafted
    a custom recommendation engine for each of the four thousand pipelines by, for
    example, choosing the best algorithm for each client, the recommendation engines
    would have been of a higher quality, but they would have never been able to complete
    the project with such a small team in such a short period of time.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 值得注意的是，尽管这个用例是虚构的，但它基于现实。类似项目的真实团队花了大约三个月的时间完成。团队利用数据科学和机器学习平台编排复制单一管道到四千个副本，并自动化流程，将相应数据集输入到每个管道并训练模型。必要时，他们在推荐质量和可扩展性之间接受了权衡，以高效地推出产品。如果团队精心为这四千个管道中的每一个定制了推荐引擎，例如为每个客户选择最佳算法，推荐引擎将会质量更高，但他们将永远无法在如此短的时间内用如此小的团队完成这个项目。
- en: ^([1](ch10.html#ch01fn8-marker)) For an explanation of human-in-command design,
    see [Karen Yeung, “Responsibility and AI” (Council of Europe study, DGI(2019)05),
    64, footnote 229](https://oreil.ly/p5hJR).
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: ^([1](ch10.html#ch01fn8-marker)) 人类控制设计的解释，请参见[Karen Yeung，“责任与人工智能”（欧洲理事会研究，DGI(2019)05），第64页，脚注229](https://oreil.ly/p5hJR)。
