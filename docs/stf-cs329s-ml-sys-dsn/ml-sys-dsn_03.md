# 第三章：3 初步研究

### 本章涵盖

+   将来自各个领域的用例应用于给定问题

+   面对和解决选择合适解决方案时的“构建或购买”困境

+   问题分解

+   选择正确的创新程度

在第二章中，我们发现确定问题是在开发成功的机器学习（ML）系统中关键要素。你描述问题越好、越精确，构建一个能够高效满足商业目标的产品概率就越高。

现在我们将深入探讨几个关键方面，这些方面标志着设计一个全面高效的机器学习（ML）系统的下一个重要阶段——解决方案空间。本章将向您介绍更多关于寻找解决方案的内容，这些解决方案在过去帮助解决了类似问题，以及在我们未来系统的主要目标下，在构建我们的组件和购买第三方产品之间做出的始终艰难的选择，以及分解问题的正确方法，以及选择最佳的创新程度。

## 3.1 哪些问题可以激发你？

> 如果我能看得更远，那是因为我站在巨人的肩膀上。——艾萨克·牛顿

想象一下，你为像 Uber 或 Lyft 这样的出租车服务公司工作，并且存在一个已知的欺诈模式：一个合法的司机开始为公司工作，但后来他们将他们的账户转给了一个人，这个人不能成为司机（他们甚至可能完全没有有效的驾驶执照）。你的目标是通过对他们注册时上传的文件中的司机照片进行个人重新识别，提示司机从他们的车内自拍，并验证显示在驾驶执照上的人是同一个人。同时，存在非常合理的非功能性要求：为了隐私，你更愿意避免从他们的设备上传司机的照片到你的服务器。还有一个方面是验证应该足够快，并且能够抵抗各种对抗性攻击（欺诈者可能非常狡猾！）。

让我们根据这些信息总结这个案例：

+   该问题基于人脸识别。因此，作为一个系统设计师，你需要熟悉该领域。

+   解决方案应该以移动优先。因此，关于移动设备上的机器学习知识至关重要。

+   解决方案应该能够抵抗欺诈尝试（一个不诚实的司机可能会试图展示一个合法司机的照片而不是他们自己的脸）。因此，在活动检测方面的经验将很有用。

这些问题在行业中通常都能得到解决，但很少在单一解决方案中处理。以下是一些例子。大型监控系统（如机场安全所用的）进行大量的面部识别，但它们的计算能力很少受到限制，并且它们的推理不需要挤进手机。另一方面，许多消费娱乐应用在手机上运行推理，它们的开发者非常擅长在有限资源下运行模型。最后，活体检测通常应用于用于身份验证的生物识别系统（iPhone 上的 FaceID 是最常见的例子）。

经验无与伦比，所以如果你足够幸运，成功地解决了所有三个问题，那就大胆地去做吧。如果没有，我们建议你花时间查看各种机器学习领域的用例，因为开阔的视野是你的最佳朋友。你通常在职业生涯中的一年里无法与数十个生产级机器学习系统一起工作，但研究这么多用例是可行的，并且可以弥补经验的不足。

在设计系统时，回想一下类似的系统并将它们作为参考是有用的。你不必直接复制某些模式，但它们可以作为灵感。我们还建议你不要忽视失败的故事，因为它们可以成为你案例中要避免的提示。这种方法与我们在第四章将要讨论的反目标概念有些重叠。

如同在软件世界中经常发生的那样，至少有两个方面的相似性：领域方面和技术方面（如图 3.1 所示）。

![figure](img/CH03_F01_Babushkin.png)

##### 图 3.1 在寻找帮助你构建系统的解决方案时，这两个方面同等重要。

前者是指寻找在商业问题方面尽可能接近的系统；而后者，我们应该回想一下具有相似技术要求的系统（例如，平台、延迟、数据模型、数据量等）。

##### 阿尔谢尼的篝火故事

我曾经在一个制造优化公司从事图像分割问题。我的工作是找到装配线图像中的特定组件。这个问题是关于我需要的精度：它是亚像素级的。换句话说，我的系统在搜索极小物体时需要提供高度详细的结果。

制造数据的图像分割不是一个常见问题；你不能只是谷歌一下，然后从互联网上抓取第一个食谱。但在其他领域，如医学图像分析和照片/视频编辑中，细粒度分割很受欢迎，通常被称为图像合成。

如果你曾经尝试在 Zoom 应用中更改背景，你一定注意到了头发周围的伪影，这正是由于相关的算法远非完美（很可能是为了计算效率而优化，而不是精细的精度）。头发分割是图像合成的一个经典例子：从背景中区分头发很复杂，需要特定的技巧，比如尽可能避免图像下采样，并使用“软标签”——具有特定权重的既被标记为前景又被标记为背景的像素。

带着这种推理，我学习了关于图像合成最先进的方法，并将它们应用于我的制造数据，这最终显著降低了我的测试误差。

我们还鼓励你思考为什么某些决策会在系统设计和解决方案中被采纳。在设计和最终应用自己的直觉时，这些练习非常有价值，尤其是在设计复杂的机器学习系统时，包括解决这类困境的能力，比如是否从头开始构建或寻找现成的产品。

## 3.2 建立或购买：基于开源或专有技术的技术

想象一下，你为 Slack 工作，这是一个支持音频和视频对话的团队消息应用。它有一个功能：接近实时音频对话的语音识别。

但 Slack 最初被设计为一个以文本为主的通讯应用，可能使用语音对话的用户比例相当小。文本字幕的使用频率更低，因为这个功能默认未启用，其应用也相对有限。同时，对语音识别准确度的要求很高：如果质量不符合预期，这样的功能将毫无用处，甚至可能有害。

对非核心功能的高质量需求可能会促使你的功能团队在市场上寻找现成的解决方案。我们不能忽视 Slack 的规模：在 2019 年疫情高峰之前，它有 1200 万日平均用户。目前声称的数字已下降到 1000 万，但这仍然是一个令人印象深刻的数字。这意味着使用由供应商提供的第三方技术可能会花费太多，而启动一个内部、理想定制的解决方案将是最佳方案。你会选择哪条路？

### 3.2.1 建立或购买

与复杂的技术系统，包括机器学习系统相关的一个大困境通常被称为“建立或购买”。当问题熟悉时，找到已经作为服务销售的供应商解决方案的机会很大。让我们捕捉一下看待这个困境的主要角度。

问题是否与业务的核心理部分相关？专注于关键竞争优势并使用第三方服务来处理像基础设施这样的商品是一种常见的做法。十五年前，大多数公司都有专门的系统管理员，他们在数据中心管理大量服务器；如今，大多数公司从云服务器提供商那里租赁虚拟机。这是一个使用第三方服务来处理关键基础设施的例子，尽管如此，这并不是赢得市场的关键。尽管对于服务器基础设施至关重要的公司（例如，高频交易、广告技术或云游戏）存在例外，但这个领域仍然需要大量的研发投资。

许多公司使用第三方服务来解决与机器翻译、语音识别、反欺诈等问题相关的机器学习问题。将驾驶员的自拍照片与他们的驾照照片进行验证是委托给供应商的常见例子。

困境的另一个方面是经济方面。假设有一个供应商提供这个问题的解决方案，并且其服务在指标方面足够好，但合理的价格标准并未得到满足。也许你的公司在低成本生活区域（相应的薪资范围）招聘人才方面很出色，因此从头开始构建系统比使用第三方解决方案更便宜。如果一个供应商为加州的 VC 支持的初创公司提供合理的定价，并不意味着同样的价格对于在东欧或亚洲起步的公司仍然是合理的。

你可以切换到开源解决方案，但选择开源选项和购买选项之间可能并不明显。你不能说开源解决方案的成本为零，因为它的维护通常与与基础设施工作相关的隐藏成本以及潜在的解决问题的成本相关。另一方面，使用购买解决方案允许将许多这些问题委托给供应商，这意味着在坚持某个选项之前，你需要对潜在的花费进行初步估计。

还有一个方面虽然通常不会公开披露，但与这个困境仍然非常相关：职业主义。并非每个决策都是出于商业利益的考虑，公司越大，这种模式就越常见。因此，一些员工可能对推动“构建而非购买”的想法感兴趣，以实现具有重大影响的项目，从而为他们的晋升或简历添加一项华丽的成就。当然，我们并不支持这种解决构建或购买困境的方式，但由于这些情况在商业中并不罕见，我们不得不提及它们。

总体而言，构建或购买困境归结为几个关键因素，这些因素构成了你工作的背景。购买现成的解决方案意味着在开发上节省时间（如果你是一家初创公司，发布截止日期紧迫且严格，这可能是一个因素），并避免招聘在生产阶段可能不可或缺但软件发布后难以找到工作的额外专家。这也意味着你将获得一个经过测试、时间考验的平台。然而，在补丁或新版本发布方面，你将受到供应商日程的限制。构建自己的解决方案确保你控制着功能集、可扩展性和发布日历，并且可以在路上修复关键错误，而不依赖于供应商。但更高的控制权在其他方面需要更高的代价：你需要内部支持，并且肯定需要一个经验丰富的开发团队。

*我们建议选择“购买”，如果*

+   你选择更快的发布。

+   你没有专门的团队来开发/维护解决方案。

+   许多来自不同领域的公司对这个解决方案有很高的需求。

一定要寻找一个在市场上拥有良好声誉的稳定平台。*我们建议选择“构建”，如果*

+   你有足够的时间投入开发。

+   你更喜欢可扩展性和按需更新的灵活性，而不是固定的发布日历。

+   你可以承担内部支持的费用。

+   你需要的不是一个足够好的解决方案，而是一个尖端解决方案。

+   你有一大堆需要平滑集成的遗留系统。

+   你正在处理高度敏感的数据，无法依赖外包的信息安全，或者简单地受到关于与第三方共享数据的相关法律规定的限制。

此外，还有一个极其重要的预算因素，你不能忽视，但同时，它不能归因于任何先前的列表。这是因为预算可以影响你的决定，无论是向哪个方向。如果你开发自己的解决方案可能导致过度支出，你希望选择购买选项。另一方面，如果你预算范围内的任何现成解决方案都不合适，构建选项是你的选择。无论你的情况如何，预算都是一个关键因素，始终需要考虑。

让我们回到 Slack 的开篇示例。解决这一困境的一种方法是从供应商开始，确保客户认可其功能，突出主要使用场景，并根据收集到的信息启动内部解决方案。

*提醒：我们并不知道这个功能是如何实际实现的。这只是我们可能会采取的方法。*

构建与购买决策的比例往往会随着时间的推移而变化。例如，至少在 2010 年代，至少有 9 个自然语言问题需要一个非常定制的解决方案，但在 2020 年代，这些可以通过简单的大型语言模型（LLM）API 调用解决，这使得从头开始构建这样的模型吸引力大减。

### 3.2.2 基于开源或专有技术

在考虑的较低层面可能会出现另一个困境，那就是开源技术与企业级专有付费技术之间的选择。在某个时候，你需要决定使用什么数据库进行存储或什么推理服务器更合适。为了回答这个问题，你需要对非功能性要求（如所需正常运行时间、延迟、负载容忍度等）有广泛的知识。对于一个初步的近似，逻辑如下：当你确信不需要紧急求助专家时，安全的选择是使用开源解决方案。相反的情况是构建一个高负载、关键任务系统；在这种情况下，站在巨人的肩膀上，比如特定的供应商，通常是有意义的。也存在混合的情况——为开源解决方案购买企业级支持，有时这可能是一条合适的中间道路。

值得注意的是，这里列出的原则并非特定于 ML——事实上，当我们设计“常规”无 ML 软件时，几乎相同的推理也是适用的。

## 3.3 问题分解

在软件工程师的工具箱中，最有用的工具之一是“分而治之”的方法，这种方法在机器学习（ML）中非常适用，无论是在低级算法实现还是高级系统设计层面。当你面对一个看似在现有规模下无法解决的复杂问题时，这是你可以应用的第一件事。

问题分解的一个典型例子是搜索引擎设计。用户可以查询任何随机的词组，包括之前从未查询过的词组（大约 15%的 Google 搜索查询是新的），并在几百毫秒内获得相关结果。

在高层次上，搜索引擎实际上只做一件事，那就是快速从数据库中提供相关结果。让我们关注两个属性：相关性和速度。快速获取一个稍微相关的结果是否更容易？我们认为是这样：只需丢弃复杂的排名算法，用简单的“文档包含查询的一些单词”启发式方法来代替。使用这样的谓词扫描整个数据库是完全可行的。从一小部分文档（数千份，而不是数十亿份）中找到相关结果是否更容易？当然，在小规模上，我们可以应用复杂的 ML 算法和大型模型，尽管推理速度较慢。

我们打赌你已经猜到了我们想要引导的方向——是时候将那些步骤结合起来，构建一个两阶段系统了。第一阶段是快速候选过滤，第二阶段是在确定的候选者中进行更复杂的排名。这种方法在许多搜索引擎中已经使用了数十年。

这个例子可以进一步发展：除了候选过滤的一次迭代之外，还可能有多个迭代。因此，基于查询语言和用户位置，可以在候选过滤之前过滤掉其他语言的文档，从而减少下游需要处理的文档数量，如图 3.2 所示。

![figure](img/CH03_F02_Babushkin.png)

##### 图 3.2 问题分解的过程

在计算机视觉领域，类似的多步骤流水线非常流行：首先应用深度学习模型，后处理负责最终答案。另一个应用领域与文本和其他半结构化数据相关：一步提取结构化数据，然后这些结构化数据在下游使用更受限制的模型进行处理。

我们知道分解的六个原因：

+   *计算复杂度*—分解被应用于减少所需计算量（就像之前搜索引擎的例子中那样）。

+   *算法不完美*—在上一步骤中产生的错误会通过后续步骤进行调整。那些在机器学习理论方面较强的读者可能会回忆起与提升算法家族的一些相似之处。

+   *利用算法的优势同时避免其弱点*—例如，我们需要在图像上计数物体。一种方法是对回归问题训练一个卷积神经网络，但经典的卷积神经网络在设计上并不完美地满足这些需求（例如，池化层往往会丢失这类信息；参见图 3.3）。另一种方法是使用一个可以检测图像中物体的模型，并在其上使用经典的计算机视觉算法来计数前一步骤中的轮廓。由于归纳偏置，纯检测模型比端到端回归模型具有更好的泛化能力，并且后处理步骤是确定性和准确的。

![figure](img/CH03_F03_Babushkin.png)

##### 图 3.3 在池化层之后，合并了两个激活区域，从而失去了对物体计数问题至关重要的信息。

+   *数据融合需求*—机器学习解决方案不能直接从其他来源获取数据，因此运行一个模型，根据结果获取额外数据，并处理融合后的数据是一种流行的模式。最近对大型语言模型（LLM）应用的兴趣就是一个很好的例子：许多特定领域的 LLM 解决方案遵循检索增强生成模式，本质上就是从向量数据库中检索相关数据，并将这些输入作为提示的一部分提供给 LLM。

+   *处理边缘情况*—机器学习解决方案可能会失败，分解有助于早期解决问题。例如，一个简单的模型（或只是一系列条件检查）可以对输入进行评分，并在输入可能无效时引发错误。

+   **将不同的模型或逻辑应用于不同的数据子集**——**有可能模型对广泛的用户群体效果良好，但很难推广到整个用户基础。这导致了一个简单的想法，即根据简单的启发式方法（例如，为不同的地理区域提供不同的模型）将用户路由到不同的模型或系统路径。我们将在第十四章中分享更多关于这个问题的细节。

我们知道这个列表可能不完整，但这是我们职业生涯中遇到的最明显的六个原因。

有时，流程并不是从一开始就按照那种顺序设计的，添加步骤的想法可能是在进一步的改进中出现。但这可能不是最好的模式：逐个堆叠组件，试图覆盖最近揭示的前一步的问题，会导致一个非稳健的设计，这种设计容易出错且难以维护，因为它没有遵循单一的想法。另一方面，在初始设计和甚至第一次实现中留下占位符是完全可以接受的（“稍后会有基于模型的选择获取，但现在我们使用随机样本作为概念验证”）。

##### 阿尔谢尼的篝火故事

我在一家增强现实公司工作，该公司正在构建虚拟试穿解决方案。其中一款产品是鞋子试穿，一个检测视频流中脚部的应用程序，并渲染所选的鞋类。它需要结合多个算法构建，包括一个遮挡算法，该算法负责确定鞋子的哪一部分应该可见并渲染，以及哪一部分被帧中的物体遮挡。

在初始发布之前，这个解决方案的部分带来了许多麻烦；团队没有好的想法来以适当、可靠的方式实现它。在某个时候，公司的 CTO 接过了领导权，并提出了一种自己的算法，该算法解决了大多数情况下的问题。这个算法有许多缺点；它不够快，不太通用，其他团队成员难以理解，等等。但有一个很大的优点超过了所有这些——该算法在大多数情况下都有效！

![侧边栏图片](img/CH03_F04_Babushkin.png)

##### 基于机器学习的解决方案示例，仅在相机能够捕捉到真实鞋子的区域渲染鞋子

CTO 的算法是早期设计和实施的一部分，并成为早期产品发布的有价值部分。后来，团队开发了一种完全不同的方法，主要解决了旧方法的缺点，由于设计得当，它不需要进行重大更改。整个流程中只有一步被替换为一种更先进的方法，这提高了后续版本的整体体验。

机器学习系统的设计原则正受到该领域最近趋势的影响。在过去，构建包含许多小型、顺序组件的流水线是常见的做法。然而，随着深度学习模型的兴起，趋势转向了端到端单一模型的方法。这种方法有可能捕捉到数据中更复杂的关系，因为它们不受人工设计假设和限制的约束，需要较少的领域知识，并减少了步骤之间的错误积累。

语音处理是端到端方法如何改变设计的一个很好的例子。在端到端之前，文本到语音（TTS）模型通常包括两个主要组件：一个处理文本输入并将其转换为语音原子，如音素、重音和语调模式，另一个使用预定义的规则或统计模型将语言信息映射到声波，以合成人类语音。

另一方面，端到端 TTS 模型不依赖于作为中间表示的显式语言信息。相反，它们使用单个神经网络模型直接将文本输入映射到音频波形。

虽然端到端模型取得了成功，但它们本身无法包含知识，并且通常需要使用数据库来处理许多应用。

最近，LLMs 如 GPT-4 实现了令人印象深刻的零样本性能，这意味着它们可以直接回答问题，而无需任何额外的输入或训练。然而，这些 LLMs 计算成本高昂，容易产生幻觉（即，将错误信息作为真实信息呈现；参见“自然语言生成中幻觉的概述”，[`arxiv.org/abs/2202.03629`](https://arxiv.org/abs/2202.03629)，以获取更广泛的背景），并且它们的知识是隐含的，不能直接修改。

目前正在进行研究，寻找将大型语言模型（LLMs）的优点与使用可维护的外部信息源的能力相结合的方法。例如，Bing AI 和 ChatGPT 插件([`openai.com/blog/chatgpt-plugins`](https://openai.com/blog/chatgpt-plugins))以类似于人们使用搜索引擎的方式使用额外的在线资源，而 Meta AI 的 Galactica([`galactica.org/`](https://galactica.org/))是第一个引入工作记忆令牌概念的，这允许模型生成可以由解释器执行的 Python 代码片段，以提供精确的答案。这些想法在 Toolformer([`arxiv.org/abs/2302.04761v1`](https://arxiv.org/abs/2302.04761v1))模型中得到了进一步的发展，这是一个专门训练以使用各种第三方 API 的模型。类似的想法也反映在快速增长的开放源代码框架 LangChain([`python.langchain.com/api_reference`](https://python.langchain.com/api_reference))中。虽然这些方法尚未在生产系统中得到广泛应用，但它们有潜力改变机器学习系统的分解方式。

根据它们的复杂性和新颖程度，机器学习系统可能意味着各种创新水平。一些竞争领域需要巨大的研究投资；在其他领域，你可以使用一个非常基础的机器学习解决方案。让我们找出如何定义你需要为你的系统达到的创新水平。

## 3.4 选择适当的创新程度

向任何机器学习系统的利益相关者提出这样一个简单的问题：最终产品应该有多好（即多准确）？最常见的回答通常是“完美”、“100%”和“尽可能好”。但让我们试图弄清楚这些简单而含糊其辞的回答背后是什么。

答案“尽可能好”隐含地意味着“一旦我们满足其他约束条件。”最明显的约束是时间和预算。他们是否希望在 10 年内拥有一个完美的机器学习系统？很可能不是。下一个季度末发布的“可接受的良好”系统更好吗？很可能，是的。

我们将在第五章中详细阐述对“足够好”和“完美”之间差异的精确理解。但在设计过程刚刚开始的最早期阶段，确切的指标并不重要。重要的是有一个粗略的理解。

通过我们创建、维护和改进具有多种规模和目标的机器学习系统的经验，我们确定了三个不同级别的完美要求，所有系统都可以在这些级别之间分配。术语可能有所不同，但据我们看来，这些是最合适的：

+   可行的最小机器学习系统

+   平均人类水平的机器学习系统

+   最佳级别的机器学习系统

一个可行的最小系统可能是一个非常简陋的解决方案，胶带是关键粘合元素。这样的系统期望是“它基本上是可行的”，观察者将能够检测到各种故障模式。这样的系统被认为是基线和原型；不期望有任何创新。

人类水平的表现设定了一个特定的标准。许多现有的成功机器学习系统甚至还没有达到人类水平的表现，但对公司来说仍然有价值。因此，我们可以认为达到这种表现水平需要相当的研究和创新。

最后，是最佳级别的类别。一些系统在没有击败大量竞争对手时几乎毫无用处——这在像交易或广告技术或全球产品如搜索引擎这样的超级竞争领域尤为常见。准确性的微小变化可能造成数百万的利润或损失，在这种情况下，机器学习系统被设计成以实现可能达到的最佳结果为目标。

我们为什么在这里讨论创新？问题空间和解决方案空间之间的桥梁强烈依赖于我们从一开始就假设的创新水平。在“最小可行系统”桶中，我们完全没有创新——我们只是使用我们知道的简单且最快的解决方案并继续前进。在光谱的另一端，我们得到的是无尽的创新，系统永远不会准备好，团队总是在寻找新的改进措施以在下一个版本中实施。

在这三个桶之间分配问题将是一个非常强大的技术，但有一个重要的因素我们不能忽视：所需创新水平不是静态的。在许多情况下——尤其是在初创公司中——事物尽可能地以最简化的形式构建，以便以后升级。这是有道理的：公司首先评估功能是否被客户（或内部用户）需要，然后根据客户反馈来改进系统。如果一个发布的功能在市场上独一无二，即使其最简化的实现也能带来巨大的价值，竞争对手会立即着手改进自己的产品。这会将初始系统从第一个桶移动到第二个桶，甚至更接近最前沿的联盟。许多初创公司面临着这种过渡的问题，而设计一个可以从原型演变为世界级宝石的系统（这是工程的艺术）的案例极为罕见。这种艺术的简化版本是设计一个可以在尽可能保留现有构建块的同时重建的系统，这是一个相当高的目标。

### 3.4.1 哪些解决方案可能是有用的？

了解你所需要的创新水平以及系统的某些高级结构，你可以在较低层次上寻找实现想法。当这一章节正在准备时，有五个流行的信息来源可以深入研究。

#### arXiv

arXiv ([`arxiv.org/`](https://arxiv.org/)) 是一个主要在科学、技术、工程和数学学科中分发学术论文的网站。数学和计算机科学，包括其子学科，占那里发布的超过两百万篇论文的很大一部分。

arXiv 是了解你问题学术观点的好地方。除了阅读与你关键词相关的一切之外，我们鼓励你使用引用和链接机制：一旦你找到一篇相关论文，你可能会对它提到的旧论文和新引用它的论文感兴趣。arXiv 是一个独特的生态系统——有浏览器扩展和额外的网站可以帮助你的搜索。一个好的开始是寻找概述论文（标题中通常包含“调查”）：通常它们包含关于该主题的正确提炼的智慧。

仅就其本身而言，arXiv 作为知识来源可能显得有些过于原始：几乎不可能阅读所有新论文，而且其搜索机制从现代角度来看有些原始。在 arXiv 之上，有多个流行的工具简化了探索。目前，我们推荐 [`arxivxplorer.com/`](https://arxivxplorer.com/)，这是一个基于论文摘要的现代搜索引擎，尽管在本书出版时，可能会有另一个花哨的工具（之前最受欢迎的附加组件是 [`arxiv-sanity-lite.com/`](https://arxiv-sanity-lite.com/)）。

#### Papers with code

如您所料，Papers with Code ([`paperswithcode.com/`](https://paperswithcode.com/)) 是一篇学术机器学习相关论文的汇编，这些论文都附有代码形式的实现。论文按主题分组，并在可能的情况下按性能排名。

您可以找到来自学术界的最接近的问题，并查看解决该问题的前 N 篇论文，它们的指标，一些元信息（例如，这种方法是否需要额外的数据？），以及——非常重要的一点——指向公开实现的链接。对于更喜欢仓库而不是正式学术写作的人来说，这个网站是一个真正的变革者。

#### GitHub

一旦我们提到了代码实现，就不可避免地要提到 GitHub ([`github.com`](https://github.com))。GitHub 是最受欢迎的开源软件平台，拥有任何场合的仓库。其缺点在于其规模：如果您在那里寻找不常见的东西，您实际上是在沙堆里找针。

GitHub 并不专门针对机器学习领域，但与此同时，大多数开源机器学习项目都位于那里。

#### Hugging Face

Hugging Face 模型中心 ([`huggingface.co/models`](https://huggingface.co/models)) 是一个主要平台，分享了许多模型和数据集。在撰写本文时，该中心包含超过 560,000 个公开可用的机器学习模型。分类和标签工作非常精确，其中很大一部分模型提供了小型交互式基于网络的演示，以展示其功能。

Hugging Face 公司最初专注于自然语言处理（NLP），该平台一直是分享以 NLP 为导向的模型的主要平台。如果您正在解决一个包含文本处理的机器学习问题，我们建议您去那里寻找与研究相关的模型。

#### Kaggle

Kaggle ([`kaggle.com`](https://kaggle.com)) 是最受欢迎的竞争性机器学习平台。组织使用该平台举办挑战赛，吸引世界上最优秀的机器学习实践者争夺奖金和荣耀。在比赛中，参与者分享与给定挑战相关的想法和代码片段。比赛结束时，获胜者和领导者通常会揭示他们的秘密。除了比赛，Kaggle 还作为多个数据集的托管网站，因此找到与您问题相关的公共数据集的机会很大。

Kaggle 是这份列表中最出色的作品，原因有很多。如果一个比赛组织得不好，问题可能就有些表述不清：竞争者可能不会解决实际问题，而是试图寻找捷径，比如数据泄露。此外，最终解决方案通常在现实中不适用：模型过于庞大，因为延迟限制可能被忽略。最后，代码片段通常不够整洁：参赛者追求快速迭代，而不是长期维护。

尽管有所有这些缺点，Kaggle 论坛仍然可以为你提供关于问题的详尽概述，包括学术论文和可能后来成为学术主流的黑客风格代码。值得一提的是，还有一些网站汇总了最佳的 Kaggle 解决方案，例如 [`farid.one/kaggle-solutions/`](https://farid.one/kaggle-solutions/)。

我们想强调的是，目前阶段还不需要基于这项研究来选择解决方案。它应该为你提供更多关于背景的细节，使你的决策过程更加可靠。

### 3.4.2 在解决方案空间中工作：实际案例

让我们用一个详细的例子来重申上一节提到的要点。想象一下，你加入了一家股票摄影公司。这个业务实际上是一个市场：摄影师加入平台并上传他们的照片，而寻找特定图像用于说明目的的客户（编辑、设计师、广告专业人士）购买这些照片的版权。这个市场通过销售佣金赚钱。公司非常希望在其网站上创建一个有效的搜索系统。

从一个角度来看，照片库非常庞大，拥有数百万张图片。当客户寻找照片时，他们通常对某些特定内容感兴趣，而简单的分类或其他天真分类法很难找到。因此，你被雇佣来构建一个现代搜索工具，能够根据客户的文本查询找到最相关的照片。你应该如何理解这个问题的背景？

首先出现的是“建造还是购买”的问题。让我们假设你认为像你这样的规模的公司通常会设计自己的解决方案，但情况并不总是如此。一些侦察工作可能是合适的。你可以很容易地发现许多供应商——既包括大型企业也包括年轻初创公司——提供搜索引擎作为服务。当你尝试寻找这些服务时，很多解决方案可能会变得不相关——你的公司需要一个基于文本查询的图像搜索引擎，这并不是最受欢迎的模式。尽管如此，仍有一些技术提供商提出了相关的建议，所以让我们记住它们。

首先，让我们考虑其他公司解决类似问题的情况：

+   当然，还有其他照片库，其中一些可能已经构建了很好的搜索引擎。他们很少会公开他们的引擎是如何构建的细节（你可以挖掘一些博客文章或会议演讲），但并非没有。

+   有像 Google 和 Bing 这样的通用搜索引擎。显然，你需要的是一个规模非常不同的系统——你需要处理数百万张图片，而它们处理的是数十亿张。在这里，你可能会说，“如果我的团队规模是 N 倍小，我该如何复制这样的巨头？”当然，在容量方面，没有人可能在与“大玩家”竞争，但你不需要这样做，因为你的主要目标将是找到满足你解决方案需求的想法，而不是多一行代码。

+   与前一点截然相反，你可以找到一些面向消费者的项目，它们可以帮助分类个人照片收藏。它们可能还没有准备好处理数百万张图片，但可能只有几千张。好处是其中一些是开源的，所以你可以直接深入代码以获取灵感。

+   最后，还有一些非虚拟商品市场——例如，销售衣服、家具等等。其中一些是像亚马逊这样的巨头，而另一些则是面向利基市场，甚至比你的公司还要小。他们的业务很大程度上依赖于搜索质量，但他们的商品不仅仅是图像，而且通常有更多的属性（它们可能是文本描述或卖家信息）。这些搜索引擎使用关于物品的更多信息，而不仅仅是视觉信息；在机器学习领域，我们称它们为多模态。

搜索引擎是信息检索学科中最受欢迎的应用之一。其从业者早期就采用了许多机器学习方法，但并没有局限于仅使用机器学习方法。对于那些对领域不太自信的人来说，从维基百科开始，对学科进行高层次的了解（或刷新记忆）可能是合适的。在了解更多关于信息检索的知识后，你可以通过阅读更多关于图像检索的内容来进一步深入。

当你在阅读有关构建搜索引擎的文档时，你肯定会看到一种分解模式：正如在许多搜索引擎中一样，在你的场景中，并不是每份文档都应该被排名。从一开始，用户就可以指定要求：例如，照片应提供为原始文件（而不是压缩的 JPEG 文件），宽度至少为 5,000 像素，且价格不超过 50 美元。这些条件可以迅速将搜索候选者从数百万缩小到数万，而我们根本没有触及图像和查询语义。这种优化将非常有价值，并可能成为你未来设计的基石。

另一件你可以发现的事情是，在底层，大多数搜索引擎实际上只做一件事。它们为用户查询和潜在相关项目（文档）对计算相关性分数，并根据这个分数对项目进行排名（见图 3.4）：

```py
relevancy = f(encode_text(query), encode_image(item)) 
```

![figure](img/CH03_F05_Babushkin.png)

##### 图 3.4 基于给定查询的相关性，搜索引擎如何对图像进行排名的分解

在我们场景的情况下，这引发了许多开放性问题：

+   函数`f`可以是哪种算法家族？

+   你如何编码查询（文本）和项目（图像）？

+   你如何衡量相关性？

+   你如何将用户反馈纳入系统中？

每个问题都很广泛，值得单独一本书（或者至少是多个章节）来探讨，因此，为了简洁起见，我们仅建议在深入研究我们之前提到的信息来源时，应牢记这些问题，从 arXiv 到 Kaggle。

下一个问题是你所寻求的创新程度。这里有几个想法：

+   公司已经有一个非常基础的搜索技术。它已经过时，并且经常产生不相关的结果，但总比没有搜索要好。

+   公司的业务可以从良好的搜索中受益。目前，由于搜索结果不佳，许多用户无法找到他们想要的，因此他们离开网站并转向竞争对手。适当的搜索质量阻碍了公司其他方面的努力：如果新用户可能因为找不到所需内容而流失，那么推出大规模营销活动有什么意义呢？

+   预算非常有限。同时，在项目首次成功之后，有很好的机会会有新的研发资金流入。

第一个观点清楚地表明，最基本的可行产品在这里不适用，因为你已经有了。同时，有限的预算意味着你最初不能追求最先进的技术解决方案。因此，你需要设计一个在有限预算和进一步改进选项下的稳固系统。

在本章中，我们涵盖了您编写设计文档准备过程中最重要的要素。您现在知道如何分解问题，哪些外部和内部因素将影响您对构建或购买困境的应对方式，哪些在线资源最有帮助，以及如何决定您的解决方案应具有的创新程度。

所有这些知识不仅将成为您编写系统设计文档的基础，而且还将帮助您理解是否最初就需要一个机器学习系统。最后一点可能听起来很有趣，甚至具有争议性，因此我们将在下一章中尝试对其进行详细阐述（以及许多其他内容）。

## 摘要

+   寻找市场上可以完全或部分满足您需求解决方案。如果找到了，请自问系统中哪些部分可以使用这些解决方案。

+   定义系统的整体视图。尽量将其绘制成三到五个非技术主管都能理解的块。

+   建设或购买困境可能会成为在构建自己的组件和购买第三方产品之间做出选择的决定性因素。为了妥善处理它，考虑各种内部和外部因素，包括可用时间和所有涉及团队的能力。

+   检查潜在因素列表，这些因素指向分解的必要性。如果你正在解决的问题符合其中任何一个，那么它很可能也需要被分解。

+   可能会有强烈的诱惑去交付一个尖端的产品；然而，你需要问自己你准备好为了创新而投资于系统了吗，以及这种投资是否首先会得到回报。

+   不要犹豫，通过流行的在线聚合器浏览，以找到你可以作为解决方案参考案例的使用案例。
