# 前言

自 2017 年在斯坦福教授第一门机器学习课程以来，许多人向我寻求在他们的组织中部署 ML 模型的建议。这些问题可能是泛泛的，比如“我应该使用什么模型？”“我应该多久重新训练我的模型？”“如何检测数据分布的变化？”“如何确保训练期间使用的特征与推断期间使用的特征一致？”

这些问题也可以是具体的，例如：“我确信从批处理预测切换到在线预测将提升我们模型的性能，但如何说服我的经理让我这么做？”或者“我是公司里资历最老的数据科学家，最近被委托建立我们的第一个机器学习平台；我应该从何开始？”

我对所有这些问题的简短回答总是：“这要看情况。”我的长篇回答通常涉及数小时的讨论，以了解提问者的出发点、他们实际想要实现的目标，以及不同方法在其具体用例中的利弊。

ML 系统既复杂又独特。它们复杂是因为它们由许多不同的组件组成（ML 算法、数据、业务逻辑、评估指标、基础设施等），并涉及许多不同的利益相关者（数据科学家、ML 工程师、业务领导、用户，甚至是整个社会）。ML 系统之所以独特，是因为它们依赖于数据，而数据在不同的用例中变化极大。

例如，两家公司可能属于同一领域（电子商务），并且面临着希望 ML 解决的同样问题（推荐系统），但是它们的 ML 系统可能具有不同的模型架构，使用不同的特征集，评估不同的指标，并带来不同的投资回报。

许多关于 ML 生产的博客文章和教程都专注于回答一个具体的问题。尽管这种专注有助于传达观点，但可能会给人一种错觉，即可以孤立地考虑每一个问题。事实上，一个组件的变化很可能会影响其他组件。因此，在做出任何设计决策时，必须考虑整个系统。

本书对 ML 系统采取了全面的方法。它考虑了系统的不同组成部分以及涉及的不同利益相关者的目标。本书内容使用实际案例进行了说明，其中许多案例我个人参与过，受到了充分的参考和 ML 从业者（无论是学术界还是行业界）的审阅。需要对某个特定主题有深入了解的部分（例如批处理与流处理的比较、存储和计算的基础设施以及负责任的 AI）还经过了专家的审阅。换句话说，本书试图对上述问题以及更多问题给出细致入微的答案。

当我首次撰写为本书奠定基础的讲座笔记时，我认为我是为我的学生准备未来作为数据科学家和 ML 工程师的工作需求。然而，我很快意识到我在这个过程中也学到了很多。我与早期读者分享的初稿引发了许多对话，测试了我的假设，迫使我考虑不同的视角，并向我介绍了新问题和新方法。

我希望这个学习过程现在能够继续进行，因为这本书现在在您手中，您有独特的经验和观点。请随时通过[MLOps Discord 服务器](https://discord.gg/Mw77HPrgjF)（我管理的地方，您也可以在那里找到其他这本书的读者）、[Twitter](https://twitter.com/chipro)、[LinkedIn](https://www.linkedin.com/in/chiphuyen)或其他可以在我的[网站](https://huyenchip.com)找到的渠道与我分享对这本书的任何反馈。

# 本书适合对象

本书适合任何想利用 ML 解决实际问题的人。本书中的 ML 指的是深度学习和经典算法，侧重于中型到大型企业和快速增长的初创企业中看到的 ML 系统。规模较小的系统往往较不复杂，可能从本书中提出的全面方法中受益较少。

因为我的背景是工程学，所以这本书的语言面向工程师，包括 ML 工程师、数据科学家、数据工程师、ML 平台工程师和工程经理。您可能能够与以下情景之一相关联：

+   您已经面临一个业务问题和大量原始数据。您希望对这些数据进行工程处理，并选择正确的指标来解决这个问题。

+   初始模型在离线实验中表现良好，并且您希望将它们部署。

+   模型部署后，您对其表现几乎没有反馈，希望找到一种快速检测、调试和解决生产中可能遇到的任何问题的方法。

+   开发、评估、部署和更新团队模型的过程大部分是手动、缓慢且容易出错的。您希望自动化和改进这个过程。

+   您组织中的每个 ML 使用案例都使用其自己的工作流部署，并希望建立可以跨用例共享和重复使用的基础设施（例如模型存储、特征存储、监控工具）。

+   您担心您的 ML 系统可能存在偏见，希望使您的系统负责任！

如果您属于以下任何一组，您也可以从本书中受益：

+   想要确定 ML 生产中未满足的领域并找出如何将您的工具定位在生态系统中的工具开发人员。

+   在行业中寻找与 ML 相关角色的个人。

+   考虑采用 ML 解决方案以改进产品和/或业务流程的技术和业务领导者。对技术背景不强的读者来说，阅读第一章、第二章和第十一章可能最有益。

# 本书不是什么

本书不是 ML 的入门书籍。有许多关于 ML 理论的书籍、课程和资源可供参考，因此本书避开这些概念，专注于 ML 的实际应用方面。具体而言，本书假设读者对以下主题有基本理解：

+   *ML 模型*，例如聚类、逻辑回归、决策树、协同过滤以及包括前馈、循环、卷积和变压器在内的各种神经网络架构

+   *ML 技术*，例如监督与无监督、梯度下降、目标/损失函数、正则化、泛化和超参数调优

+   *度量指标*，例如准确率、F1 值、精确率、召回率、ROC 曲线、均方误差和对数似然

+   *统计概念*，如方差、概率和正态/长尾分布

+   *常见的 ML 任务*，例如语言建模、异常检测、物体分类和机器翻译

您不必对这些主题了如指掌——对于那些确切定义可能需要一些记忆力的概念，例如 F1 分数，我们包含了简短的参考注释，但您应该对它们的含义有一个大致的了解。

虽然本书提到当前的工具来说明某些概念和解决方案，但它并不是一个教程书籍。技术在不断演进。工具迅速兴起和过时，但解决问题的基本方法应该更持久一些。本书为您提供了一个框架，帮助您评估适合您用例的工具。当您需要使用某个工具时，通常很容易在网上找到教程。因此，本书几乎没有代码片段，而是专注于围绕权衡、利弊和具体示例进行大量讨论。

# 浏览本书

本书的章节安排反映了数据科学家在进行 ML 项目生命周期时可能遇到的问题。前两章奠定了 ML 项目成功的基础，从最基本的问题开始：你的项目是否需要 ML？它还涵盖了选择项目目标以及如何以更简单的方式框定问题的内容。如果您已经熟悉这些考虑因素并且迫不及待地想要了解技术解决方案，可以跳过前两章。

第四章到第六章章涵盖了机器学习项目的部署前阶段：从创建训练数据和工程特征到在开发环境中开发和评估模型。这个阶段尤其需要对机器学习和问题领域的专业知识。

第七章到第九章章涵盖了机器学习项目部署和后部署阶段。我们将通过一个许多读者可能能够理解的故事来学习，即部署模型并不意味着部署过程的结束。部署的模型将需要监控并持续更新以适应不断变化的环境和业务需求。

第三章和第十章专注于为不同背景的利益相关者提供必要的基础设施，以便共同交付成功的机器学习系统。第三章专注于数据系统，而第十章专注于计算基础设施和机器学习平台。我曾经对是否深入讨论数据系统问题和在书中引入数据系统的时机进行了长时间的讨论。数据系统，包括数据库、数据格式、数据移动和数据处理引擎，在机器学习课程中往往涉及不足，因此许多数据科学家可能认为这些内容较低级或不相关。在与许多同事的讨论后，我决定因为机器学习系统依赖于数据，早期涵盖数据系统的基础知识将有助于我们就数据问题达成一致，以便在书的其余部分讨论数据事务。

虽然本书涵盖了机器学习系统的许多技术方面，但是机器学习系统是由人构建的，为人服务的，并且可能对许多人的生活产生巨大影响。在没有一章讨论其人性化方面的情况下写一本关于机器学习生产的书是不完整的，这是第十一章的重点，也是最后一章。

注意，“数据科学家”是一个在过去几年中发展迅速的角色，已经有很多讨论确定这个角色应该包括什么——我们将在第十章中详细讨论其中的一些内容。在本书中，我们使用“数据科学家”作为一个总称，包括所有从事开发和部署机器学习模型的人员，包括可能被称为机器学习工程师、数据工程师、数据分析师等的人。

# GitHub 仓库和社区

本书附带一个[GitHub 仓库](https://oreil.ly/designing-machine-learning-systems-code)，其中包含：

+   对基本机器学习概念的回顾

+   本书使用的参考文献列表和其他高级、更新的资源

+   本书中使用的代码片段

+   可以用于解决工作流中可能遇到的某些问题的工具列表

我还在[ML 运维 Discord 服务器](https://discord.gg/Mw77HPrgjF)上运营，鼓励大家讨论和提问有关本书的问题。

# 本书使用的约定

本书使用以下排版约定：

*斜体*

表示新术语、网址、电子邮件地址、文件名及文件扩展名。

`等宽字体`

用于程序清单，以及段落内部用于引用程序元素，如变量或函数名、数据库、数据类型、环境变量、语句和关键字。

###### 注意

此元素表示一般性注释。

###### 警告

此元素表示警告或注意事项。

# 使用代码示例

正如提到的那样，补充材料（代码示例、练习等）可以在[*https://oreil.ly/designing-machine-learning-systems-code*](https://oreil.ly/designing-machine-learning-systems-code)下载。

如果您有技术问题或在使用示例代码时遇到问题，请发送电子邮件至*bookquestions@oreilly.com*。

本书旨在帮助您完成工作。一般情况下，如果本书提供示例代码，您可以在自己的程序和文档中使用它。除非您复制了大部分代码，否则无需取得我们的许可。例如，编写一个使用本书多个代码片段的程序不需要许可。销售或分发 O’Reilly 书籍中的示例代码需要许可。通过引用本书并引用示例代码回答问题无需许可。将本书大量示例代码整合到您产品的文档中需要许可。

我们感谢，但通常不需要署名。署名通常包括书名、作者、出版商和 ISBN。例如：“*设计机器学习系统*，作者 Chip Huyen（O’Reilly 出版）。版权所有 2022 年 Huyen Thi Khanh Nguyen，978-1-098-10796-3。”

如果您认为您使用的示例代码超出了合理使用范围或上述许可，请随时与我们联系*permissions@oreilly.com*。

# O’Reilly 在线学习

###### 注意

40 多年来，[*O’Reilly Media*](https://oreilly.com)为公司提供技术和业务培训、知识和见解，帮助它们取得成功。

我们独特的专家和创新者网络通过书籍、文章和我们的在线学习平台分享他们的知识和专业知识。O’Reilly 的在线学习平台为您提供按需访问的实时培训课程、深入的学习路径、交互式编码环境，以及来自 O’Reilly 和其他 200 多家出版商的大量文本和视频。有关更多信息，请访问[*https://oreilly.com*](https://oreilly.com)。

# 如何联系我们

请将有关本书的评论和问题发送至出版商：

+   O’Reilly Media, Inc.

+   1005 Gravenstein Highway North

+   Sebastopol, CA 95472

+   800-998-9938（美国或加拿大）

+   707-829-0515（国际或本地）

+   707-829-0104 (传真)

我们为这本书制作了一个网页，列出了勘误、示例和任何额外信息。您可以访问这个页面：[*https://oreil.ly/designing-machine-learning-systems*](https://oreil.ly/designing-machine-learning-systems)。

通过邮件*bookquestions@oreilly.com*评论或询问有关这本书的技术问题。

获取有关我们的书籍和课程的新闻和信息，请访问[*https://oreilly.com*](https://oreilly.com)。

在 LinkedIn 上找到我们：[*https://linkedin.com/company/oreilly-media*](https://linkedin.com/company/oreilly-media)

在 Twitter 上关注我们：[*https://twitter.com/oreillymedia*](https://twitter.com/oreillymedia)

Watch us on YouTube: [*https://youtube.com/oreillymedia*](https://youtube.com/oreillymedia)

# 致谢

这本书花了两年时间来写作，而在此之前还花了更多的时间来准备。回顾过去，我对获得的大量帮助感到同样惊讶和感激。我尽力在这里列出帮助过我的每一个人的名字，但由于人类记忆的固有缺陷，我无疑忽略了许多人。如果我忘记包括你的名字，请知道这并不是因为我不欣赏你的贡献，请友善地提醒我，以便我尽快纠正！

首先，我要感谢帮助我开发课程和书籍材料的课程工作人员：Michael Cooper，Xi Yin，Chloe He，Kinbert Chou，Megan Leszczynski，Karan Goel 和 Michele Catasta。我要感谢我的教授 Christopher Ré和 Mehran Sahami，没有他们，这门课程本来不会存在。

我要感谢一大群审稿人，他们不仅给予了鼓励，而且通过许多方面改进了这本书：Eugene Yan，Josh Wills，Han-chung Lee，Thomas Dietterich，Irene Tematelewo，Goku Mohandas，Jacopo Tagliabue，Andrey Kurenkov，Zach Nussbaum，Jay Chia，Laurens Geffert，Brian Spiering，Erin Ledell，Rosanne Liu，Chin Ling，Shreya Shankar 和 Sara Hooker。

我要感谢所有阅读过早期版本并给了我改进书籍意见的读者，包括 Charles Frye，Xintong Yu，Jordan Zhang，Jonathon Belotti 和 Cynthia Yu。

当然，这本书离不开 O’Reilly 的团队，特别是我的开发编辑 Jill Leonard，以及我的制作编辑 Kristen Brown，Sharon Tripp 和 Gregory Hyman。我要感谢 Laurence Moroney，Hannes Hapke 和 Rebecca Novack，他们帮助我将这本书从构思变成了提案。

这本书，毕竟，是我职业生涯至今学到的无价之宝的积累。我要感谢我的极其能干和耐心的同事们，以及前同事们，他们分别来自 Claypot AI，Primer AI，Netflix，NVIDIA 和 Snorkel AI。我曾与每一位合作过的人都学到了关于推动机器学习走向世界的新知识。

特别感谢我的联合创始人徐振中，在我们的初创公司解决问题并允许我花时间写作这本书。还要感谢卢克，无论我的目标有多么雄心勃勃，你总是全力支持我。
