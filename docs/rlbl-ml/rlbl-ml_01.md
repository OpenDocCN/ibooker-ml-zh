# 前言

这不是一本关于机器学习工作原理的书籍。这是一本关于如何让机器学习为您工作的书籍。

机器学习（ML）的工作方式非常迷人。围绕和支持 ML 的数学、算法和统计见解本身就很有趣，当它们应用于正确的数据时，所能实现的效果简直像是魔法一般。但是我们在本书中做了一些不同的事情。我们不是*算法*导向，而是*整体系统*导向。简而言之，我们谈论除了算法以外的一切内容。许多其他作品详细介绍了 ML 算法部分，但这本书有意专注于 ML 的整个生命周期，给予了它在其他地方并没有真正获得的时间和关注。

这意味着我们谈论了在正确和负责任地引导数据、可靠的模型构建、确保顺畅（且可逆）的生产路径、更新安全性以及关于成本、性能、业务目标和组织结构的担忧中涉及的混乱、复杂和偶尔令人沮丧的工作。我们试图涵盖让 ML 在您的组织中可靠发生的一切内容。

# 为什么写这本书

我们坚定地相信至少一些炒作：ML 和 AI 技术目前以加速的速度重塑着计算和社会。在某些方面，公众炒作还没有跟上私人现实的步伐。¹ 但我们也足够理性和经验丰富，了解到许多真实世界的 ML 系统实际上是多么令人难以信赖和有问题。技术媒体写着太空飞行，而大多数组织仍然难以保持自行车的稳定性；这些仍然是早期阶段。现在正是积极关注 ML 能够做什么以及您的组织如何从中受益的完美时机。

尽管如此，我们认识到许多组织担心错过 ML 以及它对组织可能带来的影响。好消息是，没有必要恐慌——现在就可以开始，并且可以明智和有纪律地处理与 ML 相关的工作，以成功地平衡义务和回报。坏消息是，许多组织之所以担心的原因在于复杂性曲线非常陡峭。一旦您超越了较简单的方面，许多技术和技术正在刚刚被发明，很难找到一个坚实的、铺好的道路。

本书应该帮助您应对这种复杂性。我们认为，尽管行业尚不成熟，但专注于简单性和标准化仍有很多收获，这种方法有助于更容易上手。最终，深度整合机器学习到业务中的组织将会受益——有些甚至很大程度上²——但当然，他们需要一定的复杂度来理解如何达成这一点。一个简单、标准化的基础将有助于比临时实验或者更糟糕的是一个虽然有效但没人知道如何及为何有效的系统更好地发展这种能力。

# 作为 ML 的 SRE 视角

已经存在大量的机器学习书籍，其中许多承诺以某种方式改进您的机器学习之旅，通常集中于使其更容易、更快速或更高效。然而，很少有书籍谈及如何使机器学习更*可靠*，这一属性经常被忽视或低估。³ 这正是我们关注的内容，因为通过这一视角看待如何优化机器学习具有特定的好处，其他方式所无法得到。事实上，当前的最佳实践并不直接适用于从头到尾做好机器学习的挑战。相反，通过站点可靠性工程（SRE）的视角——全面、可持续地，以客户体验为中心地看待这些问题——是更好的框架，以理解如何应对这些挑战。

您可以在[*构建安全可靠系统*](https://oreil.ly/bpErx)（Heather Adkins 等著，O’Reilly，2020）中找到类似的论证。一个不可靠的系统往往会被攻击者利用为系统访问的入口——安全性和可靠性密切相关。做好其中一个很难脱离另一个。同样，机器学习系统因其意外行为和间接但深远的相互关系，促使我们采用更全面的方法来决定如何整合开发、部署、生产运营和长期维护。

简而言之，我们认为，机器学习系统的*可靠性*捕捉了顾客、业务所有者和员工真正希望从中获得的要点。

# 预期读者群

我们写作的对象是希望将机器学习应用于现实世界并在组织中产生影响的任何人。因此，本书适合数据科学家和机器学习工程师，适合软件工程师和站点可靠性工程师，以及组织决策者，甚至是非技术人员，尽管本书的部分内容相当技术性：

数据科学家和机器学习工程师

我们将探讨数据、特征和模型架构的选择如何改变您的模型运行方式，以及从长远来看如何管理它们，所有这些都是为了提升模型的速度。

软件工程构建机器学习基础设施或将机器学习集成到现有产品中

我们不仅解决了如何将机器学习整合到系统中，还解决了如何编写机器学习基础设施的问题。更好地理解机器学习生命周期如何有助于开发功能、设计应用程序接口（API）并支持客户。

网站可靠性工程师

我们将展示机器学习系统通常出现的故障以及如何最好地构建（和管理）它们，以避免这些故障模式。我们还将探讨机器学习模型质量不是完全可以被可靠性工程师忽视的影响。

希望将机器学习添加到其现有产品或服务中的组织领导者

我们将帮助您了解如何最好地将机器学习整合到您现有的产品和服务中，以及所需的结构和组织模式。在做出与机器学习相关的决策时，理性评估风险和优势是重要的。

所有对开发和部署机器学习的道德、法律和隐私影响感到合理关注的人士

我们将清晰地阐述问题，并指出在这些问题导致对用户或组织造成损害之前，您可以采取的实际步骤。

有一点可能反直觉的是：许多章节对那些不是该章节主题的人可能更有价值。例如，第二章当然可以被数据科学家和机器学习工程师阅读。但对基础设施/生产工程师和组织领导者来说，它可能更有用。对于前一组，当然，对您已经在工作的内容进行微调是有用的，但对于后者来说，它可以为可能全新的主题领域提供一个新鲜而完整的介绍。

# 本书的组织结构

在我们详细讨论书籍结构之前，让我们提供有关我们如何选择主题及其组织的更广泛背景。这可能不是您所期望的。

## 我们的方法

工程师需要采用特定的方法和技术来使机器学习系统运行良好。但是，一旦在特定组织和特定目的中实施了这些方法，每种方法都会面临大量的决策。本书不可能覆盖读者通常会面临的所有或大多数实施选择。同样地，我们将减少对特定软件片段的具体建议。我们希望通过与日常工作的分离来更清晰地表达观点，但对于这种类型的书籍来说，保持平台不可知是有益的。

## 让我们开始吧！

尽管我们不时使用其他示例，但我们用来说明本书内容的主要方法是一个假想的在线商店——一个通过名为*yarnit.ai*的网站销售纺织用品的商家。这个概念在整本书中都有详细阐述，以展示一个阶段（比如数据获取或规范化）的选择对整个技术栈、业务等的影响。

这家店铺是一个单一的、相对简单的业务（购买编织和钩针产品，将它们放在网站上，并向客户进行市场营销和销售）。这显然不能完全反映出真实世界中使用机器学习的各个行业的复杂性，如制造业、自动驾驶汽车、房地产营销和医疗技术。然而，我们的例子提供了足够的洞察力（并管理了范围），使我们认为我们在这里处理的实施复杂性能够为其他领域提供可应用的教训。（换句话说，我们相信我们的例子的局限性是值得的。）

为了更深入地探讨这个例子，让我们考虑一个零售商从大量供应商采购产品，并在网站上全球销售给公众的情况。业务是吸引并维持一个购买产品、以合理利润覆盖网站运营成本并实现利润的客户群体。从某些方面来看，这是一个相当简单的业务，但复杂性几乎立即体现出来，尤其是在我们尝试添加机器学习时。在高层次上，我们关注的是提高销售、改善客户体验、降低成本、提高利润率以及使整个业务运作更加高效。

虽然最初将机器学习技术引入业务运营通常是出于狭隘和具体的目标，比如提高效率，但这并不是终点。机器学习有可能从根本上积极或消极地改变业务，改变产品的创建和选择方式、客户的识别和服务方式以及商业机会的发现方式。成功部署这些技术的采用机器学习的企业在长期内将超过竞争对手；一项由麦肯锡进行的针对超过 2,000 名高管的最新调查显示，63%的高管的机器学习/人工智能项目改善了底线，尽管组织通常对具体的改善幅度保持缄默。但在短期内，采用必须从“提高转化率”等具体而可理解的目标开始。

我们的网站*yarnit.ai*有许多数据来源可以实施这些初步、具体的改进和许多机器学习的潜在应用。首先，我们将考虑客户面向的例子，例如推荐（客户可能喜欢的其他产品）和预测（对于特定客户，哪些产品最有可能销售）。然后我们将转向更多在幕后的应用，例如机器学习可能被用来优化整个业务流程。具体来说，我们将通过几个例子展示机器学习如何改进我们的运营，尽管当然不限于这些需求：

网站搜索结果

客户应该在他们的搜索查询中获得最佳排名，显示出最符合这些术语并且他们最有兴趣购买的产品。

发现和建议

客户应该有机会考虑与他们正在查看或购买的产品相关的其他产品。我们可以找到可能有很高使用可能性的产品，因此被购买。

动态定价

我们应该识别那些销售速度不如预期的产品，并降低它们的价格，以清理仓库空间。同样地，如果我们对极受欢迎的产品库存紧张，我们可能需要暂时提高它们的价格以减缓销售并赚取更多利润，同时可能需要订购更多库存。

购物车遗弃

是什么促使客户将商品加入购物车但没有完成购买？我们能预测吗？有没有办法学习如何通过提醒、适时的折扣或其他提高结账完成率的功能进行干预？

库存和订购自动化

我们可能希望利用机器学习来预测如何从供应商那里订购替换产品，基于未来销售的预测和预计的交货延迟。

信任和安全

这是一个行业通用术语，用于检测可能的欺诈行为——在这种情况下，尝试的购买行为，并根据需要增加验证步骤。手动审查和启发式方法不会扩展，因此求助于机器学习是合理的选择。

边际改善

我们可以使用各种技术来试图提高每次销售的利润——从在顾客购物时建议额外高利润产品，到进行营销活动以创造更多对最高利润产品的需求。

这些只是机器学习可能被试验的一些明显场所，以确定其是否为增加的复杂性和成本带来的价值。明确地说：机器学习并不总是成功的，即使它成功了，它也不一定值得麻烦。建立一个具有严格数据格式、重要工程和专业生产操作要求的复杂管道是一个成本高昂的工作，需要为客户和业务带来明显和确定的价值。维护成本也相当可观。对于你的组织来说，所有这些努力可能都不值得。这本书将帮助你理解是否值得。

像我们的毛线商店这样的组织应该以开放的心态，但愿意实验、测量，并可能在不起作用时取消应用机器学习。这就是为什么在对商店网站基础设施进行不可逆变更之前计划评估成功概率至关重要。

为了完整起见，我们需要说，显然这只是可能发现机器学习用途的一种组织和应用的单一示例。

## 导读本书

我们从介绍和一般原则开始。在这里，相对于机器学习（或者机器学习在生产中）的新手可以对整个问题空间进行定位。这也是我们涵盖影响所有后续章节的关键主题的地方，如数据管理，什么是机器学习模型，如何评估其质量，特征是什么（以及为什么你会在意），以及公平性和隐私问题。

接下来，我们关注机器学习模型及其生命周期。我们解释了模型是如何创建（称为*训练*）和在生产中使用（称为*服务*）的。我们概述了了解您的模型在开发和运行时正在做什么以及如何做到这一点的重要性。在本节的最后，我们讨论了持续机器学习的问题：模型*持续*更新，以反映不断调整的现实。

最后，我们涉及了一个复杂的问题，即机器学习如何被引入到组织中，以及在这种情况下它们会发生什么变化。我们从具体的例子开始介绍机器学习在事件响应领域的复杂性，我们期望每个负责生产的工程师都能理解。我们探讨了关于组织如何将机器学习整合到现有（和新兴）产品中的一些关键问题，这通常是一个需要提前深思熟虑的过程。然后我们看看机器学习在组织中如何实施：集中化、分布式以及介于两者之间的各种点，接着在下一章提出了具体的指南和建议。最后，我们以全球组织中实施机器学习的真实案例结束。

经过所有这些，首先，你应该休息一下——但第二，你应该有充分的准备去理解你第一次进行机器学习时或者在你已经有经验的情况下，在你的组织内部如何精细化其工作中可能遇到的一切。

# 关于作者

这本书的作者们共同拥有数十年在生产环境中构建和运行各种类型机器学习系统的经验。我们参与过大规模广告定向系统的产品化；建立过大型搜索与发现系统；在机器学习在生产中的开创性研究上有过贡献；并构建和运行了围绕它们的关键数据摄入、处理和存储系统。我们共同亲眼见证了这些系统在各种惊人而迷人的方式下可能发生故障。但好消息是，我们学会了如何构建对机器学习系统最常见故障模式具有弹性的系统——无论是技术上还是组织上。

# 本书使用的惯例

本书使用以下排印惯例：

*Italic*

指示新术语、网址、电子邮件地址、文件名和文件扩展名。

`Constant width`

用于程序清单，以及段落内引用程序元素，如变量或函数名称、数据库、数据类型、环境变量、语句和关键字。

**`Constant width bold`**

显示应由用户直接输入的命令或其他文本。

*`Constant width italic`*

显示应由用户提供值或根据上下文确定的值的文本。

###### 提示

此元素表示提示或建议。

###### 注意

此元素表示一般性注释。

###### 警告

此元素表示警告或注意事项。

# 致谢

作者们想借此机会感谢以下人士。

我们还要集体感谢本书的以下贡献者：Ely M. Spears，在本书的许多章节中提供了宝贵的技术和结构反馈，谢谢您帮助这本书变得更好。Robbie Sedgewick 也提供了类似的反馈，以及在我们觉得写的内容可能不会引起普通读者共鸣时的鼓励。James Blessing 迅速审阅了多个章节，并提供了有益的反馈，帮助我们改进。我们还受益于 Andrew Ferlitsch、Ben Hutchinson、Benjamin Sloss、Brian Spiering、Chenyu Zhao、Christina Greer、Christopher Heiser、Daniel H. Papasian、David J. Groom、Diego M. Oppenheimer、Goku Mohandas、Herve Quiroz、Jeremy Kubica、Julian Grady、Konstantinos (Gus) Katsiapis、Lynn He、Michael O’Reilly、Parker Barnes、Robert Crowe、Salem Haykal、Shreya Shankar、Tina H. Wong、Todd Phillips 以及 Vinsensius B. Vega S. Naryanto 细致、周到的审阅。最后，也要感谢我们在 O’Reilly 的团队：John Devins、Mike Loukides、Angela Rufino、Ashley Stussy、Kristen Brown 和 Sharon Wilkey。

## Cathy Chen

感谢我的伴侣 Morgan，在我需要周末或晚上工作时一直给予爱的支持。我责怪 Todd 把我拉入这个项目，但不仅要感谢他在这个项目中的出色领导，还要感谢他给我一个很好的工作场所。感谢所有的合著者和我们那些出色的志愿者们，他们在审阅、编辑、评论以及帮助我们改进这本书方面做出了重要贡献。

## Niall Richard Murphy

我将这本书献给在书写期间去世的人们。在写作这本书的时候——甚至在我将它写下来的时候，我仍然很难相信——我们都经历了全球流行病、欧洲的选择性战争以及许多政治、个人和职业事件，虽然我常常希望不是这样，但这场暴风雪似乎没有停下的迹象。因此，在此我想追忆我的父亲的继母 Winifred，她于 2020 年因 COVID-19 不幸离世，以及我在 2021 年在贝尔法斯特去世的姑姑 Esther Gray，她备受想念。在我们身边仍然健在的人中，我要感谢我母亲 Kay Murphy，她是我所能拥有的最好的母亲，在黑暗时期是一束光明的道德光芒，还有我的妻子 Léan 和我的孩子们 Oisín 和 Fiachra。自从上一次感谢部分以来，Oisín 成为了国家 U19 象棋冠军，Fiachra 的艺术作品也被收录在另一本书中，他们的父亲会永远为他们感到骄傲。最后，我还要感谢 Todd Underwood 本人，他在同样艰难的时期展现出了持续的幽默领导力。这个项目的存在归功于他，超过其他任何人。我学到了很多，发现自己知道的比想象中多，但很多我学到的东西都是从他那里学到的。

## Kranti Parisa

我将这本书献给所有在 COVID-19 危机中的一线和必要工作者，他们是我们的英雄。他们对工作和人类的无比奉献真是鼓舞人心。我要感谢所有合著者和贡献者，因为他们的非凡承诺和耐心。特别感谢 Todd Underwood——你是这本书背后的伟大灵感来源。我要感谢我的朋友 Dave Rensin，让我参与这个了不起的机会，并激励我与世界分享我在大规模构建 ML 系统方面的知识和经验。最后，感谢我的父母，特别是我的母亲 Nagarani，我的妻子 Pallavi，我的小公主 Sree，以及我的朋友们，感谢他们不断的爱和支持。

## D. Sculley

我要感谢我的杰出合著者和许多教给我的同事们——与我一起经历了所有的生产火灾和棘手问题。我的妻子 Jessica 和女儿 Sofia 依然是我做任何事情的灵感来源。

## Todd Underwood

我将这本书献给我的家人，他们在我写作时要么受益，要么为我长时间的缺席买单。Beth、Ágatha 和 Beatrix：我不认为你们会读到这些，但我希望你们终于为我完成了这本书感到高兴。我也将它献给我的兄弟 Adam，在一场大流行中去世，我没有像希望的那样经常见到他。最后，也要感谢我的合著者们，在这个看似永远无法完成的项目中坚持不懈。我希望我们在这里做了一些有价值的事情——一些有用的，我们可以为之感到自豪的事情。

¹ 参见 [“AI 和机器学习实践中的 27 个令人惊讶的例子”](https://oreil.ly/ITkPX)，Bernard Marr 提供的例子可能会让你感到惊讶。这篇 2018 年的福布斯文章在机器学习领域已经是古老的历史，而行业在多个行业和应用领域持续扩展。目前有着无数不合理的机器学习/AI 炒作，但同时也有更多实际有效的应用涉足比大多数人认识到的更多行业。

² 参见谷歌云报告 [“机器学习的商业影响”](https://oreil.ly/eWgDg)，这段摘录或许是最大的原因：“标准的机器学习项目在首年实施后的投资回报率通常在两到五倍之间。”

³ 或者换个角度说，关于如何构建一个机器学习模型的材料很多，但是关于如何构建一个机器学习*系统*的却很少。一个模型的可靠性问题可能与系统有所不同。
